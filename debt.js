!function e(n,t,r){function a(i,c){if(!t[i]){if(!n[i]){var u="function"==typeof require&&require;if(!c&&u)return u(i,!0);if(o)return o(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var l=t[i]={exports:{}};n[i][0].call(l.exports,function(e){var t=n[i][1][e];return a(t?t:e)},l,l.exports,e,n,t,r)}return t[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(e,n,t){"use strict";function r(e){e.setPrefix("debtApp")}function a(e){var n=["action","alert","content","navigation"],t=u.map(n,function(e){var n="svg-sprite-"+e+".svg";return{filePath:"resources/icons/"+n,spriteName:e}});u.each(t,function(n){e.iconSet(n.spriteName,n.filePath)})}function o(e){e.aHrefSanitizationWhitelist(/^(blob||https?):/)}function i(e,n,t){e.$state=n,e.$stateParams=t}var c=e("angular");e("angular-material"),e("angular-route"),e("angular-ui-router"),e("angular-local-storage"),e("ng-mfb"),e("ng-file-upload");var u=e("lodash");c.module("debtApp",["ngMaterial","ui.router","LocalStorageModule","ng-mfb","ngFileUpload"]).constant("events",{BALANCE_SHEET_UPDATED:"balance sheet updated"}).constant("debtCalculationInterval",500).value("debounce",u.debounce).config(r).config(a).config(o).run(i),e("./debt-app-ctrl"),e("./route-config"),e("./debts"),e("./balance-sheet"),e("./persons"),e("./expenses"),e("./utils"),r.$inject=["localStorageServiceProvider"],a.$inject=["$mdIconProvider"],o.$inject=["$compileProvider"],i.$inject=["$rootScope","$state","$stateParams"]},{"./balance-sheet":5,"./debt-app-ctrl":7,"./debts":10,"./expenses":15,"./persons":18,"./route-config":21,"./utils":25,angular:"angular","angular-local-storage":"angular-local-storage","angular-material":"angular-material","angular-route":"angular-route","angular-ui-router":"angular-ui-router",lodash:"lodash","ng-file-upload":"ng-file-upload","ng-mfb":"ng-mfb"}],2:[function(e,n,t){"use strict";function r(e,n,t,r){function a(){o(),r.$on(t.BALANCE_SHEET_UPDATED,u.refresh)}function o(){u.balanceSheet=e.balanceSheet,u.debtsByDebtor=i()}function i(){if(u.balanceSheet.isBalanced()){var e=u.balanceSheet.getNonSettledParticipations(),t=n.computeDebts(e);return n.organizeByDebtor(t)}return void 0}function c(){r.$emit(t.BALANCE_SHEET_UPDATED)}var u=this;u.init=a,u.refresh=o,u.updateSheet=c,a()}var a=(e("lodash"),e("angular"));a.module("debtApp").controller("BalanceSheetCtrl",r),r.$inject=["balanceSheetService","debtService","events","$scope"]},{angular:"angular",lodash:"lodash"}],3:[function(e,n,t){"use strict";function r(e){function n(){var n=e.get("balanceSheetData");try{u.balanceSheet=new o(n),u.error=void 0}catch(t){u.error=t}}function t(){if(!u.balanceSheet)throw u.error;try{u.balanceSheet.throwErrorIfInvalid()}catch(n){throw u.error=n,n}e.set("balanceSheetData",u.balanceSheet.exportData()),u.error=void 0}function r(e){var n=a.fromJson(e);u.balanceSheet=new o(n),t()}function i(){var e=u.balanceSheet.exportData();return a.toJson(e)}function c(){u.balanceSheet=new o,u.save()}var u={balanceSheet:void 0,error:void 0,save:t,loadFromJson:r,exportToJson:i,createNew:c,init:n};return u.init(),u}var a=(e("lodash"),e("angular")),o=e("./balance-sheet");a.module("debtApp").factory("balanceSheetService",r),r.$inject=["localStorageService"]},{"./balance-sheet":4,angular:"angular",lodash:"lodash"}],4:[function(e,n,t){"use strict";var r=e("lodash"),a=(e("angular"),e("simple-decimal-money")),o=function(e){function n(){return r.filter(w,function(e){return!e.expense.settled})}function t(){return r.reduce(P,function(e,n){return e&&(n.settled||n.isBalanced())},!0)}function o(e){return r($).find(function(n){return n.id==e})}function i(e,n){e=r.extend({name:"Person "+($.length+1)},e),n=r.extend({},n),void 0===e.id&&(e.id=D,D+=1);var t=new h(e);return $.push(t),n.createParticipations===!0&&r.each(P,function(e){e.settled||(d({person:t,expense:e}),e.shareCost())}),t}function c(e){e=o(e.id),e&&(r.remove($,function(n){return n.equals(e)}),r.forEach(e.getParticipations(),function(e){p(e)}))}function u(e){return r(P).find(function(n){return n.id==e})}function s(e,n){e=r.extend({name:"Expense "+(P.length+1),sharing:"equal",settled:!1},e),n=r.extend({},n),void 0===e.id&&(e.id=D,D+=1);var t=new v(e);return P.push(t),n.createParticipations===!0&&r.each($,function(e){d({person:e,expense:t})}),t}function l(e){e=u(e.id),e&&(r.remove(P,function(n){return n.equals(e)}),r.forEach(e.getParticipations(),function(e){p(e)}))}function f(e){var n=new b(e);return r(w).find(function(e){return n.equals(e)})}function d(e){if(f(e))throw"Duplicate participation";e=r.extend({paid:0,share:0},e);var n=new b(e);return w.push(n),n.expense.shareCost(),n}function p(e){e=f(e),e&&(r.remove(w,function(n){return n.equals(e)}),e.expense.shareCost())}function h(e){function n(){return d.value().toNumber()}function t(){return p.value().toNumber()}function o(){return 0===v.value().toNumber()}function i(){return v.value().toNumber()}function c(){return l.value()}function u(e){return e instanceof h&&e.id===s.id}var s=this;r.extend(s,e),s.equals=u,s.getCost=n,s.getSumOfShares=t,s.getBalance=i,s.isBalanced=o,s.getParticipations=c;var l=r.chain(w).filter(function(e){return s.equals(e.person)}),f=l.filter(function(e){return!e.expense.settled}),d=f.filter(function(e){return!e.expense.settled}).map("paid").reduce(function(e,n){return e.add(n)},new a(0)),p=f.map("share").reduce(function(e,n){return e.add(n)},new a(0)),v=f.map(function(e){return new a(e.share).subtract(e.paid)}).reduce(function(e,n){return e.add(n)},new a(0))}function v(e){function n(){return p.value().toNumber()}function t(){return h.value().toNumber()}function o(){return 0===b.value().toNumber()}function i(){return b.value().toNumber()}function c(){return d.value()}function u(){"equal"===f.sharing&&s()}function s(){var e=f.getParticipations();if(0!==e.length){var n=new a(f.getCost()),t=n.divideBy(e.length),o=n.subtract(t.multiply(e.length-1));r.forEach(e,function(n,r){r<e.length-1&&(n.share=t.toNumber())}),r.last(e).share=o.toNumber()}}function l(e){return e instanceof v&&e.id===f.id}var f=this;r.extend(f,e),f.getCost=n,f.getSumOfShares=t,f.getBalance=i,f.isBalanced=o,f.getParticipations=c,f.shareCost=u,f.equals=l;var d=r.chain(w).filter(function(e){return f.equals(e.expense)}),p=d.map("paid").reduce(function(e,n){return e.add(n)},new a(0)),h=d.map("share").reduce(function(e,n){return e.add(n)},new a(0)),b=d.map(function(e){return new a(e.share).subtract(e.paid)}).reduce(function(e,n){return e.add(n)},new a(0))}function b(e){function n(e){return e instanceof b&&t.expense.equals(e.expense)&&t.person.equals(e.person)}var t=this;if(!e||!e.person||!e.expense)throw"Undefined participation";r.extend(this,e),this.equals=n}function m(){var e=r.negate(r.isFunction),n=r.pick(A,e);return n.persons=r.map($,function(n){return r.pick(n,e)}),n.expenses=r.map(P,function(n){return r.pick(n,e)}),n.participations=r.map(w,function(e){return{personId:e.person.id,expenseId:e.expense.id,paid:e.paid,share:e.share}}),n}function g(e){D=r([]).concat(e.persons).concat(e.expenses).pluck("id").max()+1,D==-(1/0)&&(D=1);var n={persons:!0,expenses:!0,participations:!0};r.extend(A,r.pick(e,function(e,t){return!n[t]})),r.each(e.persons,function(e){i(e)}),r.each(e.expenses,function(e){s(e)}),r.each(e.participations,function(e){var n=o(e.personId),t=u(e.expenseId);d({person:n,expense:t,paid:e.paid,share:e.share})}),S()}function x(){try{return S(),!0}catch(e){return!1}}function S(){r.each($,function(e){if(!r.isNumber(e.id))throw new E("Person has no id")}),r.each(P,function(e){if(!r.isNumber(e.id))throw new E("Expense has no id")});var e={};r.each($,function(n){e[n.id]=n}),r.each(P,function(n){e[n.id]=n}),r.each(w,function(n){if(!n.person)throw new E("Participation has no person");if(!e[n.person.id])throw new E("Participation person is unknown");if(!n.expense)throw new E("Participation has no expense");if(!e[n.expense.id])throw new E("Participation expense is unknown")})}function E(e){this.message=e}var A=this,$=[],P=[],w=[],D=1;A.name="New sheet",A.persons=$,A.expenses=P,A.participations=w,e&&g(e),A.getNonSettledParticipations=n,A.isBalanced=t,A.getPerson=o,A.createPerson=i,A.removePerson=c,A.getExpense=u,A.createExpense=s,A.removeExpense=l,A.getParticipation=f,A.createParticipation=d,A.removeParticipation=p,A.exportData=m,A.isValid=x,A.throwErrorIfInvalid=S};n.exports=o},{angular:"angular",lodash:"lodash","simple-decimal-money":"simple-decimal-money"}],5:[function(e,n,t){"use strict";e("./route-config"),e("./balance-sheet"),e("./balance-sheet-service"),e("./balance-sheet-ctrl")},{"./balance-sheet":4,"./balance-sheet-ctrl":2,"./balance-sheet-service":3,"./route-config":6}],6:[function(e,n,t){"use strict";function r(e){e.state("balanceSheet",{url:"/",templateUrl:"balance-sheet/balance-sheet.html",controller:"BalanceSheetCtrl as vm"})}var a=e("angular");a.module("debtApp").config(r),r.$inject=["$stateProvider"]},{angular:"angular"}],7:[function(e,n,t){"use strict";function r(e,n,t,r,a,o,i,c,u,s,l,f){function d(){u("main-menu").toggle()}function p(){l.$on(i.BALANCE_SHEET_UPDATED,n(h,t)),P.refresh()}function h(){P.refresh(),P.errorMessage||P.save()}function v(){try{e.save(),P.errorMessage=void 0}catch(n){P.errorMessage="Cannot save: "+n.message}}function b(){P.balanceSheet=e.balanceSheet,P.errorMessage=e.error?"Invalid sheet: "+e.error.message:void 0}function m(){r().then(function(n){e.balanceSheet.createPerson(n.person,n.options),h(),l.$broadcast(i.BALANCE_SHEET_UPDATED)})}function g(){a().then(function(n){e.balanceSheet.createExpense(n.expense,n.options),h(),l.$broadcast(i.BALANCE_SHEET_UPDATED)})}function x(){c.show(w).then(function(){e.createNew(),h(),s.go("balanceSheet"),l.$broadcast(i.BALANCE_SHEET_UPDATED),P.mainMenu.toggle()},function(){P.mainMenu.toggle()})}function S(e){if(e&&e.length){if(!o.isSupported())return void(P.errorMessage="File operations not supported in this browser. Please consider a more modern browser.");var n=e[0];o.readAsText(n).then(function(e){E(e)})["catch"](function(){P.errorMessage="Unable to read file"})["finally"](function(){P.mainMenu.toggle()})}}function E(n){e.loadFromJson(n),h(),s.go("balanceSheet"),l.$broadcast(i.BALANCE_SHEET_UPDATED)}function A(){if(!o.isSupported())return void(P.errorMessage="File operations not supported in this browser. Please consider a more modern browser.");var n=e.exportToJson();try{o.saveAsFile([n],e.balanceSheet.name+".txt")}catch(t){P.errorMessage="Error when saving file"}P.mainMenu.toggle()}function $(){c.show({templateUrl:"help.html",controller:["$scope","$mdDialog",function(e,n){e.close=function(){n.hide()}}]}),P.mainMenu.toggle()}var P=this;P.mainMenu={toggle:d},P.init=p,P.createPerson=m,P.createExpense=g,P.createNewSheet=x,P.loadSheet=S,P.exportSheet=A,P.save=v,P.refresh=b,P.showHelp=$;var w=c.confirm().title("Create new sheet").content("The current sheet will be discarded. Please consider exporting it first. Continue?").ok("Ok").cancel("Cancel");p()}{var a=e("angular");e("lodash")}a.module("debtApp").constant("balanceSheetSaveInterval",500).controller("DebtAppCtrl",r),r.$inject=["balanceSheetService","debounce","balanceSheetSaveInterval","openCreatePersonDialog","openCreateExpenseDialog","fileService","events","$mdDialog","$mdSidenav","$state","$scope","$log"]},{angular:"angular",lodash:"lodash"}],8:[function(e,n,t){"use strict";function r(e){function n(n){return e(n)}function t(e){var n=[],t={};return a.forEach(e,function(e){var r,a=t[e.debtor.id];void 0===a&&(a=n.length,r={debtor:e.debtor,debts:[]},n.push(r),t[e.debtor.id]=a),r=n[a],r.debts.push({creditor:e.creditor,amount:e.amount})}),a.forEach(n,function(e){e.debts.sort(function(e,n){return e.creditor.name.localeCompare(n.creditor.name)})}),n.sort(function(e,n){return e.debtor.name.localeCompare(n.debtor.name)}),n}return{computeDebts:n,organizeByDebtor:t}}var a=e("angular");a.module("debtApp").factory("debtService",r),r.$inject=["solveDebts"]},{angular:"angular"}],9:[function(e,n,t){"use strict";function r(e){function n(e){if(!e||0===e.length)return[];var n=t(e);if(!r(n))return[];var a=c(n),o=u(a),i=l(o),s=d(i,a);return s}function t(e){var n={};return a.forEach(e,function(e){var t=n[e.person.id];void 0===t&&(t={person:e.person,balance:new o(0)},n[e.person.id]=t);var r=new o(e.paid),a=new o(e.share);t.balance=t.balance.add(a.subtract(r))}),a.forEach(n,function(e){e.balance=e.balance.toNumber()}),n}function r(e){var n=!1;return a.forEach(e,function(e){0!==e.balance&&(n=!0)}),n}function c(e){var n=[],t=[];return a.forEach(e,function(e){e.balance<=0?t.push(e):n.push(e)}),{debtors:n,creditors:t}}function u(e){for(var n=e.debtors.length,t=e.creditors.length,r=[],a=0;n>a;a++)r[a]=new o(e.debtors[a].balance).multiply(100).toNumber();for(var a=0;t>a;a++)r[n+a]=new o(e.creditors[a].balance).multiply(-100).toNumber();for(var i=s(n+t,n*t),a=0;n>a;a++)for(var c=a*t;(a+1)*t>c;c++)i[a][c]=1;for(var a=n;t+n>a;++a)for(var c=a-n;n*t>c;c+=t)i[a][c]=1;return{A:i,b:r}}function s(e,n){for(var t=[],r=0;e>r;r++){t[r]=[];for(var a=0;n>a;a++)t[r][a]=0}return t}function l(n){var t=e(n),r=t.numberOfVariables,o=t.numberOfFreeVariables;if(0===o)return t.xVector;var c=i.engines.mt19937();c.seed(20150312);var u;do{for(var s=a.copy(n.A),l=n.b,d=[],p=0;r>p;p++)d[p]=p;u=[];for(var p=0;o>p;p++){var h=i.integer(0,d.length-1)(c);u.push(d[h]),d.splice(h,1)}for(var p=0;p<s.length;p++)for(var v=0;v<u.length;v++)s[p][u[v]]=0;t=e({A:s,b:l})}while(!f(t.xVector));return t.xVector}function f(e){if(!e)return!1;for(var n=0;n<e.length;n++)if(e[n]<0)return!1;return!0}function d(e,n){for(var t=[],r=0;r<e.length;r++)if(0!==e[r]){var a=Math.floor(r/n.creditors.length),i=r-n.creditors.length*a,c=new o(e[r]).divideBy(100).toNumber(),u={debtor:n.debtors[a].person,creditor:n.creditors[i].person,amount:c};t.push(u)}return t}return n}var a=e("angular"),o=e("simple-decimal-money"),i=e("random-js");a.module("debtApp").factory("solveDebts",r),r.$inject=["solveLinearSystem"]},{angular:"angular","random-js":"random-js","simple-decimal-money":"simple-decimal-money"}],10:[function(e,n,t){"use strict";e("./lin-eq-solver"),e("./lin-eq-solver-factory"),e("./debt-solver"),e("./debt-service")},{"./debt-service":8,"./debt-solver":9,"./lin-eq-solver":12,"./lin-eq-solver-factory":11}],11:[function(e,n,t){"use strict";function r(){return a}var a=e("./lin-eq-solver"),o=e("angular");o.module("debtApp").factory("solveLinearSystem",r)},{"./lin-eq-solver":12,angular:"angular"}],12:[function(e,n,t){"use strict";function r(e){function n(){if(!e||!e.A||!e.b)throw"Null matrix A or vector b in system Ax = b";if(e.A.length<1||e.A[0].length<1)throw"Matrix A in Ax = b has no rows or no columns";if(e.A.length!=e.b.length)throw"The dimensions of the matrix and the constant vector are incompatible"}function t(){f=i(e.A),d=o(e.b),h=f.length,v=f[0].length,g=[];for(var n=0;h>n;n++)g[n]=n;S=[];for(var n=0;h>n;n++){S[n]=0;for(var t=0;v>t;t++){var r=Math.abs(f[n][t]);r>S[n]&&(S[n]=r)}}x=[];for(var t=0;v>t;t++)x[t]=t}function r(){for(var e=0,n=[];h-1>e;){for(var t=0,r=e,a=e;h>a;++a){var o=g[a],i=x[e],c=Math.abs(f[o][i]/S[o]);c>t&&(t=c,r=a)}if(0===t){var u=x[e];n[u]=!0;for(var a=e,s=u;s==u&&v-1>a;)++a,n[x[a]]||(s=x[a]);if(s!=u){x[e]=s,x[a]=u;continue}return}var l=g[e];g[e]=g[r],g[r]=l;var p=g[e],b=x[e];for(a=e+1;h>a;++a){for(var o=g[a],m=f[o][b]/f[p][b],E=e+1;v>E;++E){var A=x[E];f[o][A]=f[o][A]-m*f[p][A]}f[o][b]=0,d[o]=d[o]-m*d[p]}e++}}function c(){var e;for(e=Math.min(h,v)-1;e>0;--e){var n=g[e],t=x[e];if(0!==f[n][t])for(var r=e-1;r>-1;--r){for(var a=f[g[r]][x[e]]/f[g[e]][x[e]],o=0;v>o;++o)f[g[r]][x[o]]-=a*f[g[e]][x[o]];d[g[r]]-=a*d[g[e]]}}for(e=0;e<Math.min(h,v);++e)if(0!==f[g[e]][x[e]]){for(var i=f[g[e]][x[e]],o=0;v>o;++o)f[g[e]][o]=f[g[e]][o]/i;d[g[e]]=d[g[e]]/i}}function u(){b=0;var e,n;e:for(n=0;v>n;++n){for(e=0;h>e;++e){if(e!=n&&0!==f[g[e]][x[n]])break e;if(e==n&&1!=f[g[e]][x[n]])break e}++b}}function s(){for(var e=!0,n=b;h>n;++n)if(0!==d[g[n]]){e=!1;break}h>b&&!e?m=0:b!=v||b!=h&&!e?v>b&&(b==h||e)&&(m=Number.MAX_VALUE):m=1}function l(){if(0===m)p=void 0;else{p=a(v);for(var e=0;b>e;++e)p[x[e]]=d[g[e]]}}var f,d,p,h,v,b,m,g,x,S;return n(),t(),r(),c(),u(),s(),l(),{xVector:p,numberOfEquations:h,numberOfVariables:v,rank:b,numberOfFreeVariables:v-b,numberOfSolutions:m}}function a(e){for(var n=[],t=0;e>t;t++)n[t]=0;return n}function o(e){return e.slice()}function i(e){for(var n=[],t=0;t<e.length;t++)n[t]=e[t].slice();return n}n.exports=r},{}],13:[function(e,n,t){"use strict";function r(e){function n(){return e.show({templateUrl:"expenses/create-expense-dialog.html",controller:a,controllerAs:"vm"})}return n}function a(e){function n(){a.expense={name:void 0,sharing:"equal"},a.options={createParticipations:!0}}function t(){e.hide({expense:a.expense,options:a.options})}function r(){e.cancel()}var a=this;a.ok=t,a.cancel=r,a.init=n,n()}var o=e("angular");o.module("debtApp").factory("openCreateExpenseDialog",r),r.$inject=["$mdDialog"],a.$inject=["$mdDialog"]},{angular:"angular"}],14:[function(e,n,t){"use strict";function r(e,n,t,r,o,i,c,u,s,l){function f(){g.balanceSheet=e.balanceSheet,g.expense=g.balanceSheet.getExpense(c.id),g.isParticipant={},g.everyoneParticipates=!0,d(),s.$on(t.BALANCE_SHEET_UPDATED,function(e){e.targetScope!=s&&g.updateExpense()})}function d(){g.expense.shareCost(),g.isParticipant=p(),g.cost=g.expense.getCost(),g.sumOfShares=g.expense.getSumOfShares(),s.$emit(t.BALANCE_SHEET_UPDATED),S()}function p(){var e={};return a.forEach(g.balanceSheet.persons,function(n){e[n.id]=!1,a.forEach(g.expense.getParticipations(),function(t){t.person.equals(n)&&(e[n.id]=!0)})}),e}function h(e,n){n?g.balanceSheet.createParticipation({expense:g.expense,person:e}):g.balanceSheet.removeParticipation({expense:g.expense,person:e}),d()}function v(){i.show(x).then(b)}function b(){g.balanceSheet.removeExpense(g.expense),s.$emit(t.BALANCE_SHEET_UPDATED),u.go("balanceSheet")}function m(){if(g.expense.isBalanced()){var e=n.computeDebts(g.expense.getParticipations());return n.organizeByDebtor(e)}}var g=this,x=i.confirm().content("Really delete this expense?").ok("Ok").cancel("Cancel"),S=r(function(){l(function(){g.debtsByDebtor=m()})},o);g.init=f,g.setParticipation=h,g.updateExpense=d,g.removeExpense=v,f()}var a=(e("lodash"),e("angular"));a.module("debtApp").controller("ExpenseDetailCtrl",r),r.$inject=["balanceSheetService","debtService","events","debounce","debtCalculationInterval","$mdDialog","$stateParams","$state","$scope","$timeout"]},{angular:"angular",lodash:"lodash"}],15:[function(e,n,t){"use strict";e("./route-config"),e("./expense-detail-ctrl"),e("./create-expense-dialog")},{"./create-expense-dialog":13,"./expense-detail-ctrl":14,"./route-config":16}],16:[function(e,n,t){"use strict";function r(e){e.state("expense",{url:"/expenses/:id",templateUrl:"expenses/expense-detail.html",controller:"ExpenseDetailCtrl as vm"})}var a=e("angular");a.module("debtApp").config(r),r.$inject=["$stateProvider"]},{angular:"angular"}],17:[function(e,n,t){"use strict";function r(e){function n(){return e.show({templateUrl:"persons/create-person-dialog.html",controller:a,controllerAs:"vm"})}return n}function a(e){function n(){a.person={name:void 0},a.options={createParticipations:!0}}function t(){e.hide({person:a.person,options:a.options})}function r(){e.cancel()}var a=this;a.ok=t,a.cancel=r,a.init=n,n()}var o=e("angular");o.module("debtApp").factory("openCreatePersonDialog",r),r.$inject=["$mdDialog"],a.$inject=["$mdDialog"]},{angular:"angular"}],18:[function(e,n,t){"use strict";e("./route-config"),e("./person-detail-ctrl"),e("./create-person-dialog")},{"./create-person-dialog":17,"./person-detail-ctrl":19,"./route-config":20}],19:[function(e,n,t){"use strict";function r(e,n,t,r,a,i,c,u,s,l){function f(){E.balanceSheet=e.balanceSheet,E.person=E.balanceSheet.getPerson(c.id),d(),S=u.confirm().content("Really delete this person?").ok("Ok").cancel("Cancel"),s.$on(t.BALANCE_SHEET_UPDATED,E.refresh)}function d(){E.isParticipant=p(),E.cost=E.person.getCost(),E.sumOfShares=E.person.getSumOfShares(),E.balance=E.person.getBalance(),A()}function p(){var e={};return o.forEach(E.balanceSheet.expenses,function(n){e[n.id]=!1,o.forEach(E.person.getParticipations(),function(t){t.expense.equals(n)&&(e[n.id]=!0)})}),e}function h(e){e.shareCost(),d(),s.$emit(t.BALANCE_SHEET_UPDATED)}function v(e,n){n?E.balanceSheet.createParticipation({expense:e,person:E.person}):E.balanceSheet.removeParticipation({expense:e,person:E.person}),E.updateExpense(e)}function b(){var e={role:void 0,debts:void 0};if(!E.balanceSheet.isBalanced())return e.role="unbalanced",e;if(E.balance>0)e.role="debtor";else{if(!(E.balance<0))return e.role="settled",e;e.role="creditor"}var t={debtor:"creditor",creditor:"debtor"},r=n.computeDebts(E.balanceSheet.getNonSettledParticipations());return e.debts=o.chain(r).filter(function(n){return n[e.role].equals(E.person)}).map(function(n){return{person:n[t[e.role]],amount:n.amount}}).value(),e}function m(){u.show(S).then(g)}function g(){E.balanceSheet.removePerson(E.person),s.$emit(t.BALANCE_SHEET_UPDATED),i.go("balanceSheet")}function x(){s.$emit(t.BALANCE_SHEET_UPDATED)}var S,E=this,A=r(function(){l(function(){var e=b();E.debtRole=e.role,E.debts=e.debts})},a);E.init=f,E.refresh=d,E.updateExpense=h,E.setParticipation=v,E.removePerson=m,E.updatePerson=x,f()}var a=e("angular"),o=e("lodash");a.module("debtApp").controller("PersonDetailCtrl",r),r.$inject=["balanceSheetService","debtService","events","debounce","debtCalculationInterval","$state","$stateParams","$mdDialog","$scope","$timeout"]},{angular:"angular",lodash:"lodash"}],20:[function(e,n,t){"use strict";function r(e){e.state("person",{url:"/persons/:id",templateUrl:"persons/person-detail.html",controller:"PersonDetailCtrl as vm"})}var a=e("angular");a.module("debtApp").config(r),r.$inject=["$stateProvider"]},{angular:"angular"}],21:[function(e,n,t){"use strict";function r(e){e.otherwise("/")}var a=e("angular");a.module("debtApp").config(r),r.$inject=["$urlRouterProvider"]},{angular:"angular"}],22:[function(e,n,t){"use strict";function r(e){return function(n){return n>0?"+"+e("number")(n,"2"):0>=n?e("number")(n,"2"):void 0}}{var a=e("angular");e("lodash")}a.module("debtApp").filter("balance",r),r.$inject=["$filter"]},{angular:"angular",lodash:"lodash"}],23:[function(e,n,t){"use strict";function r(e,n){function t(t){var r=e.defer(),a=new n.FileReader;return a.onload=function(){r.resolve(a.result)},a.onerror=function(){r.resolve(a.error)},a.readAsText(t),r.promise}function r(e,t){var r=new n.Blob(e,{});o.saveAs(r,t)}function a(){return n.FileReader&&n.Blob}return{readAsText:t,saveAsFile:r,isSupported:a}}var a=e("angular"),o=e("node-safe-filesaver");e("blob-polyfill"),a.module("debtApp").factory("fileService",r),r.$inject=["$q","$window"]},{angular:"angular","blob-polyfill":"blob-polyfill","node-safe-filesaver":"node-safe-filesaver"}],24:[function(e,n,t){"use strict";function r(e){return{restrict:"A",link:function(n,t){e(function(){t[0].focus()},0)}}}var a=e("angular");a.module("debtApp").directive("focus",r),r.$inject=["$timeout"]},{angular:"angular"}],25:[function(e,n,t){"use strict";e("./money-input-directive"),e("./balance-filter"),e("./money-filter"),e("./file-service"),e("./focus-directive")},{"./balance-filter":22,"./file-service":23,"./focus-directive":24,"./money-filter":26,"./money-input-directive":27}],26:[function(e,n,t){"use strict";function r(e){return function(n){return e("number")(n,"2")}}var a=e("angular");a.module("debtApp").filter("money",r),r.$inject=["$filter"]},{angular:"angular"}],27:[function(e,n,t){"use strict";function r(e){function n(e,n,o,i){function c(){n.val(i.$valid?r(i.$modelValue):i.$viewValue)}function u(){i.$render()}i.$validators.money=t,i.$parsers.push(a),i.$formatters.unshift(r),n.on("blur",u),i.$render=c}function t(e){return 0>e?!1:!0}function r(n){return void 0===n||null===n?"":e("number")(n,2)}function a(e){return new o(e).toNumber()}return{restrict:"A",require:"ngModel",link:n}}var a=e("angular"),o=e("simple-decimal-money");a.module("debtApp").directive("moneyInput",r),r.$inject=["$filter"]},{angular:"angular","simple-decimal-money":"simple-decimal-money"}]},{},[1]);
//# sourceMappingURL=debt.js.map