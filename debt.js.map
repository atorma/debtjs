{"version":3,"sources":["debt.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","configureLocalStorage","localStorageServiceProvider","setPrefix","configureIcons","$mdIconProvider","spriteNames","spriteProps","_","map","name","fileName","filePath","spriteName","each","prop","iconSet","hrefSanitization","$compileProvider","aHrefSanitizationWhitelist","makeStateAvailableInScope","$rootScope","$state","$stateParams","angular","constant","BALANCE_SHEET_UPDATED","config","run","$inject","./balance-sheet","./debt-app-ctrl","./debts","./expenses","./persons","./route-config","./utils","angular-local-storage","angular-material","angular-route","angular-ui-router","lodash","ng-file-upload","ng-mfb",2,"BalanceSheetCtrl","balanceSheetService","debtService","events","$scope","init","refresh","$on","vm","balanceSheet","debtsByDebtor","computeDebts","isBalanced","participations","getNonSettledParticipations","debts","organizeByDebtor","undefined","updateSheet","$emit","this","controller",3,"localStorageService","data","get","service","BalanceSheet","error","save","throwErrorIfInvalid","set","exportData","loadFromJson","json","fromJson","exportToJson","toJson","createNew","factory",4,"Decimal","filter","pt","expense","settled","reduce","expenses","getPerson","id","persons","find","p","createPerson","options","extend","idSequence","person","Person","push","createParticipations","createParticipation","shareCost","removePerson","toRemove","remove","equals","forEach","getParticipations","removeParticipation","getExpense","createExpense","sharing","Expense","removeExpense","getParticipation","criteria","toSeek","Participation","paid","share","participation","getCost","_cost","value","toNumber","getSumOfShares","_sumOfShares","_balance","getBalance","_myParticipations","other","_this","chain","_nonSettledParticipations","cost","add","sum","subtract","b","shareEqually","divideBy","lastShare","multiply","last","isNotFunction","negate","isFunction","pick","personId","expenseId","importData","concat","pluck","max","Infinity","separately","key","isValid","isNumber","idToEntity","message","simple-decimal-money",5,"./balance-sheet-ctrl","./balance-sheet-service",6,"$stateProvider","state","url","templateUrl",7,"DebtAppCtrl","balanceSheetSaveCtrlConfig","openCreatePersonDialog","openCreateExpenseDialog","fileService","$mdDialog","$mdSidenav","$log","toggleMenu","toggle","debounce","onBalanceSheetUpdated","wait","errorMessage","debug","then","dialogResult","$broadcast","createNewSheet","show","confirmCreateNewSheet","go","mainMenu","loadSheet","files","isSupported","file","readAsText","result","loadSheetFromJson","exportSheet","saveAsFile","showHelp","close","hide","confirm","title","content","ok","cancel",8,"solveDebts","debtorList","debtorIndices","d","debtor","debtorIndex","creditor","amount","sort","d1","d2","localeCompare",9,"debtSolverFactory","solveLinearSystem","solve","balances","computeBalances","hasNonZeroBalance","roles","getDebtorsAndCreditors","linearSystem","createDebtEquations","debtVector","createDebts","balance","debtors","creditors","c","A","initMatrix","j","rows","cols","solution","numVars","numberOfVariables","numFreeVars","numberOfFreeVariables","xVector","randomEngine","Random","engines","mt19937","seed","toEliminate","copy","candidates","candidateIdx","integer","splice","isNonNegative","vector","debtorIdx","Math","floor","creditorIdx","debt","random-js",10,"./debt-service","./debt-solver","./lin-eq-solver","./lin-eq-solver-factory",11,12,"input","validate","initialize","coefMatrix","copyMatrix","constVector","copyArray","m","pivotToEquationMap","equationScale","abscoef","abs","pivotToVariableMap","transformToRowEchelonForm","pivotIdx","knownFreeVariables","maxRatio","bestPivotEquationIndex","rowIdx","colIdx","ratio","currPivotVaribleIdx","newPivotVariableIdx","temp","pivotRowIdx","pivotColIdx","mult","colIndex","reduceRowEchelonForm","pivotIndex","min","div","determineRank","rank","columns","determineNumberOfSolutions","b2IsZero","numberOfSolutions","Number","MAX_VALUE","determineSolution","initArray","numberOfEquations","size","array","slice",13,"open","DialogController","controllerAs",14,"ExpenseDetailCtrl","isParticipant","everyoneParticipates","updateExpense","event","targetScope","getParticipationMap","sumOfShares","setParticipation","confirmRemoveExpense","doRemoveExpense",15,"./create-expense-dialog","./expense-detail-ctrl",16,17,18,"./create-person-dialog","./person-detail-ctrl",19,"PersonDetailCtrl","confirmRemovePerson","debtResult","debtRole","role","counterRole","doRemovePerson","updatePerson",20,21,"$urlRouterProvider","otherwise",22,"$filter",23,"$q","$window","blob","deferred","defer","reader","FileReader","onload","resolve","onerror","promise","dataArray","Blob","fileSaver","saveAs","blob-polyfill","node-safe-filesaver",24,"focus","$timeout","restrict","link","iElem","directive",25,"./balance-filter","./file-service","./focus-directive","./money-filter","./money-input-directive",26,"money",27,"moneyInput","iAttrs","ngModel","render","val","$valid","formatMoney","$modelValue","$viewValue","handleBlur","$render","$validators","validateMoney","$parsers","parseMoney","$formatters","unshift","on"],"mappings":"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","file":"debt.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nrequire(\"angular-material\");\r\nrequire(\"angular-route\");\r\nrequire(\"angular-ui-router\");\r\nrequire(\"angular-local-storage\");\r\nrequire(\"ng-mfb\");\r\nrequire(\"ng-file-upload\");\r\n\r\nvar _ = require(\"lodash\");\r\n\r\nangular\r\n  .module(\"debtApp\", [\"ngMaterial\", \"ui.router\", \"LocalStorageModule\", \"ng-mfb\", \"ngFileUpload\"])\r\n  .constant(\"events\", {\r\n    BALANCE_SHEET_UPDATED: \"balance sheet updated\"\r\n  })\r\n  .config(configureLocalStorage)\r\n  .config(configureIcons)\r\n  .config(hrefSanitization)\r\n  .run(makeStateAvailableInScope);\r\n\r\nrequire(\"./debt-app-ctrl\");\r\nrequire(\"./route-config\");\r\nrequire(\"./debts\");\r\nrequire(\"./balance-sheet\");\r\nrequire(\"./persons\");\r\nrequire(\"./expenses\");\r\nrequire(\"./utils\");\r\n\r\nfunction configureLocalStorage(localStorageServiceProvider) {\r\n  localStorageServiceProvider.setPrefix(\"debtApp\");\r\n}\r\nconfigureLocalStorage.$inject = [\"localStorageServiceProvider\"];\r\n\r\nfunction configureIcons($mdIconProvider) {\r\n  \r\n  var spriteNames = ['action', 'alert', 'content', 'navigation'];\r\n  \r\n  var spriteProps = _.map(spriteNames, function(name) {\r\n    var fileName = 'svg-sprite-' + name + '.svg';\r\n    return {\r\n      filePath: 'resources/icons/' + fileName,\r\n      spriteName: name\r\n    };\r\n  });\r\n\r\n  _.each(spriteProps, function(prop) {\r\n    $mdIconProvider.iconSet(prop.spriteName, prop.filePath);\r\n  });\r\n\r\n}\r\nconfigureIcons.$inject = [\"$mdIconProvider\"];\r\n\r\nfunction hrefSanitization($compileProvider) {\r\n  $compileProvider.aHrefSanitizationWhitelist(/^(blob||https?):/);\r\n}\r\nhrefSanitization.$inject = [\"$compileProvider\"];\r\n\r\n// Injection of $state may trigger a GET, which can show as an \r\n// \"Unexpected request\" error in your test. Workaround is to \r\n// $provide a mock $state to Angular.\r\nfunction makeStateAvailableInScope($rootScope, $state, $stateParams) {\r\n  $rootScope.$state = $state;\r\n  $rootScope.$stateParams = $stateParams;\r\n}\r\nmakeStateAvailableInScope.$inject = [\"$rootScope\", \"$state\", \"$stateParams\"];\r\n\n},{\"./balance-sheet\":5,\"./debt-app-ctrl\":7,\"./debts\":10,\"./expenses\":15,\"./persons\":18,\"./route-config\":21,\"./utils\":25,\"angular\":\"angular\",\"angular-local-storage\":\"angular-local-storage\",\"angular-material\":\"angular-material\",\"angular-route\":\"angular-route\",\"angular-ui-router\":\"angular-ui-router\",\"lodash\":\"lodash\",\"ng-file-upload\":\"ng-file-upload\",\"ng-mfb\":\"ng-mfb\"}],2:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar _ = require(\"lodash\");\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n  .controller(\"BalanceSheetCtrl\", BalanceSheetCtrl);\r\n\r\nfunction BalanceSheetCtrl(balanceSheetService, debtService, events, $scope) {\r\n  var vm = this;\r\n  \r\n  vm.init = init;\r\n  vm.refresh = refresh;\r\n  vm.updateSheet = updateSheet;\r\n  \r\n  init();\r\n  \r\n  /////////////////////////////////////////////////////////////\r\n  \r\n  function init() {\r\n    refresh();\r\n    $scope.$on(events.BALANCE_SHEET_UPDATED, vm.refresh);\r\n  }\r\n  \r\n  function refresh() {\r\n    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n    vm.debtsByDebtor = computeDebts();\r\n  }\r\n  \r\n  function computeDebts() {\r\n    if (vm.balanceSheet.isBalanced()) {\r\n      var participations = vm.balanceSheet.getNonSettledParticipations();\r\n      var debts = debtService.computeDebts(participations);\r\n      return debtService.organizeByDebtor(debts);\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  function updateSheet() {\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n}\r\nBalanceSheetCtrl.$inject = [\"balanceSheetService\", \"debtService\", \"events\", \"$scope\"];\n},{\"angular\":\"angular\",\"lodash\":\"lodash\"}],3:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar _ = require(\"lodash\");\r\nvar angular = require(\"angular\");\r\nvar BalanceSheet = require('./balance-sheet');\r\n\r\nangular.module(\"debtApp\")\r\n.factory(\"balanceSheetService\", balanceSheetService);\r\n\r\nfunction balanceSheetService(localStorageService) {\r\n  \r\n  var service = {\r\n    balanceSheet: undefined,\r\n    error: undefined,\r\n    save: save,\r\n    loadFromJson: loadFromJson,\r\n    exportToJson: exportToJson,\r\n    createNew: createNew,\r\n    init: init\r\n  };\r\n  service.init();\r\n  \r\n  return service;\r\n  \r\n  \r\n  function init() {\r\n    var data = localStorageService.get(\"balanceSheetData\");\r\n    try {\r\n      service.balanceSheet = new BalanceSheet(data);\r\n      service.error = undefined;\r\n    } catch (e) {\r\n      service.error = e;\r\n    }\r\n  }\r\n\r\n  function save() {\r\n    if (!service.balanceSheet) {\r\n      throw service.error;\r\n    }\r\n\r\n    try {\r\n      service.balanceSheet.throwErrorIfInvalid();\r\n    } catch (e) {\r\n      service.error = e;\r\n      throw e;\r\n    }\r\n\r\n    localStorageService.set(\"balanceSheetData\", service.balanceSheet.exportData());\r\n    service.error = undefined;\r\n  }\r\n  \r\n  function loadFromJson(json) {\r\n    var data = angular.fromJson(json);\r\n    service.balanceSheet = new BalanceSheet(data);\r\n    save();\r\n  }\r\n  \r\n  function exportToJson() {\r\n    var data = service.balanceSheet.exportData(); \r\n    return angular.toJson(data);\r\n  }\r\n\r\n  function createNew() {\r\n    service.balanceSheet = new BalanceSheet();\r\n    service.save();\r\n  }\r\n\r\n}\r\nbalanceSheetService.$inject = [\"localStorageService\"];\r\n\r\n\r\n\n},{\"./balance-sheet\":4,\"angular\":\"angular\",\"lodash\":\"lodash\"}],4:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar _ = require('lodash');\r\nvar angular = require(\"angular\");\r\nvar Decimal = require(\"simple-decimal-money\");\r\n\r\nvar BalanceSheet = function(data) {\r\n\r\n  var _this = this;\r\n\r\n  // Data\r\n\r\n  var persons = [];\r\n  var expenses = [];\r\n  var participations = [];\r\n  var idSequence = 1;\r\n\r\n  _this.name = \"New sheet\";\r\n  _this.persons = persons;\r\n  _this.expenses = expenses;\r\n  _this.participations = participations;\r\n\r\n  if (data) {\r\n    importData(data);\r\n  }\r\n\r\n  // Methods\r\n\r\n  _this.getNonSettledParticipations = getNonSettledParticipations;\r\n\r\n  _this.isBalanced = isBalanced;\r\n\r\n  _this.getPerson = getPerson;\r\n  _this.createPerson = createPerson;\r\n  _this.removePerson = removePerson;\r\n\r\n  _this.getExpense = getExpense;\r\n  _this.createExpense = createExpense;\r\n  _this.removeExpense = removeExpense;\r\n\r\n  _this.getParticipation = getParticipation;\r\n  _this.createParticipation = createParticipation;\r\n  _this.removeParticipation = removeParticipation;\r\n\r\n  _this.exportData = exportData;\r\n\r\n  _this.isValid = isValid;\r\n  _this.throwErrorIfInvalid = throwErrorIfInvalid;\r\n\r\n  /////////////////////////////////////\r\n\r\n\r\n  function getNonSettledParticipations() {\r\n    return _.filter(participations, function(pt) {\r\n      return !pt.expense.settled;\r\n    });\r\n  }\r\n\r\n  function isBalanced() {\r\n    return _.reduce(expenses, function(isBalanced, e) {\r\n      return isBalanced && (e.settled || e.isBalanced());\r\n    }, true);\r\n  }\r\n\r\n\r\n  function getPerson(id) {\r\n    return _(persons).find(function(p) {\r\n      return p.id == id;\r\n    });\r\n  }\r\n\r\n\r\n  function createPerson(data, options) {\r\n    data = _.extend({\r\n      name: \"Person \" + (persons.length + 1)\r\n    }, data);\r\n\r\n    options = _.extend({}, options);\r\n\r\n    if (data.id === undefined) {\r\n      data.id = idSequence;\r\n      idSequence = idSequence + 1;\r\n    }\r\n\r\n    var person = new Person(data);\r\n    persons.push(person);\r\n\r\n    if (options.createParticipations === true) {\r\n      _.each(expenses, function(e) {\r\n        if (!e.settled) {\r\n          createParticipation({person: person, expense: e});\r\n          e.shareCost();\r\n        }\r\n      });\r\n    }\r\n\r\n    return person;\r\n  }\r\n\r\n  function removePerson(toRemove) {\r\n    toRemove = getPerson(toRemove.id);\r\n\r\n    if (!toRemove) return;\r\n\r\n    _.remove(persons, function(e) {\r\n      return e.equals(toRemove);\r\n    });\r\n\r\n    _.forEach(toRemove.getParticipations(), function(pt) {\r\n      removeParticipation(pt);\r\n    });\r\n  }\r\n\r\n  function getExpense(id) {\r\n    return _(expenses).find(function(e) {\r\n      return e.id == id;\r\n    });\r\n  }\r\n\r\n  function createExpense(data, options) {\r\n    data = _.extend({\r\n      name: \"Expense \" + (expenses.length + 1),\r\n      sharing: \"equal\",\r\n      settled: false\r\n    }, data);\r\n\r\n    options = _.extend({}, options);\r\n\r\n    if (data.id === undefined) {\r\n      data.id = idSequence;\r\n      idSequence = idSequence + 1;\r\n    }\r\n\r\n    var expense = new Expense(data);\r\n    expenses.push(expense);\r\n\r\n    if (options.createParticipations === true) {\r\n      _.each(persons, function(p) {\r\n        createParticipation({person: p, expense: expense});\r\n      });\r\n    }\r\n\r\n    return expense;\r\n  }\r\n\r\n  function removeExpense(toRemove) {\r\n    toRemove = getExpense(toRemove.id);\r\n\r\n    if (!toRemove) return;\r\n\r\n    _.remove(expenses, function(e) {\r\n      return e.equals(toRemove);\r\n    });\r\n\r\n    _.forEach(toRemove.getParticipations(), function(pt) {\r\n      removeParticipation(pt);\r\n    });\r\n  }\r\n\r\n\r\n  function getParticipation(criteria) {\r\n    var toSeek = new Participation(criteria);\r\n    return _(participations).find(function(pt) {\r\n      return toSeek.equals(pt);\r\n    });\r\n  }\r\n\r\n  function createParticipation(data) {\r\n    if (getParticipation(data)) {\r\n      throw \"Duplicate participation\";\r\n    }\r\n\r\n    data = _.extend({\r\n      paid: 0,\r\n      share: 0\r\n    }, data);\r\n\r\n    var participation = new Participation(data);\r\n    participations.push(participation);\r\n\r\n    participation.expense.shareCost();\r\n\r\n    return participation;\r\n  }\r\n\r\n  function removeParticipation(toRemove) {\r\n    toRemove = getParticipation(toRemove);\r\n\r\n    if (!toRemove) return;\r\n\r\n    _.remove(participations, function(pt) {\r\n      return pt.equals(toRemove);\r\n    });\r\n\r\n    toRemove.expense.shareCost();\r\n  }\r\n\r\n\r\n  function Person(data) {\r\n    var _this = this;\r\n\r\n    _.extend(_this, data);\r\n\r\n    // Methods\r\n\r\n    _this.equals = equals;\r\n    _this.getCost = getCost;\r\n    _this.getSumOfShares = getSumOfShares;\r\n    _this.getBalance = getBalance;\r\n    _this.isBalanced = isBalanced;\r\n    _this.getParticipations = getParticipations;\r\n\r\n    ///////////////////////////////////////\r\n\r\n    var _myParticipations = _.chain(participations)\r\n      .filter(function(pt) {\r\n        return _this.equals(pt.person);\r\n      });\r\n\r\n    var _nonSettledParticipations = _myParticipations\r\n      .filter(function(pt) {\r\n        return !pt.expense.settled;\r\n      });\r\n\r\n    var _cost = _nonSettledParticipations\r\n      .filter(function(pt) {\r\n        return !pt.expense.settled;\r\n      })\r\n      .map(\"paid\").reduce(function(cost, paid) {\r\n        return cost.add(paid);\r\n      }, new Decimal(0));\r\n\r\n    var _sumOfShares = _nonSettledParticipations\r\n      .map(\"share\").reduce(function(sum, share) {\r\n        return sum.add(share);\r\n      }, new Decimal(0));\r\n\r\n    var _balance = _nonSettledParticipations\r\n      .map(function(pt) {\r\n        return (new Decimal(pt.share)).subtract(pt.paid);\r\n      })\r\n      .reduce(function(sum, b) {\r\n        return sum.add(b);\r\n      }, new Decimal(0));\r\n\r\n\r\n    function getCost() {\r\n      return _cost.value().toNumber();\r\n    }\r\n\r\n    function getSumOfShares() {\r\n      return _sumOfShares.value().toNumber();\r\n    }\r\n\r\n    function isBalanced() {\r\n      return _balance.value().toNumber() === 0;\r\n    }\r\n\r\n    function getBalance() {\r\n      return _balance.value().toNumber();\r\n    }\r\n\r\n    function getParticipations() {\r\n      return _myParticipations.value();\r\n    }\r\n\r\n    function equals(other) {\r\n      return (other instanceof Person) && (other.id === _this.id);\r\n    }\r\n\r\n  }\r\n\r\n\r\n  function Expense(data) {\r\n    var _this = this;\r\n\r\n    // Data\r\n\r\n    _.extend(_this, data);\r\n\r\n    // Methods\r\n\r\n    _this.getCost = getCost;\r\n    _this.getSumOfShares = getSumOfShares;\r\n    _this.getBalance = getBalance;\r\n    _this.isBalanced = isBalanced;\r\n    _this.getParticipations = getParticipations;\r\n    _this.shareCost = shareCost;\r\n    _this.equals = equals;\r\n\r\n    ///////////////////////////////////////\r\n\r\n    var _myParticipations = _.chain(participations).filter(function(p) {\r\n      return _this.equals(p.expense);\r\n    });\r\n\r\n    var _cost = _myParticipations\r\n      .map(\"paid\").reduce(function(cost, paid) {\r\n        return cost.add(paid);\r\n      }, new Decimal(0));\r\n\r\n    var _sumOfShares = _myParticipations\r\n      .map(\"share\").reduce(function(sum, share) {\r\n        return sum.add(share);\r\n      }, new Decimal(0));\r\n\r\n    var _balance = _myParticipations\r\n      .map(function(pt) {\r\n        return (new Decimal(pt.share)).subtract(pt.paid);\r\n      })\r\n      .reduce(function(sum, b) {\r\n        return sum.add(b);\r\n      }, new Decimal(0));\r\n\r\n\r\n    function getCost() {\r\n      return _cost.value().toNumber();\r\n    }\r\n\r\n    function getSumOfShares() {\r\n      return _sumOfShares.value().toNumber();\r\n    }\r\n\r\n    function isBalanced() {\r\n      return _balance.value().toNumber() === 0;\r\n    }\r\n\r\n    function getBalance() {\r\n      return _balance.value().toNumber();\r\n    }\r\n\r\n    function getParticipations() {\r\n      return _myParticipations.value();\r\n    }\r\n\r\n    function shareCost() {\r\n      if (_this.sharing === \"equal\") {\r\n        shareEqually();\r\n      }\r\n    }\r\n\r\n    function shareEqually() {\r\n      var participations = _this.getParticipations();\r\n      if (participations.length === 0) {\r\n        return;\r\n      }\r\n\r\n      var cost = new Decimal(_this.getCost());\r\n      var share = cost.divideBy(participations.length);\r\n      var lastShare = cost.subtract(share.multiply(participations.length - 1));\r\n\r\n      _.forEach(participations, function(p, i) {\r\n        if (i < participations.length - 1) {\r\n          p.share = share.toNumber();\r\n        }\r\n      });\r\n      _.last(participations).share = lastShare.toNumber();\r\n    }\r\n\r\n    function equals(other) {\r\n      return (other instanceof Expense) && (other.id === _this.id);\r\n    }\r\n\r\n  }\r\n\r\n\r\n  function Participation(data) {\r\n    var _this = this;\r\n\r\n    if (!data || !data.person || !data.expense) {\r\n      throw \"Undefined participation\";\r\n    }\r\n\r\n    // Data\r\n\r\n    _.extend(this, data);\r\n\r\n    // Methods\r\n\r\n    this.equals = equals;\r\n\r\n\r\n    ///////////////////////////////////////\r\n\r\n    function equals(other) {\r\n      return (other instanceof Participation) && _this.expense.equals(other.expense) && _this.person.equals(other.person);\r\n    }\r\n  }\r\n\r\n\r\n  function exportData() {\r\n    var isNotFunction = _.negate(_.isFunction);\r\n    var data = _.pick(_this, isNotFunction);\r\n    data.persons = _.map(persons, function(p) {\r\n      return _.pick(p, isNotFunction);\r\n    });\r\n    data.expenses = _.map(expenses, function(e) {\r\n      return _.pick(e, isNotFunction);\r\n    });\r\n    data.participations = _.map(participations, function(pt) {\r\n      return {personId: pt.person.id, expenseId: pt.expense.id, paid: pt.paid, share: pt.share};\r\n    });\r\n    return data;\r\n  }\r\n\r\n  function importData(data) {\r\n    idSequence = _([])\r\n        .concat(data.persons)\r\n        .concat(data.expenses)\r\n        .pluck(\"id\")\r\n        .max() + 1;\r\n    if (idSequence == -Infinity) {\r\n      idSequence = 1;\r\n    }\r\n\r\n    var separately = {persons: true, expenses: true, participations: true};\r\n    _.extend(_this, _.pick(data, function(value, key) {\r\n      return !separately[key];\r\n    }));\r\n\r\n    _.each(data.persons, function(p) {\r\n      createPerson(p);\r\n    });\r\n\r\n    _.each(data.expenses, function(e) {\r\n      createExpense(e);\r\n    });\r\n\r\n    _.each(data.participations, function(p) {\r\n      var person = getPerson(p.personId);\r\n      var expense = getExpense(p.expenseId);\r\n      createParticipation({person: person, expense: expense, paid: p.paid, share: p.share});\r\n    });\r\n\r\n    throwErrorIfInvalid();\r\n  }\r\n\r\n  function isValid() {\r\n    try {\r\n      throwErrorIfInvalid();\r\n      return true;\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function throwErrorIfInvalid() {\r\n\r\n    _.each(persons, function(p) {\r\n      if (!_.isNumber(p.id)) {\r\n        throw new Error(\"Person has no id\");\r\n      }\r\n    });\r\n\r\n    _.each(expenses, function(e) {\r\n      if (!_.isNumber(e.id)) {\r\n        throw new Error(\"Expense has no id\");\r\n      }\r\n    });\r\n\r\n    var idToEntity = {};\r\n    _.each(persons, function(p) {\r\n      idToEntity[p.id] = p;\r\n    });\r\n    _.each(expenses, function(e) {\r\n      idToEntity[e.id] = e;\r\n    });\r\n    _.each(participations, function(pt) {\r\n      if (!pt.person) {\r\n        throw new Error(\"Participation has no person\");\r\n      }\r\n      if (!idToEntity[pt.person.id]) {\r\n        throw new Error(\"Participation person is unknown\");\r\n      }\r\n      if (!pt.expense) {\r\n        throw new Error(\"Participation has no expense\");\r\n      }\r\n      if (!idToEntity[pt.expense.id]) {\r\n        throw new Error(\"Participation expense is unknown\");\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  function Error(message) {\r\n    this.message = message;\r\n  }\r\n\r\n};\r\n\r\n\r\nmodule.exports = BalanceSheet;\n},{\"angular\":\"angular\",\"lodash\":\"lodash\",\"simple-decimal-money\":\"simple-decimal-money\"}],5:[function(require,module,exports){\n\"use strict\";\r\n\r\nrequire(\"./route-config\");\r\nrequire(\"./balance-sheet\");\r\nrequire(\"./balance-sheet-service\");\r\nrequire(\"./balance-sheet-ctrl\");\n},{\"./balance-sheet\":4,\"./balance-sheet-ctrl\":2,\"./balance-sheet-service\":3,\"./route-config\":6}],6:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n  .config(config);\r\n\r\nfunction config($stateProvider) {\r\n\r\n  $stateProvider\r\n    .state(\"balanceSheet\", {\r\n      url: \"/\",\r\n      templateUrl : \"balance-sheet/balance-sheet.html\",\r\n      controller : \"BalanceSheetCtrl as vm\"\r\n    });\r\n  \r\n}\r\nconfig.$inject = [\"$stateProvider\"];\n},{\"angular\":\"angular\"}],7:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar _ = require(\"lodash\");\r\n\r\nangular.module(\"debtApp\")\r\n  .value(\"balanceSheetSaveCtrlConfig\", {wait: 500})\r\n  .controller(\"DebtAppCtrl\", DebtAppCtrl);\r\n\r\nfunction DebtAppCtrl(balanceSheetService,\r\n                     balanceSheetSaveCtrlConfig,\r\n                     openCreatePersonDialog,\r\n                     openCreateExpenseDialog,\r\n                     fileService,\r\n                     events,\r\n                     $mdDialog,\r\n                     $mdSidenav,\r\n                     $state,\r\n                     $scope,\r\n                     $log) {\r\n\r\n  var vm = this;\r\n\r\n  vm.mainMenu = {\r\n    toggle: toggleMenu\r\n  };\r\n\r\n  vm.init = init;\r\n  vm.createPerson = createPerson;\r\n  vm.createExpense = createExpense;\r\n  vm.createNewSheet = createNewSheet;\r\n  vm.loadSheet = loadSheet;\r\n  vm.exportSheet = exportSheet;\r\n  vm.save = save;\r\n  vm.refresh = refresh;\r\n  vm.showHelp = showHelp;\r\n\r\n  var confirmCreateNewSheet = $mdDialog.confirm()\r\n    .title(\"Create new sheet\")\r\n    .content(\"The current sheet will be discarded. Please consider exporting it first. Continue?\")\r\n    .ok(\"Ok\").cancel(\"Cancel\");\r\n\r\n  init();\r\n\r\n  /////////////////////////////////////////////////////////////\r\n\r\n  function toggleMenu() {\r\n    $mdSidenav(\"main-menu\").toggle();\r\n  }\r\n\r\n  function init() {\r\n    $scope.$on(events.BALANCE_SHEET_UPDATED, _.debounce(onBalanceSheetUpdated, balanceSheetSaveCtrlConfig.wait));\r\n    vm.refresh();\r\n  }\r\n\r\n  function onBalanceSheetUpdated() {\r\n    vm.refresh();\r\n    if (!vm.errorMessage) {\r\n      vm.save();\r\n    }\r\n  }\r\n\r\n  function save() {\r\n    try {\r\n      balanceSheetService.save();\r\n      vm.errorMessage = undefined;\r\n      $log.debug(\"Balance sheet saved\");\r\n    } catch (e) {\r\n      vm.errorMessage = \"Cannot save: \" + e.message;\r\n      $log.error(\"Error when saving balance sheet: \" + e.message);\r\n    }\r\n  }\r\n\r\n  function refresh() {\r\n    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n    if (balanceSheetService.error) {\r\n      vm.errorMessage = \"Invalid sheet: \" + balanceSheetService.error.message;\r\n    } else {\r\n      vm.errorMessage = undefined;\r\n    }\r\n  }\r\n\r\n\r\n  function createPerson() {\r\n    openCreatePersonDialog()\r\n      .then(function(dialogResult) {\r\n        balanceSheetService.balanceSheet.createPerson(dialogResult.person, dialogResult.options);\r\n        onBalanceSheetUpdated();\r\n        $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n      });\r\n  }\r\n\r\n  function createExpense() {\r\n    openCreateExpenseDialog()\r\n      .then(function(dialogResult) {\r\n        balanceSheetService.balanceSheet.createExpense(dialogResult.expense, dialogResult.options);\r\n        onBalanceSheetUpdated();\r\n        $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n      });\r\n  }\r\n\r\n  function createNewSheet() {\r\n    $mdDialog.show(confirmCreateNewSheet)\r\n      .then(function() {\r\n        balanceSheetService.createNew();\r\n        onBalanceSheetUpdated();\r\n        $state.go(\"balanceSheet\");\r\n        $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n        vm.mainMenu.toggle();\r\n      }, function() {\r\n        vm.mainMenu.toggle();\r\n      });\r\n  }\r\n\r\n  function loadSheet(files) {\r\n    if (!files || !files.length) return;\r\n\r\n    if (!fileService.isSupported()) {\r\n      vm.errorMessage = \"File operations not supported in this browser. Please consider a more modern browser.\";\r\n      return;\r\n    }\r\n\r\n    var file = files[0];\r\n    fileService.readAsText(file)\r\n      .then(function(result) {\r\n        loadSheetFromJson(result);\r\n      })\r\n      .catch(function() {\r\n        vm.errorMessage = \"Unable to read file\";\r\n      })\r\n      .finally(function() {\r\n        vm.mainMenu.toggle();\r\n      });\r\n  }\r\n\r\n  function loadSheetFromJson(json) {\r\n    balanceSheetService.loadFromJson(json);\r\n    onBalanceSheetUpdated();\r\n    $state.go(\"balanceSheet\");\r\n    $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n\r\n  function exportSheet() {\r\n    if (!fileService.isSupported()) {\r\n      vm.errorMessage = \"File operations not supported in this browser. Please consider a more modern browser.\";\r\n      return;\r\n    }\r\n\r\n    var json = balanceSheetService.exportToJson();\r\n    try {\r\n      fileService.saveAsFile([json], balanceSheetService.balanceSheet.name + \".txt\");\r\n    } catch (e) {\r\n      vm.errorMessage = \"Error when saving file\";\r\n    }\r\n    vm.mainMenu.toggle();\r\n  }\r\n\r\n  function showHelp() {\r\n    $mdDialog.show({\r\n      templateUrl: \"help.html\",\r\n      controller: [\"$scope\", \"$mdDialog\", function($scope, $mdDialog) {\r\n        $scope.close = function() {\r\n          $mdDialog.hide();\r\n        }\r\n      }]\r\n    });\r\n    vm.mainMenu.toggle();\r\n  }\r\n}\r\nDebtAppCtrl.$inject = [\"balanceSheetService\", \"balanceSheetSaveCtrlConfig\", \"openCreatePersonDialog\", \"openCreateExpenseDialog\", \"fileService\", \"events\", \"$mdDialog\", \"$mdSidenav\", \"$state\", \"$scope\", \"$log\"];\n},{\"angular\":\"angular\",\"lodash\":\"lodash\"}],8:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular\r\n  .module(\"debtApp\")\r\n    .factory(\"debtService\", debtService);\r\n\r\n\r\nfunction debtService(solveDebts) {\r\n  \r\n  return {\r\n    computeDebts: computeDebts,\r\n    organizeByDebtor: organizeByDebtor\r\n  };\r\n  \r\n  /////////////////////////////////////////\r\n  \r\n  function computeDebts(participations) {\r\n    return solveDebts(participations);\r\n  } \r\n  \r\n  function organizeByDebtor(debts) {\r\n    var debtorList = [];\r\n    var debtorIndices = {};\r\n    \r\n    angular.forEach(debts, function(d) {\r\n      var debtorIndex = debtorIndices[d.debtor.id];\r\n      var debtor;\r\n      if (debtorIndex === undefined) {\r\n        debtorIndex = debtorList.length;\r\n        debtor = {debtor: d.debtor, debts: []};\r\n        debtorList.push(debtor);\r\n        debtorIndices[d.debtor.id] = debtorIndex;\r\n      }\r\n      debtor = debtorList[debtorIndex];\r\n      debtor.debts.push({creditor: d.creditor, amount: d.amount});\r\n    });\r\n    \r\n    angular.forEach(debtorList, function(d) {\r\n      d.debts.sort(function(d1, d2) {\r\n        return d1.creditor.name.localeCompare(d2.creditor.name);\r\n      });\r\n    });\r\n    debtorList.sort(function(d1, d2) {\r\n      return d1.debtor.name.localeCompare(d2.debtor.name);\r\n    });\r\n    \r\n    return debtorList;\r\n  }\r\n  \r\n}\r\ndebtService.$inject = [\"solveDebts\"];\n},{\"angular\":\"angular\"}],9:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar Decimal = require(\"simple-decimal-money\");\r\nvar Random = require(\"random-js\");\r\n\r\nangular\r\n  .module(\"debtApp\")\r\n    .factory(\"solveDebts\", debtSolverFactory);\r\n\r\n\r\n\r\n\r\n/**\r\n * A function that computes debts from given expense participations.\r\n *  \r\n * We form a linear system Ax = b. A is a binary matrix with size (d+c)*(d*c),\r\n * where d is the number of debtors and c is the number of creditors. Columns of A \r\n * are ordered so that x[c*i + j] is the value of the debt owed by debtor i to creditor j.\r\n * \r\n * Elements of b are balances - converted to non-negative - of the debtors and the creditors \r\n * with the following correspondence:\r\n * \r\n * b[0]: first debtor\r\n * ... \r\n * b[d-1]: last debtor\r\n * b[d] = first creditor\r\n * ... \r\n * b[d+c-1] = last creditor\r\n * \r\n * The coefficient matrix A is constructed so that for each person i, we have equation\r\n * where total value of debts to paid by i (if i is a debtor) or to i (if i is a creditor) equals i's \r\n * non-negative balance.\r\n * \r\n * Rows of A indexed between [0, d-1] represent the debtors in the order \r\n * of debtors> list. Rows of A indexed between [d, d+c-1] represent the \r\n * creditors in the order of creditors list.\r\n * \r\n * Ideally, we would like to find the sparsest (most 0's) solution x to Ax = b\r\n * in case the system is underdetermined and has an infinite number of solutions.\r\n * \r\n * This problem, posed as min ||x||_0  s.t. Ax = b, x >= 0, where ||x||_0 is the number\r\n * of non-zero elements, is in general an NP-hard problem. There is some amount of literature\r\n * about the problem (keywords: sparse nonnegative solution of underdetermined linear equations).\r\n * The problem is usually approximated as convex optimization problem by minimizing L1-norm (sum of \r\n * absolute value) instead. One option could be to use the cassowary javascript library.\r\n * \r\n * In this function we find a non-negative x using Gaussian elimination and setting random combinations \r\n * of free variables to zero until we find a non-negative solution.\r\n */\r\nfunction debtSolverFactory(solveLinearSystem) {\r\n  \r\n  return solve;\r\n  \r\n  \r\n  function solve(participations) {\r\n    if (!participations || participations.length === 0) {\r\n      return [];\r\n    }\r\n    var balances = computeBalances(participations);\r\n    if (!hasNonZeroBalance(balances)) {\r\n      return [];\r\n    }\r\n    var roles = getDebtorsAndCreditors(balances);\r\n    var linearSystem = createDebtEquations(roles);\r\n    var debtVector = solveDebts(linearSystem);\r\n    var debts = createDebts(debtVector, roles);\r\n    return debts;\r\n  }\r\n  \r\n  function computeBalances(participations) {\r\n    var balances = {};\r\n    angular.forEach(participations, function(p) {\r\n      var b = balances[p.person.id];\r\n      if (b === undefined) {\r\n        b = {person: p.person, balance: new Decimal(0)};\r\n        balances[p.person.id] = b;\r\n      }\r\n      var paid = new Decimal(p.paid);\r\n      var share = new Decimal(p.share);\r\n      b.balance = b.balance.add(share.subtract(paid));\r\n    });\r\n\r\n    angular.forEach(balances, function(b) {\r\n      b.balance = b.balance.toNumber();\r\n    });\r\n    \r\n    return balances;\r\n  }\r\n  \r\n  function hasNonZeroBalance(balances) {\r\n    var result = false;\r\n    angular.forEach(balances, function(b) {\r\n      if (b.balance !== 0) {\r\n        result = true;\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n  \r\n  function getDebtorsAndCreditors(balances) {\r\n    var debtors = [];\r\n    var creditors = [];\r\n    \r\n    angular.forEach(balances, function(b) {\r\n      if (b.balance <= 0) {\r\n        creditors.push(b);\r\n      } else {\r\n        debtors.push(b);\r\n      }\r\n    });\r\n    \r\n    return {\r\n      debtors: debtors,\r\n      creditors: creditors\r\n    };\r\n  }\r\n  \r\n  function createDebtEquations(roles) {\r\n    var d = roles.debtors.length;\r\n    var c = roles.creditors.length;\r\n    \r\n    // Right-hand side vector, creditor balances converted to non-negative to allow binary coefficients\r\n    var b = []; \r\n    for (var i = 0; i < d; i++) {\r\n      b[i] = (new Decimal(roles.debtors[i].balance)).multiply(100).toNumber();\r\n    }\r\n    for (var i = 0; i < c; i++) {\r\n      b[d + i] = (new Decimal(roles.creditors[i].balance)).multiply(-100).toNumber();\r\n    }\r\n    \r\n    // Coefficient matrix\r\n    var A = initMatrix(d + c, d*c); \r\n    \r\n    // Coefficients of equations \"sum of debts paid by debtor = debtor's balance\"\r\n    for (var i = 0; i < d; i++) {\r\n      for (var j = i*c; j < (i+1)*c; j++) {\r\n        A[i][j] = 1;\r\n      }\r\n    }\r\n    \r\n    // Coefficients of equations \"sum debts received by creditor = creditor's balance\"\r\n    for (var i = d; i < c+d; ++i) {\r\n      for (var j = (i-d); j < d*c; j += c) {\r\n        A[i][j] = 1;\r\n      }\r\n    } \r\n    \r\n    return {\r\n      A: A,\r\n      b: b\r\n    };\r\n  }\r\n  \r\n  function initMatrix(rows, cols) {\r\n    var A = [];\r\n    for (var i = 0; i < rows; i++) {\r\n      A[i] = [];\r\n      for (var j = 0; j < cols; j++) {\r\n        A[i][j] = 0;\r\n      }\r\n    }\r\n    return A;\r\n  }\r\n  \r\n  // Solve debts, ensuring a non-negative solution \r\n  function solveDebts(linearSystem) {\r\n    var solution = solveLinearSystem(linearSystem);\r\n    var numVars = solution.numberOfVariables;\r\n    var numFreeVars = solution.numberOfFreeVariables;\r\n    \r\n    if (numFreeVars === 0) {\r\n      return solution.xVector;\r\n    }\r\n\r\n    // Known seed so we always get the same result from\r\n    // the same system.\r\n    var randomEngine = Random.engines.mt19937();\r\n    randomEngine.seed(20150312);\r\n\r\n    var toEliminate;\r\n    do {\r\n      \r\n      var A = angular.copy(linearSystem.A);\r\n      var b = linearSystem.b;\r\n      \r\n      // Pick random numFreeVars variables for elimination\r\n      \r\n      var candidates = [];\r\n      for (var i = 0; i < numVars; i++) {\r\n        candidates[i] = i;\r\n      }\r\n      \r\n      toEliminate = [];\r\n      for (var i = 0; i < numFreeVars; i++) {\r\n        var candidateIdx = Random.integer(0, candidates.length-1)(randomEngine);\r\n        toEliminate.push(candidates[candidateIdx]);\r\n        candidates.splice(candidateIdx, 1);\r\n      }\r\n      \r\n      // Eliminate the chosen variables by setting their coefficients to zero\r\n      \r\n      for (var i = 0; i < A.length; i++) {\r\n        for (var j = 0; j < toEliminate.length; j++) {\r\n          A[i][toEliminate[j]] = 0;\r\n        }\r\n      }\r\n\r\n      // Solve the updated system\r\n      \r\n      solution = solveLinearSystem({A: A, b: b});\r\n      \r\n    } while (!isNonNegative(solution.xVector));\r\n\r\n    \r\n    return solution.xVector;\r\n  }\r\n  \r\n  function isNonNegative(vector) {\r\n    if (!vector) {\r\n      return false;\r\n    }\r\n    for (var i = 0; i < vector.length; i++) {\r\n      if (vector[i] < 0) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n  \r\n  function createDebts(debtVector, roles) {\r\n    var debts = [];\r\n\r\n    for (var i = 0; i < debtVector.length; i++) {\r\n      if (debtVector[i] !== 0) {\r\n        var debtorIdx = Math.floor(i/roles.creditors.length);\r\n        var creditorIdx = i - roles.creditors.length*debtorIdx;\r\n        var amount = (new Decimal(debtVector[i])).divideBy(100).toNumber();\r\n        var debt = {debtor: roles.debtors[debtorIdx].person, creditor: roles.creditors[creditorIdx].person, amount: amount};\r\n        debts.push(debt);\r\n      }\r\n    }\r\n    \r\n    return debts;\r\n  }\r\n}\r\ndebtSolverFactory.$inject = [\"solveLinearSystem\"];  \n},{\"angular\":\"angular\",\"random-js\":\"random-js\",\"simple-decimal-money\":\"simple-decimal-money\"}],10:[function(require,module,exports){\n\"use strict\";\r\n\r\nrequire(\"./lin-eq-solver\");\r\nrequire(\"./lin-eq-solver-factory\");\r\nrequire(\"./debt-solver\");\r\nrequire(\"./debt-service\");\n},{\"./debt-service\":8,\"./debt-solver\":9,\"./lin-eq-solver\":12,\"./lin-eq-solver-factory\":11}],11:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar solve = require(\"./lin-eq-solver\");\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n.factory(\"solveLinearSystem\", solveLinearSystem);\r\n\r\nfunction solveLinearSystem() {\r\n  return solve;\r\n}\n},{\"./lin-eq-solver\":12,\"angular\":\"angular\"}],12:[function(require,module,exports){\n\"use strict\";\r\n\r\n\r\nfunction solve(input) {\r\n\t// Internal copies of the linear system and its dimensions\r\n\tvar coefMatrix, constVector, xVector;\r\n\tvar m, n, rank, numberOfSolutions;\r\n\t\r\n\t// With these we can \"virtually\" rearrange the rows and columns\r\n\t// for better numerical stability in the variable elimination phases.\r\n\t// At step i, row index pivotToEquationMap[i] is the pivot equation and\r\n\t// it is used for eliminating variable index pivotToVariableMap[i] from all the\r\n\t// other equations.\r\n\tvar pivotToEquationMap, pivotToVariableMap, equationScale;\r\n\t\r\n\tvalidate();\r\n\tinitialize();\r\n\ttransformToRowEchelonForm();\r\n\treduceRowEchelonForm();\r\n\tdetermineRank();\r\n\tdetermineNumberOfSolutions();\r\n\tdetermineSolution();\r\n\r\n\treturn {\r\n\t\txVector: xVector,\r\n\t\tnumberOfEquations: m,\r\n\t\tnumberOfVariables: n,\r\n\t\trank: rank,\r\n\t\tnumberOfFreeVariables: n - rank,\r\n\t\tnumberOfSolutions: numberOfSolutions\r\n\t};\r\n\t\r\n\t/////////////////////////////////////////////////////////////\r\n\t\r\n\tfunction validate() {\r\n    \tif (!input || !input.A || !input.b) {\r\n    \t\tthrow \"Null matrix A or vector b in system Ax = b\";\r\n    \t}\r\n    \t\r\n    \tif (input.A.length < 1 || input.A[0].length < 1) {\r\n    \t\tthrow \"Matrix A in Ax = b has no rows or no columns\";\r\n    \t}\r\n\t\t\r\n    \tif (input.A.length != input.b.length) {\r\n    \t\tthrow \"The dimensions of the matrix and the constant vector are incompatible\"; \r\n    \t}\r\n\t}\r\n\r\n\tfunction initialize() {\r\n\t\tcoefMatrix = copyMatrix(input.A);\r\n\t\tconstVector = copyArray(input.b);\r\n\t\t\r\n\t\tm = coefMatrix.length;\r\n\t\tn = coefMatrix[0].length;\r\n\r\n\t\tpivotToEquationMap = [];\r\n\t\tfor (var i = 0; i < m; i++) {\r\n\t\t\tpivotToEquationMap[i] = i;\r\n\t\t}\r\n\t\t\r\n\t\tequationScale = [];\r\n\t\tfor (var i = 0; i < m; i++) {\r\n\t\t\tequationScale[i] = 0;\r\n\t\t\tfor (var j = 0; j < n; j++) {\r\n\t\t\t\tvar abscoef = Math.abs(coefMatrix[i][j]);\r\n\t\t\t\tif (abscoef > equationScale[i]) {\r\n\t\t\t\t\tequationScale[i] = abscoef;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpivotToVariableMap = [];\r\n\t\tfor (var j = 0; j < n; j++) {\r\n\t\t\tpivotToVariableMap[j] = j;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction transformToRowEchelonForm() {\r\n\t\tvar pivotIdx = 0; \r\n\t\tvar knownFreeVariables = [];\r\n\t\t\r\n\t\twhile (pivotIdx < m-1) { \r\n\r\n\t\t\t// Choose the best pivot-equation for eliminating variable pivotToVariableMap[pivotIdx] \r\n\t\t\t// from equations equations not yet used as pivot equations.\r\n\t\t\tvar maxRatio = 0;\r\n\t\t\tvar bestPivotEquationIndex = pivotIdx;\r\n\t\t\tfor (var i = pivotIdx; i < m; ++i) {\r\n\t\t\t\tvar rowIdx = pivotToEquationMap[i];\r\n\t\t\t\tvar colIdx = pivotToVariableMap[pivotIdx];\r\n\t\t\t\tvar ratio = Math.abs(coefMatrix[rowIdx][colIdx]/equationScale[rowIdx]);\r\n\t\r\n\t\t\t\tif (ratio > maxRatio) {\r\n\t\t\t\t\tmaxRatio = ratio;\r\n\t\t\t\t\tbestPivotEquationIndex = i;\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// If maxRatio == 0, the coefficient of variable pivotToVariableMap[pivotIdx] is 0 in all the rest of the equations. \r\n\t\t\t// That is pivotToVariableMap[pivotIdx] is a free variable. Find the next suitable variable.\r\n\t\t\tif (maxRatio === 0) {\r\n\t\t\t\tvar currPivotVaribleIdx = pivotToVariableMap[pivotIdx];\r\n\t\t\t\tknownFreeVariables[currPivotVaribleIdx] = true;     \r\n\t\t\t\t\r\n\t\t\t\t// The next one must not be a free variable.\r\n\t\t\t\tvar i = pivotIdx;\r\n\t\t\t\tvar newPivotVariableIdx = currPivotVaribleIdx;\r\n\t\t\t\twhile (newPivotVariableIdx == currPivotVaribleIdx && i < n-1) {\r\n\t\t\t\t\t++i;\r\n\t\t\t\t\tif (!knownFreeVariables[pivotToVariableMap[i]]) {\r\n\t\t\t\t\t\tnewPivotVariableIdx = pivotToVariableMap[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (newPivotVariableIdx != currPivotVaribleIdx) {\r\n\t\t\t\t\tpivotToVariableMap[pivotIdx] = newPivotVariableIdx;\r\n\t\t\t\t\tpivotToVariableMap[i] = currPivotVaribleIdx;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else { \r\n\t\t\t\t\t// Could not find a suitable variable. This means the row echelon form is ready.\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\r\n\t\t\tvar temp = pivotToEquationMap[pivotIdx];\r\n\t\t\tpivotToEquationMap[pivotIdx] = pivotToEquationMap[bestPivotEquationIndex];\r\n\t\t\tpivotToEquationMap[bestPivotEquationIndex] = temp;     \r\n\t\t\t\r\n\t\t\t// Elimination phase\r\n\t\t\tvar pivotRowIdx = pivotToEquationMap[pivotIdx];\r\n\t\t\tvar pivotColIdx = pivotToVariableMap[pivotIdx];\r\n\t\t\tfor (i = pivotIdx + 1; i < m; ++i) {\r\n\t\t\t\tvar rowIdx = pivotToEquationMap[i];\r\n\t\t\t\tvar mult = coefMatrix[rowIdx][pivotColIdx] / coefMatrix[pivotRowIdx][pivotColIdx];\r\n\r\n\t\t\t\tfor (var j = pivotIdx + 1; j < n; ++j) {\r\n\t\t\t\t\tvar colIndex = pivotToVariableMap[j];\r\n\t\t\t\t\tcoefMatrix[rowIdx][colIndex] = coefMatrix[rowIdx][colIndex] - mult * coefMatrix[pivotRowIdx][colIndex];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcoefMatrix[rowIdx][pivotColIdx] = 0;\r\n\t\t\t\tconstVector[rowIdx] = constVector[rowIdx] - mult * constVector[pivotRowIdx];\r\n\t\t\t}\r\n\r\n\t\t\tpivotIdx++;\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tfunction reduceRowEchelonForm() {\r\n\t\t// Eliminate pivot variables from previous pivot equations by going through the pivot steps in reverse order.\r\n\t\tvar pivotIndex;\r\n\t\tfor (pivotIndex = Math.min(m, n) - 1; pivotIndex > 0; --pivotIndex) {\r\n\t\t\tvar pivotRowIdx = pivotToEquationMap[pivotIndex];\r\n\t\t\tvar pivotColIdx = pivotToVariableMap[pivotIndex];\r\n\t\t\t\r\n\t\t\tif (coefMatrix[pivotRowIdx][pivotColIdx] === 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (var i = pivotIndex - 1; i > -1; --i) {\r\n\t\t\t\t\r\n\t\t\t\tvar mult = coefMatrix[pivotToEquationMap[i]][pivotToVariableMap[pivotIndex]]/coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[pivotIndex]];\r\n\t\t\t\tfor (var j = 0; j < n; ++j) {\r\n\t\t\t\t\tcoefMatrix[pivotToEquationMap[i]][pivotToVariableMap[j]] -= mult*coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[j]];\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconstVector[pivotToEquationMap[i]] -= mult*constVector[pivotToEquationMap[pivotIndex]];\r\n\t\t\t}            \t\t\r\n\t\t}\r\n\t\t\r\n\t\t// Normalize the coeffients in each row and the rhs value by the coeffient of the pivot variable in the row\r\n\t\tfor (pivotIndex = 0; pivotIndex < Math.min(m, n); ++pivotIndex) {\r\n\t\t\t\r\n\t\t\tif (coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[pivotIndex]] === 0) {\r\n\t\t\t\tcontinue; \r\n\t\t\t}\r\n\r\n\t\t\tvar div = coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[pivotIndex]];\r\n\t\t\tfor (var j = 0; j < n; ++j) {\r\n\t\t\t\tcoefMatrix[pivotToEquationMap[pivotIndex]][j] = coefMatrix[pivotToEquationMap[pivotIndex]][j]/div;\r\n\t\t\t}\r\n\t\t\tconstVector[pivotToEquationMap[pivotIndex]] = constVector[pivotToEquationMap[pivotIndex]]/div;\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\tfunction determineRank() {\r\n\t\trank = 0;\r\n\t\tvar i,j;\r\n\t\t\r\n\t\tcolumns: \r\n\t\tfor (j=0; j<n; ++j) {\r\n\t\t\trows:\r\n\t\t\tfor (i=0; i<m; ++i) { \r\n\t\t\t\tif (i != j && coefMatrix[pivotToEquationMap[i]][pivotToVariableMap[j]] !== 0) {\r\n\t\t\t\t\tbreak columns;\r\n\t\t\t\t}\r\n\t\t\t\telse if (i == j && coefMatrix[pivotToEquationMap[i]][pivotToVariableMap[j]] != 1) {\r\n\t\t\t\t\tbreak columns;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t++rank;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction determineNumberOfSolutions() {\r\n\t\t\r\n\t\tvar b2IsZero = true;\r\n\r\n\t\tfor (var i = rank; i < m; ++i) {\r\n\t\t\tif (constVector[pivotToEquationMap[i]] !== 0) {\r\n\t\t\t\tb2IsZero = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (rank < m && !b2IsZero) {\r\n\t\t\tnumberOfSolutions = 0;\r\n\t\t} else if (rank == n && (rank == m || b2IsZero)) {\r\n\t\t\tnumberOfSolutions = 1;\r\n\t\t} else if (rank < n && (rank == m || b2IsZero)) {\r\n\t\t\tnumberOfSolutions = Number.MAX_VALUE;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction determineSolution() {\r\n\t\tif (numberOfSolutions === 0) {\r\n\t\t\txVector = undefined;\r\n\t\t} else {\r\n\t\t\txVector = initArray(n);\r\n\t\t\tfor (var i = 0; i < rank; ++i) {\r\n\t\t\t\txVector[pivotToVariableMap[i]] = constVector[pivotToEquationMap[i]];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction initArray(size) {\r\n\t\tvar array = [];\r\n\t\tfor (var i = 0; i < size; i++) {\r\n\t\t\tarray[i] = 0;\r\n\t\t}\r\n\t\treturn array;\r\n\t}\r\n\t\r\nfunction copyArray(input) {\r\n\treturn input.slice();\r\n}\r\n\r\nfunction copyMatrix(input) {\r\n\tvar copy = [];\r\n\tfor (var i = 0; i < input.length; i++) {\r\n\t\tcopy[i] = input[i].slice();\r\n\t}\r\n\treturn copy;\r\n}\r\n\t\r\n\r\nmodule.exports = solve;\n},{}],13:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n.factory(\"openCreateExpenseDialog\", openCreateExpenseDialog);\r\n\r\n\r\nfunction openCreateExpenseDialog($mdDialog) {\r\n  \r\n  return open;\r\n  \r\n  function open() {\r\n    return $mdDialog.show({\r\n      templateUrl: \"expenses/create-expense-dialog.html\",\r\n      controller: DialogController,\r\n      controllerAs: \"vm\"\r\n    });\r\n  }\r\n  \r\n}\r\nopenCreateExpenseDialog.$inject = [\"$mdDialog\"];\r\n\r\nfunction DialogController($mdDialog) {\r\n  var vm = this;\r\n  \r\n  vm.ok = ok;\r\n  vm.cancel = cancel;\r\n  vm.init = init;\r\n  \r\n  init();\r\n  \r\n  \r\n  function init() {\r\n    vm.expense = {\r\n      name: undefined,\r\n      sharing: \"equal\"\r\n    };\r\n    vm.options = {\r\n      createParticipations: true\r\n    };\r\n  }\r\n\r\n  function ok() {\r\n    $mdDialog.hide({expense: vm.expense, options: vm.options});\r\n  }\r\n  \r\n  function cancel() {\r\n    $mdDialog.cancel();\r\n  }\r\n}\r\nDialogController.$inject = [\"$mdDialog\"];\n},{\"angular\":\"angular\"}],14:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar _ = require('lodash');\r\nvar angular = require(\"angular\");\r\n\r\nangular\r\n  .module(\"debtApp\")\r\n  .controller(\"ExpenseDetailCtrl\", ExpenseDetailCtrl);\r\n\r\nfunction ExpenseDetailCtrl(balanceSheetService, debtService, events, $mdDialog, $stateParams, $state, $scope) {\r\n  var vm = this;\r\n\r\n  var confirmRemoveExpense = $mdDialog.confirm()\r\n    .content(\"Really delete this expense?\")\r\n    .ok(\"Ok\").cancel(\"Cancel\");\r\n\r\n  vm.init = init;\r\n  vm.setParticipation = setParticipation;\r\n  vm.updateExpense = updateExpense;\r\n  vm.removeExpense = removeExpense;\r\n\r\n  init();\r\n\r\n  /////////////////////////////////////////////////////////////\r\n\r\n  function init() {\r\n    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n    vm.expense = vm.balanceSheet.getExpense($stateParams.id);\r\n    vm.isParticipant = {};\r\n    vm.everyoneParticipates = true;\r\n    updateExpense();\r\n\r\n    $scope.$on(events.BALANCE_SHEET_UPDATED, function(event) {\r\n      if (event.targetScope != $scope) {\r\n        vm.updateExpense();\r\n      }\r\n    });\r\n  }\r\n\r\n  function updateExpense() {\r\n    vm.expense.shareCost();\r\n    vm.isParticipant = getParticipationMap();\r\n    vm.debtsByDebtor = computeDebts();\r\n    vm.cost = vm.expense.getCost();\r\n    vm.sumOfShares = vm.expense.getSumOfShares();\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n\r\n  function getParticipationMap() {\r\n    var map = {};\r\n\r\n    angular.forEach(vm.balanceSheet.persons, function(person) {\r\n      map[person.id] = false;\r\n      angular.forEach(vm.expense.getParticipations(), function(p) {\r\n        if (p.person.equals(person)) {\r\n          map[person.id] = true;\r\n        }\r\n      });\r\n    });\r\n\r\n    return map;\r\n  }\r\n\r\n  function setParticipation(person, isParticipant) {\r\n    if (isParticipant) {\r\n      vm.balanceSheet.createParticipation({expense: vm.expense, person: person});\r\n    } else {\r\n      vm.balanceSheet.removeParticipation({expense: vm.expense, person: person});\r\n    }\r\n    updateExpense();\r\n  }\r\n\r\n  function removeExpense() {\r\n    $mdDialog.show(confirmRemoveExpense)\r\n      .then(doRemoveExpense);\r\n  }\r\n\r\n  function doRemoveExpense() {\r\n    vm.balanceSheet.removeExpense(vm.expense);\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n    $state.go(\"balanceSheet\");\r\n  }\r\n\r\n  function computeDebts() {\r\n    if (vm.expense.isBalanced()) {\r\n      var debts = debtService.computeDebts(vm.expense.getParticipations());\r\n      return debtService.organizeByDebtor(debts);\r\n    }\r\n  }\r\n\r\n\r\n}\r\nExpenseDetailCtrl.$inject = [\"balanceSheetService\", \"debtService\", \"events\", \"$mdDialog\", \"$stateParams\", \"$state\", \"$scope\"];\r\n\n},{\"angular\":\"angular\",\"lodash\":\"lodash\"}],15:[function(require,module,exports){\n\"use strict\";\r\n\r\nrequire(\"./route-config\");\r\nrequire(\"./expense-detail-ctrl\");\r\nrequire(\"./create-expense-dialog\");\n},{\"./create-expense-dialog\":13,\"./expense-detail-ctrl\":14,\"./route-config\":16}],16:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n\t.config(config);\r\n\r\nfunction config($stateProvider) {\r\n\r\n\t$stateProvider\r\n\t\t.state(\"expense\", {\r\n\t\t\turl: \"/expenses/:id\",\r\n\t    templateUrl: \"expenses/expense-detail.html\",\r\n      controller: \"ExpenseDetailCtrl as vm\"\r\n\t\t})\r\n\t\t;\r\n}\r\nconfig.$inject = [\"$stateProvider\"];\n},{\"angular\":\"angular\"}],17:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n.factory(\"openCreatePersonDialog\", openCreatePersonDialog);\r\n\r\n\r\nfunction openCreatePersonDialog($mdDialog) {\r\n  \r\n  return open;\r\n  \r\n  function open() {\r\n    return $mdDialog.show({\r\n      templateUrl: \"persons/create-person-dialog.html\",\r\n      controller: DialogController,\r\n      controllerAs: \"vm\"\r\n    });\r\n  }\r\n  \r\n}\r\nopenCreatePersonDialog.$inject = [\"$mdDialog\"];\r\n\r\nfunction DialogController($mdDialog) {\r\n  var vm = this;\r\n  \r\n  vm.ok = ok;\r\n  vm.cancel = cancel;\r\n  vm.init = init;\r\n  \r\n  init();\r\n  \r\n  \r\n  function init() {\r\n    vm.person = {\r\n      name: undefined\r\n    };\r\n    vm.options = {\r\n      createParticipations: true\r\n    };\r\n  }\r\n\r\n  function ok() {\r\n    $mdDialog.hide({person: vm.person, options: vm.options});\r\n  }\r\n  \r\n  function cancel() {\r\n    $mdDialog.cancel();\r\n  }\r\n}\r\nDialogController.$inject = [\"$mdDialog\"];\n},{\"angular\":\"angular\"}],18:[function(require,module,exports){\n\"use strict\";\r\n\r\nrequire(\"./route-config\");\r\nrequire(\"./person-detail-ctrl\");\r\nrequire(\"./create-person-dialog\");\n},{\"./create-person-dialog\":17,\"./person-detail-ctrl\":19,\"./route-config\":20}],19:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar _ = require('lodash');\r\n\r\nangular.module(\"debtApp\")\r\n  .controller(\"PersonDetailCtrl\", PersonDetailCtrl);\r\n\r\nfunction PersonDetailCtrl(balanceSheetService, debtService, events, $state, $stateParams, $mdDialog, $scope, $log) {\r\n\r\n  var vm = this;\r\n  var confirmRemovePerson;\r\n\r\n  vm.init = init;\r\n  vm.refresh = refresh;\r\n  vm.updateExpense = updateExpense;\r\n  vm.setParticipation = setParticipation;\r\n  vm.removePerson = removePerson;\r\n  vm.updatePerson = updatePerson;\r\n\r\n  init();\r\n\r\n  function init() {\r\n    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n    vm.person = vm.balanceSheet.getPerson($stateParams.id);\r\n\r\n    refresh();\r\n\r\n    confirmRemovePerson = $mdDialog.confirm()\r\n      .content(\"Really delete this person?\")\r\n      .ok(\"Ok\").cancel(\"Cancel\");\r\n\r\n    $scope.$on(events.BALANCE_SHEET_UPDATED, vm.refresh);\r\n  }\r\n\r\n  function refresh() {\r\n    vm.isParticipant = getParticipationMap();\r\n    vm.cost = vm.person.getCost();\r\n    vm.sumOfShares = vm.person.getSumOfShares();\r\n    vm.balance = vm.person.getBalance();\r\n    var debtResult = computeDebts();\r\n    vm.debtRole = debtResult.role;\r\n    vm.debts = debtResult.debts;\r\n  }\r\n\r\n  function getParticipationMap() {\r\n    var map = {};\r\n\r\n    _.forEach(vm.balanceSheet.expenses, function(expense) {\r\n      map[expense.id] = false;\r\n      _.forEach(vm.person.getParticipations(), function(pt) {\r\n        if (pt.expense.equals(expense)) {\r\n          map[expense.id] = true;\r\n        }\r\n      });\r\n    });\r\n\r\n    return map;\r\n  }\r\n\r\n  function updateExpense(expense) {\r\n    expense.shareCost();\r\n    refresh();\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n\r\n  function setParticipation(expense, isParticipant) {\r\n    if (isParticipant) {\r\n      vm.balanceSheet.createParticipation({expense: expense, person: vm.person});\r\n    } else {\r\n      vm.balanceSheet.removeParticipation({expense: expense, person: vm.person});\r\n    }\r\n    vm.updateExpense(expense);\r\n  }\r\n\r\n  function computeDebts() {\r\n    var result = {\r\n      role: undefined,\r\n      debts: undefined\r\n    };\r\n\r\n    if (!vm.balanceSheet.isBalanced()) {\r\n      result.role = \"unbalanced\";\r\n      return result;\r\n    }\r\n\r\n    if (vm.balance > 0) {\r\n      result.role = \"debtor\";\r\n    } else if (vm.balance < 0) {\r\n      result.role = \"creditor\";\r\n    } else {\r\n      result.role = \"settled\";\r\n      return result;\r\n    }\r\n\r\n    var counterRole = {\r\n      \"debtor\": \"creditor\",\r\n      \"creditor\": \"debtor\"\r\n    };\r\n\r\n    var debts = debtService.computeDebts(vm.balanceSheet.getNonSettledParticipations());\r\n    result.debts = _.chain(debts)\r\n      .filter(function(d) {\r\n        return d[result.role].equals(vm.person);\r\n      })\r\n      .map(function(d) {\r\n        return {person: d[counterRole[result.role]], amount: d.amount};\r\n      })\r\n      .value();\r\n\r\n    return result;\r\n  }\r\n\r\n  function removePerson() {\r\n    $mdDialog.show(confirmRemovePerson)\r\n      .then(doRemovePerson);\r\n  }\r\n\r\n  function doRemovePerson() {\r\n    vm.balanceSheet.removePerson(vm.person);\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n    $state.go(\"balanceSheet\");\r\n  }\r\n\r\n  function updatePerson() {\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n}\r\nPersonDetailCtrl.$inject = [\"balanceSheetService\", \"debtService\", \"events\", \"$state\", \"$stateParams\", \"$mdDialog\", \"$scope\", \"$log\"];\r\n\n},{\"angular\":\"angular\",\"lodash\":\"lodash\"}],20:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n  .config(config);\r\n\r\nfunction config($stateProvider) {\r\n\r\n  $stateProvider\r\n    .state(\"person\", {\r\n      url: \"/persons/:id\",\r\n      templateUrl: \"persons/person-detail.html\",\r\n      controller: \"PersonDetailCtrl as vm\"\r\n    })\r\n    ;\r\n}\r\nconfig.$inject = [\"$stateProvider\"];\n},{\"angular\":\"angular\"}],21:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n\t.config(config);\r\n\r\nfunction config($urlRouterProvider) {\r\n  \r\n  $urlRouterProvider.otherwise(\"/\");\r\n  \r\n}\r\nconfig.$inject = [\"$urlRouterProvider\"];\n},{\"angular\":\"angular\"}],22:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar _ = require('lodash');\r\n\r\nangular.module(\"debtApp\")\r\n  .filter(\"balance\", balance);\r\n\r\n\r\nfunction balance($filter) {\r\n  return function balance(value) {\r\n    if (value > 0) {\r\n      return \"+\" + $filter(\"number\")(value, \"2\");\r\n    } else if (value <= 0) {\r\n      return $filter(\"number\")(value, \"2\");\r\n    } else {\r\n      return undefined;\r\n    }\r\n  };\r\n}\r\nbalance.$inject = [\"$filter\"];\n},{\"angular\":\"angular\",\"lodash\":\"lodash\"}],23:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar fileSaver = require(\"node-safe-filesaver\");\r\nrequire(\"blob-polyfill\");\r\n\r\nangular.module(\"debtApp\")\r\n  .factory(\"fileService\", fileService);\r\n\r\n\r\nfunction fileService($q, $window) {\r\n\r\n  return {\r\n    readAsText: readAsText,\r\n    saveAsFile: saveAsFile,\r\n    isSupported: isSupported\r\n  };\r\n\r\n  function readAsText(blob) {\r\n    var deferred = $q.defer();\r\n\r\n    var reader = new $window.FileReader();\r\n    reader.onload = function() {\r\n      deferred.resolve(reader.result);\r\n    };\r\n    reader.onerror = function() {\r\n      deferred.resolve(reader.error);\r\n    };\r\n    reader.readAsText(blob);\r\n\r\n    return deferred.promise;\r\n  }\r\n\r\n  function saveAsFile(dataArray, fileName) {\r\n    var blob = new $window.Blob(dataArray, {});\r\n    fileSaver.saveAs(blob, fileName);\r\n  }\r\n\r\n  function isSupported() {\r\n    return $window.FileReader && $window.Blob;\r\n  }\r\n}\r\nfileService.$inject = [\"$q\", \"$window\"];\n},{\"angular\":\"angular\",\"blob-polyfill\":\"blob-polyfill\",\"node-safe-filesaver\":\"node-safe-filesaver\"}],24:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n  .directive(\"focus\", focus);\r\n\r\n\r\nfunction focus($timeout) {\r\n  return {\r\n    restrict: \"A\",\r\n    link: function($scope, iElem) {\r\n      $timeout(function() {\r\n        iElem[0].focus();\r\n      }, 0);\r\n    }\r\n  };\r\n}\r\nfocus.$inject = [\"$timeout\"];\n},{\"angular\":\"angular\"}],25:[function(require,module,exports){\n\"use strict\";\r\n\r\nrequire(\"./money-input-directive\");\r\nrequire(\"./balance-filter\");\r\nrequire(\"./money-filter\");\r\nrequire(\"./file-service\");\r\nrequire(\"./focus-directive\");\n},{\"./balance-filter\":22,\"./file-service\":23,\"./focus-directive\":24,\"./money-filter\":26,\"./money-input-directive\":27}],26:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n  .filter(\"money\", money);\r\n\r\n\r\nfunction money($filter) {\r\n  return function money(value) {\r\n    return $filter(\"number\")(value, \"2\");\r\n  };\r\n}\r\nmoney.$inject = [\"$filter\"];\n},{\"angular\":\"angular\"}],27:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar Decimal = require(\"simple-decimal-money\");\r\n\r\nangular.module(\"debtApp\")\r\n  .directive(\"moneyInput\", moneyInput);\r\n\r\n\r\nfunction moneyInput($filter) {\r\n  return {\r\n    restrict: \"A\",\r\n    require: \"ngModel\",\r\n    link: link\r\n  };\r\n\r\n  function link($scope, iElem, iAttrs, ngModel) {\r\n    ngModel.$validators.money = validateMoney;\r\n    ngModel.$parsers.push(parseMoney);\r\n    ngModel.$formatters.unshift(formatMoney);\r\n\r\n    iElem.on(\"blur\", handleBlur);\r\n    ngModel.$render = render;\r\n\r\n    function render() {\r\n      if (ngModel.$valid) {\r\n        iElem.val(formatMoney(ngModel.$modelValue));\r\n      } else {\r\n        iElem.val(ngModel.$viewValue);\r\n      }\r\n    }\r\n\r\n    function handleBlur() {\r\n      ngModel.$render();\r\n    }\r\n  }\r\n\r\n  function validateMoney(value) {\r\n    if (value < 0) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  function formatMoney(value) {\r\n    if (value === undefined || value === null) {\r\n      return \"\";\r\n    } else {\r\n      return $filter(\"number\")(value, 2);\r\n    }\r\n  }\r\n\r\n  function parseMoney(value) {\r\n    return new Decimal(value).toNumber();\r\n  }\r\n\r\n}\r\nmoneyInput.$inject = [\"$filter\"];\r\n\n},{\"angular\":\"angular\",\"simple-decimal-money\":\"simple-decimal-money\"}]},{},[1]);\n"],"sourceRoot":"/source/"}