{"version":3,"sources":["debt.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","configureLocalStorage","localStorageServiceProvider","setPrefix","configureIcons","$mdIconProvider","spriteNames","spriteProps","_","map","name","fileName","filePath","spriteName","each","prop","iconSet","hrefSanitization","$compileProvider","aHrefSanitizationWhitelist","makeStateAvailableInScope","$rootScope","$state","$stateParams","angular","constant","BALANCE_SHEET_UPDATED","value","debounce","config","run","$inject","./balance-sheet","./debt-app-ctrl","./debts","./expenses","./persons","./route-config","./utils","angular-local-storage","angular-material","angular-route","angular-ui-router","lodash","ng-file-upload","ng-mfb",2,"BalanceSheetCtrl","balanceSheetService","debtService","events","$scope","init","refresh","$on","vm","balanceSheet","debtsByDebtor","computeDebts","isBalanced","participations","getNonSettledParticipations","debts","organizeByDebtor","undefined","updateSheet","$emit","this","controller",3,"localStorageService","data","get","service","BalanceSheet","error","save","throwErrorIfInvalid","set","exportData","loadFromJson","json","fromJson","exportToJson","toJson","createNew","factory",4,"Decimal","filter","pt","expense","settled","reduce","expenses","getPerson","id","persons","find","p","createPerson","options","extend","idSequence","person","Person","push","createParticipations","createParticipation","shareCost","removePerson","toRemove","remove","equals","forEach","getParticipations","removeParticipation","getExpense","createExpense","sharing","Expense","removeExpense","getParticipation","criteria","toSeek","Participation","paid","share","participation","getCost","_cost","toNumber","getSumOfShares","_sumOfShares","_balance","getBalance","_myParticipations","other","_this","chain","_nonSettledParticipations","cost","add","sum","subtract","b","shareEqually","divideBy","lastShare","multiply","last","isNotFunction","negate","isFunction","pick","personId","expenseId","importData","concat","pluck","max","Infinity","separately","key","isValid","isNumber","idToEntity","message","simple-decimal-money",5,"./balance-sheet-ctrl","./balance-sheet-service",6,"$stateProvider","state","url","templateUrl",7,"DebtAppCtrl","balanceSheetSaveInterval","openCreatePersonDialog","openCreateExpenseDialog","fileService","$mdDialog","$mdSidenav","$log","toggleMenu","toggle","onBalanceSheetUpdated","errorMessage","then","dialogResult","$broadcast","createNewSheet","show","confirmCreateNewSheet","go","mainMenu","loadSheet","files","isSupported","file","readAsText","result","loadSheetFromJson","exportSheet","saveAsFile","showHelp","close","hide","confirm","title","content","ok","cancel",8,"solveDebts","debtorList","debtorIndices","d","debtor","debtorIndex","creditor","amount","sort","d1","d2","localeCompare",9,"debtSolverFactory","solveLinearSystem","solve","balances","computeBalances","hasNonZeroBalance","roles","getDebtorsAndCreditors","linearSystem","createDebtEquations","debtVector","createDebts","balance","debtors","creditors","c","A","initMatrix","j","rows","cols","solution","numVars","numberOfVariables","numFreeVars","numberOfFreeVariables","xVector","randomEngine","Random","engines","mt19937","seed","toEliminate","copy","candidates","candidateIdx","integer","splice","isNonNegative","vector","debtorIdx","Math","floor","creditorIdx","debt","random-js",10,"./debt-service","./debt-solver","./lin-eq-solver","./lin-eq-solver-factory",11,12,"input","validate","initialize","coefMatrix","copyMatrix","constVector","copyArray","m","pivotToEquationMap","equationScale","abscoef","abs","pivotToVariableMap","transformToRowEchelonForm","pivotIdx","knownFreeVariables","maxRatio","bestPivotEquationIndex","rowIdx","colIdx","ratio","currPivotVaribleIdx","newPivotVariableIdx","temp","pivotRowIdx","pivotColIdx","mult","colIndex","reduceRowEchelonForm","pivotIndex","min","div","determineRank","rank","columns","determineNumberOfSolutions","b2IsZero","numberOfSolutions","Number","MAX_VALUE","determineSolution","initArray","numberOfEquations","size","array","slice",13,"open","DialogController","controllerAs",14,"ExpenseDetailCtrl","debtCalculationInterval","$timeout","isParticipant","everyoneParticipates","updateExpense","event","targetScope","getParticipationMap","sumOfShares","computeDebtsDebounced","setParticipation","confirmRemoveExpense","doRemoveExpense",15,"./create-expense-dialog","./expense-detail-ctrl",16,17,18,"./create-person-dialog","./person-detail-ctrl",19,"PersonDetailCtrl","confirmRemovePerson","role","counterRole","doRemovePerson","updatePerson","debtResult","debtRole",20,21,"$urlRouterProvider","otherwise",22,"$filter",23,"$q","$window","blob","deferred","defer","reader","FileReader","onload","resolve","onerror","promise","dataArray","Blob","fileSaver","saveAs","blob-polyfill","node-safe-filesaver",24,"focus","restrict","link","iElem","directive",25,"./balance-filter","./file-service","./focus-directive","./money-filter","./money-input-directive",26,"money",27,"moneyInput","iAttrs","ngModel","render","val","$valid","formatMoney","$modelValue","$viewValue","handleBlur","$render","$validators","validateMoney","$parsers","parseMoney","$formatters","unshift","on"],"mappings":"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","file":"debt.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nrequire(\"angular-material\");\r\nrequire(\"angular-route\");\r\nrequire(\"angular-ui-router\");\r\nrequire(\"angular-local-storage\");\r\nrequire(\"ng-mfb\");\r\nrequire(\"ng-file-upload\");\r\n\r\nvar _ = require(\"lodash\");\r\n\r\nangular\r\n  .module(\"debtApp\", [\"ngMaterial\", \"ui.router\", \"LocalStorageModule\", \"ng-mfb\", \"ngFileUpload\"])\r\n  .constant(\"events\", {\r\n    BALANCE_SHEET_UPDATED: \"balance sheet updated\"\r\n  })\r\n  .constant(\"debtCalculationInterval\", 500)\r\n  .value(\"debounce\", _.debounce) // allows stubbing this for faster tests\r\n  .config(configureLocalStorage)\r\n  .config(configureIcons)\r\n  .config(hrefSanitization)\r\n  .run(makeStateAvailableInScope);\r\n\r\nrequire(\"./debt-app-ctrl\");\r\nrequire(\"./route-config\");\r\nrequire(\"./debts\");\r\nrequire(\"./balance-sheet\");\r\nrequire(\"./persons\");\r\nrequire(\"./expenses\");\r\nrequire(\"./utils\");\r\n\r\nfunction configureLocalStorage(localStorageServiceProvider) {\r\n  localStorageServiceProvider.setPrefix(\"debtApp\");\r\n}\r\nconfigureLocalStorage.$inject = [\"localStorageServiceProvider\"];\r\n\r\nfunction configureIcons($mdIconProvider) {\r\n  \r\n  var spriteNames = ['action', 'alert', 'content', 'navigation'];\r\n  \r\n  var spriteProps = _.map(spriteNames, function(name) {\r\n    var fileName = 'svg-sprite-' + name + '.svg';\r\n    return {\r\n      filePath: 'resources/icons/' + fileName,\r\n      spriteName: name\r\n    };\r\n  });\r\n\r\n  _.each(spriteProps, function(prop) {\r\n    $mdIconProvider.iconSet(prop.spriteName, prop.filePath);\r\n  });\r\n\r\n}\r\nconfigureIcons.$inject = [\"$mdIconProvider\"];\r\n\r\nfunction hrefSanitization($compileProvider) {\r\n  $compileProvider.aHrefSanitizationWhitelist(/^(blob||https?):/);\r\n}\r\nhrefSanitization.$inject = [\"$compileProvider\"];\r\n\r\n// Injection of $state may trigger a GET, which can show as an \r\n// \"Unexpected request\" error in your test. Workaround is to \r\n// $provide a mock $state to Angular.\r\nfunction makeStateAvailableInScope($rootScope, $state, $stateParams) {\r\n  $rootScope.$state = $state;\r\n  $rootScope.$stateParams = $stateParams;\r\n}\r\nmakeStateAvailableInScope.$inject = [\"$rootScope\", \"$state\", \"$stateParams\"];\r\n\n},{\"./balance-sheet\":5,\"./debt-app-ctrl\":7,\"./debts\":10,\"./expenses\":15,\"./persons\":18,\"./route-config\":21,\"./utils\":25,\"angular\":\"angular\",\"angular-local-storage\":\"angular-local-storage\",\"angular-material\":\"angular-material\",\"angular-route\":\"angular-route\",\"angular-ui-router\":\"angular-ui-router\",\"lodash\":\"lodash\",\"ng-file-upload\":\"ng-file-upload\",\"ng-mfb\":\"ng-mfb\"}],2:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar _ = require(\"lodash\");\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n  .controller(\"BalanceSheetCtrl\", BalanceSheetCtrl);\r\n\r\nfunction BalanceSheetCtrl(balanceSheetService, debtService, events, $scope) {\r\n  var vm = this;\r\n  \r\n  vm.init = init;\r\n  vm.refresh = refresh;\r\n  vm.updateSheet = updateSheet;\r\n  \r\n  init();\r\n  \r\n  /////////////////////////////////////////////////////////////\r\n  \r\n  function init() {\r\n    refresh();\r\n    $scope.$on(events.BALANCE_SHEET_UPDATED, vm.refresh);\r\n  }\r\n  \r\n  function refresh() {\r\n    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n    vm.debtsByDebtor = computeDebts();\r\n  }\r\n  \r\n  function computeDebts() {\r\n    if (vm.balanceSheet.isBalanced()) {\r\n      var participations = vm.balanceSheet.getNonSettledParticipations();\r\n      var debts = debtService.computeDebts(participations);\r\n      return debtService.organizeByDebtor(debts);\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  function updateSheet() {\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n}\r\nBalanceSheetCtrl.$inject = [\"balanceSheetService\", \"debtService\", \"events\", \"$scope\"];\n},{\"angular\":\"angular\",\"lodash\":\"lodash\"}],3:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar _ = require(\"lodash\");\r\nvar angular = require(\"angular\");\r\nvar BalanceSheet = require('./balance-sheet');\r\n\r\nangular.module(\"debtApp\")\r\n.factory(\"balanceSheetService\", balanceSheetService);\r\n\r\nfunction balanceSheetService(localStorageService) {\r\n  \r\n  var service = {\r\n    balanceSheet: undefined,\r\n    error: undefined,\r\n    save: save,\r\n    loadFromJson: loadFromJson,\r\n    exportToJson: exportToJson,\r\n    createNew: createNew,\r\n    init: init\r\n  };\r\n  service.init();\r\n  \r\n  return service;\r\n  \r\n  \r\n  function init() {\r\n    var data = localStorageService.get(\"balanceSheetData\");\r\n    try {\r\n      service.balanceSheet = new BalanceSheet(data);\r\n      service.error = undefined;\r\n    } catch (e) {\r\n      service.error = e;\r\n    }\r\n  }\r\n\r\n  function save() {\r\n    if (!service.balanceSheet) {\r\n      throw service.error;\r\n    }\r\n\r\n    try {\r\n      service.balanceSheet.throwErrorIfInvalid();\r\n    } catch (e) {\r\n      service.error = e;\r\n      throw e;\r\n    }\r\n\r\n    localStorageService.set(\"balanceSheetData\", service.balanceSheet.exportData());\r\n    service.error = undefined;\r\n  }\r\n  \r\n  function loadFromJson(json) {\r\n    var data = angular.fromJson(json);\r\n    service.balanceSheet = new BalanceSheet(data);\r\n    save();\r\n  }\r\n  \r\n  function exportToJson() {\r\n    var data = service.balanceSheet.exportData(); \r\n    return angular.toJson(data);\r\n  }\r\n\r\n  function createNew() {\r\n    service.balanceSheet = new BalanceSheet();\r\n    service.save();\r\n  }\r\n\r\n}\r\nbalanceSheetService.$inject = [\"localStorageService\"];\r\n\r\n\r\n\n},{\"./balance-sheet\":4,\"angular\":\"angular\",\"lodash\":\"lodash\"}],4:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar _ = require('lodash');\r\nvar angular = require(\"angular\");\r\nvar Decimal = require(\"simple-decimal-money\");\r\n\r\nvar BalanceSheet = function(data) {\r\n\r\n  var _this = this;\r\n\r\n  // Data\r\n\r\n  var persons = [];\r\n  var expenses = [];\r\n  var participations = [];\r\n  var idSequence = 1;\r\n\r\n  _this.name = \"New sheet\";\r\n  _this.persons = persons;\r\n  _this.expenses = expenses;\r\n  _this.participations = participations;\r\n\r\n  if (data) {\r\n    importData(data);\r\n  }\r\n\r\n  // Methods\r\n\r\n  _this.getNonSettledParticipations = getNonSettledParticipations;\r\n\r\n  _this.isBalanced = isBalanced;\r\n\r\n  _this.getPerson = getPerson;\r\n  _this.createPerson = createPerson;\r\n  _this.removePerson = removePerson;\r\n\r\n  _this.getExpense = getExpense;\r\n  _this.createExpense = createExpense;\r\n  _this.removeExpense = removeExpense;\r\n\r\n  _this.getParticipation = getParticipation;\r\n  _this.createParticipation = createParticipation;\r\n  _this.removeParticipation = removeParticipation;\r\n\r\n  _this.exportData = exportData;\r\n\r\n  _this.isValid = isValid;\r\n  _this.throwErrorIfInvalid = throwErrorIfInvalid;\r\n\r\n  /////////////////////////////////////\r\n\r\n\r\n  function getNonSettledParticipations() {\r\n    return _.filter(participations, function(pt) {\r\n      return !pt.expense.settled;\r\n    });\r\n  }\r\n\r\n  function isBalanced() {\r\n    return _.reduce(expenses, function(isBalanced, e) {\r\n      return isBalanced && (e.settled || e.isBalanced());\r\n    }, true);\r\n  }\r\n\r\n\r\n  function getPerson(id) {\r\n    return _(persons).find(function(p) {\r\n      return p.id == id;\r\n    });\r\n  }\r\n\r\n\r\n  function createPerson(data, options) {\r\n    data = _.extend({\r\n      name: \"Person \" + (persons.length + 1)\r\n    }, data);\r\n\r\n    options = _.extend({}, options);\r\n\r\n    if (data.id === undefined) {\r\n      data.id = idSequence;\r\n      idSequence = idSequence + 1;\r\n    }\r\n\r\n    var person = new Person(data);\r\n    persons.push(person);\r\n\r\n    if (options.createParticipations === true) {\r\n      _.each(expenses, function(e) {\r\n        if (!e.settled) {\r\n          createParticipation({person: person, expense: e});\r\n          e.shareCost();\r\n        }\r\n      });\r\n    }\r\n\r\n    return person;\r\n  }\r\n\r\n  function removePerson(toRemove) {\r\n    toRemove = getPerson(toRemove.id);\r\n\r\n    if (!toRemove) return;\r\n\r\n    _.remove(persons, function(e) {\r\n      return e.equals(toRemove);\r\n    });\r\n\r\n    _.forEach(toRemove.getParticipations(), function(pt) {\r\n      removeParticipation(pt);\r\n    });\r\n  }\r\n\r\n  function getExpense(id) {\r\n    return _(expenses).find(function(e) {\r\n      return e.id == id;\r\n    });\r\n  }\r\n\r\n  function createExpense(data, options) {\r\n    data = _.extend({\r\n      name: \"Expense \" + (expenses.length + 1),\r\n      sharing: \"equal\",\r\n      settled: false\r\n    }, data);\r\n\r\n    options = _.extend({}, options);\r\n\r\n    if (data.id === undefined) {\r\n      data.id = idSequence;\r\n      idSequence = idSequence + 1;\r\n    }\r\n\r\n    var expense = new Expense(data);\r\n    expenses.push(expense);\r\n\r\n    if (options.createParticipations === true) {\r\n      _.each(persons, function(p) {\r\n        createParticipation({person: p, expense: expense});\r\n      });\r\n    }\r\n\r\n    return expense;\r\n  }\r\n\r\n  function removeExpense(toRemove) {\r\n    toRemove = getExpense(toRemove.id);\r\n\r\n    if (!toRemove) return;\r\n\r\n    _.remove(expenses, function(e) {\r\n      return e.equals(toRemove);\r\n    });\r\n\r\n    _.forEach(toRemove.getParticipations(), function(pt) {\r\n      removeParticipation(pt);\r\n    });\r\n  }\r\n\r\n\r\n  function getParticipation(criteria) {\r\n    var toSeek = new Participation(criteria);\r\n    return _(participations).find(function(pt) {\r\n      return toSeek.equals(pt);\r\n    });\r\n  }\r\n\r\n  function createParticipation(data) {\r\n    if (getParticipation(data)) {\r\n      throw \"Duplicate participation\";\r\n    }\r\n\r\n    data = _.extend({\r\n      paid: 0,\r\n      share: 0\r\n    }, data);\r\n\r\n    var participation = new Participation(data);\r\n    participations.push(participation);\r\n\r\n    participation.expense.shareCost();\r\n\r\n    return participation;\r\n  }\r\n\r\n  function removeParticipation(toRemove) {\r\n    toRemove = getParticipation(toRemove);\r\n\r\n    if (!toRemove) return;\r\n\r\n    _.remove(participations, function(pt) {\r\n      return pt.equals(toRemove);\r\n    });\r\n\r\n    toRemove.expense.shareCost();\r\n  }\r\n\r\n\r\n  function Person(data) {\r\n    var _this = this;\r\n\r\n    _.extend(_this, data);\r\n\r\n    // Methods\r\n\r\n    _this.equals = equals;\r\n    _this.getCost = getCost;\r\n    _this.getSumOfShares = getSumOfShares;\r\n    _this.getBalance = getBalance;\r\n    _this.isBalanced = isBalanced;\r\n    _this.getParticipations = getParticipations;\r\n\r\n    ///////////////////////////////////////\r\n\r\n    var _myParticipations = _.chain(participations)\r\n      .filter(function(pt) {\r\n        return _this.equals(pt.person);\r\n      });\r\n\r\n    var _nonSettledParticipations = _myParticipations\r\n      .filter(function(pt) {\r\n        return !pt.expense.settled;\r\n      });\r\n\r\n    var _cost = _nonSettledParticipations\r\n      .filter(function(pt) {\r\n        return !pt.expense.settled;\r\n      })\r\n      .map(\"paid\").reduce(function(cost, paid) {\r\n        return cost.add(paid);\r\n      }, new Decimal(0));\r\n\r\n    var _sumOfShares = _nonSettledParticipations\r\n      .map(\"share\").reduce(function(sum, share) {\r\n        return sum.add(share);\r\n      }, new Decimal(0));\r\n\r\n    var _balance = _nonSettledParticipations\r\n      .map(function(pt) {\r\n        return (new Decimal(pt.share)).subtract(pt.paid);\r\n      })\r\n      .reduce(function(sum, b) {\r\n        return sum.add(b);\r\n      }, new Decimal(0));\r\n\r\n\r\n    function getCost() {\r\n      return _cost.value().toNumber();\r\n    }\r\n\r\n    function getSumOfShares() {\r\n      return _sumOfShares.value().toNumber();\r\n    }\r\n\r\n    function isBalanced() {\r\n      return _balance.value().toNumber() === 0;\r\n    }\r\n\r\n    function getBalance() {\r\n      return _balance.value().toNumber();\r\n    }\r\n\r\n    function getParticipations() {\r\n      return _myParticipations.value();\r\n    }\r\n\r\n    function equals(other) {\r\n      return (other instanceof Person) && (other.id === _this.id);\r\n    }\r\n\r\n  }\r\n\r\n\r\n  function Expense(data) {\r\n    var _this = this;\r\n\r\n    // Data\r\n\r\n    _.extend(_this, data);\r\n\r\n    // Methods\r\n\r\n    _this.getCost = getCost;\r\n    _this.getSumOfShares = getSumOfShares;\r\n    _this.getBalance = getBalance;\r\n    _this.isBalanced = isBalanced;\r\n    _this.getParticipations = getParticipations;\r\n    _this.shareCost = shareCost;\r\n    _this.equals = equals;\r\n\r\n    ///////////////////////////////////////\r\n\r\n    var _myParticipations = _.chain(participations).filter(function(p) {\r\n      return _this.equals(p.expense);\r\n    });\r\n\r\n    var _cost = _myParticipations\r\n      .map(\"paid\").reduce(function(cost, paid) {\r\n        return cost.add(paid);\r\n      }, new Decimal(0));\r\n\r\n    var _sumOfShares = _myParticipations\r\n      .map(\"share\").reduce(function(sum, share) {\r\n        return sum.add(share);\r\n      }, new Decimal(0));\r\n\r\n    var _balance = _myParticipations\r\n      .map(function(pt) {\r\n        return (new Decimal(pt.share)).subtract(pt.paid);\r\n      })\r\n      .reduce(function(sum, b) {\r\n        return sum.add(b);\r\n      }, new Decimal(0));\r\n\r\n\r\n    function getCost() {\r\n      return _cost.value().toNumber();\r\n    }\r\n\r\n    function getSumOfShares() {\r\n      return _sumOfShares.value().toNumber();\r\n    }\r\n\r\n    function isBalanced() {\r\n      return _balance.value().toNumber() === 0;\r\n    }\r\n\r\n    function getBalance() {\r\n      return _balance.value().toNumber();\r\n    }\r\n\r\n    function getParticipations() {\r\n      return _myParticipations.value();\r\n    }\r\n\r\n    function shareCost() {\r\n      if (_this.sharing === \"equal\") {\r\n        shareEqually();\r\n      }\r\n    }\r\n\r\n    function shareEqually() {\r\n      var participations = _this.getParticipations();\r\n      if (participations.length === 0) {\r\n        return;\r\n      }\r\n\r\n      var cost = new Decimal(_this.getCost());\r\n      var share = cost.divideBy(participations.length);\r\n      var lastShare = cost.subtract(share.multiply(participations.length - 1));\r\n\r\n      _.forEach(participations, function(p, i) {\r\n        if (i < participations.length - 1) {\r\n          p.share = share.toNumber();\r\n        }\r\n      });\r\n      _.last(participations).share = lastShare.toNumber();\r\n    }\r\n\r\n    function equals(other) {\r\n      return (other instanceof Expense) && (other.id === _this.id);\r\n    }\r\n\r\n  }\r\n\r\n\r\n  function Participation(data) {\r\n    var _this = this;\r\n\r\n    if (!data || !data.person || !data.expense) {\r\n      throw \"Undefined participation\";\r\n    }\r\n\r\n    // Data\r\n\r\n    _.extend(this, data);\r\n\r\n    // Methods\r\n\r\n    this.equals = equals;\r\n\r\n\r\n    ///////////////////////////////////////\r\n\r\n    function equals(other) {\r\n      return (other instanceof Participation) && _this.expense.equals(other.expense) && _this.person.equals(other.person);\r\n    }\r\n  }\r\n\r\n\r\n  function exportData() {\r\n    var isNotFunction = _.negate(_.isFunction);\r\n    var data = _.pick(_this, isNotFunction);\r\n    data.persons = _.map(persons, function(p) {\r\n      return _.pick(p, isNotFunction);\r\n    });\r\n    data.expenses = _.map(expenses, function(e) {\r\n      return _.pick(e, isNotFunction);\r\n    });\r\n    data.participations = _.map(participations, function(pt) {\r\n      return {personId: pt.person.id, expenseId: pt.expense.id, paid: pt.paid, share: pt.share};\r\n    });\r\n    return data;\r\n  }\r\n\r\n  function importData(data) {\r\n    idSequence = _([])\r\n        .concat(data.persons)\r\n        .concat(data.expenses)\r\n        .pluck(\"id\")\r\n        .max() + 1;\r\n    if (idSequence == -Infinity) {\r\n      idSequence = 1;\r\n    }\r\n\r\n    var separately = {persons: true, expenses: true, participations: true};\r\n    _.extend(_this, _.pick(data, function(value, key) {\r\n      return !separately[key];\r\n    }));\r\n\r\n    _.each(data.persons, function(p) {\r\n      createPerson(p);\r\n    });\r\n\r\n    _.each(data.expenses, function(e) {\r\n      createExpense(e);\r\n    });\r\n\r\n    _.each(data.participations, function(p) {\r\n      var person = getPerson(p.personId);\r\n      var expense = getExpense(p.expenseId);\r\n      createParticipation({person: person, expense: expense, paid: p.paid, share: p.share});\r\n    });\r\n\r\n    throwErrorIfInvalid();\r\n  }\r\n\r\n  function isValid() {\r\n    try {\r\n      throwErrorIfInvalid();\r\n      return true;\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function throwErrorIfInvalid() {\r\n\r\n    _.each(persons, function(p) {\r\n      if (!_.isNumber(p.id)) {\r\n        throw new Error(\"Person has no id\");\r\n      }\r\n    });\r\n\r\n    _.each(expenses, function(e) {\r\n      if (!_.isNumber(e.id)) {\r\n        throw new Error(\"Expense has no id\");\r\n      }\r\n    });\r\n\r\n    var idToEntity = {};\r\n    _.each(persons, function(p) {\r\n      idToEntity[p.id] = p;\r\n    });\r\n    _.each(expenses, function(e) {\r\n      idToEntity[e.id] = e;\r\n    });\r\n    _.each(participations, function(pt) {\r\n      if (!pt.person) {\r\n        throw new Error(\"Participation has no person\");\r\n      }\r\n      if (!idToEntity[pt.person.id]) {\r\n        throw new Error(\"Participation person is unknown\");\r\n      }\r\n      if (!pt.expense) {\r\n        throw new Error(\"Participation has no expense\");\r\n      }\r\n      if (!idToEntity[pt.expense.id]) {\r\n        throw new Error(\"Participation expense is unknown\");\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  function Error(message) {\r\n    this.message = message;\r\n  }\r\n\r\n};\r\n\r\n\r\nmodule.exports = BalanceSheet;\n},{\"angular\":\"angular\",\"lodash\":\"lodash\",\"simple-decimal-money\":\"simple-decimal-money\"}],5:[function(require,module,exports){\n\"use strict\";\r\n\r\nrequire(\"./route-config\");\r\nrequire(\"./balance-sheet\");\r\nrequire(\"./balance-sheet-service\");\r\nrequire(\"./balance-sheet-ctrl\");\n},{\"./balance-sheet\":4,\"./balance-sheet-ctrl\":2,\"./balance-sheet-service\":3,\"./route-config\":6}],6:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n  .config(config);\r\n\r\nfunction config($stateProvider) {\r\n\r\n  $stateProvider\r\n    .state(\"balanceSheet\", {\r\n      url: \"/\",\r\n      templateUrl : \"balance-sheet/balance-sheet.html\",\r\n      controller : \"BalanceSheetCtrl as vm\"\r\n    });\r\n  \r\n}\r\nconfig.$inject = [\"$stateProvider\"];\n},{\"angular\":\"angular\"}],7:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar _ = require(\"lodash\");\r\n\r\nangular.module(\"debtApp\")\r\n  .constant(\"balanceSheetSaveInterval\", 500)\r\n  .controller(\"DebtAppCtrl\", DebtAppCtrl);\r\n\r\nfunction DebtAppCtrl(balanceSheetService,\r\n                     debounce,\r\n                     balanceSheetSaveInterval,\r\n                     openCreatePersonDialog,\r\n                     openCreateExpenseDialog,\r\n                     fileService,\r\n                     events,\r\n                     $mdDialog,\r\n                     $mdSidenav,\r\n                     $state,\r\n                     $scope,\r\n                     $log) {\r\n\r\n  var vm = this;\r\n\r\n  vm.mainMenu = {\r\n    toggle: toggleMenu\r\n  };\r\n\r\n  vm.init = init;\r\n  vm.createPerson = createPerson;\r\n  vm.createExpense = createExpense;\r\n  vm.createNewSheet = createNewSheet;\r\n  vm.loadSheet = loadSheet;\r\n  vm.exportSheet = exportSheet;\r\n  vm.save = save;\r\n  vm.refresh = refresh;\r\n  vm.showHelp = showHelp;\r\n\r\n  var confirmCreateNewSheet = $mdDialog.confirm()\r\n    .title(\"Create new sheet\")\r\n    .content(\"The current sheet will be discarded. Please consider exporting it first. Continue?\")\r\n    .ok(\"Ok\").cancel(\"Cancel\");\r\n\r\n  init();\r\n\r\n  /////////////////////////////////////////////////////////////\r\n\r\n  function toggleMenu() {\r\n    $mdSidenav(\"main-menu\").toggle();\r\n  }\r\n\r\n  function init() {\r\n    $scope.$on(events.BALANCE_SHEET_UPDATED, debounce(onBalanceSheetUpdated, balanceSheetSaveInterval));\r\n    vm.refresh();\r\n  }\r\n\r\n  function onBalanceSheetUpdated() {\r\n    vm.refresh();\r\n    if (!vm.errorMessage) {\r\n      vm.save();\r\n    }\r\n  }\r\n\r\n  function save() {\r\n    try {\r\n      balanceSheetService.save();\r\n      vm.errorMessage = undefined;\r\n      //$log.debug(\"Balance sheet saved\");\r\n    } catch (e) {\r\n      vm.errorMessage = \"Cannot save: \" + e.message;\r\n      //$log.error(\"Error when saving balance sheet: \" + e.message);\r\n    }\r\n  }\r\n\r\n  function refresh() {\r\n    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n    if (balanceSheetService.error) {\r\n      vm.errorMessage = \"Invalid sheet: \" + balanceSheetService.error.message;\r\n    } else {\r\n      vm.errorMessage = undefined;\r\n    }\r\n  }\r\n\r\n\r\n  function createPerson() {\r\n    openCreatePersonDialog()\r\n      .then(function(dialogResult) {\r\n        balanceSheetService.balanceSheet.createPerson(dialogResult.person, dialogResult.options);\r\n        onBalanceSheetUpdated();\r\n        $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n      });\r\n  }\r\n\r\n  function createExpense() {\r\n    openCreateExpenseDialog()\r\n      .then(function(dialogResult) {\r\n        balanceSheetService.balanceSheet.createExpense(dialogResult.expense, dialogResult.options);\r\n        onBalanceSheetUpdated();\r\n        $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n      });\r\n  }\r\n\r\n  function createNewSheet() {\r\n    $mdDialog.show(confirmCreateNewSheet)\r\n      .then(function() {\r\n        balanceSheetService.createNew();\r\n        onBalanceSheetUpdated();\r\n        $state.go(\"balanceSheet\");\r\n        $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n        vm.mainMenu.toggle();\r\n      }, function() {\r\n        vm.mainMenu.toggle();\r\n      });\r\n  }\r\n\r\n  function loadSheet(files) {\r\n    if (!files || !files.length) return;\r\n\r\n    if (!fileService.isSupported()) {\r\n      vm.errorMessage = \"File operations not supported in this browser. Please consider a more modern browser.\";\r\n      return;\r\n    }\r\n\r\n    var file = files[0];\r\n    fileService.readAsText(file)\r\n      .then(function(result) {\r\n        loadSheetFromJson(result);\r\n      })\r\n      .catch(function() {\r\n        vm.errorMessage = \"Unable to read file\";\r\n      })\r\n      .finally(function() {\r\n        vm.mainMenu.toggle();\r\n      });\r\n  }\r\n\r\n  function loadSheetFromJson(json) {\r\n    balanceSheetService.loadFromJson(json);\r\n    onBalanceSheetUpdated();\r\n    $state.go(\"balanceSheet\");\r\n    $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n\r\n  function exportSheet() {\r\n    if (!fileService.isSupported()) {\r\n      vm.errorMessage = \"File operations not supported in this browser. Please consider a more modern browser.\";\r\n      return;\r\n    }\r\n\r\n    var json = balanceSheetService.exportToJson();\r\n    try {\r\n      fileService.saveAsFile([json], balanceSheetService.balanceSheet.name + \".txt\");\r\n    } catch (e) {\r\n      vm.errorMessage = \"Error when saving file\";\r\n    }\r\n    vm.mainMenu.toggle();\r\n  }\r\n\r\n  function showHelp() {\r\n    $mdDialog.show({\r\n      templateUrl: \"help.html\",\r\n      controller: [\"$scope\", \"$mdDialog\", function($scope, $mdDialog) {\r\n        $scope.close = function() {\r\n          $mdDialog.hide();\r\n        }\r\n      }]\r\n    });\r\n    vm.mainMenu.toggle();\r\n  }\r\n}\r\nDebtAppCtrl.$inject = [\"balanceSheetService\", \"debounce\", \"balanceSheetSaveInterval\", \"openCreatePersonDialog\", \"openCreateExpenseDialog\", \"fileService\", \"events\", \"$mdDialog\", \"$mdSidenav\", \"$state\", \"$scope\", \"$log\"];\n},{\"angular\":\"angular\",\"lodash\":\"lodash\"}],8:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular\r\n  .module(\"debtApp\")\r\n    .factory(\"debtService\", debtService);\r\n\r\n\r\nfunction debtService(solveDebts) {\r\n  \r\n  return {\r\n    computeDebts: computeDebts,\r\n    organizeByDebtor: organizeByDebtor\r\n  };\r\n  \r\n  /////////////////////////////////////////\r\n  \r\n  function computeDebts(participations) {\r\n    return solveDebts(participations);\r\n  } \r\n  \r\n  function organizeByDebtor(debts) {\r\n    var debtorList = [];\r\n    var debtorIndices = {};\r\n    \r\n    angular.forEach(debts, function(d) {\r\n      var debtorIndex = debtorIndices[d.debtor.id];\r\n      var debtor;\r\n      if (debtorIndex === undefined) {\r\n        debtorIndex = debtorList.length;\r\n        debtor = {debtor: d.debtor, debts: []};\r\n        debtorList.push(debtor);\r\n        debtorIndices[d.debtor.id] = debtorIndex;\r\n      }\r\n      debtor = debtorList[debtorIndex];\r\n      debtor.debts.push({creditor: d.creditor, amount: d.amount});\r\n    });\r\n    \r\n    angular.forEach(debtorList, function(d) {\r\n      d.debts.sort(function(d1, d2) {\r\n        return d1.creditor.name.localeCompare(d2.creditor.name);\r\n      });\r\n    });\r\n    debtorList.sort(function(d1, d2) {\r\n      return d1.debtor.name.localeCompare(d2.debtor.name);\r\n    });\r\n    \r\n    return debtorList;\r\n  }\r\n  \r\n}\r\ndebtService.$inject = [\"solveDebts\"];\n},{\"angular\":\"angular\"}],9:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar Decimal = require(\"simple-decimal-money\");\r\nvar Random = require(\"random-js\");\r\n\r\nangular\r\n  .module(\"debtApp\")\r\n    .factory(\"solveDebts\", debtSolverFactory);\r\n\r\n\r\n\r\n\r\n/**\r\n * A function that computes debts from given expense participations.\r\n *  \r\n * We form a linear system Ax = b. A is a binary matrix with size (d+c)*(d*c),\r\n * where d is the number of debtors and c is the number of creditors. Columns of A \r\n * are ordered so that x[c*i + j] is the value of the debt owed by debtor i to creditor j.\r\n * \r\n * Elements of b are balances - converted to non-negative - of the debtors and the creditors \r\n * with the following correspondence:\r\n * \r\n * b[0]: first debtor\r\n * ... \r\n * b[d-1]: last debtor\r\n * b[d] = first creditor\r\n * ... \r\n * b[d+c-1] = last creditor\r\n * \r\n * The coefficient matrix A is constructed so that for each person i, we have equation\r\n * where total value of debts to paid by i (if i is a debtor) or to i (if i is a creditor) equals i's \r\n * non-negative balance.\r\n * \r\n * Rows of A indexed between [0, d-1] represent the debtors in the order \r\n * of debtors> list. Rows of A indexed between [d, d+c-1] represent the \r\n * creditors in the order of creditors list.\r\n * \r\n * Ideally, we would like to find the sparsest (most 0's) solution x to Ax = b\r\n * in case the system is underdetermined and has an infinite number of solutions.\r\n * \r\n * This problem, posed as min ||x||_0  s.t. Ax = b, x >= 0, where ||x||_0 is the number\r\n * of non-zero elements, is in general an NP-hard problem. There is some amount of literature\r\n * about the problem (keywords: sparse nonnegative solution of underdetermined linear equations).\r\n * The problem is usually approximated as convex optimization problem by minimizing L1-norm (sum of \r\n * absolute value) instead. One option could be to use the cassowary javascript library.\r\n * \r\n * In this function we find a non-negative x using Gaussian elimination and setting random combinations \r\n * of free variables to zero until we find a non-negative solution.\r\n */\r\nfunction debtSolverFactory(solveLinearSystem) {\r\n  \r\n  return solve;\r\n  \r\n  \r\n  function solve(participations) {\r\n    if (!participations || participations.length === 0) {\r\n      return [];\r\n    }\r\n    var balances = computeBalances(participations);\r\n    if (!hasNonZeroBalance(balances)) {\r\n      return [];\r\n    }\r\n    var roles = getDebtorsAndCreditors(balances);\r\n    var linearSystem = createDebtEquations(roles);\r\n    var debtVector = solveDebts(linearSystem);\r\n    var debts = createDebts(debtVector, roles);\r\n    return debts;\r\n  }\r\n  \r\n  function computeBalances(participations) {\r\n    var balances = {};\r\n    angular.forEach(participations, function(p) {\r\n      var b = balances[p.person.id];\r\n      if (b === undefined) {\r\n        b = {person: p.person, balance: new Decimal(0)};\r\n        balances[p.person.id] = b;\r\n      }\r\n      var paid = new Decimal(p.paid);\r\n      var share = new Decimal(p.share);\r\n      b.balance = b.balance.add(share.subtract(paid));\r\n    });\r\n\r\n    angular.forEach(balances, function(b) {\r\n      b.balance = b.balance.toNumber();\r\n    });\r\n    \r\n    return balances;\r\n  }\r\n  \r\n  function hasNonZeroBalance(balances) {\r\n    var result = false;\r\n    angular.forEach(balances, function(b) {\r\n      if (b.balance !== 0) {\r\n        result = true;\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n  \r\n  function getDebtorsAndCreditors(balances) {\r\n    var debtors = [];\r\n    var creditors = [];\r\n    \r\n    angular.forEach(balances, function(b) {\r\n      if (b.balance <= 0) {\r\n        creditors.push(b);\r\n      } else {\r\n        debtors.push(b);\r\n      }\r\n    });\r\n    \r\n    return {\r\n      debtors: debtors,\r\n      creditors: creditors\r\n    };\r\n  }\r\n  \r\n  function createDebtEquations(roles) {\r\n    var d = roles.debtors.length;\r\n    var c = roles.creditors.length;\r\n    \r\n    // Right-hand side vector, creditor balances converted to non-negative to allow binary coefficients\r\n    var b = []; \r\n    for (var i = 0; i < d; i++) {\r\n      b[i] = (new Decimal(roles.debtors[i].balance)).multiply(100).toNumber();\r\n    }\r\n    for (var i = 0; i < c; i++) {\r\n      b[d + i] = (new Decimal(roles.creditors[i].balance)).multiply(-100).toNumber();\r\n    }\r\n    \r\n    // Coefficient matrix\r\n    var A = initMatrix(d + c, d*c); \r\n    \r\n    // Coefficients of equations \"sum of debts paid by debtor = debtor's balance\"\r\n    for (var i = 0; i < d; i++) {\r\n      for (var j = i*c; j < (i+1)*c; j++) {\r\n        A[i][j] = 1;\r\n      }\r\n    }\r\n    \r\n    // Coefficients of equations \"sum debts received by creditor = creditor's balance\"\r\n    for (var i = d; i < c+d; ++i) {\r\n      for (var j = (i-d); j < d*c; j += c) {\r\n        A[i][j] = 1;\r\n      }\r\n    } \r\n    \r\n    return {\r\n      A: A,\r\n      b: b\r\n    };\r\n  }\r\n  \r\n  function initMatrix(rows, cols) {\r\n    var A = [];\r\n    for (var i = 0; i < rows; i++) {\r\n      A[i] = [];\r\n      for (var j = 0; j < cols; j++) {\r\n        A[i][j] = 0;\r\n      }\r\n    }\r\n    return A;\r\n  }\r\n  \r\n  // Solve debts, ensuring a non-negative solution \r\n  function solveDebts(linearSystem) {\r\n    var solution = solveLinearSystem(linearSystem);\r\n    var numVars = solution.numberOfVariables;\r\n    var numFreeVars = solution.numberOfFreeVariables;\r\n    \r\n    if (numFreeVars === 0) {\r\n      return solution.xVector;\r\n    }\r\n\r\n    // Known seed so we always get the same result from\r\n    // the same system.\r\n    var randomEngine = Random.engines.mt19937();\r\n    randomEngine.seed(20150312);\r\n\r\n    var toEliminate;\r\n    do {\r\n      \r\n      var A = angular.copy(linearSystem.A);\r\n      var b = linearSystem.b;\r\n      \r\n      // Pick random numFreeVars variables for elimination\r\n      \r\n      var candidates = [];\r\n      for (var i = 0; i < numVars; i++) {\r\n        candidates[i] = i;\r\n      }\r\n      \r\n      toEliminate = [];\r\n      for (var i = 0; i < numFreeVars; i++) {\r\n        var candidateIdx = Random.integer(0, candidates.length-1)(randomEngine);\r\n        toEliminate.push(candidates[candidateIdx]);\r\n        candidates.splice(candidateIdx, 1);\r\n      }\r\n      \r\n      // Eliminate the chosen variables by setting their coefficients to zero\r\n      \r\n      for (var i = 0; i < A.length; i++) {\r\n        for (var j = 0; j < toEliminate.length; j++) {\r\n          A[i][toEliminate[j]] = 0;\r\n        }\r\n      }\r\n\r\n      // Solve the updated system\r\n      \r\n      solution = solveLinearSystem({A: A, b: b});\r\n      \r\n    } while (!isNonNegative(solution.xVector));\r\n\r\n    \r\n    return solution.xVector;\r\n  }\r\n  \r\n  function isNonNegative(vector) {\r\n    if (!vector) {\r\n      return false;\r\n    }\r\n    for (var i = 0; i < vector.length; i++) {\r\n      if (vector[i] < 0) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n  \r\n  function createDebts(debtVector, roles) {\r\n    var debts = [];\r\n\r\n    for (var i = 0; i < debtVector.length; i++) {\r\n      if (debtVector[i] !== 0) {\r\n        var debtorIdx = Math.floor(i/roles.creditors.length);\r\n        var creditorIdx = i - roles.creditors.length*debtorIdx;\r\n        var amount = (new Decimal(debtVector[i])).divideBy(100).toNumber();\r\n        var debt = {debtor: roles.debtors[debtorIdx].person, creditor: roles.creditors[creditorIdx].person, amount: amount};\r\n        debts.push(debt);\r\n      }\r\n    }\r\n    \r\n    return debts;\r\n  }\r\n}\r\ndebtSolverFactory.$inject = [\"solveLinearSystem\"];  \n},{\"angular\":\"angular\",\"random-js\":\"random-js\",\"simple-decimal-money\":\"simple-decimal-money\"}],10:[function(require,module,exports){\n\"use strict\";\r\n\r\nrequire(\"./lin-eq-solver\");\r\nrequire(\"./lin-eq-solver-factory\");\r\nrequire(\"./debt-solver\");\r\nrequire(\"./debt-service\");\n},{\"./debt-service\":8,\"./debt-solver\":9,\"./lin-eq-solver\":12,\"./lin-eq-solver-factory\":11}],11:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar solve = require(\"./lin-eq-solver\");\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n.factory(\"solveLinearSystem\", solveLinearSystem);\r\n\r\nfunction solveLinearSystem() {\r\n  return solve;\r\n}\n},{\"./lin-eq-solver\":12,\"angular\":\"angular\"}],12:[function(require,module,exports){\n\"use strict\";\r\n\r\n\r\nfunction solve(input) {\r\n\t// Internal copies of the linear system and its dimensions\r\n\tvar coefMatrix, constVector, xVector;\r\n\tvar m, n, rank, numberOfSolutions;\r\n\t\r\n\t// With these we can \"virtually\" rearrange the rows and columns\r\n\t// for better numerical stability in the variable elimination phases.\r\n\t// At step i, row index pivotToEquationMap[i] is the pivot equation and\r\n\t// it is used for eliminating variable index pivotToVariableMap[i] from all the\r\n\t// other equations.\r\n\tvar pivotToEquationMap, pivotToVariableMap, equationScale;\r\n\t\r\n\tvalidate();\r\n\tinitialize();\r\n\ttransformToRowEchelonForm();\r\n\treduceRowEchelonForm();\r\n\tdetermineRank();\r\n\tdetermineNumberOfSolutions();\r\n\tdetermineSolution();\r\n\r\n\treturn {\r\n\t\txVector: xVector,\r\n\t\tnumberOfEquations: m,\r\n\t\tnumberOfVariables: n,\r\n\t\trank: rank,\r\n\t\tnumberOfFreeVariables: n - rank,\r\n\t\tnumberOfSolutions: numberOfSolutions\r\n\t};\r\n\t\r\n\t/////////////////////////////////////////////////////////////\r\n\t\r\n\tfunction validate() {\r\n    \tif (!input || !input.A || !input.b) {\r\n    \t\tthrow \"Null matrix A or vector b in system Ax = b\";\r\n    \t}\r\n    \t\r\n    \tif (input.A.length < 1 || input.A[0].length < 1) {\r\n    \t\tthrow \"Matrix A in Ax = b has no rows or no columns\";\r\n    \t}\r\n\t\t\r\n    \tif (input.A.length != input.b.length) {\r\n    \t\tthrow \"The dimensions of the matrix and the constant vector are incompatible\"; \r\n    \t}\r\n\t}\r\n\r\n\tfunction initialize() {\r\n\t\tcoefMatrix = copyMatrix(input.A);\r\n\t\tconstVector = copyArray(input.b);\r\n\t\t\r\n\t\tm = coefMatrix.length;\r\n\t\tn = coefMatrix[0].length;\r\n\r\n\t\tpivotToEquationMap = [];\r\n\t\tfor (var i = 0; i < m; i++) {\r\n\t\t\tpivotToEquationMap[i] = i;\r\n\t\t}\r\n\t\t\r\n\t\tequationScale = [];\r\n\t\tfor (var i = 0; i < m; i++) {\r\n\t\t\tequationScale[i] = 0;\r\n\t\t\tfor (var j = 0; j < n; j++) {\r\n\t\t\t\tvar abscoef = Math.abs(coefMatrix[i][j]);\r\n\t\t\t\tif (abscoef > equationScale[i]) {\r\n\t\t\t\t\tequationScale[i] = abscoef;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpivotToVariableMap = [];\r\n\t\tfor (var j = 0; j < n; j++) {\r\n\t\t\tpivotToVariableMap[j] = j;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction transformToRowEchelonForm() {\r\n\t\tvar pivotIdx = 0; \r\n\t\tvar knownFreeVariables = [];\r\n\t\t\r\n\t\twhile (pivotIdx < m-1) { \r\n\r\n\t\t\t// Choose the best pivot-equation for eliminating variable pivotToVariableMap[pivotIdx] \r\n\t\t\t// from equations equations not yet used as pivot equations.\r\n\t\t\tvar maxRatio = 0;\r\n\t\t\tvar bestPivotEquationIndex = pivotIdx;\r\n\t\t\tfor (var i = pivotIdx; i < m; ++i) {\r\n\t\t\t\tvar rowIdx = pivotToEquationMap[i];\r\n\t\t\t\tvar colIdx = pivotToVariableMap[pivotIdx];\r\n\t\t\t\tvar ratio = Math.abs(coefMatrix[rowIdx][colIdx]/equationScale[rowIdx]);\r\n\t\r\n\t\t\t\tif (ratio > maxRatio) {\r\n\t\t\t\t\tmaxRatio = ratio;\r\n\t\t\t\t\tbestPivotEquationIndex = i;\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// If maxRatio == 0, the coefficient of variable pivotToVariableMap[pivotIdx] is 0 in all the rest of the equations. \r\n\t\t\t// That is pivotToVariableMap[pivotIdx] is a free variable. Find the next suitable variable.\r\n\t\t\tif (maxRatio === 0) {\r\n\t\t\t\tvar currPivotVaribleIdx = pivotToVariableMap[pivotIdx];\r\n\t\t\t\tknownFreeVariables[currPivotVaribleIdx] = true;     \r\n\t\t\t\t\r\n\t\t\t\t// The next one must not be a free variable.\r\n\t\t\t\tvar i = pivotIdx;\r\n\t\t\t\tvar newPivotVariableIdx = currPivotVaribleIdx;\r\n\t\t\t\twhile (newPivotVariableIdx == currPivotVaribleIdx && i < n-1) {\r\n\t\t\t\t\t++i;\r\n\t\t\t\t\tif (!knownFreeVariables[pivotToVariableMap[i]]) {\r\n\t\t\t\t\t\tnewPivotVariableIdx = pivotToVariableMap[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (newPivotVariableIdx != currPivotVaribleIdx) {\r\n\t\t\t\t\tpivotToVariableMap[pivotIdx] = newPivotVariableIdx;\r\n\t\t\t\t\tpivotToVariableMap[i] = currPivotVaribleIdx;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else { \r\n\t\t\t\t\t// Could not find a suitable variable. This means the row echelon form is ready.\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\r\n\t\t\tvar temp = pivotToEquationMap[pivotIdx];\r\n\t\t\tpivotToEquationMap[pivotIdx] = pivotToEquationMap[bestPivotEquationIndex];\r\n\t\t\tpivotToEquationMap[bestPivotEquationIndex] = temp;     \r\n\t\t\t\r\n\t\t\t// Elimination phase\r\n\t\t\tvar pivotRowIdx = pivotToEquationMap[pivotIdx];\r\n\t\t\tvar pivotColIdx = pivotToVariableMap[pivotIdx];\r\n\t\t\tfor (i = pivotIdx + 1; i < m; ++i) {\r\n\t\t\t\tvar rowIdx = pivotToEquationMap[i];\r\n\t\t\t\tvar mult = coefMatrix[rowIdx][pivotColIdx] / coefMatrix[pivotRowIdx][pivotColIdx];\r\n\r\n\t\t\t\tfor (var j = pivotIdx + 1; j < n; ++j) {\r\n\t\t\t\t\tvar colIndex = pivotToVariableMap[j];\r\n\t\t\t\t\tcoefMatrix[rowIdx][colIndex] = coefMatrix[rowIdx][colIndex] - mult * coefMatrix[pivotRowIdx][colIndex];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcoefMatrix[rowIdx][pivotColIdx] = 0;\r\n\t\t\t\tconstVector[rowIdx] = constVector[rowIdx] - mult * constVector[pivotRowIdx];\r\n\t\t\t}\r\n\r\n\t\t\tpivotIdx++;\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tfunction reduceRowEchelonForm() {\r\n\t\t// Eliminate pivot variables from previous pivot equations by going through the pivot steps in reverse order.\r\n\t\tvar pivotIndex;\r\n\t\tfor (pivotIndex = Math.min(m, n) - 1; pivotIndex > 0; --pivotIndex) {\r\n\t\t\tvar pivotRowIdx = pivotToEquationMap[pivotIndex];\r\n\t\t\tvar pivotColIdx = pivotToVariableMap[pivotIndex];\r\n\t\t\t\r\n\t\t\tif (coefMatrix[pivotRowIdx][pivotColIdx] === 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (var i = pivotIndex - 1; i > -1; --i) {\r\n\t\t\t\t\r\n\t\t\t\tvar mult = coefMatrix[pivotToEquationMap[i]][pivotToVariableMap[pivotIndex]]/coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[pivotIndex]];\r\n\t\t\t\tfor (var j = 0; j < n; ++j) {\r\n\t\t\t\t\tcoefMatrix[pivotToEquationMap[i]][pivotToVariableMap[j]] -= mult*coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[j]];\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconstVector[pivotToEquationMap[i]] -= mult*constVector[pivotToEquationMap[pivotIndex]];\r\n\t\t\t}            \t\t\r\n\t\t}\r\n\t\t\r\n\t\t// Normalize the coeffients in each row and the rhs value by the coeffient of the pivot variable in the row\r\n\t\tfor (pivotIndex = 0; pivotIndex < Math.min(m, n); ++pivotIndex) {\r\n\t\t\t\r\n\t\t\tif (coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[pivotIndex]] === 0) {\r\n\t\t\t\tcontinue; \r\n\t\t\t}\r\n\r\n\t\t\tvar div = coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[pivotIndex]];\r\n\t\t\tfor (var j = 0; j < n; ++j) {\r\n\t\t\t\tcoefMatrix[pivotToEquationMap[pivotIndex]][j] = coefMatrix[pivotToEquationMap[pivotIndex]][j]/div;\r\n\t\t\t}\r\n\t\t\tconstVector[pivotToEquationMap[pivotIndex]] = constVector[pivotToEquationMap[pivotIndex]]/div;\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\tfunction determineRank() {\r\n\t\trank = 0;\r\n\t\tvar i,j;\r\n\t\t\r\n\t\tcolumns: \r\n\t\tfor (j=0; j<n; ++j) {\r\n\t\t\trows:\r\n\t\t\tfor (i=0; i<m; ++i) { \r\n\t\t\t\tif (i != j && coefMatrix[pivotToEquationMap[i]][pivotToVariableMap[j]] !== 0) {\r\n\t\t\t\t\tbreak columns;\r\n\t\t\t\t}\r\n\t\t\t\telse if (i == j && coefMatrix[pivotToEquationMap[i]][pivotToVariableMap[j]] != 1) {\r\n\t\t\t\t\tbreak columns;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t++rank;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction determineNumberOfSolutions() {\r\n\t\t\r\n\t\tvar b2IsZero = true;\r\n\r\n\t\tfor (var i = rank; i < m; ++i) {\r\n\t\t\tif (constVector[pivotToEquationMap[i]] !== 0) {\r\n\t\t\t\tb2IsZero = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (rank < m && !b2IsZero) {\r\n\t\t\tnumberOfSolutions = 0;\r\n\t\t} else if (rank == n && (rank == m || b2IsZero)) {\r\n\t\t\tnumberOfSolutions = 1;\r\n\t\t} else if (rank < n && (rank == m || b2IsZero)) {\r\n\t\t\tnumberOfSolutions = Number.MAX_VALUE;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction determineSolution() {\r\n\t\tif (numberOfSolutions === 0) {\r\n\t\t\txVector = undefined;\r\n\t\t} else {\r\n\t\t\txVector = initArray(n);\r\n\t\t\tfor (var i = 0; i < rank; ++i) {\r\n\t\t\t\txVector[pivotToVariableMap[i]] = constVector[pivotToEquationMap[i]];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction initArray(size) {\r\n\t\tvar array = [];\r\n\t\tfor (var i = 0; i < size; i++) {\r\n\t\t\tarray[i] = 0;\r\n\t\t}\r\n\t\treturn array;\r\n\t}\r\n\t\r\nfunction copyArray(input) {\r\n\treturn input.slice();\r\n}\r\n\r\nfunction copyMatrix(input) {\r\n\tvar copy = [];\r\n\tfor (var i = 0; i < input.length; i++) {\r\n\t\tcopy[i] = input[i].slice();\r\n\t}\r\n\treturn copy;\r\n}\r\n\t\r\n\r\nmodule.exports = solve;\n},{}],13:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n.factory(\"openCreateExpenseDialog\", openCreateExpenseDialog);\r\n\r\n\r\nfunction openCreateExpenseDialog($mdDialog) {\r\n  \r\n  return open;\r\n  \r\n  function open() {\r\n    return $mdDialog.show({\r\n      templateUrl: \"expenses/create-expense-dialog.html\",\r\n      controller: DialogController,\r\n      controllerAs: \"vm\"\r\n    });\r\n  }\r\n  \r\n}\r\nopenCreateExpenseDialog.$inject = [\"$mdDialog\"];\r\n\r\nfunction DialogController($mdDialog) {\r\n  var vm = this;\r\n  \r\n  vm.ok = ok;\r\n  vm.cancel = cancel;\r\n  vm.init = init;\r\n  \r\n  init();\r\n  \r\n  \r\n  function init() {\r\n    vm.expense = {\r\n      name: undefined,\r\n      sharing: \"equal\"\r\n    };\r\n    vm.options = {\r\n      createParticipations: true\r\n    };\r\n  }\r\n\r\n  function ok() {\r\n    $mdDialog.hide({expense: vm.expense, options: vm.options});\r\n  }\r\n  \r\n  function cancel() {\r\n    $mdDialog.cancel();\r\n  }\r\n}\r\nDialogController.$inject = [\"$mdDialog\"];\n},{\"angular\":\"angular\"}],14:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar _ = require('lodash');\r\nvar angular = require(\"angular\");\r\n\r\nangular\r\n  .module(\"debtApp\")\r\n  .controller(\"ExpenseDetailCtrl\", ExpenseDetailCtrl);\r\n\r\nfunction ExpenseDetailCtrl(balanceSheetService,\r\n                           debtService,\r\n                           events,\r\n                           debounce,\r\n                           debtCalculationInterval,\r\n                           $mdDialog,\r\n                           $stateParams,\r\n                           $state,\r\n                           $scope,\r\n                           $timeout)\r\n{\r\n  var vm = this;\r\n\r\n  var confirmRemoveExpense = $mdDialog.confirm()\r\n    .content(\"Really delete this expense?\")\r\n    .ok(\"Ok\").cancel(\"Cancel\");\r\n\r\n  var computeDebtsDebounced = debounce(function() {\r\n    $timeout(function() {\r\n      vm.debtsByDebtor = computeDebts();\r\n    });\r\n  }, debtCalculationInterval);\r\n\r\n  vm.init = init;\r\n  vm.setParticipation = setParticipation;\r\n  vm.updateExpense = updateExpense;\r\n  vm.removeExpense = removeExpense;\r\n\r\n  init();\r\n\r\n  /////////////////////////////////////////////////////////////\r\n\r\n  function init() {\r\n    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n    vm.expense = vm.balanceSheet.getExpense($stateParams.id);\r\n    vm.isParticipant = {};\r\n    vm.everyoneParticipates = true;\r\n    updateExpense();\r\n\r\n    $scope.$on(events.BALANCE_SHEET_UPDATED, function(event) {\r\n      if (event.targetScope != $scope) {\r\n        vm.updateExpense();\r\n      }\r\n    });\r\n  }\r\n\r\n  function updateExpense() {\r\n    vm.expense.shareCost();\r\n    vm.isParticipant = getParticipationMap();\r\n    vm.cost = vm.expense.getCost();\r\n    vm.sumOfShares = vm.expense.getSumOfShares();\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n    computeDebtsDebounced();\r\n  }\r\n\r\n  function getParticipationMap() {\r\n    var map = {};\r\n\r\n    angular.forEach(vm.balanceSheet.persons, function(person) {\r\n      map[person.id] = false;\r\n      angular.forEach(vm.expense.getParticipations(), function(p) {\r\n        if (p.person.equals(person)) {\r\n          map[person.id] = true;\r\n        }\r\n      });\r\n    });\r\n\r\n    return map;\r\n  }\r\n\r\n  function setParticipation(person, isParticipant) {\r\n    if (isParticipant) {\r\n      vm.balanceSheet.createParticipation({expense: vm.expense, person: person});\r\n    } else {\r\n      vm.balanceSheet.removeParticipation({expense: vm.expense, person: person});\r\n    }\r\n    updateExpense();\r\n  }\r\n\r\n  function removeExpense() {\r\n    $mdDialog.show(confirmRemoveExpense)\r\n      .then(doRemoveExpense);\r\n  }\r\n\r\n  function doRemoveExpense() {\r\n    vm.balanceSheet.removeExpense(vm.expense);\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n    $state.go(\"balanceSheet\");\r\n  }\r\n\r\n  function computeDebts() {\r\n    if (vm.expense.isBalanced()) {\r\n      var debts = debtService.computeDebts(vm.expense.getParticipations());\r\n      return debtService.organizeByDebtor(debts);\r\n    }\r\n  }\r\n\r\n\r\n}\r\nExpenseDetailCtrl.$inject = [\"balanceSheetService\", \"debtService\", \"events\", \"debounce\", \"debtCalculationInterval\", \"$mdDialog\", \"$stateParams\", \"$state\", \"$scope\", \"$timeout\"];\r\n\n},{\"angular\":\"angular\",\"lodash\":\"lodash\"}],15:[function(require,module,exports){\n\"use strict\";\r\n\r\nrequire(\"./route-config\");\r\nrequire(\"./expense-detail-ctrl\");\r\nrequire(\"./create-expense-dialog\");\n},{\"./create-expense-dialog\":13,\"./expense-detail-ctrl\":14,\"./route-config\":16}],16:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n\t.config(config);\r\n\r\nfunction config($stateProvider) {\r\n\r\n\t$stateProvider\r\n\t\t.state(\"expense\", {\r\n\t\t\turl: \"/expenses/:id\",\r\n\t    templateUrl: \"expenses/expense-detail.html\",\r\n      controller: \"ExpenseDetailCtrl as vm\"\r\n\t\t})\r\n\t\t;\r\n}\r\nconfig.$inject = [\"$stateProvider\"];\n},{\"angular\":\"angular\"}],17:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n.factory(\"openCreatePersonDialog\", openCreatePersonDialog);\r\n\r\n\r\nfunction openCreatePersonDialog($mdDialog) {\r\n  \r\n  return open;\r\n  \r\n  function open() {\r\n    return $mdDialog.show({\r\n      templateUrl: \"persons/create-person-dialog.html\",\r\n      controller: DialogController,\r\n      controllerAs: \"vm\"\r\n    });\r\n  }\r\n  \r\n}\r\nopenCreatePersonDialog.$inject = [\"$mdDialog\"];\r\n\r\nfunction DialogController($mdDialog) {\r\n  var vm = this;\r\n  \r\n  vm.ok = ok;\r\n  vm.cancel = cancel;\r\n  vm.init = init;\r\n  \r\n  init();\r\n  \r\n  \r\n  function init() {\r\n    vm.person = {\r\n      name: undefined\r\n    };\r\n    vm.options = {\r\n      createParticipations: true\r\n    };\r\n  }\r\n\r\n  function ok() {\r\n    $mdDialog.hide({person: vm.person, options: vm.options});\r\n  }\r\n  \r\n  function cancel() {\r\n    $mdDialog.cancel();\r\n  }\r\n}\r\nDialogController.$inject = [\"$mdDialog\"];\n},{\"angular\":\"angular\"}],18:[function(require,module,exports){\n\"use strict\";\r\n\r\nrequire(\"./route-config\");\r\nrequire(\"./person-detail-ctrl\");\r\nrequire(\"./create-person-dialog\");\n},{\"./create-person-dialog\":17,\"./person-detail-ctrl\":19,\"./route-config\":20}],19:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar _ = require('lodash');\r\n\r\nangular.module(\"debtApp\")\r\n  .controller(\"PersonDetailCtrl\", PersonDetailCtrl);\r\n\r\nfunction PersonDetailCtrl(balanceSheetService,\r\n                          debtService,\r\n                          events,\r\n                          debounce,\r\n                          debtCalculationInterval,\r\n                          $state,\r\n                          $stateParams,\r\n                          $mdDialog,\r\n                          $scope,\r\n                          $timeout)\r\n{\r\n\r\n  var vm = this;\r\n  var confirmRemovePerson;\r\n\r\n  var computeDebtsDebounced = debounce(function() {\r\n    $timeout(function() {\r\n      var debtResult = computeDebts();\r\n      vm.debtRole = debtResult.role;\r\n      vm.debts = debtResult.debts;\r\n    });\r\n  }, debtCalculationInterval);\r\n\r\n  vm.init = init;\r\n  vm.refresh = refresh;\r\n  vm.updateExpense = updateExpense;\r\n  vm.setParticipation = setParticipation;\r\n  vm.removePerson = removePerson;\r\n  vm.updatePerson = updatePerson;\r\n\r\n  init();\r\n\r\n  function init() {\r\n    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n    vm.person = vm.balanceSheet.getPerson($stateParams.id);\r\n\r\n    refresh();\r\n\r\n    confirmRemovePerson = $mdDialog.confirm()\r\n      .content(\"Really delete this person?\")\r\n      .ok(\"Ok\").cancel(\"Cancel\");\r\n\r\n    $scope.$on(events.BALANCE_SHEET_UPDATED, vm.refresh);\r\n  }\r\n\r\n  function refresh() {\r\n    vm.isParticipant = getParticipationMap();\r\n    vm.cost = vm.person.getCost();\r\n    vm.sumOfShares = vm.person.getSumOfShares();\r\n    vm.balance = vm.person.getBalance();\r\n    computeDebtsDebounced();\r\n  }\r\n\r\n  function getParticipationMap() {\r\n    var map = {};\r\n\r\n    _.forEach(vm.balanceSheet.expenses, function(expense) {\r\n      map[expense.id] = false;\r\n      _.forEach(vm.person.getParticipations(), function(pt) {\r\n        if (pt.expense.equals(expense)) {\r\n          map[expense.id] = true;\r\n        }\r\n      });\r\n    });\r\n\r\n    return map;\r\n  }\r\n\r\n  function updateExpense(expense) {\r\n    expense.shareCost();\r\n    refresh();\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n\r\n  function setParticipation(expense, isParticipant) {\r\n    if (isParticipant) {\r\n      vm.balanceSheet.createParticipation({expense: expense, person: vm.person});\r\n    } else {\r\n      vm.balanceSheet.removeParticipation({expense: expense, person: vm.person});\r\n    }\r\n    vm.updateExpense(expense);\r\n  }\r\n\r\n  function computeDebts() {\r\n    var result = {\r\n      role: undefined,\r\n      debts: undefined\r\n    };\r\n\r\n    if (!vm.balanceSheet.isBalanced()) {\r\n      result.role = \"unbalanced\";\r\n      return result;\r\n    }\r\n\r\n    if (vm.balance > 0) {\r\n      result.role = \"debtor\";\r\n    } else if (vm.balance < 0) {\r\n      result.role = \"creditor\";\r\n    } else {\r\n      result.role = \"settled\";\r\n      return result;\r\n    }\r\n\r\n    var counterRole = {\r\n      \"debtor\": \"creditor\",\r\n      \"creditor\": \"debtor\"\r\n    };\r\n\r\n    var debts = debtService.computeDebts(vm.balanceSheet.getNonSettledParticipations());\r\n    result.debts = _.chain(debts)\r\n      .filter(function(d) {\r\n        return d[result.role].equals(vm.person);\r\n      })\r\n      .map(function(d) {\r\n        return {person: d[counterRole[result.role]], amount: d.amount};\r\n      })\r\n      .value();\r\n\r\n    return result;\r\n  }\r\n\r\n  function removePerson() {\r\n    $mdDialog.show(confirmRemovePerson)\r\n      .then(doRemovePerson);\r\n  }\r\n\r\n  function doRemovePerson() {\r\n    vm.balanceSheet.removePerson(vm.person);\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n    $state.go(\"balanceSheet\");\r\n  }\r\n\r\n  function updatePerson() {\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n}\r\nPersonDetailCtrl.$inject = [\"balanceSheetService\", \"debtService\", \"events\", \"debounce\", \"debtCalculationInterval\", \"$state\", \"$stateParams\", \"$mdDialog\", \"$scope\", \"$timeout\"];\r\n\n},{\"angular\":\"angular\",\"lodash\":\"lodash\"}],20:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n  .config(config);\r\n\r\nfunction config($stateProvider) {\r\n\r\n  $stateProvider\r\n    .state(\"person\", {\r\n      url: \"/persons/:id\",\r\n      templateUrl: \"persons/person-detail.html\",\r\n      controller: \"PersonDetailCtrl as vm\"\r\n    })\r\n    ;\r\n}\r\nconfig.$inject = [\"$stateProvider\"];\n},{\"angular\":\"angular\"}],21:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n\t.config(config);\r\n\r\nfunction config($urlRouterProvider) {\r\n  \r\n  $urlRouterProvider.otherwise(\"/\");\r\n  \r\n}\r\nconfig.$inject = [\"$urlRouterProvider\"];\n},{\"angular\":\"angular\"}],22:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar _ = require('lodash');\r\n\r\nangular.module(\"debtApp\")\r\n  .filter(\"balance\", balance);\r\n\r\n\r\nfunction balance($filter) {\r\n  return function balance(value) {\r\n    if (value > 0) {\r\n      return \"+\" + $filter(\"number\")(value, \"2\");\r\n    } else if (value <= 0) {\r\n      return $filter(\"number\")(value, \"2\");\r\n    } else {\r\n      return undefined;\r\n    }\r\n  };\r\n}\r\nbalance.$inject = [\"$filter\"];\n},{\"angular\":\"angular\",\"lodash\":\"lodash\"}],23:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar fileSaver = require(\"node-safe-filesaver\");\r\nrequire(\"blob-polyfill\");\r\n\r\nangular.module(\"debtApp\")\r\n  .factory(\"fileService\", fileService);\r\n\r\n\r\nfunction fileService($q, $window) {\r\n\r\n  return {\r\n    readAsText: readAsText,\r\n    saveAsFile: saveAsFile,\r\n    isSupported: isSupported\r\n  };\r\n\r\n  function readAsText(blob) {\r\n    var deferred = $q.defer();\r\n\r\n    var reader = new $window.FileReader();\r\n    reader.onload = function() {\r\n      deferred.resolve(reader.result);\r\n    };\r\n    reader.onerror = function() {\r\n      deferred.resolve(reader.error);\r\n    };\r\n    reader.readAsText(blob);\r\n\r\n    return deferred.promise;\r\n  }\r\n\r\n  function saveAsFile(dataArray, fileName) {\r\n    var blob = new $window.Blob(dataArray, {});\r\n    fileSaver.saveAs(blob, fileName);\r\n  }\r\n\r\n  function isSupported() {\r\n    return $window.FileReader && $window.Blob;\r\n  }\r\n}\r\nfileService.$inject = [\"$q\", \"$window\"];\n},{\"angular\":\"angular\",\"blob-polyfill\":\"blob-polyfill\",\"node-safe-filesaver\":\"node-safe-filesaver\"}],24:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n  .directive(\"focus\", focus);\r\n\r\n\r\nfunction focus($timeout) {\r\n  return {\r\n    restrict: \"A\",\r\n    link: function($scope, iElem) {\r\n      $timeout(function() {\r\n        iElem[0].focus();\r\n      }, 0);\r\n    }\r\n  };\r\n}\r\nfocus.$inject = [\"$timeout\"];\n},{\"angular\":\"angular\"}],25:[function(require,module,exports){\n\"use strict\";\r\n\r\nrequire(\"./money-input-directive\");\r\nrequire(\"./balance-filter\");\r\nrequire(\"./money-filter\");\r\nrequire(\"./file-service\");\r\nrequire(\"./focus-directive\");\n},{\"./balance-filter\":22,\"./file-service\":23,\"./focus-directive\":24,\"./money-filter\":26,\"./money-input-directive\":27}],26:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n  .filter(\"money\", money);\r\n\r\n\r\nfunction money($filter) {\r\n  return function money(value) {\r\n    return $filter(\"number\")(value, \"2\");\r\n  };\r\n}\r\nmoney.$inject = [\"$filter\"];\n},{\"angular\":\"angular\"}],27:[function(require,module,exports){\n\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar Decimal = require(\"simple-decimal-money\");\r\n\r\nangular.module(\"debtApp\")\r\n  .directive(\"moneyInput\", moneyInput);\r\n\r\n\r\nfunction moneyInput($filter) {\r\n  return {\r\n    restrict: \"A\",\r\n    require: \"ngModel\",\r\n    link: link\r\n  };\r\n\r\n  function link($scope, iElem, iAttrs, ngModel) {\r\n    ngModel.$validators.money = validateMoney;\r\n    ngModel.$parsers.push(parseMoney);\r\n    ngModel.$formatters.unshift(formatMoney);\r\n\r\n    iElem.on(\"blur\", handleBlur);\r\n    ngModel.$render = render;\r\n\r\n    function render() {\r\n      if (ngModel.$valid) {\r\n        iElem.val(formatMoney(ngModel.$modelValue));\r\n      } else {\r\n        iElem.val(ngModel.$viewValue);\r\n      }\r\n    }\r\n\r\n    function handleBlur() {\r\n      ngModel.$render();\r\n    }\r\n  }\r\n\r\n  function validateMoney(value) {\r\n    if (value < 0) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  function formatMoney(value) {\r\n    if (value === undefined || value === null) {\r\n      return \"\";\r\n    } else {\r\n      return $filter(\"number\")(value, 2);\r\n    }\r\n  }\r\n\r\n  function parseMoney(value) {\r\n    return new Decimal(value).toNumber();\r\n  }\r\n\r\n}\r\nmoneyInput.$inject = [\"$filter\"];\r\n\n},{\"angular\":\"angular\",\"simple-decimal-money\":\"simple-decimal-money\"}]},{},[1]);\n"],"sourceRoot":"/source/"}