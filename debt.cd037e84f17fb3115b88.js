webpackJsonp([0,2],[function(e,n,t){e.exports=t(1)},function(e,n,t){"use strict";function a(e){var n=["ic_add_24px.svg","ic_attach_money_24px.svg","ic_chevron_right_24px.svg","ic_close_24px.svg","ic_delete_24px.svg","ic_face_24px.svg","ic_home_24px.svg","ic_more_vert_24px.svg","ic_shopping_basket_24px.svg","ic_warning_24px.svg"],a=l.map(n,function(e){var n=e.substr(0,e.indexOf("."));return{filePath:t(74)("./"+e),iconName:n}});l.each(a,function(n){e.icon(n.iconName,n.filePath)})}function r(e){e.setPrefix("debtApp")}function i(e){e.aHrefSanitizationWhitelist(/^(blob||https?):/)}function o(e,n){e.decorator("$exceptionHandler",["$delegate","$log","$injector",function(e,t,a){return function(t,r){e(t,r);var i=a.get("$rootScope");if(i.$broadcast(n.ERROR,t,r),t instanceof d){var o=a.get("$state");o.go("currencies")}}}])}function c(e,n,t){e.$state=n,e.$stateParams=t}function s(e,n){e.$mdMedia=n}r.$inject=["localStorageServiceProvider"],a.$inject=["$mdIconProvider"],i.$inject=["$compileProvider"],o.$inject=["$provide","events"],c.$inject=["$rootScope","$state","$stateParams"],s.$inject=["$rootScope","$mdMedia"],t(2),t(6),t(13);var u=t(14);t(16),t(22),t(23),t(24);var l=t(25);u.module("debtApp",["ngMaterial","ui.router","LocalStorageModule","ngFileUpload"]).constant("events",{BALANCE_SHEET_UPDATED:"balance sheet updated",ERROR:"error"}).constant("debtCalculationInterval",500).config(r).config(a).config(i).config(o).run(c).run(s),t(27),t(28),t(29),t(36),t(44),t(51),t(58),t(69);var d=t(41)},function(e,n){},,,,function(e,n){},,,,,,,function(e,n){window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(){window.location.reload()},!1)},!1)},,,,,,,,,,,,,,function(e,n,t){"use strict";function a(e,n,t,a,r,o,c,s,u,l,d){function p(){l.$on(c.BALANCE_SHEET_UPDATED,n(function(){w.balanceSheetUpdated()}),t,l,!0),l.$on(c.ERROR,v),e.init(),w.balanceSheet=e.balanceSheet,f()}function m(){w.errorMessage=void 0,g(),f()}function g(){try{e.save()}catch(e){d.error(e),w.errorMessage="Cannot save: "+e.message}}function f(){var e=w.balanceSheet.getNonConvertibleCurrencies(w.balanceSheet.getExpenseCurrencies(),w.balanceSheet.currency);if(0!==e.length&&!w.errorMessage){var n=i.template("Cannot convert <%= currencyWord %> <%= currencyList %> to balance sheet's currency <%= balanceSheetCurrency %>"),t={currencyWord:1==e.length?"currency":"currencies",currencyList:"",balanceSheetCurrency:"'"+w.balanceSheet.currency+"'"};i.each(e,function(e,n){t.currencyList=t.currencyList+(n>0?", ":"")+"'"+e+"'"}),w.errorMessage=n(t)}}function v(e,n){w.errorMessage=n.message}function b(){a().then(function(n){e.balanceSheet.createPerson(n.person,n.options),w.balanceSheetUpdated(),l.$broadcast(c.BALANCE_SHEET_UPDATED)})}function h(){r().then(function(n){e.balanceSheet.createExpense(n.expense,n.options),w.balanceSheetUpdated(),l.$broadcast(c.BALANCE_SHEET_UPDATED)})}function x(){s.show(C).then(function(){e.createNew(),w.balanceSheetUpdated(),u.go("balanceSheet"),l.$broadcast(c.BALANCE_SHEET_UPDATED)})}function y(e){if(e&&e.length){if(!o.isSupported())return void(w.errorMessage="File operations not supported in this browser. Please consider a more modern browser.");var n=e[0];o.readAsText(n).then(function(e){S(e)}).catch(function(e){d.error(e),w.errorMessage="Unable to read file"})}}function S(n){e.loadFromJson(n),w.balanceSheetUpdated(),u.go("balanceSheet"),l.$broadcast(c.BALANCE_SHEET_UPDATED)}function E(){if(!o.isSupported())return void(w.errorMessage="File operations not supported in this browser. Please consider a more modern browser.");var n=e.exportToJson();try{o.saveAsFile([n],e.balanceSheet.name+".txt")}catch(e){d.error(e),w.errorMessage="Error when saving file"}}function M(){s.show({templateUrl:"help.html",controller:["$scope","$mdDialog",function(e,n){e.close=function(){n.hide()}}]})}var w=this;w.init=p,w.createPerson=b,w.createExpense=h,w.createNewSheet=x,w.loadSheet=y,w.exportSheet=E,w.balanceSheetUpdated=m,w.showHelp=M;var C=s.confirm().title("Create new sheet").content("The current sheet will be discarded. Please consider exporting it first. Continue?").ok("Ok").cancel("Cancel");p()}a.$inject=["balanceSheetService","debounce","balanceSheetSaveInterval","openCreatePersonDialog","openCreateExpenseDialog","fileService","events","$mdDialog","$state","$scope","$log"];var r=t(14),i=t(25);r.module("debtApp").constant("balanceSheetSaveInterval",500).controller("DebtAppCtrl",a)},function(e,n,t){"use strict";function a(e){e.otherwise("/")}a.$inject=["$urlRouterProvider"];var r=t(14);r.module("debtApp").config(a)},function(e,n,t){"use strict";t(30),t(31),t(32),t(35)},function(e,n){"use strict";function t(e){function n(){if(!e||!e.A||!e.b)throw new TypeError("Null matrix A or vector b in system Ax = b");if(e.A.length<1||e.A[0].length<1)throw new TypeError("Matrix A in Ax = b has no rows or no columns");if(e.A.length!=e.b.length)throw new RangeError("The dimensions of the matrix and the constant vector are incompatible")}function t(){d=i(e.A),p=r(e.b),g=d.length,f=d[0].length,h=[];for(var n=0;n<g;n++)h[n]=n;y=[];for(var n=0;n<g;n++){y[n]=0;for(var t=0;t<f;t++){var a=Math.abs(d[n][t]);a>y[n]&&(y[n]=a)}}x=[];for(var t=0;t<f;t++)x[t]=t}function o(){for(var e=0,n=[];e<g-1;){for(var t=0,a=e,r=e;r<g;++r){var i=h[r],o=x[e],c=Math.abs(d[i][o]/y[i]);c>t&&(t=c,a=r)}if(0===t){var s=x[e];n[s]=!0;for(var r=e,u=s;u==s&&r<f-1;)++r,n[x[r]]||(u=x[r]);if(u!=s){x[e]=u,x[r]=s;continue}return}var l=h[e];h[e]=h[a],h[a]=l;var m=h[e],v=x[e];for(r=e+1;r<g;++r){for(var i=h[r],b=d[i][v]/d[m][v],S=e+1;S<f;++S){var E=x[S];d[i][E]=d[i][E]-b*d[m][E]}d[i][v]=0,p[i]=p[i]-b*p[m]}e++}}function c(){var e;for(e=Math.min(g,f)-1;e>0;--e){var n=h[e],t=x[e];if(0!==d[n][t])for(var a=e-1;a>-1;--a){for(var r=d[h[a]][x[e]]/d[h[e]][x[e]],i=0;i<f;++i)d[h[a]][x[i]]-=r*d[h[e]][x[i]];p[h[a]]-=r*p[h[e]]}}for(e=0;e<Math.min(g,f);++e)if(0!==d[h[e]][x[e]]){for(var o=d[h[e]][x[e]],i=0;i<f;++i)d[h[e]][i]=d[h[e]][i]/o;p[h[e]]=p[h[e]]/o}}function s(){v=0;var e,n;e:for(n=0;n<f;++n){for(e=0;e<g;++e){if(e!=n&&0!==d[h[e]][x[n]])break e;if(e==n&&1!=d[h[e]][x[n]])break e}++v}}function u(){for(var e=!0,n=v;n<g;++n)if(0!==p[h[n]]){e=!1;break}v<g&&!e?b=0:v!=f||v!=g&&!e?v<f&&(v==g||e)&&(b=Number.MAX_VALUE):b=1}function l(){if(0===b)m=void 0;else{m=a(f);for(var e=0;e<v;++e)m[x[e]]=p[h[e]]}}var d,p,m,g,f,v,b,h,x,y;return n(),t(),o(),c(),s(),u(),l(),{xVector:m,numberOfEquations:g,numberOfVariables:f,rank:v,numberOfFreeVariables:f-v,numberOfSolutions:b}}function a(e){for(var n=[],t=0;t<e;t++)n[t]=0;return n}function r(e){return e.slice()}function i(e){for(var n=[],t=0;t<e.length;t++)n[t]=e[t].slice();return n}e.exports=t},function(e,n,t){"use strict";function a(){return r}var r=t(30),i=t(14);i.module("debtApp").factory("solveLinearSystem",a)},function(e,n,t){"use strict";function a(e){function n(e){if(!e||0===e.length)return[];var n=t(e);if(a(n))return[];if(!s(n))throw new Error("Debt system is not balanced");var r=u(n),i=l(r),o=p(i);return g(o,r)}function t(e){var n={};return r.forEach(e,function(e){var t=n[e.person.id];void 0===t&&(t={person:e.person,balance:new i(0)},n[e.person.id]=t);var a=new i(e.paid),r=new i(e.share);t.balance=t.balance.add(r.subtract(a))}),r.forEach(n,function(e){e.balance=e.balance.toNumber()}),n}function a(e){return c.every(e,{balance:0})}function s(e){return 0===c.reduce(e,function(e,n){return e.add(n.balance)},new i(0)).toNumber()}function u(e){var n=[],t=[];return r.forEach(e,function(e){e.balance<=0?t.push(e):n.push(e)}),{debtors:n,creditors:t}}function l(e){var n=e.debtors.length,t=e.creditors.length,a=[];c.each(e.debtors,function(e,n){a[n]=new i(e.balance).multiply(100).toNumber()}),c.each(e.creditors,function(e,t){a[n+t]=new i(e.balance).multiply(-100).toNumber()});for(var r=d(n+t,n*t),o=0;o<n;o++)for(var s=o*t;s<(o+1)*t;s++)r[o][s]=1;for(var o=n;o<t+n;++o)for(var s=o-n;s<n*t;s+=t)r[o][s]=1;return{A:r,b:a}}function d(e,n){for(var t=[],a=0;a<e;a++){t[a]=[];for(var r=0;r<n;r++)t[a][r]=0}return t}function p(n){var t=e(n);if(0===t.numberOfSolutions)throw new Error("Debt system has no solutions");var a=t.numberOfVariables,i=t.numberOfFreeVariables;if(0===i)return t.xVector;var c=o.engines.mt19937();c.seed(20150312);var s;do{for(var u=r.copy(n.A),l=n.b,d=[],p=0;p<a;p++)d[p]=p;s=[];for(var p=0;p<i;p++){var g=o.integer(0,d.length-1)(c);s.push(d[g]),d.splice(g,1)}for(var p=0;p<u.length;p++)for(var f=0;f<s.length;f++)u[p][s[f]]=0;t=e({A:u,b:l})}while(!m(t.xVector));return t.xVector}function m(e){if(!e)return!1;for(var n=0;n<e.length;n++)if(e[n]<0)return!1;return!0}function g(e,n){for(var t=[],a=0;a<e.length;a++)if(0!==e[a]){var r=Math.floor(a/n.creditors.length),o=a-n.creditors.length*r,c=new i(e[a]).divideBy(100).toNumber(),s={debtor:n.debtors[r].person,creditor:n.creditors[o].person,amount:c};t.push(s)}return t}return n}a.$inject=["solveLinearSystem"];var r=t(14),i=t(33),o=t(34),c=t(25);r.module("debtApp").factory("solveDebts",a)},,,function(e,n,t){"use strict";function a(e){function n(n,t){void 0!==t&&(n=i.map(n,function(e){return{person:e.person,expense:e.expense,paid:e.getPaid(t,{strictConversion:!0}),share:e.getShare(t,{strictConversion:!0})}}));var a=e(n);return void 0!==t&&(a=i.map(a,function(e){return i.extend(e,{currency:t})})),a}function t(e){var n=[],t={};return i.each(e,function(e){var a,r=t[e.debtor.id];void 0===r&&(r=n.length,a={debtor:e.debtor,debts:[]},n.push(a),t[e.debtor.id]=r),a=n[r],a.debts.push(i.omit(e,"debtor"))}),i.each(n,function(e){e.debts.sort(function(e,n){return e.creditor.name.localeCompare(n.creditor.name)})}),n.sort(function(e,n){return e.debtor.name.localeCompare(n.debtor.name)}),n}return{computeDebts:n,organizeByDebtor:t}}a.$inject=["solveDebts"];var r=t(14),i=t(25);r.module("debtApp").factory("debtService",a)},function(e,n,t){"use strict";t(37),t(40),t(42),t(43),t(41)},function(e,n,t){"use strict";function a(e){e.state("balanceSheet",{url:"/",views:{"":{templateUrl:i,controller:"BalanceSheetCtrl as vm"},floatingButton:{templateUrl:o}}})}a.$inject=["$stateProvider"];var r=t(14),i=t(38),o=t(39);r.module("debtApp").config(a)},function(e,n){var t="balance-sheet/balance-sheet.html",a='<section layout=column> <md-input-container class=md-title md-no-float> <input type=text placeholder="Sheet name" ng-model=vm.balanceSheet.name ng-change=::vm.updateSheet() ng-required=true /> </md-input-container> <div ng-if=vm.balanceSheet.currenciesEnabled() class=row layout=row layout-align="start center"> <label for=currency flex>Currency</label> <md-select id=currency aria-label=Currency class="no-margin margin-right" ng-model=vm.balanceSheet.currency ng-change=::vm.updateSheet()> <md-option ng-value=::currency ng-repeat="currency in ::vm.balanceSheet.getCurrencies()">{{::currency}}</md-option> </md-select> </div> </section> <section> <md-list> <md-subheader class="md-primary section-header md-no-sticky">Expenses</md-subheader> <md-list-item class=md-2-line ng-repeat="expense in vm.balanceSheet.expenses" ng-click="::$state.go(\'expense\', {id: expense.id})"> <md-icon hide-xs ng-if=::expense.isBalanced() class=md-primary md-svg-icon=ic_shopping_basket_24px></md-icon> <md-icon ng-if=::!expense.isBalanced() class=md-warn md-svg-icon=ic_warning_24px></md-icon> <div class=md-list-item-text layout=column> <div layout=row ng-class="{\'md-body-1\': $mdMedia(\'xs\')}"> <span flex class=margin-right-double ng-class="::{settled: expense.settled}">{{::expense.name}}</span> <span ng-if=::!vm.balanceSheet.currenciesEnabled()> {{::expense.getCost() | money}} </span> <span ng-if=::vm.balanceSheet.currenciesEnabled()> {{vm.balanceSheet.currency}} {{expense.getCost(vm.balanceSheet.currency) | money}} </span> </div> <p layout=row> <span>{{expense.date | date:\'longDate\'}}</span> <span flex>&nbsp;</span> <span ng-if="vm.balanceSheet.currenciesEnabled() && vm.balanceSheet.currency !== expense.computedCurrency()"> {{expense.computedCurrency()}} {{::expense.getCost() | money}} </span> </p> </div> </md-list-item> <md-list-item ng-if="vm.balanceSheet.expenses.length == 0"> <p class=md-list-item-text> No expenses. </p> </md-list-item> </md-list> </section> <section> <md-list> <md-subheader class="md-primary section-header md-no-sticky">People</md-subheader> <md-list-item class=md-2-line ng-repeat="person in vm.balanceSheet.persons" ng-click="::$state.go(\'person\', {id: person.id})"> <md-icon hide-xs class=md-primary md-svg-icon=ic_face_24px></md-icon> <div class=md-list-item-text> <div layout=row ng-class="{\'md-body-1\': $mdMedia(\'xs\')}"> <span flex class=margin-right-double>{{::person.name}}</span> <span ng-if=::!vm.balanceSheet.currenciesEnabled()> {{::person.getBalance() | balance}} </span> <span ng-if=::vm.balanceSheet.currenciesEnabled()> {{vm.balanceSheet.currency}} {{person.getBalance(vm.balanceSheet.currency) | balance}} </span> </div> <p>&nbsp;</p> </div> </md-list-item> <md-list-item ng-if="vm.balanceSheet.persons.length == 0"> <p class=md-list-item-text> No people. </p> </md-list-item> </md-list> </section> <section> <md-list> <md-subheader class="md-primary section-header md-no-sticky">Debts</md-subheader> <md-list-item class=md-2-line ng-repeat="d in vm.debtsByDebtor"> <div class=md-list-item-text layout=column> <span class=margin-bottom>{{d.debtor.name}} owes</span> <span ng-repeat="c in d.debts" class="margin-left-double margin-bottom"> {{c.creditor.name}}: {{c.currency}} {{c.amount | money}} </span> </div> </md-list-item> <md-list-item ng-if="vm.balanceSheet.persons.length == 0 || vm.balanceSheet.expenses.length == 0"> <div class=md-list-item-text> <p>This section will show debts that settle all expenses with minimum number of transactions.</p> <p>You can also settle expenses individually.</p> </div> </md-list-item> <md-list-item ng-if="vm.debtsByDebtor.length == 0 && vm.balanceSheet.persons.length > 0 && vm.balanceSheet.expenses.length > 0"> <p class=md-list-item-text> Everyone is settled up! </p> </md-list-item> <md-list-item ng-if=::!vm.balanceSheet.isBalanced()> <md-icon class=md-warn md-svg-icon=ic_warning_24px></md-icon> <p class=md-list-item-text> Cannot compute debts. There are unbalanced expenses. </p> </md-list-item> <md-list-item ng-if=vm.debtComputationError> <md-icon class=md-warn md-svg-icon=ic_warning_24px></md-icon> <p class=md-list-item-text> {{vm.debtComputationError}} </p> </md-list-item> </md-list> </section>';window.angular.module("ng").run(["$templateCache",function(e){e.put(t,a)}]),e.exports=t},function(e,n){var t="balance-sheet/floating-button.html",a='<md-fab-speed-dial md-direction=up ng-init="isFabOpen = false" md-open=isFabOpen ng-mouseenter="isFabOpen = true" ng-mouseleave="isFabOpen = false" class="md-fab-bottom-right md-scale md-hover-full"> <md-fab-trigger> <md-button aria-label=Create... class="md-fab md-primary"> <md-icon md-svg-icon=ic_add_24px></md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <md-button ng-click=vm.createExpense() aria-label="Create expense" class="md-fab md-primary md-mini"> <md-icon md-svg-icon=ic_shopping_basket_24px></md-icon> </md-button> <md-button ng-click=vm.createPerson() aria-label="Create person" class="md-fab md-primary md-mini"> <md-icon md-svg-icon=ic_face_24px></md-icon> </md-button> </md-fab-actions> </md-fab-speed-dial> ';window.angular.module("ng").run(["$templateCache",function(e){e.put(t,a)}]),e.exports=t},function(e,n,t){"use strict";var a=t(25),r=t(33),i=t(41),o=function(e){function n(){return a.filter(q,function(e){return!e.expense.settled})}function t(){return a.reduce(Z,function(e,n){return e&&(n.settled||n.isBalanced())},!0)}function o(e){return a(H).find(function(n){return n.id==e})}function c(e,n){e=a.extend({name:"Person "+(H.length+1)},e),n=a.extend({},n),void 0===e.id&&(e.id=F,F+=1);var t=new L(e);return H.push(t),n.createParticipations===!0&&a.each(Z,function(e){e.settled||(m({person:t,expense:e}),e.shareCost())}),t}function s(e){e=o(e.id),e&&(a.remove(H,function(n){return n.equals(e)}),a.forEach(e.getParticipations(),function(e){g(e)}))}function u(e){return a(Z).find(function(n){return n.id==e})}function l(e,n){e=a.extend({name:"Expense "+(Z.length+1),sharing:"equal",settled:!1,currency:void 0},e),n=a.extend({},n),void 0===e.id&&(e.id=F,F+=1);var t=new T(e);return Z.push(t),n.createParticipations===!0&&a.each(H,function(e){m({person:e,expense:t})}),t}function d(e){e=u(e.id),e&&(a.remove(Z,function(n){return n.equals(e)}),a.forEach(e.getParticipations(),function(e){g(e)}))}function p(e){var n=new _(e);return a(q).find(function(e){return n.equals(e)})}function m(e){if(p(e))throw new Error("Duplicate participation");e=a.extend({paid:0,share:0},e);var n=new _(e);return q.push(n),n.expense.shareCost(),n}function g(e){e=p(e),e&&(a.remove(q,function(n){return n.equals(e)}),e.expense.shareCost())}function f(){return J&&J.length>0}function v(){return a.cloneDeep(J)}function b(){return a.chain(h()).concat(x(),U.currency).uniq().sort().value()}function h(){return a.reduce(J,function(e,n){return e.push(n.fixed),e.push(n.variable),e},[])}function x(){return a.map(Z,function(e){return e.computedCurrency()})}function y(e){S(e);var n=a.find(J,a.pick(e,"fixed","variable"));n?a.extend(n,e):J.push(e),N()}function S(e){if(!a.isString(e.fixed)||""===a.trim(e.fixed))throw new TypeError("Fixed currency symbol must be a non-empty string");if(!a.isString(e.variable)||""===a.trim(e.variable))throw new TypeError("Variable currency symbol must be a non-empty string");if(!a.isNumber(e.rate)||e.rate<1e-4)throw new RangeError("Foreign currency rate must be >= 0.0001")}function E(e){return e?a.isString(e)&&0===a.trim(e).length?void 0:a.trim(e):void 0}function M(e){return e=a.clone(e),e.fixed=E(e.fixed),e.variable=E(e.variable),e}function w(e){e&&(e=M(e),a.remove(J,a.pick(e,"fixed","variable")),N(),P())}function C(e){var n;if(!e)throw new i("Undefined or null conversion data");if(e=M(e),e.fixed==e.variable)return new r(e.value).toNumber();var t=a.find(J,{fixed:e.fixed,variable:e.variable});if(t)n=new r(t.rate,z);else{var o={variable:e.fixed,fixed:e.variable},c=a.find(J,o);c&&(n=new r(1/c.rate,z))}if(!n)throw new i("Could not find an exchange rate for conversion '"+e.fixed+"' -> '"+e.variable+"'.");return new r(100*e.value).multiply(n).divideBy(100).toNumber()}function I(e){try{return C(e)}catch(e){if(e instanceof i)return NaN;throw e}}function D(e,n){if(!a.isArray(e))return[];var t=[];return a.each(b(),function(e){try{C({fixed:e,variable:n,value:1}),t.push(e)}catch(e){}}),t}function A(e,n){return a.difference(e,D(e,n))}function N(){var e=h();0===J.length?U.currency=void 0:void 0!==U.currency&&a.indexOf(e,U.currency)!==-1||(U.currency=J[0].fixed)}function P(){var e=a.concat(h(),U.currency);a.each(Z,function(n){a.indexOf(e,n.currency)===-1&&(n.currency=U.currency)})}function j(){a.each(Z,function(e){try{C({fixed:e.computedCurrency(),variable:U.currency,value:1})}catch(n){throw new i("Cannot convert currency '"+e.computedCurrency()+"' of '"+e.name+"' to balance sheet's currency '"+U.currency+"'")}})}function L(e){function n(e){return g.map(e).reduce(function(e,n){return e.add(n)},new r(0)).value().toNumber()}function t(){return R.currency}function i(e){return e=e||p.computedCurrency(),n(function(n){return n.getPaid(e)})}function o(e){return e=e||p.computedCurrency(),n(function(n){return n.getShare(e)})}function c(){return 0===s()}function s(e){return e=e||p.computedCurrency(),new r(o(e)).subtract(i(e)).toNumber()}function u(){return m.value()}function l(e){return e instanceof L&&e.id===p.id}function d(){var e=a.negate(a.isFunction);return a.extend(a.pickBy(p,e),{})}var p=this;a.extend(p,e),p.computedCurrency=t,p.equals=l,p.getCost=i,p.getSumOfShares=o,p.getBalance=s,p.isBalanced=c,p.getParticipations=u,p.exportData=d;var m=a.chain(q).filter(function(e){return p.equals(e.person)}),g=m.filter(function(e){return!e.expense.settled})}function T(e){function n(e,n){var t=f.map(e).reduce(function(e,n){return e.add(n)},new r(0)).value().toNumber();return n&&n!==g.computedCurrency()?I({value:t,fixed:g.computedCurrency(),variable:n}):t}function t(){return g.currency||R.currency}function i(e){return n(function(e){return e.paid},e)}function o(e){return n(function(e){return e.share},e)}function c(){return 0===s(g.computedCurrency())}function s(e){return new r(o(e)).subtract(i(e)).toNumber()}function u(){return f.value()}function l(){"equal"===g.sharing&&d()}function d(){var e=g.getParticipations();if(0!==e.length){var n=new r(g.getCost()),t=n.divideBy(e.length),i=n.subtract(t.multiply(e.length-1));a.forEach(e,function(n,a){a<e.length-1&&(n.share=t.toNumber())}),a.last(e).share=i.toNumber()}}function p(e){return e instanceof T&&e.id===g.id}function m(){var e=a.negate(a.isFunction);return a.extend(a.pickBy(g,e))}var g=this;a.extend(g,e),g.computedCurrency=t,g.getCost=i,g.getSumOfShares=o,g.getBalance=s,g.isBalanced=c,g.getParticipations=u,g.shareCost=l,g.equals=p,g.exportData=m;var f=a.chain(q).filter(function(e){return g.equals(e.expense)})}function _(e){function n(e){return e.strictConversion?C:I}function t(e,t,i){if(!t||t===u.expense.computedCurrency())return u[e];i=a.extend({strictConversion:!1},i);var o=n(i),c=u.expense.getParticipations();if(a.last(c)===u){var s=o({value:u[e],fixed:u.expense.computedCurrency(),variable:t}),l=a.reduce(c,function(n,t){return n.add(t[e])},new r(0)).toNumber(),d=o({value:l,fixed:u.expense.computedCurrency(),variable:t}),p=a.reduce(c,function(n,a){var r=o({value:a[e],fixed:a.expense.computedCurrency(),variable:t});return n.add(r)},new r(0)),m=p.subtract(d);return new r(s).subtract(m).toNumber()}return o({value:u[e],fixed:u.expense.computedCurrency(),variable:t})}function i(e,n){return t("paid",e,n)}function o(e,n){return t("share",e,n)}function c(e){return e instanceof _&&u.expense.equals(e.expense)&&u.person.equals(e.person)}function s(){return{personId:u.person.id,expenseId:u.expense.id,paid:u.paid,share:u.share}}var u=this;if(!e||!e.person||!e.expense)throw new ReferenceError("Undefined participation");a.extend(u,e),u.getPaid=i,u.getShare=o,u.equals=c,u.exportData=s}function $(){var e=a.negate(a.isFunction),n=a.pickBy(U,e);return n.persons=a.map(H,function(e){return e.exportData()}),n.expenses=a.map(Z,function(e){return e.exportData()}),n.participations=a.map(q,function(e){return e.exportData()}),n.exchangeRates=v(),n}function k(e){F=a([]).concat(e.persons).concat(e.expenses).map("id").max()+1,a.isNaN(F)&&(F=1);var n={persons:!0,expenses:!0,participations:!0,exchangeRates:!0};a.each(e.exchangeRates,function(e){y(e)}),a.extend(U,a.pickBy(e,function(e,t){return!n[t]})),a.each(e.persons,function(e){c(e)}),a.each(e.expenses,function(e){l(e)}),a.each(e.participations,function(e){var n=o(e.personId),t=u(e.expenseId);m({person:n,expense:t,paid:e.paid,share:e.share})}),O()}function B(){try{return O(),!0}catch(e){return!1}}function O(){a.each(H,function(e){if(!a.isNumber(e.id))throw new Error("Person has no id")}),a.each(Z,function(e){if(!a.isNumber(e.id))throw new Error("Expense has no id")});var e={};a.each(H,function(n){e[n.id]=n}),a.each(Z,function(n){e[n.id]=n}),a.each(q,function(n){if(!n.person)throw new Error("Participation has no person");if(!e[n.person.id])throw new Error("Participation person is unknown");if(!n.expense)throw new Error("Participation has no expense");if(!e[n.expense.id])throw new Error("Participation expense is unknown")})}var U=this,R=this,z=4,H=[],Z=[],q=[],J=[],F=1;U.name="New sheet",U.currency=void 0,U.persons=H,U.expenses=Z,U.participations=q,e&&k(e),U.getNonSettledParticipations=n,U.isBalanced=t,U.getPerson=o,U.createPerson=c,U.removePerson=s,U.getExpense=u,U.createExpense=l,U.removeExpense=d,U.getParticipation=p,U.createParticipation=m,U.removeParticipation=g,U.exportData=$,U.isValid=B,U.throwErrorIfInvalid=O,U.currenciesEnabled=f,U.getExchangeRates=v,U.getCurrencies=b,U.getExpenseCurrencies=x,U.getExchangeRateCurrencies=h,U.addOrUpdateExchangeRate=y,U.removeExchangeRate=w,U.convertCurrency=C,U.getConvertibleCurrencies=D,U.getNonConvertibleCurrencies=A,U.throwErrorIfInvalidExpenseCurrencies=j};e.exports=o},function(e,n){"use strict";function t(e){var n=Error.apply(this,arguments);this.stack=n.stack,this.message=n.message}t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e.exports=t},function(e,n,t){"use strict";function a(e){function n(){var n,t=e.get("balanceSheetData");n=t&&t.json?JSON.parse(t.json,r):t?t:{},u.balanceSheet=new i(n)}function t(){if(!u.balanceSheet)throw new ReferenceError("No balance valid balance sheet");u.balanceSheet.throwErrorIfInvalid();var n=JSON.stringify(u.balanceSheet.exportData());e.set("balanceSheetData",{json:n})}function a(e){var n=JSON.parse(e,r),a=new i(n);a.throwErrorIfInvalid(),u.balanceSheet=a,t()}function r(e,n){return"string"==typeof n&&s.test(n)?new Date(n):n}function o(){var e=u.balanceSheet.exportData();return JSON.stringify(e)}function c(){u.balanceSheet=new i,u.save()}var s=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z/,u={balanceSheet:void 0,save:t,loadFromJson:a,exportToJson:o,createNew:c,init:n};return u}a.$inject=["localStorageService"];var r=t(14),i=t(40);r.module("debtApp").factory("balanceSheetService",a)},function(e,n,t){"use strict";function a(e,n,t,a,r){function i(){o(),a.$on(t.BALANCE_SHEET_UPDATED,u.refresh)}function o(){u.balanceSheet=e.balanceSheet;try{u.debtsByDebtor=c(),u.debtComputationError=void 0}catch(e){r.error(e),u.debtsByDebtor=void 0,u.debtComputationError="Cannot compute debts"}}function c(){if(u.balanceSheet.isBalanced()){var e=u.balanceSheet.getNonSettledParticipations(),t=n.computeDebts(e,u.balanceSheet.currency);return n.organizeByDebtor(t)}}function s(){a.$emit(t.BALANCE_SHEET_UPDATED)}var u=this;u.init=i,u.refresh=o,u.updateSheet=s,i()}a.$inject=["balanceSheetService","debtService","events","$scope","$log"];var r=t(14);r.module("debtApp").controller("BalanceSheetCtrl",a)},function(e,n,t){"use strict";t(45),t(48),t(49)},function(e,n,t){"use strict";function a(e){e.state("person",{url:"/persons/:id",views:{"":{templateUrl:i,controller:"PersonDetailCtrl as vm"},floatingButton:{templateUrl:o}}})}a.$inject=["$stateProvider"];var r=t(14),i=t(46),o=t(47);r.module("debtApp").config(a)},function(e,n){var t="persons/person-detail.html",a='<section> <div layout=row layout-align="start start"> <md-input-container class=md-title flex md-no-float> <input type=text placeholder="Person name" ng-model=::vm.person.name ng-change=::vm.updatePerson() ng-required=true /> </md-input-container> <md-button class=md-icon-button aria-label=delete ng-click=vm.removePerson()> <md-tooltip>Delete</md-tooltip> <md-icon md-svg-icon=ic_delete_24px></md-icon> </md-button> </div> <div layout=column> <div layout=row layout-align="start center"> <span flex id=balance>Balance</span> <span aria-labelledby=balance class=margin-right> <span ng-if=::vm.balanceSheet.currenciesEnabled()>{{::vm.person.computedCurrency()}}</span> {{vm.balance | balance}} </span> </div> </div> </section> <section> <md-subheader class="md-primary section-header md-no-sticky">Expenses</md-subheader> <div layout=column> <div ng-repeat="expense in vm.balanceSheet.expenses" class=participation layout-xs=column layout-align-xs="center start" layout-gt-xs=row layout-align-gt-xs="start center"> <div layout-fill class=participant flex-gt-xs layout=row layout-align="start center"> <md-checkbox class=md-primary ng-class="{\'md-warn\': !expense.isBalanced()}" ng-model=::vm.isParticipant[expense.id] ng-change="::vm.setParticipation(expense, vm.isParticipant[expense.id])" ng-disabled=::expense.settled> <span ng-class="::{settled: expense.settled}">{{::expense.name}}</span> </md-checkbox> <span flex></span> <md-button hide-gt-xs ng-href=#/expenses/{{::expense.id}} class=md-icon-button aria-label="{{::expense.name}} details"> <md-icon md-svg-icon=ic_chevron_right_24px></md-icon> </md-button> </div> <div layout=row layout-align="start center"> <span class=currency-label ng-if=::vm.balanceSheet.currenciesEnabled()>{{::expense.computedCurrency()}}</span> <md-input-container> <label>Paid</label> <input type=number money-input ng-required=::vm.isParticipant[expense.id] ng-model="::vm.balanceSheet.getParticipation({person: vm.person, expense: expense}).paid" ng-change=::vm.updateExpense(expense) ng-disabled="expense.settled || !vm.isParticipant[expense.id]"/> </md-input-container> <md-input-container> <label>Share</label> <input type=number money-input ng-required=::vm.isParticipant[expense.id] ng-model="::vm.balanceSheet.getParticipation({person: vm.person, expense: expense}).share" ng-change=::vm.updateExpense(expense) ng-disabled="expense.settled || !vm.isParticipant[expense.id]" ng-readonly="::expense.sharing != \'custom\'"/> </md-input-container> </div> <md-button hide-xs ng-href=#/expenses/{{::expense.id}} class=md-icon-button aria-label="{{::expense.name}} details"> <md-icon md-svg-icon=ic_chevron_right_24px></md-icon> </md-button> </div> <div class=participation layout-xs=column layout-align-xs="center start" layout-gt-xs=row layout-align-gt-xs="start center"> <div layout-fill flex-gt-xs layout=row layout-align="start center"> <span class=label>Total</span> <icon-button-strut hide-gt-xs></icon-button-strut> </div> <div layout=row layout-align="start center"> <span class=currency-label ng-if=::vm.balanceSheet.currenciesEnabled()>{{::vm.person.computedCurrency()}}</span> <md-input-container> <label>Paid</label> <input type=number money-input ng-model=::vm.cost ng-readonly=true /> </md-input-container> <md-input-container> <label>Share</label> <input type=number money-input ng-model=::vm.sumOfShares ng-readonly=true /> </md-input-container> </div> <icon-button-strut hide-xs></icon-button-strut> </div> </div> </section> <section> <md-subheader class="md-primary section-header md-no-sticky">Debts</md-subheader> <div layout=column> <div ng-switch=vm.debtRole class=margin-bottom> <span ng-switch-when=debtor>{{vm.person.name}} owes</span> <span ng-switch-when=creditor>{{vm.person.name}} is owed by</span> <span ng-switch-when=settled>{{vm.person.name}} is settled up</span> <span ng-switch-when=unbalanced>Debts cannot be computed. There are unbalanced expenses.</span> </div> <div ng-repeat="d in vm.debts" class="margin-bottom margin-left-double"> <span>{{d.person.name}}: {{d.currency}} {{d.amount | money}}</span> </div> <div ng-if=vm.debtComputationError class=margin-bottom> <md-icon class=md-warn md-svg-icon=ic_warning_24px></md-icon> {{vm.debtComputationError}} </div> </div> </section>';window.angular.module("ng").run(["$templateCache",function(e){e.put(t,a)}]),e.exports=t},function(e,n){var t="persons/floating-button.html",a='<md-fab-speed-dial class=md-fab-bottom-right> <md-fab-trigger> <md-button ng-click=::vm.createExpense() aria-label="Create expense" class="md-fab md-primary"> <md-icon md-svg-icon=ic_shopping_basket_24px></md-icon> </md-button> </md-fab-trigger> </md-fab-speed-dial>';window.angular.module("ng").run(["$templateCache",function(e){e.put(t,a)}]),e.exports=t},function(e,n,t){"use strict";function a(e,n,t,a,r,o,c,s,u,l,d){function p(){E.balanceSheet=e.balanceSheet,E.person=E.balanceSheet.getPerson(c.id),m(),S=s.confirm().content("Really delete this person?").ok("Ok").cancel("Cancel"),u.$on(t.BALANCE_SHEET_UPDATED,E.refresh)}function m(){E.isParticipant=g(),E.cost=E.person.getCost(),E.sumOfShares=E.person.getSumOfShares(),E.balance=E.person.getBalance(),M()}function g(){var e={};return i.forEach(E.balanceSheet.expenses,function(n){e[n.id]=!1,i.forEach(E.person.getParticipations(),function(t){t.expense.equals(n)&&(e[n.id]=!0)})}),e}function f(e){e.shareCost(),m(),u.$emit(t.BALANCE_SHEET_UPDATED)}function v(e,n){n?E.balanceSheet.createParticipation({expense:e,person:E.person}):E.balanceSheet.removeParticipation({expense:e,person:E.person}),E.updateExpense(e)}function b(){var e={role:void 0,debts:void 0};if(!E.balanceSheet.isBalanced())return e.role="unbalanced",e;if(E.balance>0)e.role="debtor";else if(E.balance<0)e.role="creditor";else if(0===E.balance)return e.role="settled",e;var t={
debtor:"creditor",creditor:"debtor"},a=n.computeDebts(E.balanceSheet.getNonSettledParticipations(),E.person.computedCurrency());return e.debts=i.chain(a).filter(function(n){return n[e.role].equals(E.person)}).map(function(n){return{person:n[t[e.role]],amount:n.amount,currency:n.currency}}).value(),e}function h(){s.show(S).then(x)}function x(){E.balanceSheet.removePerson(E.person),u.$emit(t.BALANCE_SHEET_UPDATED),o.go("balanceSheet")}function y(){u.$emit(t.BALANCE_SHEET_UPDATED)}var S,E=this,M=a(function(){l(function(){try{var e=b();E.debtRole=e.role,E.debts=e.debts,E.debtComputationError=void 0}catch(e){d.error(e),E.debtRole=void 0,E.debts=void 0,E.debtComputationError="Cannot compute debts"}})},r);E.init=p,E.refresh=m,E.updateExpense=f,E.setParticipation=v,E.removePerson=h,E.updatePerson=y,p()}a.$inject=["balanceSheetService","debtService","events","debounce","debtCalculationInterval","$state","$stateParams","$mdDialog","$scope","$timeout","$log"];var r=t(14),i=t(25);r.module("debtApp").controller("PersonDetailCtrl",a)},function(e,n,t){"use strict";function a(e){function n(){return e.show({templateUrl:o,controller:r,controllerAs:"vm"})}return n}function r(e){function n(){r.person={name:void 0},r.options={createParticipations:!0}}function t(){e.hide({person:r.person,options:r.options})}function a(){e.cancel()}var r=this;r.ok=t,r.cancel=a,r.init=n,n()}a.$inject=["$mdDialog"],r.$inject=["$mdDialog"];var i=t(14),o=t(50);i.module("debtApp").factory("openCreatePersonDialog",a)},function(e,n){var t="persons/create-person-dialog.html",a='<md-dialog aria-label="Create person dialog"> <form name=form novalidate autocomplete=off> <md-dialog-content class=md-dialog-content> <h2 class=md-title>Create person</h2> <div layout=column> <md-input-container> <label>Name</label> <input type=text ng-model=vm.person.name ng-required=true md-autofocus/> </md-input-container> <md-checkbox ng-model=vm.options.createParticipations class=md-primary> Shares all expenses </md-checkbox> </div> </md-dialog-content> <md-dialog-actions> <md-button type=button ng-click=vm.cancel()>Cancel</md-button> <md-button type=submit class=md-primary ng-click=vm.ok() ng-disabled=!form.$valid>Ok</md-button> </md-dialog-actions> </form> </md-dialog> ';window.angular.module("ng").run(["$templateCache",function(e){e.put(t,a)}]),e.exports=t},function(e,n,t){"use strict";t(52),t(55),t(56)},function(e,n,t){"use strict";function a(e){e.state("expense",{url:"/expenses/:id",views:{"":{templateUrl:i,controller:"ExpenseDetailCtrl as vm"},floatingButton:{templateUrl:o}}})}a.$inject=["$stateProvider"];var r=t(14),i=t(53),o=t(54);r.module("debtApp").config(a)},function(e,n){var t="expenses/expense-detail.html",a='<section layout=column> <div layout=row layout-align="start start"> <md-input-container class=md-title flex md-no-float> <input type=text placeholder="Expense name" ng-model=::vm.expense.name ng-change=::vm.updateExpense() ng-required=true /> </md-input-container> <md-button class=md-icon-button aria-label=delete ng-click=::vm.removeExpense()> <md-tooltip>Delete</md-tooltip> <md-icon md-svg-icon=ic_delete_24px></md-icon> </md-button> </div> <div layout=column> <div class=row layout=row layout-align="start center"> <span flex aria-hidden=true>Date</span> <md-datepicker class=no-icon md-placeholder=Date ng-model=::vm.expense.date ng-change=::vm.updateExpense()></md-datepicker> </div> <div ng-if=::vm.balanceSheet.currenciesEnabled() class=row layout=row layout-align="start center"> <span flex aria-hidden=true>Currency</span> <md-select id=currency aria-label=Currency class="no-margin margin-right" ng-model=vm.expense.currency ng-change=::vm.updateExpense()> <md-option ng-value=::currency ng-repeat="currency in ::vm.balanceSheet.getCurrencies()">{{::currency}}</md-option> </md-select> </div> <div class=row layout=row layout-align="start center"> <span flex id=cost>Cost</span> <div aria-labelledby=cost class=margin-right> <span ng-if=::vm.balanceSheet.currenciesEnabled()>{{vm.expense.currency}}</span> {{vm.cost | money}} <span ng-if="vm.balanceSheet.currenciesEnabled() && vm.balanceSheet.currency !== vm.expense.computedCurrency()"> ({{vm.balanceSheet.currency}} {{vm.expense.getCost(vm.balanceSheet.currency) | money}}) </span> </div> </div> <div class=row layout=row layout-align="start center"> <span flex aria-hidden=true>Share equally</span> <md-switch ng-model=vm.expense.sharing ng-change=::vm.updateExpense() ng-disabled=vm.expense.settled ng-true-value="\'equal\'" ng-false-value="\'custom\'" id=sharing class="md-primary no-margin" aria-label="Share equally"> </md-switch> </div> <div class=row layout=row layout-align="start center"> <span flex aria-hidden=true>Settled</span> <md-switch ng-model=vm.expense.settled ng-change=::vm.updateExpense() id=settled class="md-primary no-margin" aria-label=Settled> </md-switch> </div> </div> </section> <section> <md-subheader class="md-primary section-header md-no-sticky">People</md-subheader> <div layout=column> <div ng-repeat="person in vm.balanceSheet.persons" class=participation layout-xs=column layout-align-xs="center start" layout-gt-xs=row layout-align-gt-xs="start center"> <div layout-fill flex-gt-xs class=participant layout=row layout-align="start center"> <md-checkbox class=md-primary ng-model=::vm.isParticipant[person.id] ng-change="::vm.setParticipation(person, vm.isParticipant[person.id])" ng-disabled=vm.expense.settled> {{::person.name}} </md-checkbox> <span flex></span> <md-button hide-gt-xs ng-href=#/persons/{{::person.id}} class=md-icon-button aria-label="{{::person.name}} details"> <md-icon md-svg-icon=ic_chevron_right_24px></md-icon> </md-button> </div> <div layout=row layout-align="start center"> <span class=currency-label ng-if=::vm.balanceSheet.currenciesEnabled()>{{vm.expense.currency}}</span> <md-input-container> <label>Paid</label> <input type=number money-input ng-required=::vm.isParticipant[person.id] ng-model="::vm.balanceSheet.getParticipation({person: person, expense: vm.expense}).paid" ng-change=::vm.updateExpense() ng-disabled="vm.expense.settled || !vm.isParticipant[person.id]"/> </md-input-container> <md-input-container> <label>Share</label> <input type=number money-input ng-required=::vm.isParticipant[person.id] ng-model="::vm.balanceSheet.getParticipation({person: person, expense: vm.expense}).share" ng-change=::vm.updateExpense() ng-disabled="vm.expense.settled || !vm.isParticipant[person.id]" ng-readonly="vm.expense.sharing != \'custom\'"/> </md-input-container> </div> <md-button hide-xs ng-href=#/persons/{{::person.id}} class=md-icon-button aria-label="{{::person.name}} details"> <md-icon md-svg-icon=ic_chevron_right_24px></md-icon> </md-button> </div> <div class=participation layout-xs=column layout-align-xs="center start" layout-gt-xs=row layout-align-gt-xs="start center"> <div layout-fill flex-gt-xs layout=row layout-align="start center"> <span ng-if=!vm.isBalanced style=color:red> <md-icon class="md-warn no-margin-left" md-svg-icon=ic_warning_24px></md-icon>&nbsp;Unbalanced </span> <span ng-if=vm.isBalanced class=label>Total</span> <icon-button-strut hide-gt-xs></icon-button-strut> </div> <div layout=row layout-align="start center"> <span class=currency-label ng-if=::vm.balanceSheet.currenciesEnabled()>{{vm.expense.currency}}</span> <md-input-container> <label>Paid</label> <input type=number money-input ng-model=::vm.cost ng-readonly=true /> </md-input-container> <md-input-container> <label>Share</label> <input type=number money-input ng-model=::vm.sumOfShares ng-readonly=true /> </md-input-container> </div> <icon-button-strut hide-xs></icon-button-strut> </div> </div> </section> <section> <md-subheader class="md-primary section-header md-no-sticky">Debts</md-subheader> <div layout=column> <div ng-if="vm.debtsByDebtor.length > 0"> <p ng-if=!vm.expense.settled>To settle this expense individually:</p> <div ng-if=vm.expense.settled> <p>This expense is settled. It does not affect total balances and debts.</p> <p>The debts from this expense were:</p> </div> <div ng-repeat="d in vm.debtsByDebtor"> <p layout=column> <span class=margin-bottom>{{d.debtor.name}} owes </span> <span ng-repeat="c in d.debts" class="margin-bottom margin-left-double"> {{c.creditor.name}}: <span ng-if=::vm.balanceSheet.currenciesEnabled()>{{c.currency}}</span> {{c.amount | money}} </span> </p> </div> </div> <div ng-if="vm.debtsByDebtor.length == 0"> <p>No debts!</p> </div> <div ng-if=!vm.isBalanced> <p>Cannot compute debts. Expense is not balanced.</p> </div> </div> </section>';window.angular.module("ng").run(["$templateCache",function(e){e.put(t,a)}]),e.exports=t},function(e,n){var t="expenses/floating-button.html",a='<md-fab-speed-dial class=md-fab-bottom-right> <md-fab-trigger> <md-button ng-click=::vm.createPerson() aria-label="Create person" class="md-fab md-primary"> <md-icon md-svg-icon=ic_face_24px></md-icon> </md-button> </md-fab-trigger> </md-fab-speed-dial>';window.angular.module("ng").run(["$templateCache",function(e){e.put(t,a)}]),e.exports=t},function(e,n,t){"use strict";function a(e,n,t,a,i,o,c,s,u,l){function d(){x.balanceSheet=e.balanceSheet,x.expense=x.balanceSheet.getExpense(c.id),x.isParticipant={},x.everyoneParticipates=!0,p(),u.$on(t.BALANCE_SHEET_UPDATED,function(e){e.targetScope!=u&&x.updateExpense()})}function p(){x.expense.shareCost(),x.isParticipant=m(),x.cost=x.expense.getCost(),x.sumOfShares=x.expense.getSumOfShares(),x.isBalanced=x.expense.isBalanced(),u.$emit(t.BALANCE_SHEET_UPDATED),S()}function m(){var e={};return r.forEach(x.balanceSheet.persons,function(n){e[n.id]=!1,r.forEach(x.expense.getParticipations(),function(t){t.person.equals(n)&&(e[n.id]=!0)})}),e}function g(e,n){n?x.balanceSheet.createParticipation({expense:x.expense,person:e}):x.balanceSheet.removeParticipation({expense:x.expense,person:e}),p()}function f(){o.show(y).then(v)}function v(){x.balanceSheet.removeExpense(x.expense),u.$emit(t.BALANCE_SHEET_UPDATED),s.go("balanceSheet")}function b(){if(x.expense.isBalanced()){var e=n.computeDebts(x.expense.getParticipations(),x.expense.computedCurrency());return n.organizeByDebtor(e)}}function h(e){x.expense.currency=e,u.$emit(t.BALANCE_SHEET_UPDATED)}var x=this,y=o.confirm().content("Really delete this expense?").ok("Ok").cancel("Cancel"),S=a(function(){l(function(){x.debtsByDebtor=b()})},i);x.init=d,x.setParticipation=g,x.updateExpense=p,x.removeExpense=f,x.setCurrency=h,d()}a.$inject=["balanceSheetService","debtService","events","debounce","debtCalculationInterval","$mdDialog","$stateParams","$state","$scope","$timeout"];var r=t(14);r.module("debtApp").controller("ExpenseDetailCtrl",a)},function(e,n,t){"use strict";function a(e){function n(){return e.show({templateUrl:o,controller:r,controllerAs:"vm"})}return n}function r(e){function n(){r.expense={name:void 0,sharing:"equal"},r.options={createParticipations:!0}}function t(){e.hide({expense:r.expense,options:r.options})}function a(){e.cancel()}var r=this;r.ok=t,r.cancel=a,r.init=n,n()}a.$inject=["$mdDialog"],r.$inject=["$mdDialog"];var i=t(14),o=t(57);i.module("debtApp").factory("openCreateExpenseDialog",a)},function(e,n){var t="expenses/create-expense-dialog.html",a='<md-dialog aria-label="Create expense dialog"> <form name=form novalidate autocomplete=off> <md-dialog-content class=md-dialog-content> <h2 class=md-title>Create expense</h2> <div layout=column> <md-input-container> <label>Name</label> <input type=text ng-model=vm.expense.name ng-required=true md-autofocus/> </md-input-container> <md-checkbox ng-model=vm.options.createParticipations class=md-primary> Everyone participates </md-checkbox> </div> </md-dialog-content> <md-dialog-actions> <md-button type=button ng-click=vm.cancel()>Cancel</md-button> <md-button type=submit class=md-primary ng-click=vm.ok() ng-disabled=!form.$valid>Ok</md-button> </md-dialog-actions> </form> </md-dialog> ';window.angular.module("ng").run(["$templateCache",function(e){e.put(t,a)}]),e.exports=t},function(e,n,t){"use strict";t(59),t(60),t(61),t(62),t(67),t(68)},function(e,n,t){"use strict";function a(e){function n(e,n,i,o){function c(){o.$valid?n.val(a(o.$modelValue)):n.val(o.$viewValue)}function s(){o.$render()}o.$validators.money=t,o.$parsers.push(r),o.$formatters.unshift(a),n.on("blur",s),o.$render=c}function t(e){return!(e<0)}function a(n){return void 0===n||null===n?"":e("number")(n,2)}function r(e){return new i(e).toNumber()}return{restrict:"A",require:"ngModel",link:n}}a.$inject=["$filter"];var r=t(14),i=t(33);r.module("debtApp").directive("moneyInput",a)},function(e,n,t){"use strict";function a(e){return function(n){return!i.isNumber(n)||isNaN(n)?n:n>0?"+"+e("number")(n,"2"):e("number")(n,"2")}}a.$inject=["$filter"];var r=t(14),i=t(25);r.module("debtApp").filter("balance",a)},function(e,n,t){"use strict";function a(e){return function(n){return!i.isNumber(n)||isNaN(n)?n:e("number")(n,"2")}}a.$inject=["$filter"];var r=t(14),i=t(25);r.module("debtApp").filter("money",a)},function(e,n,t){"use strict";function a(e,n){function t(t){var a=e.defer(),r=new n.FileReader;return r.onload=function(){a.resolve(r.result)},r.onerror=function(){a.resolve(r.error)},r.readAsText(t),a.promise}function a(e,t){var a=new n.Blob(e,{});i.saveAs(a,t)}function r(){return n.FileReader&&n.Blob}return{readAsText:t,saveAsFile:a,isSupported:r}}a.$inject=["$q","$window"];var r=t(14),i=t(63);t(66),r.module("debtApp").factory("fileService",a)},,,,,function(e,n,t){"use strict";function a(e){return{restrict:"A",link:function(n,t,a){var r=a.focus||"true";e(function(){var e=n.$eval(r);e&&t[0].focus()},0)}}}a.$inject=["$timeout"];var r=t(14);r.module("debtApp").directive("focus",a)},function(e,n,t){"use strict";function a(e){function n(n,t,a,r){var i;return function(){var o=a,c=Array.prototype.slice.call(arguments);e.cancel(i),i=e(function(){i=void 0,n.apply(o,c)},t||10,r)}}return n}a.$inject=["$timeout"];var r=t(14);r.module("debtApp").factory("debounce",a)},function(e,n,t){"use strict";t(70),t(73)},function(e,n,t){"use strict";function a(e){e.state("currencies",{url:"/currencies",views:{"":{controller:"CurrencyListCtrl as vm",templateUrl:i},floatingButton:{controller:"CurrencyListCtrl as vm",templateUrl:o}}})}a.$inject=["$stateProvider"];var r=t(14),i=t(71),o=t(72);r.module("debtApp").config(a)},function(e,n){var t="currencies/currencies.html",a='<section> <div ng-repeat="quotation in vm.exchangeRates" class=exchange-rate layout=row layout-align="start center"> <span flex-xs=66 flex=33>{{::quotation.fixed}} to {{::quotation.variable}}</span> <md-input-container md-no-float> <input type=number placeholder=Rate ng-model=::quotation.rate ng-change=::vm.updateExchangeRate(quotation) required min=0.0001 /> </md-input-container> <span flex></span> <md-button class=md-icon-button ng-click=::vm.removeExchangeRate(quotation)> <md-icon aria-label=Remove md-svg-icon=ic_delete_24px></md-icon> </md-button> </div> <p ng-if="!vm.exchangeRates || vm.exchangeRates.length == 0"> Enable currencies by adding an exchange rate. Click the floating button below. </p> </section> ';window.angular.module("ng").run(["$templateCache",function(e){e.put(t,a)}]),e.exports=t},function(e,n){var t="currencies/floating-button.html",a='<md-fab-speed-dial class=md-fab-bottom-right> <md-fab-trigger> <md-button ng-click=::vm.openExchangeRateDialog() aria-label="Add exchange rate" class="md-fab md-primary"> <md-icon md-svg-icon=ic_attach_money_24px></md-icon> </md-button> </md-fab-trigger> </md-fab-speed-dial>';window.angular.module("ng").run(["$templateCache",function(e){e.put(t,a)}]),e.exports=t},function(e,n,t){"use strict";function a(e,n,t,a,r,i){function c(){p.balanceSheet=e.balanceSheet,s(),t.$watch(function(){return e.balanceSheet.getExchangeRates()},r(s,50),!0)}function s(){p.exchangeRates=e.balanceSheet.getExchangeRates()}function u(){return a.show({templateUrl:"currencies/exchange-rate-dialog.html",controller:"ExchangeRateDialogCtrl as vm"}).then(function(e){l(e)})}function l(a){try{e.balanceSheet.addOrUpdateExchangeRate(a),t.$emit(n.BALANCE_SHEET_UPDATED),s()}catch(e){i.error(e)}}function d(a){e.balanceSheet.removeExchangeRate(a),o.remove(p.exchangeRates,a),t.$emit(n.BALANCE_SHEET_UPDATED),s()}var p=this;p.init=c,p.openExchangeRateDialog=u,p.updateExchangeRate=l,p.removeExchangeRate=d,c()}function r(e){function n(){r.quotation={}}function t(){e.hide(r.quotation)}function a(){e.cancel()}var r=this;r.ok=t,r.cancel=a,r.init=n,n()}a.$inject=["balanceSheetService","events","$scope","$mdDialog","debounce","$log"],r.$inject=["$mdDialog"];var i=t(14),o=t(25);i.module("debtApp").controller("CurrencyListCtrl",a).controller("ExchangeRateDialogCtrl",r)},function(e,n,t){function a(e){return t(r(e))}function r(e){return i[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var i={"./ic_add_24px.svg":75,"./ic_attach_money_24px.svg":76,"./ic_chevron_right_24px.svg":77,"./ic_close_24px.svg":78,"./ic_delete_24px.svg":79,"./ic_face_24px.svg":80,"./ic_home_24px.svg":81,"./ic_more_vert_24px.svg":82,"./ic_shopping_basket_24px.svg":83,"./ic_warning_24px.svg":84};a.keys=function(){return Object.keys(i)},a.resolve=r,e.exports=a,a.id=74},function(e,n){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTkgMTNoLTZ2NmgtMnYtNkg1di0yaDZWNWgydjZoNnYyeiIvPjwvc3ZnPg=="},function(e,n){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTEuOCAxMC45Yy0yLjI3LS41OS0zLTEuMi0zLTIuMTUgMC0xLjA5IDEuMDEtMS44NSAyLjctMS44NSAxLjc4IDAgMi40NC44NSAyLjUgMi4xaDIuMjFjLS4wNy0xLjcyLTEuMTItMy4zLTMuMjEtMy44MVYzaC0zdjIuMTZjLTEuOTQuNDItMy41IDEuNjgtMy41IDMuNjEgMCAyLjMxIDEuOTEgMy40NiA0LjcgNC4xMyAyLjUuNiAzIDEuNDggMyAyLjQxIDAgLjY5LS40OSAxLjc5LTIuNyAxLjc5LTIuMDYgMC0yLjg3LS45Mi0yLjk4LTIuMWgtMi4yYy4xMiAyLjE5IDEuNzYgMy40MiAzLjY4IDMuODNWMjFoM3YtMi4xNWMxLjk1LS4zNyAzLjUtMS41IDMuNS0zLjU1IDAtMi44NC0yLjQzLTMuODEtNC43LTQuNHoiLz48L3N2Zz4="},function(e,n){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTAgNkw4LjU5IDcuNDEgMTMuMTcgMTJsLTQuNTggNC41OUwxMCAxOGw2LTZ6Ii8+PC9zdmc+"},function(e,n){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjwvc3ZnPg=="},function(e,n){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNNiAxOWMwIDEuMS45IDIgMiAyaDhjMS4xIDAgMi0uOSAyLTJWN0g2djEyek0xOSA0aC0zLjVsLTEtMWgtNWwtMSAxSDV2MmgxNFY0eiIvPjwvc3ZnPg=="},function(e,n){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNOSAxMS43NWMtLjY5IDAtMS4yNS41Ni0xLjI1IDEuMjVzLjU2IDEuMjUgMS4yNSAxLjI1IDEuMjUtLjU2IDEuMjUtMS4yNS0uNTYtMS4yNS0xLjI1LTEuMjV6bTYgMGMtLjY5IDAtMS4yNS41Ni0xLjI1IDEuMjVzLjU2IDEuMjUgMS4yNSAxLjI1IDEuMjUtLjU2IDEuMjUtMS4yNS0uNTYtMS4yNS0xLjI1LTEuMjV6TTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgMThjLTQuNDEgMC04LTMuNTktOC04IDAtLjI5LjAyLS41OC4wNS0uODYgMi4zNi0xLjA1IDQuMjMtMi45OCA1LjIxLTUuMzdDMTEuMDcgOC4zMyAxNC4wNSAxMCAxNy40MiAxMGMuNzggMCAxLjUzLS4wOSAyLjI1LS4yNi4yMS43MS4zMyAxLjQ3LjMzIDIuMjYgMCA0LjQxLTMuNTkgOC04IDh6Ii8+PC9zdmc+"},function(e,n){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTAgMjB2LTZoNHY2aDV2LThoM0wxMiAzIDIgMTJoM3Y4eiIvPjwvc3ZnPg=="},function(e,n){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTIgOGMxLjEgMCAyLS45IDItMnMtLjktMi0yLTItMiAuOS0yIDIgLjkgMiAyIDJ6bTAgMmMtMS4xIDAtMiAuOS0yIDJzLjkgMiAyIDIgMi0uOSAyLTItLjktMi0yLTJ6bTAgNmMtMS4xIDAtMiAuOS0yIDJzLjkgMiAyIDIgMi0uOSAyLTItLjktMi0yLTJ6Ii8+PC9zdmc+"},function(e,n){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTcuMjEgOWwtNC4zOC02LjU2Yy0uMTktLjI4LS41MS0uNDItLjgzLS40Mi0uMzIgMC0uNjQuMTQtLjgzLjQzTDYuNzkgOUgyYy0uNTUgMC0xIC40NS0xIDEgMCAuMDkuMDEuMTguMDQuMjdsMi41NCA5LjI3Yy4yMy44NCAxIDEuNDYgMS45MiAxLjQ2aDEzYy45MiAwIDEuNjktLjYyIDEuOTMtMS40NmwyLjU0LTkuMjdMMjMgMTBjMC0uNTUtLjQ1LTEtMS0xaC00Ljc5ek05IDlsMy00LjRMMTUgOUg5em0zIDhjLTEuMSAwLTItLjktMi0ycy45LTIgMi0yIDIgLjkgMiAyLS45IDItMiAyeiIvPjwvc3ZnPg=="},function(e,n){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMSAyMWgyMkwxMiAyIDEgMjF6bTEyLTNoLTJ2LTJoMnYyem0wLTRoLTJ2LTRoMnY0eiIvPjwvc3ZnPg=="}]);
//# sourceMappingURL=debt.cd037e84f17fb3115b88.js.map