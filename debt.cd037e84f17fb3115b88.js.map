{"version":3,"sources":["webpack:///debt.cd037e84f17fb3115b88.js","webpack:///./src/app/debt.js","webpack:///./src/app/appcache-reload.js","webpack:///./src/app/debt-app-ctrl.js","webpack:///./src/app/route-config.js","webpack:///./src/app/debts/index.js","webpack:///./src/app/debts/lin-eq-solver.js","webpack:///./src/app/debts/lin-eq-solver-factory.js","webpack:///./src/app/debts/debt-solver.js","webpack:///./src/app/debts/debt-service.js","webpack:///./src/app/balance-sheet/index.js","webpack:///./src/app/balance-sheet/route-config.js","webpack:///./src/app/balance-sheet/balance-sheet.html","webpack:///./src/app/balance-sheet/floating-button.html","webpack:///./src/app/balance-sheet/balance-sheet.js","webpack:///./src/app/balance-sheet/currency-conversion-error.js","webpack:///./src/app/balance-sheet/balance-sheet-service.js","webpack:///./src/app/balance-sheet/balance-sheet-ctrl.js","webpack:///./src/app/persons/index.js","webpack:///./src/app/persons/route-config.js","webpack:///./src/app/persons/person-detail.html","webpack:///./src/app/persons/floating-button.html","webpack:///./src/app/persons/person-detail-ctrl.js","webpack:///./src/app/persons/create-person-dialog.js","webpack:///./src/app/persons/create-person-dialog.html","webpack:///./src/app/expenses/index.js","webpack:///./src/app/expenses/route-config.js","webpack:///./src/app/expenses/expense-detail.html","webpack:///./src/app/expenses/floating-button.html","webpack:///./src/app/expenses/expense-detail-ctrl.js","webpack:///./src/app/expenses/create-expense-dialog.js","webpack:///./src/app/expenses/create-expense-dialog.html","webpack:///./src/app/utils/index.js","webpack:///./src/app/utils/money-input-directive.js","webpack:///./src/app/utils/balance-filter.js","webpack:///./src/app/utils/money-filter.js","webpack:///./src/app/utils/file-service.js","webpack:///./src/app/utils/focus-directive.js","webpack:///./src/app/utils/debounce.js","webpack:///./src/app/currencies/index.js","webpack:///./src/app/currencies/route-config.js","webpack:///./src/app/currencies/currencies.html","webpack:///./src/app/currencies/floating-button.html","webpack:///./src/app/currencies/currency-list-ctrl.js","webpack:///./src/resources/icons ^\\.\\/.*$","webpack:///./src/resources/icons/ic_add_24px.svg","webpack:///./src/resources/icons/ic_attach_money_24px.svg","webpack:///./src/resources/icons/ic_chevron_right_24px.svg","webpack:///./src/resources/icons/ic_close_24px.svg","webpack:///./src/resources/icons/ic_delete_24px.svg","webpack:///./src/resources/icons/ic_face_24px.svg","webpack:///./src/resources/icons/ic_home_24px.svg","webpack:///./src/resources/icons/ic_more_vert_24px.svg","webpack:///./src/resources/icons/ic_shopping_basket_24px.svg","webpack:///./src/resources/icons/ic_warning_24px.svg"],"names":["webpackJsonp","module","exports","__webpack_require__","configureIcons","$mdIconProvider","iconFiles","iconProps","_","map","fileName","iconName","substr","indexOf","filePath","each","prop","icon","configureLocalStorage","localStorageServiceProvider","setPrefix","hrefSanitization","$compileProvider","aHrefSanitizationWhitelist","decorateExceptionHandler","$provide","events","decorator","$delegate","$log","$injector","exception","cause","$rootScope","get","$broadcast","ERROR","CurrencyConversionError","$state","go","makeStateAvailableInScope","$stateParams","makeMdMediaAvailableInScope","$mdMedia","$inject","angular","constant","BALANCE_SHEET_UPDATED","config","run","window","addEventListener","applicationCache","location","reload","DebtAppCtrl","balanceSheetService","debounce","balanceSheetSaveInterval","openCreatePersonDialog","openCreateExpenseDialog","fileService","$mdDialog","$scope","init","$on","vm","balanceSheetUpdated","handleErrorEvent","balanceSheet","findExpensesWithInvalidCurrencies","errorMessage","undefined","tryToSave","save","e","error","message","nonConvertible","getNonConvertibleCurrencies","getExpenseCurrencies","currency","length","messageTemplate","template","data","currencyWord","currencyList","balanceSheetCurrency","c","index","event","createPerson","then","dialogResult","person","options","createExpense","expense","createNewSheet","show","confirmCreateNewSheet","createNew","loadSheet","files","isSupported","file","readAsText","result","loadSheetFromJson","catch","json","loadFromJson","exportSheet","exportToJson","saveAsFile","name","showHelp","templateUrl","controller","close","hide","this","confirm","title","content","ok","cancel","$urlRouterProvider","otherwise","solve","input","validate","A","b","TypeError","RangeError","initialize","coefMatrix","copyMatrix","constVector","copyArray","m","n","pivotToEquationMap","i","equationScale","j","abscoef","Math","abs","pivotToVariableMap","transformToRowEchelonForm","pivotIdx","knownFreeVariables","maxRatio","bestPivotEquationIndex","rowIdx","colIdx","ratio","currPivotVaribleIdx","newPivotVariableIdx","temp","pivotRowIdx","pivotColIdx","mult","colIndex","reduceRowEchelonForm","pivotIndex","min","div","determineRank","rank","columns","determineNumberOfSolutions","b2IsZero","numberOfSolutions","Number","MAX_VALUE","determineSolution","xVector","initArray","numberOfEquations","numberOfVariables","numberOfFreeVariables","size","array","slice","copy","solveLinearSystem","factory","debtSolverFactory","participations","balances","computeBalances","isEveryoneBalanced","isSystemBalanced","Error","roles","getDebtorsAndCreditors","linearSystem","createDebtEquations","debtVector","solveDebts","createDebts","forEach","p","id","balance","Decimal","paid","share","add","subtract","toNumber","every","reduce","sum","debtors","creditors","push","d","debtor","multiply","creditor","initMatrix","rows","cols","solution","numVars","numFreeVars","randomEngine","Random","engines","mt19937","seed","toEliminate","candidates","candidateIdx","integer","splice","isNonNegative","vector","debts","debtorIdx","floor","creditorIdx","amount","divideBy","debt","debtService","computeDebts","getPaid","strictConversion","getShare","extend","organizeByDebtor","debtorList","debtorIndices","debtorIndex","omit","sort","d1","d2","localeCompare","$stateProvider","state","url","views","","balanceSheetTpl","floatingButton","floatingButtonTpl","path","html","put","BalanceSheet","getNonSettledParticipations","filter","pt","settled","isBalanced","expenses","getPerson","persons","find","idSequence","Person","createParticipations","createParticipation","shareCost","removePerson","toRemove","remove","equals","getParticipations","removeParticipation","getExpense","sharing","Expense","removeExpense","getParticipation","criteria","toSeek","Participation","participation","currenciesEnabled","exchangeRates","getExchangeRates","cloneDeep","getCurrencies","chain","getExchangeRateCurrencies","concat","_this","uniq","value","er","fixed","variable","computedCurrency","addOrUpdateExchangeRate","quotation","validateQuotation","existing","pick","updateBalanceSheetCurrencyIfNeeded","isString","trim","isNumber","rate","cleanUpCurrency","cleanUpCurrencyPair","currencyPair","clone","removeExchangeRate","updateExpenseCurrenciesIfNeeded","convertCurrency","toConvert","EXCHANGE_RATE_DECIMALS","searchPair","inverseQuotation","tryToConvertCurrency","NaN","getConvertibleCurrencies","fromCurrencies","toCurrency","isArray","convertible","difference","currencies","throwErrorIfInvalidExpenseCurrencies","ex","getTotal","participationMapping","_nonSettledParticipations","total","_sheet","getCost","getSumOfShares","getBalance","_myParticipations","other","exportData","isNotFunction","negate","isFunction","pickBy","shareEqually","cost","lastShare","last","getCurrencyConversionFunction","getValue","propName","convert","expenseParticipations","thisValueConverted","originalSum","prt","convertedSum","sumOfConverted","delta","personId","expenseId","ReferenceError","importData","max","isNaN","separately","q","key","throwErrorIfInvalid","isValid","idToEntity","apply","arguments","stack","prototype","Object","create","constructor","writable","configurable","localStorageService","localStorageData","JSON","parse","dateReviver","service","jsonString","stringify","set","DATE_REGEX","test","Date","BalanceSheetCtrl","refresh","debtsByDebtor","debtComputationError","updateSheet","$emit","personDetailTpl","PersonDetailCtrl","debtCalculationInterval","$timeout","confirmRemovePerson","isParticipant","getParticipationMap","sumOfShares","computeDebtsDebounced","updateExpense","setParticipation","role","counterRole","doRemovePerson","updatePerson","debtResult","debtRole","open","createPersonDialogTpl","DialogController","controllerAs","expenseDetailTpl","ExpenseDetailCtrl","everyoneParticipates","targetScope","confirmRemoveExpense","doRemoveExpense","setCurrency","createExpenseDialogTpl","moneyInput","$filter","link","iElem","iAttrs","ngModel","render","$valid","val","formatMoney","$modelValue","$viewValue","handleBlur","$render","$validators","money","validateMoney","$parsers","parseMoney","$formatters","unshift","on","restrict","require","directive","$q","$window","blob","deferred","defer","reader","FileReader","onload","resolve","onerror","promise","dataArray","Blob","fileSaver","saveAs","focus","focusExpr","shouldFocus","$eval","debounceFactory","func","wait","scope","invokeApply","timer","context","args","Array","call","currenciesTpl","CurrencyListCtrl","$watch","openExchangeRateDialog","updateExchangeRate","exchangeRate","ExchangeRateDialogCtrl","webpackContext","req","webpackContextResolve","./ic_add_24px.svg","./ic_attach_money_24px.svg","./ic_chevron_right_24px.svg","./ic_close_24px.svg","./ic_delete_24px.svg","./ic_face_24px.svg","./ic_home_24px.svg","./ic_more_vert_24px.svg","./ic_shopping_basket_24px.svg","./ic_warning_24px.svg","keys"],"mappings":"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","file":"debt.cd037e84f17fb3115b88.js","sourcesContent":["webpackJsonp([0,2],[\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(1);\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tconfigureLocalStorage.$inject = [\"localStorageServiceProvider\"];\r\n\tconfigureIcons.$inject = [\"$mdIconProvider\"];\r\n\threfSanitization.$inject = [\"$compileProvider\"];\r\n\tdecorateExceptionHandler.$inject = [\"$provide\", \"events\"];\r\n\tmakeStateAvailableInScope.$inject = [\"$rootScope\", \"$state\", \"$stateParams\"];\r\n\tmakeMdMediaAvailableInScope.$inject = [\"$rootScope\", \"$mdMedia\"];\r\n\t__webpack_require__(2);\r\n\t__webpack_require__(6);\r\n\t\r\n\t__webpack_require__(13);\r\n\t\r\n\tvar angular = __webpack_require__(14);\r\n\t__webpack_require__(16);\r\n\t__webpack_require__(22);\r\n\t__webpack_require__(23);\r\n\t__webpack_require__(24);\r\n\t\r\n\tvar _ = __webpack_require__(25);\r\n\t\r\n\tangular\r\n\t  .module(\"debtApp\", [\"ngMaterial\", \"ui.router\", \"LocalStorageModule\", \"ngFileUpload\"])\r\n\t  .constant(\"events\", {\r\n\t    BALANCE_SHEET_UPDATED: \"balance sheet updated\",\r\n\t    ERROR: \"error\"\r\n\t  })\r\n\t  .constant(\"debtCalculationInterval\", 500)\r\n\t  .config(configureLocalStorage)\r\n\t  .config(configureIcons)\r\n\t  .config(hrefSanitization)\r\n\t  .config(decorateExceptionHandler)\r\n\t  .run(makeStateAvailableInScope)\r\n\t  .run(makeMdMediaAvailableInScope)\r\n\t;\r\n\t\r\n\t__webpack_require__(27);\r\n\t__webpack_require__(28);\r\n\t__webpack_require__(29);\r\n\t__webpack_require__(36);\r\n\t__webpack_require__(44);\r\n\t__webpack_require__(51);\r\n\t__webpack_require__(58);\r\n\t__webpack_require__(69);\r\n\t\r\n\tfunction configureIcons($mdIconProvider) {\r\n\t  var iconFiles = [\r\n\t    'ic_add_24px.svg',\r\n\t    'ic_attach_money_24px.svg',\r\n\t    'ic_chevron_right_24px.svg',\r\n\t    'ic_close_24px.svg',\r\n\t    'ic_delete_24px.svg',\r\n\t    'ic_face_24px.svg',\r\n\t    'ic_home_24px.svg',\r\n\t    'ic_more_vert_24px.svg',\r\n\t    'ic_shopping_basket_24px.svg',\r\n\t    'ic_warning_24px.svg'\r\n\t  ];\r\n\t  var iconProps = _.map(iconFiles, function(fileName) {\r\n\t    var iconName = fileName.substr(0, fileName.indexOf('.'));\r\n\t    return {\r\n\t      filePath: __webpack_require__(74)(\"./\" + fileName),\r\n\t      iconName: iconName\r\n\t    };\r\n\t  });\r\n\t\r\n\t  _.each(iconProps, function(prop) {\r\n\t    $mdIconProvider.icon(prop.iconName, prop.filePath);\r\n\t  });\r\n\t}\r\n\t\r\n\t\r\n\tfunction configureLocalStorage(localStorageServiceProvider) {\r\n\t  localStorageServiceProvider.setPrefix(\"debtApp\");\r\n\t}\r\n\t\r\n\t\r\n\tfunction hrefSanitization($compileProvider) {\r\n\t  $compileProvider.aHrefSanitizationWhitelist(/^(blob||https?):/);\r\n\t}\r\n\t\r\n\t\r\n\tvar CurrencyConversionError = __webpack_require__(41);\r\n\tfunction decorateExceptionHandler($provide, events) {\r\n\t  $provide.decorator('$exceptionHandler', [\"$delegate\", \"$log\", \"$injector\", function($delegate, $log, $injector) {\r\n\t    return function(exception, cause) {\r\n\t      $delegate(exception, cause);\r\n\t\r\n\t      var $rootScope = $injector.get('$rootScope');\r\n\t      $rootScope.$broadcast(events.ERROR, exception, cause);\r\n\t\r\n\t      if (exception instanceof CurrencyConversionError) {\r\n\t        var $state = $injector.get('$state');\r\n\t        $state.go(\"currencies\");\r\n\t      }\r\n\t\r\n\t    };\r\n\t  }]);\r\n\t}\r\n\t\r\n\t// Injection of $state may trigger a GET, which can show as an \r\n\t// \"Unexpected request\" error in your test. Workaround is to \r\n\t// $provide a mock $state to Angular.\r\n\tfunction makeStateAvailableInScope($rootScope, $state, $stateParams) {\r\n\t  $rootScope.$state = $state;\r\n\t  $rootScope.$stateParams = $stateParams;\r\n\t}\r\n\t\r\n\tfunction makeMdMediaAvailableInScope($rootScope, $mdMedia) {\r\n\t  $rootScope.$mdMedia = $mdMedia;\r\n\t}\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t// removed by extract-text-webpack-plugin\n\n/***/ },\n/* 3 */,\n/* 4 */,\n/* 5 */,\n/* 6 */\n/***/ function(module, exports) {\n\n\t// removed by extract-text-webpack-plugin\n\n/***/ },\n/* 7 */,\n/* 8 */,\n/* 9 */,\n/* 10 */,\n/* 11 */,\n/* 12 */,\n/* 13 */\n/***/ function(module, exports) {\n\n\twindow.addEventListener('load', function() {\r\n\t  window.applicationCache.addEventListener('updateready', function() {\r\n\t    window.location.reload();\r\n\t  }, false);\r\n\t}, false);\n\n/***/ },\n/* 14 */,\n/* 15 */,\n/* 16 */,\n/* 17 */,\n/* 18 */,\n/* 19 */,\n/* 20 */,\n/* 21 */,\n/* 22 */,\n/* 23 */,\n/* 24 */,\n/* 25 */,\n/* 26 */,\n/* 27 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tDebtAppCtrl.$inject = [\"balanceSheetService\", \"debounce\", \"balanceSheetSaveInterval\", \"openCreatePersonDialog\", \"openCreateExpenseDialog\", \"fileService\", \"events\", \"$mdDialog\", \"$state\", \"$scope\", \"$log\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar _ = __webpack_require__(25);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .constant(\"balanceSheetSaveInterval\", 500)\r\n\t  .controller(\"DebtAppCtrl\", DebtAppCtrl);\r\n\t\r\n\tfunction DebtAppCtrl(balanceSheetService,\r\n\t                     debounce,\r\n\t                     balanceSheetSaveInterval,\r\n\t                     openCreatePersonDialog,\r\n\t                     openCreateExpenseDialog,\r\n\t                     fileService,\r\n\t                     events,\r\n\t                     $mdDialog,\r\n\t                     $state,\r\n\t                     $scope,\r\n\t                     $log) {\r\n\t\r\n\t  var vm = this;\r\n\t\r\n\t  vm.init = init;\r\n\t  vm.createPerson = createPerson;\r\n\t  vm.createExpense = createExpense;\r\n\t  vm.createNewSheet = createNewSheet;\r\n\t  vm.loadSheet = loadSheet;\r\n\t  vm.exportSheet = exportSheet;\r\n\t  vm.balanceSheetUpdated = balanceSheetUpdated;\r\n\t  vm.showHelp = showHelp;\r\n\t\r\n\t  var confirmCreateNewSheet = $mdDialog.confirm()\r\n\t    .title(\"Create new sheet\")\r\n\t    .content(\"The current sheet will be discarded. Please consider exporting it first. Continue?\")\r\n\t    .ok(\"Ok\").cancel(\"Cancel\");\r\n\t\r\n\t  init();\r\n\t\r\n\t  /////////////////////////////////////////////////////////////\r\n\t\r\n\t  function init() {\r\n\t    $scope.$on(events.BALANCE_SHEET_UPDATED, debounce(function() {\r\n\t      vm.balanceSheetUpdated();\r\n\t    }), balanceSheetSaveInterval, $scope, true);\r\n\t    $scope.$on(events.ERROR, handleErrorEvent);\r\n\t    balanceSheetService.init();\r\n\t    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n\t    findExpensesWithInvalidCurrencies();\r\n\t  }\r\n\t\r\n\t  function balanceSheetUpdated() {\r\n\t    vm.errorMessage = undefined;\r\n\t    tryToSave();\r\n\t    findExpensesWithInvalidCurrencies();\r\n\t  }\r\n\t\r\n\t  function tryToSave() {\r\n\t    try {\r\n\t      balanceSheetService.save();\r\n\t    } catch (e) {\r\n\t      $log.error(e);\r\n\t      vm.errorMessage = \"Cannot save: \" + e.message;\r\n\t    }\r\n\t  }\r\n\t\r\n\t  function findExpensesWithInvalidCurrencies() {\r\n\t    var nonConvertible = vm.balanceSheet.getNonConvertibleCurrencies(vm.balanceSheet.getExpenseCurrencies(), vm.balanceSheet.currency);\r\n\t\r\n\t    if (nonConvertible.length === 0 || vm.errorMessage) {\r\n\t      return;\r\n\t    }\r\n\t    var messageTemplate = _.template(\"Cannot convert <%= currencyWord %> <%= currencyList %> to balance sheet's currency <%= balanceSheetCurrency %>\");\r\n\t\r\n\t    var data = {\r\n\t      currencyWord: nonConvertible.length == 1 ? \"currency\" : \"currencies\",\r\n\t      currencyList: \"\",\r\n\t      balanceSheetCurrency: \"'\" + vm.balanceSheet.currency + \"'\"\r\n\t    };\r\n\t\r\n\t    _.each(nonConvertible, function(c, index) {\r\n\t      data.currencyList = data.currencyList + (index > 0 ? \", \" : \"\") + \"'\" + c + \"'\";\r\n\t    });\r\n\t\r\n\t    vm.errorMessage = messageTemplate(data);\r\n\t  }\r\n\t\r\n\t  function handleErrorEvent(event, error) {\r\n\t    vm.errorMessage = error.message;\r\n\t  }\r\n\t\r\n\t  function createPerson() {\r\n\t    openCreatePersonDialog()\r\n\t      .then(function(dialogResult) {\r\n\t        balanceSheetService.balanceSheet.createPerson(dialogResult.person, dialogResult.options);\r\n\t        vm.balanceSheetUpdated();\r\n\t        $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n\t      });\r\n\t  }\r\n\t\r\n\t  function createExpense() {\r\n\t    openCreateExpenseDialog()\r\n\t      .then(function(dialogResult) {\r\n\t        balanceSheetService.balanceSheet.createExpense(dialogResult.expense, dialogResult.options);\r\n\t        vm.balanceSheetUpdated();\r\n\t        $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n\t      });\r\n\t  }\r\n\t\r\n\t  function createNewSheet() {\r\n\t    $mdDialog.show(confirmCreateNewSheet)\r\n\t      .then(function() {\r\n\t        balanceSheetService.createNew();\r\n\t        vm.balanceSheetUpdated();\r\n\t        $state.go(\"balanceSheet\");\r\n\t        $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n\t      });\r\n\t  }\r\n\t\r\n\t  function loadSheet(files) {\r\n\t    if (!files || !files.length) return;\r\n\t\r\n\t    if (!fileService.isSupported()) {\r\n\t      vm.errorMessage = \"File operations not supported in this browser. Please consider a more modern browser.\";\r\n\t      return;\r\n\t    }\r\n\t\r\n\t    var file = files[0];\r\n\t    fileService.readAsText(file)\r\n\t      .then(function(result) {\r\n\t        loadSheetFromJson(result);\r\n\t      })\r\n\t      .catch(function(e) {\r\n\t        $log.error(e);\r\n\t        vm.errorMessage = \"Unable to read file\";\r\n\t      });\r\n\t  }\r\n\t\r\n\t  function loadSheetFromJson(json) {\r\n\t    balanceSheetService.loadFromJson(json);\r\n\t    vm.balanceSheetUpdated();\r\n\t    $state.go(\"balanceSheet\");\r\n\t    $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n\t  }\r\n\t\r\n\t  function exportSheet() {\r\n\t    if (!fileService.isSupported()) {\r\n\t      vm.errorMessage = \"File operations not supported in this browser. Please consider a more modern browser.\";\r\n\t      return;\r\n\t    }\r\n\t\r\n\t    var json = balanceSheetService.exportToJson();\r\n\t    try {\r\n\t      fileService.saveAsFile([json], balanceSheetService.balanceSheet.name + \".txt\");\r\n\t    } catch (e) {\r\n\t      $log.error(e);\r\n\t      vm.errorMessage = \"Error when saving file\";\r\n\t    }\r\n\t  }\r\n\t\r\n\t  function showHelp() {\r\n\t    $mdDialog.show({\r\n\t      templateUrl: \"help.html\",\r\n\t      controller: [\"$scope\", \"$mdDialog\", function($scope, $mdDialog) {\r\n\t        $scope.close = function() {\r\n\t          $mdDialog.hide();\r\n\t        };\r\n\t      }]\r\n\t    });\r\n\t  }\r\n\t}\n\n/***/ },\n/* 28 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tconfig.$inject = [\"$urlRouterProvider\"];\r\n\tvar angular = __webpack_require__(14);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t\t.config(config);\r\n\t\r\n\tfunction config($urlRouterProvider) {\r\n\t  \r\n\t  $urlRouterProvider.otherwise(\"/\");\r\n\t  \r\n\t}\n\n/***/ },\n/* 29 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\t__webpack_require__(30);\r\n\t__webpack_require__(31);\r\n\t__webpack_require__(32);\r\n\t__webpack_require__(35);\n\n/***/ },\n/* 30 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\r\n\t\r\n\t\r\n\tfunction solve(input) {\r\n\t\t// Internal copies of the linear system and its dimensions\r\n\t\tvar coefMatrix, constVector, xVector;\r\n\t\tvar m, n, rank, numberOfSolutions;\r\n\t\t\r\n\t\t// With these we can \"virtually\" rearrange the rows and columns\r\n\t\t// for better numerical stability in the variable elimination phases.\r\n\t\t// At step i, row index pivotToEquationMap[i] is the pivot equation and\r\n\t\t// it is used for eliminating variable index pivotToVariableMap[i] from all the\r\n\t\t// other equations.\r\n\t\tvar pivotToEquationMap, pivotToVariableMap, equationScale;\r\n\t\t\r\n\t\tvalidate();\r\n\t\tinitialize();\r\n\t\ttransformToRowEchelonForm();\r\n\t\treduceRowEchelonForm();\r\n\t\tdetermineRank();\r\n\t\tdetermineNumberOfSolutions();\r\n\t\tdetermineSolution();\r\n\t\r\n\t\treturn {\r\n\t\t\txVector: xVector,\r\n\t\t\tnumberOfEquations: m,\r\n\t\t\tnumberOfVariables: n,\r\n\t\t\trank: rank,\r\n\t\t\tnumberOfFreeVariables: n - rank,\r\n\t\t\tnumberOfSolutions: numberOfSolutions\r\n\t\t};\r\n\t\t\r\n\t\t/////////////////////////////////////////////////////////////\r\n\t\t\r\n\t\tfunction validate() {\r\n\t    \tif (!input || !input.A || !input.b) {\r\n\t    \t\tthrow new TypeError(\"Null matrix A or vector b in system Ax = b\");\r\n\t    \t}\r\n\t    \t\r\n\t    \tif (input.A.length < 1 || input.A[0].length < 1) {\r\n\t    \t\tthrow new TypeError(\"Matrix A in Ax = b has no rows or no columns\");\r\n\t    \t}\r\n\t\t\t\r\n\t    \tif (input.A.length != input.b.length) {\r\n\t    \t\tthrow new RangeError(\"The dimensions of the matrix and the constant vector are incompatible\");\r\n\t    \t}\r\n\t\t}\r\n\t\r\n\t\tfunction initialize() {\r\n\t\t\tcoefMatrix = copyMatrix(input.A);\r\n\t\t\tconstVector = copyArray(input.b);\r\n\t\t\t\r\n\t\t\tm = coefMatrix.length;\r\n\t\t\tn = coefMatrix[0].length;\r\n\t\r\n\t\t\tpivotToEquationMap = [];\r\n\t\t\tfor (var i = 0; i < m; i++) {\r\n\t\t\t\tpivotToEquationMap[i] = i;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tequationScale = [];\r\n\t\t\tfor (var i = 0; i < m; i++) {\r\n\t\t\t\tequationScale[i] = 0;\r\n\t\t\t\tfor (var j = 0; j < n; j++) {\r\n\t\t\t\t\tvar abscoef = Math.abs(coefMatrix[i][j]);\r\n\t\t\t\t\tif (abscoef > equationScale[i]) {\r\n\t\t\t\t\t\tequationScale[i] = abscoef;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\tpivotToVariableMap = [];\r\n\t\t\tfor (var j = 0; j < n; j++) {\r\n\t\t\t\tpivotToVariableMap[j] = j;\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\tfunction transformToRowEchelonForm() {\r\n\t\t\tvar pivotIdx = 0; \r\n\t\t\tvar knownFreeVariables = [];\r\n\t\t\t\r\n\t\t\twhile (pivotIdx < m-1) { \r\n\t\r\n\t\t\t\t// Choose the best pivot-equation for eliminating variable pivotToVariableMap[pivotIdx] \r\n\t\t\t\t// from equations equations not yet used as pivot equations.\r\n\t\t\t\tvar maxRatio = 0;\r\n\t\t\t\tvar bestPivotEquationIndex = pivotIdx;\r\n\t\t\t\tfor (var i = pivotIdx; i < m; ++i) {\r\n\t\t\t\t\tvar rowIdx = pivotToEquationMap[i];\r\n\t\t\t\t\tvar colIdx = pivotToVariableMap[pivotIdx];\r\n\t\t\t\t\tvar ratio = Math.abs(coefMatrix[rowIdx][colIdx]/equationScale[rowIdx]);\r\n\t\t\r\n\t\t\t\t\tif (ratio > maxRatio) {\r\n\t\t\t\t\t\tmaxRatio = ratio;\r\n\t\t\t\t\t\tbestPivotEquationIndex = i;\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t// If maxRatio == 0, the coefficient of variable pivotToVariableMap[pivotIdx] is 0 in all the rest of the equations. \r\n\t\t\t\t// That is pivotToVariableMap[pivotIdx] is a free variable. Find the next suitable variable.\r\n\t\t\t\tif (maxRatio === 0) {\r\n\t\t\t\t\tvar currPivotVaribleIdx = pivotToVariableMap[pivotIdx];\r\n\t\t\t\t\tknownFreeVariables[currPivotVaribleIdx] = true;     \r\n\t\t\t\t\t\r\n\t\t\t\t\t// The next one must not be a free variable.\r\n\t\t\t\t\tvar i = pivotIdx;\r\n\t\t\t\t\tvar newPivotVariableIdx = currPivotVaribleIdx;\r\n\t\t\t\t\twhile (newPivotVariableIdx == currPivotVaribleIdx && i < n-1) {\r\n\t\t\t\t\t\t++i;\r\n\t\t\t\t\t\tif (!knownFreeVariables[pivotToVariableMap[i]]) {\r\n\t\t\t\t\t\t\tnewPivotVariableIdx = pivotToVariableMap[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tif (newPivotVariableIdx != currPivotVaribleIdx) {\r\n\t\t\t\t\t\tpivotToVariableMap[pivotIdx] = newPivotVariableIdx;\r\n\t\t\t\t\t\tpivotToVariableMap[i] = currPivotVaribleIdx;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else { \r\n\t\t\t\t\t\t// Could not find a suitable variable. This means the row echelon form is ready.\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\tvar temp = pivotToEquationMap[pivotIdx];\r\n\t\t\t\tpivotToEquationMap[pivotIdx] = pivotToEquationMap[bestPivotEquationIndex];\r\n\t\t\t\tpivotToEquationMap[bestPivotEquationIndex] = temp;     \r\n\t\t\t\t\r\n\t\t\t\t// Elimination phase\r\n\t\t\t\tvar pivotRowIdx = pivotToEquationMap[pivotIdx];\r\n\t\t\t\tvar pivotColIdx = pivotToVariableMap[pivotIdx];\r\n\t\t\t\tfor (i = pivotIdx + 1; i < m; ++i) {\r\n\t\t\t\t\tvar rowIdx = pivotToEquationMap[i];\r\n\t\t\t\t\tvar mult = coefMatrix[rowIdx][pivotColIdx] / coefMatrix[pivotRowIdx][pivotColIdx];\r\n\t\r\n\t\t\t\t\tfor (var j = pivotIdx + 1; j < n; ++j) {\r\n\t\t\t\t\t\tvar colIndex = pivotToVariableMap[j];\r\n\t\t\t\t\t\tcoefMatrix[rowIdx][colIndex] = coefMatrix[rowIdx][colIndex] - mult * coefMatrix[pivotRowIdx][colIndex];\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tcoefMatrix[rowIdx][pivotColIdx] = 0;\r\n\t\t\t\t\tconstVector[rowIdx] = constVector[rowIdx] - mult * constVector[pivotRowIdx];\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tpivotIdx++;\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\tfunction reduceRowEchelonForm() {\r\n\t\t\t// Eliminate pivot variables from previous pivot equations by going through the pivot steps in reverse order.\r\n\t\t\tvar pivotIndex;\r\n\t\t\tfor (pivotIndex = Math.min(m, n) - 1; pivotIndex > 0; --pivotIndex) {\r\n\t\t\t\tvar pivotRowIdx = pivotToEquationMap[pivotIndex];\r\n\t\t\t\tvar pivotColIdx = pivotToVariableMap[pivotIndex];\r\n\t\t\t\t\r\n\t\t\t\tif (coefMatrix[pivotRowIdx][pivotColIdx] === 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfor (var i = pivotIndex - 1; i > -1; --i) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar mult = coefMatrix[pivotToEquationMap[i]][pivotToVariableMap[pivotIndex]]/coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[pivotIndex]];\r\n\t\t\t\t\tfor (var j = 0; j < n; ++j) {\r\n\t\t\t\t\t\tcoefMatrix[pivotToEquationMap[i]][pivotToVariableMap[j]] -= mult*coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[j]];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tconstVector[pivotToEquationMap[i]] -= mult*constVector[pivotToEquationMap[pivotIndex]];\r\n\t\t\t\t}            \t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Normalize the coeffients in each row and the rhs value by the coeffient of the pivot variable in the row\r\n\t\t\tfor (pivotIndex = 0; pivotIndex < Math.min(m, n); ++pivotIndex) {\r\n\t\t\t\t\r\n\t\t\t\tif (coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[pivotIndex]] === 0) {\r\n\t\t\t\t\tcontinue; \r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tvar div = coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[pivotIndex]];\r\n\t\t\t\tfor (var j = 0; j < n; ++j) {\r\n\t\t\t\t\tcoefMatrix[pivotToEquationMap[pivotIndex]][j] = coefMatrix[pivotToEquationMap[pivotIndex]][j]/div;\r\n\t\t\t\t}\r\n\t\t\t\tconstVector[pivotToEquationMap[pivotIndex]] = constVector[pivotToEquationMap[pivotIndex]]/div;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t\r\n\t\tfunction determineRank() {\r\n\t\t\trank = 0;\r\n\t\t\tvar i,j;\r\n\t\t\t\r\n\t\t\tcolumns: \r\n\t\t\tfor (j=0; j<n; ++j) {\r\n\t\t\t\trows:\r\n\t\t\t\tfor (i=0; i<m; ++i) { \r\n\t\t\t\t\tif (i != j && coefMatrix[pivotToEquationMap[i]][pivotToVariableMap[j]] !== 0) {\r\n\t\t\t\t\t\tbreak columns;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (i == j && coefMatrix[pivotToEquationMap[i]][pivotToVariableMap[j]] != 1) {\r\n\t\t\t\t\t\tbreak columns;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t++rank;\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\tfunction determineNumberOfSolutions() {\r\n\t\t\t\r\n\t\t\tvar b2IsZero = true;\r\n\t\r\n\t\t\tfor (var i = rank; i < m; ++i) {\r\n\t\t\t\tif (constVector[pivotToEquationMap[i]] !== 0) {\r\n\t\t\t\t\tb2IsZero = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (rank < m && !b2IsZero) {\r\n\t\t\t\tnumberOfSolutions = 0;\r\n\t\t\t} else if (rank == n && (rank == m || b2IsZero)) {\r\n\t\t\t\tnumberOfSolutions = 1;\r\n\t\t\t} else if (rank < n && (rank == m || b2IsZero)) {\r\n\t\t\t\tnumberOfSolutions = Number.MAX_VALUE;\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\tfunction determineSolution() {\r\n\t\t\tif (numberOfSolutions === 0) {\r\n\t\t\t\txVector = undefined;\r\n\t\t\t} else {\r\n\t\t\t\txVector = initArray(n);\r\n\t\t\t\tfor (var i = 0; i < rank; ++i) {\r\n\t\t\t\t\txVector[pivotToVariableMap[i]] = constVector[pivotToEquationMap[i]];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction initArray(size) {\r\n\t\t\tvar array = [];\r\n\t\t\tfor (var i = 0; i < size; i++) {\r\n\t\t\t\tarray[i] = 0;\r\n\t\t\t}\r\n\t\t\treturn array;\r\n\t\t}\r\n\t\t\r\n\tfunction copyArray(input) {\r\n\t\treturn input.slice();\r\n\t}\r\n\t\r\n\tfunction copyMatrix(input) {\r\n\t\tvar copy = [];\r\n\t\tfor (var i = 0; i < input.length; i++) {\r\n\t\t\tcopy[i] = input[i].slice();\r\n\t\t}\r\n\t\treturn copy;\r\n\t}\r\n\t\t\r\n\t\r\n\tmodule.exports = solve;\n\n/***/ },\n/* 31 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tvar solve = __webpack_require__(30);\r\n\tvar angular = __webpack_require__(14);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t.factory(\"solveLinearSystem\", solveLinearSystem);\r\n\t\r\n\tfunction solveLinearSystem() {\r\n\t  return solve;\r\n\t}\n\n/***/ },\n/* 32 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tdebtSolverFactory.$inject = [\"solveLinearSystem\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar Decimal = __webpack_require__(33);\r\n\tvar Random = __webpack_require__(34);\r\n\tvar _ = __webpack_require__(25);\r\n\t\r\n\tangular\r\n\t  .module(\"debtApp\")\r\n\t    .factory(\"solveDebts\", debtSolverFactory);\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t/**\r\n\t * A function that computes debts from given expense participations.\r\n\t *\r\n\t * The input is an array of Participation objects in a BalanceSheet.\r\n\t *\r\n\t * Returns an array of debts:\r\n\t * [{debtor: <a Person object>, creditor: <a Person object>, amount: <float; how much the debtor owes the creditor>}, ...]\r\n\t *\r\n\t * We form a linear system Ax = b. A is a binary matrix with size (d+c)*(d*c),\r\n\t * where d is the number of debtors and c is the number of creditors. Columns of A \r\n\t * are ordered so that x[c*i + j] is the value of the debt owed by debtor i to creditor j.\r\n\t * \r\n\t * Elements of b are balances - converted to non-negative - of the debtors and the creditors \r\n\t * with the following correspondence:\r\n\t * \r\n\t * b[0]: first debtor\r\n\t * ... \r\n\t * b[d-1]: last debtor\r\n\t * b[d] = first creditor\r\n\t * ... \r\n\t * b[d+c-1] = last creditor\r\n\t * \r\n\t * The coefficient matrix A is constructed so that for each person i, we have equation\r\n\t * where total value of debts to paid by i (if i is a debtor) or to i (if i is a creditor) equals i's \r\n\t * non-negative balance.\r\n\t * \r\n\t * Rows of A indexed between [0, d-1] represent the debtors in the order \r\n\t * of debtors> list. Rows of A indexed between [d, d+c-1] represent the \r\n\t * creditors in the order of creditors list.\r\n\t * \r\n\t * Ideally, we would like to find the sparsest (most 0's) solution x to Ax = b\r\n\t * in case the system is underdetermined and has an infinite number of solutions.\r\n\t * \r\n\t * This problem, posed as min ||x||_0  s.t. Ax = b, x >= 0, where ||x||_0 is the number\r\n\t * of non-zero elements, is in general an NP-hard problem. There is some amount of literature\r\n\t * about the problem (keywords: sparse nonnegative solution of underdetermined linear equations).\r\n\t * The problem is usually approximated as convex optimization problem by minimizing L1-norm (sum of \r\n\t * absolute value) instead. One option could be to use the cassowary javascript library.\r\n\t * \r\n\t * In this function we find a non-negative x using Gaussian elimination and setting random combinations \r\n\t * of free variables to zero until we find a non-negative solution.\r\n\t */\r\n\tfunction debtSolverFactory(solveLinearSystem) {\r\n\t  \r\n\t  return solve;\r\n\t  \r\n\t  \r\n\t  function solve(participations) {\r\n\t    if (!participations || participations.length === 0) {\r\n\t      return [];\r\n\t    }\r\n\t\r\n\t    var balances = computeBalances(participations);\r\n\t    if (isEveryoneBalanced(balances)) {\r\n\t      return [];\r\n\t    }\r\n\t\r\n\t    if (!isSystemBalanced(balances)) {\r\n\t      throw new Error(\"Debt system is not balanced\");\r\n\t    }\r\n\t\r\n\t    var roles = getDebtorsAndCreditors(balances);\r\n\t    var linearSystem = createDebtEquations(roles);\r\n\t    var debtVector = solveDebts(linearSystem);\r\n\t    return createDebts(debtVector, roles);\r\n\t  }\r\n\t  \r\n\t  function computeBalances(participations) {\r\n\t    var balances = {};\r\n\t    angular.forEach(participations, function(p) {\r\n\t      var b = balances[p.person.id];\r\n\t      if (b === undefined) {\r\n\t        b = {person: p.person, balance: new Decimal(0)};\r\n\t        balances[p.person.id] = b;\r\n\t      }\r\n\t      var paid = new Decimal(p.paid);\r\n\t      var share = new Decimal(p.share);\r\n\t      b.balance = b.balance.add(share.subtract(paid));\r\n\t    });\r\n\t\r\n\t    angular.forEach(balances, function(b) {\r\n\t      b.balance = b.balance.toNumber();\r\n\t    });\r\n\t    \r\n\t    return balances;\r\n\t  }\r\n\t  \r\n\t  function isEveryoneBalanced(balances) {\r\n\t    return _.every(balances, {balance: 0});\r\n\t  }\r\n\t\r\n\t  function isSystemBalanced(balances) {\r\n\t    return _.reduce(balances, function(sum, b) {\r\n\t        return sum.add(b.balance);\r\n\t    }, new Decimal(0)).toNumber() === 0;\r\n\t  }\r\n\t  \r\n\t  function getDebtorsAndCreditors(balances) {\r\n\t    var debtors = [];\r\n\t    var creditors = [];\r\n\t    \r\n\t    angular.forEach(balances, function(b) {\r\n\t      if (b.balance <= 0) {\r\n\t        creditors.push(b);\r\n\t      } else {\r\n\t        debtors.push(b);\r\n\t      }\r\n\t    });\r\n\t    \r\n\t    return {\r\n\t      debtors: debtors,\r\n\t      creditors: creditors\r\n\t    };\r\n\t  }\r\n\t  \r\n\t  function createDebtEquations(roles) {\r\n\t    var d = roles.debtors.length;\r\n\t    var c = roles.creditors.length;\r\n\t    \r\n\t    // Right-hand side vector, creditor balances converted to non-negative to allow binary coefficients\r\n\t    var b = [];\r\n\t    _.each(roles.debtors, function(debtor, i) {\r\n\t      b[i] = (new Decimal(debtor.balance)).multiply(100).toNumber();\r\n\t    });\r\n\t    _.each(roles.creditors, function(creditor, i) {\r\n\t      b[d + i] = (new Decimal(creditor.balance)).multiply(-100).toNumber();\r\n\t    });\r\n\t    \r\n\t    // Coefficient matrix\r\n\t    var A = initMatrix(d + c, d*c); \r\n\t    \r\n\t    // Coefficients of equations \"sum of debts paid by debtor = debtor's balance\"\r\n\t    for (var i = 0; i < d; i++) {\r\n\t      for (var j = i*c; j < (i+1)*c; j++) {\r\n\t        A[i][j] = 1;\r\n\t      }\r\n\t    }\r\n\t    \r\n\t    // Coefficients of equations \"sum debts received by creditor = creditor's balance\"\r\n\t    for (var i = d; i < c+d; ++i) {\r\n\t      for (var j = (i-d); j < d*c; j += c) {\r\n\t        A[i][j] = 1;\r\n\t      }\r\n\t    } \r\n\t    \r\n\t    return {\r\n\t      A: A,\r\n\t      b: b\r\n\t    };\r\n\t  }\r\n\t  \r\n\t  function initMatrix(rows, cols) {\r\n\t    var A = [];\r\n\t    for (var i = 0; i < rows; i++) {\r\n\t      A[i] = [];\r\n\t      for (var j = 0; j < cols; j++) {\r\n\t        A[i][j] = 0;\r\n\t      }\r\n\t    }\r\n\t    return A;\r\n\t  }\r\n\t  \r\n\t  // Solve debts, ensuring a non-negative solution \r\n\t  function solveDebts(linearSystem) {\r\n\t    var solution = solveLinearSystem(linearSystem);\r\n\t    if (solution.numberOfSolutions === 0) {\r\n\t      throw new Error(\"Debt system has no solutions\");\r\n\t    }\r\n\t\r\n\t\r\n\t    var numVars = solution.numberOfVariables;\r\n\t    var numFreeVars = solution.numberOfFreeVariables;\r\n\t    \r\n\t    if (numFreeVars === 0) {\r\n\t      return solution.xVector;\r\n\t    }\r\n\t\r\n\t    // Known seed so we always get the same result from\r\n\t    // the same system.\r\n\t    var randomEngine = Random.engines.mt19937();\r\n\t    randomEngine.seed(20150312);\r\n\t\r\n\t    var toEliminate;\r\n\t    do {\r\n\t      \r\n\t      var A = angular.copy(linearSystem.A);\r\n\t      var b = linearSystem.b;\r\n\t      \r\n\t      // Pick random numFreeVars variables for elimination\r\n\t      \r\n\t      var candidates = [];\r\n\t      for (var i = 0; i < numVars; i++) {\r\n\t        candidates[i] = i;\r\n\t      }\r\n\t      \r\n\t      toEliminate = [];\r\n\t      for (var i = 0; i < numFreeVars; i++) {\r\n\t        var candidateIdx = Random.integer(0, candidates.length-1)(randomEngine);\r\n\t        toEliminate.push(candidates[candidateIdx]);\r\n\t        candidates.splice(candidateIdx, 1);\r\n\t      }\r\n\t      \r\n\t      // Eliminate the chosen variables by setting their coefficients to zero\r\n\t      \r\n\t      for (var i = 0; i < A.length; i++) {\r\n\t        for (var j = 0; j < toEliminate.length; j++) {\r\n\t          A[i][toEliminate[j]] = 0;\r\n\t        }\r\n\t      }\r\n\t\r\n\t      // Solve the updated system\r\n\t      \r\n\t      solution = solveLinearSystem({A: A, b: b});\r\n\t      \r\n\t    } while (!isNonNegative(solution.xVector));\r\n\t\r\n\t    \r\n\t    return solution.xVector;\r\n\t  }\r\n\t  \r\n\t  function isNonNegative(vector) {\r\n\t    if (!vector) {\r\n\t      return false;\r\n\t    }\r\n\t    for (var i = 0; i < vector.length; i++) {\r\n\t      if (vector[i] < 0) {\r\n\t        return false;\r\n\t      }\r\n\t    }\r\n\t    return true;\r\n\t  }\r\n\t  \r\n\t  function createDebts(debtVector, roles) {\r\n\t    var debts = [];\r\n\t\r\n\t    for (var i = 0; i < debtVector.length; i++) {\r\n\t      if (debtVector[i] !== 0) {\r\n\t        var debtorIdx = Math.floor(i/roles.creditors.length);\r\n\t        var creditorIdx = i - roles.creditors.length*debtorIdx;\r\n\t        var amount = (new Decimal(debtVector[i])).divideBy(100).toNumber();\r\n\t        var debt = {debtor: roles.debtors[debtorIdx].person, creditor: roles.creditors[creditorIdx].person, amount: amount};\r\n\t        debts.push(debt);\r\n\t      }\r\n\t    }\r\n\t    \r\n\t    return debts;\r\n\t  }\r\n\t}  \n\n/***/ },\n/* 33 */,\n/* 34 */,\n/* 35 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tdebtService.$inject = [\"solveDebts\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar _ = __webpack_require__(25);\r\n\t\r\n\tangular\r\n\t  .module(\"debtApp\")\r\n\t    .factory(\"debtService\", debtService);\r\n\t\r\n\t\r\n\tfunction debtService(solveDebts) {\r\n\t  \r\n\t  return {\r\n\t    computeDebts: computeDebts,\r\n\t    organizeByDebtor: organizeByDebtor\r\n\t  };\r\n\t  \r\n\t  /////////////////////////////////////////\r\n\t\r\n\t  function computeDebts(participations, currency) {\r\n\t    if (currency !== undefined) {\r\n\t      participations = _.map(participations, function(p) {\r\n\t        return {\r\n\t          person: p.person,\r\n\t          expense: p.expense,\r\n\t          paid: p.getPaid(currency, {strictConversion: true}),\r\n\t          share: p.getShare(currency, {strictConversion: true})\r\n\t        };\r\n\t      });\r\n\t    }\r\n\t\r\n\t    var debts = solveDebts(participations);\r\n\t\r\n\t    if (currency !== undefined) {\r\n\t      debts = _.map(debts, function(debt) {\r\n\t        return _.extend(debt, {currency: currency});\r\n\t      });\r\n\t    }\r\n\t\r\n\t    return debts;\r\n\t  } \r\n\t  \r\n\t  function organizeByDebtor(debts) {\r\n\t    var debtorList = [];\r\n\t    var debtorIndices = {};\r\n\t    \r\n\t    _.each(debts, function(d) {\r\n\t      var debtorIndex = debtorIndices[d.debtor.id];\r\n\t      var debtor;\r\n\t      if (debtorIndex === undefined) {\r\n\t        debtorIndex = debtorList.length;\r\n\t        debtor = {debtor: d.debtor, debts: []};\r\n\t        debtorList.push(debtor);\r\n\t        debtorIndices[d.debtor.id] = debtorIndex;\r\n\t      }\r\n\t      debtor = debtorList[debtorIndex];\r\n\t      debtor.debts.push(_.omit(d, \"debtor\")) ;\r\n\t    });\r\n\t\r\n\t    _.each(debtorList, function(d) {\r\n\t      d.debts.sort(function(d1, d2) {\r\n\t        return d1.creditor.name.localeCompare(d2.creditor.name);\r\n\t      });\r\n\t    });\r\n\t    debtorList.sort(function(d1, d2) {\r\n\t      return d1.debtor.name.localeCompare(d2.debtor.name);\r\n\t    });\r\n\t    \r\n\t    return debtorList;\r\n\t  }\r\n\t  \r\n\t}\n\n/***/ },\n/* 36 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\t__webpack_require__(37);\r\n\t__webpack_require__(40);\r\n\t__webpack_require__(42);\r\n\t__webpack_require__(43);\r\n\t__webpack_require__(41);\n\n/***/ },\n/* 37 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tconfig.$inject = [\"$stateProvider\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar balanceSheetTpl = __webpack_require__(38);\r\n\tvar floatingButtonTpl = __webpack_require__(39);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .config(config);\r\n\t\r\n\tfunction config($stateProvider) {\r\n\t\r\n\t  $stateProvider\r\n\t    .state(\"balanceSheet\", {\r\n\t      url: \"/\",\r\n\t      views: {\r\n\t        \"\": {\r\n\t          templateUrl : balanceSheetTpl,\r\n\t          controller : \"BalanceSheetCtrl as vm\"\r\n\t        },\r\n\t        \"floatingButton\": {\r\n\t          templateUrl : floatingButtonTpl\r\n\t        }\r\n\t      }\r\n\t    });\r\n\t  \r\n\t}\n\n/***/ },\n/* 38 */\n/***/ function(module, exports) {\n\n\tvar path = 'balance-sheet/balance-sheet.html';\n\tvar html = \"<section layout=column> <md-input-container class=md-title md-no-float> <input type=text placeholder=\\\"Sheet name\\\" ng-model=vm.balanceSheet.name ng-change=::vm.updateSheet() ng-required=true /> </md-input-container> <div ng-if=vm.balanceSheet.currenciesEnabled() class=row layout=row layout-align=\\\"start center\\\"> <label for=currency flex>Currency</label> <md-select id=currency aria-label=Currency class=\\\"no-margin margin-right\\\" ng-model=vm.balanceSheet.currency ng-change=::vm.updateSheet()> <md-option ng-value=::currency ng-repeat=\\\"currency in ::vm.balanceSheet.getCurrencies()\\\">{{::currency}}</md-option> </md-select> </div> </section> <section> <md-list> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">Expenses</md-subheader> <md-list-item class=md-2-line ng-repeat=\\\"expense in vm.balanceSheet.expenses\\\" ng-click=\\\"::$state.go('expense', {id: expense.id})\\\"> <md-icon hide-xs ng-if=::expense.isBalanced() class=md-primary md-svg-icon=ic_shopping_basket_24px></md-icon> <md-icon ng-if=::!expense.isBalanced() class=md-warn md-svg-icon=ic_warning_24px></md-icon> <div class=md-list-item-text layout=column> <div layout=row ng-class=\\\"{'md-body-1': $mdMedia('xs')}\\\"> <span flex class=margin-right-double ng-class=\\\"::{settled: expense.settled}\\\">{{::expense.name}}</span> <span ng-if=::!vm.balanceSheet.currenciesEnabled()> {{::expense.getCost() | money}} </span> <span ng-if=::vm.balanceSheet.currenciesEnabled()> {{vm.balanceSheet.currency}} {{expense.getCost(vm.balanceSheet.currency) | money}} </span> </div> <p layout=row> <span>{{expense.date | date:'longDate'}}</span> <span flex>&nbsp;</span> <span ng-if=\\\"vm.balanceSheet.currenciesEnabled() && vm.balanceSheet.currency !== expense.computedCurrency()\\\"> {{expense.computedCurrency()}} {{::expense.getCost() | money}} </span> </p> </div> </md-list-item> <md-list-item ng-if=\\\"vm.balanceSheet.expenses.length == 0\\\"> <p class=md-list-item-text> No expenses. </p> </md-list-item> </md-list> </section> <section> <md-list> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">People</md-subheader> <md-list-item class=md-2-line ng-repeat=\\\"person in vm.balanceSheet.persons\\\" ng-click=\\\"::$state.go('person', {id: person.id})\\\"> <md-icon hide-xs class=md-primary md-svg-icon=ic_face_24px></md-icon> <div class=md-list-item-text> <div layout=row ng-class=\\\"{'md-body-1': $mdMedia('xs')}\\\"> <span flex class=margin-right-double>{{::person.name}}</span> <span ng-if=::!vm.balanceSheet.currenciesEnabled()> {{::person.getBalance() | balance}} </span> <span ng-if=::vm.balanceSheet.currenciesEnabled()> {{vm.balanceSheet.currency}} {{person.getBalance(vm.balanceSheet.currency) | balance}} </span> </div> <p>&nbsp;</p> </div> </md-list-item> <md-list-item ng-if=\\\"vm.balanceSheet.persons.length == 0\\\"> <p class=md-list-item-text> No people. </p> </md-list-item> </md-list> </section> <section> <md-list> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">Debts</md-subheader> <md-list-item class=md-2-line ng-repeat=\\\"d in vm.debtsByDebtor\\\"> <div class=md-list-item-text layout=column> <span class=margin-bottom>{{d.debtor.name}} owes</span> <span ng-repeat=\\\"c in d.debts\\\" class=\\\"margin-left-double margin-bottom\\\"> {{c.creditor.name}}: {{c.currency}} {{c.amount | money}} </span> </div> </md-list-item> <md-list-item ng-if=\\\"vm.balanceSheet.persons.length == 0 || vm.balanceSheet.expenses.length == 0\\\"> <div class=md-list-item-text> <p>This section will show debts that settle all expenses with minimum number of transactions.</p> <p>You can also settle expenses individually.</p> </div> </md-list-item> <md-list-item ng-if=\\\"vm.debtsByDebtor.length == 0 && vm.balanceSheet.persons.length > 0 && vm.balanceSheet.expenses.length > 0\\\"> <p class=md-list-item-text> Everyone is settled up! </p> </md-list-item> <md-list-item ng-if=::!vm.balanceSheet.isBalanced()> <md-icon class=md-warn md-svg-icon=ic_warning_24px></md-icon> <p class=md-list-item-text> Cannot compute debts. There are unbalanced expenses. </p> </md-list-item> <md-list-item ng-if=vm.debtComputationError> <md-icon class=md-warn md-svg-icon=ic_warning_24px></md-icon> <p class=md-list-item-text> {{vm.debtComputationError}} </p> </md-list-item> </md-list> </section>\";\n\twindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\n\tmodule.exports = path;\n\n/***/ },\n/* 39 */\n/***/ function(module, exports) {\n\n\tvar path = 'balance-sheet/floating-button.html';\n\tvar html = \"<md-fab-speed-dial md-direction=up ng-init=\\\"isFabOpen = false\\\" md-open=isFabOpen ng-mouseenter=\\\"isFabOpen = true\\\" ng-mouseleave=\\\"isFabOpen = false\\\" class=\\\"md-fab-bottom-right md-scale md-hover-full\\\"> <md-fab-trigger> <md-button aria-label=Create... class=\\\"md-fab md-primary\\\"> <md-icon md-svg-icon=ic_add_24px></md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <md-button ng-click=vm.createExpense() aria-label=\\\"Create expense\\\" class=\\\"md-fab md-primary md-mini\\\"> <md-icon md-svg-icon=ic_shopping_basket_24px></md-icon> </md-button> <md-button ng-click=vm.createPerson() aria-label=\\\"Create person\\\" class=\\\"md-fab md-primary md-mini\\\"> <md-icon md-svg-icon=ic_face_24px></md-icon> </md-button> </md-fab-actions> </md-fab-speed-dial> \";\n\twindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\n\tmodule.exports = path;\n\n/***/ },\n/* 40 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tvar _ = __webpack_require__(25);\r\n\tvar Decimal = __webpack_require__(33);\r\n\tvar CurrencyConversionError = __webpack_require__(41);\r\n\t\r\n\tvar BalanceSheet = function(data) {\r\n\t\r\n\t  var _this = this;\r\n\t  var _sheet = this;\r\n\t\r\n\t  var EXCHANGE_RATE_DECIMALS = 4;\r\n\t\r\n\t  // Data\r\n\t\r\n\t  var persons = [];\r\n\t  var expenses = [];\r\n\t  var participations = [];\r\n\t\r\n\t  var exchangeRates = [];\r\n\t\r\n\t  var idSequence = 1;\r\n\t\r\n\t  _this.name = \"New sheet\";\r\n\t  _this.currency = undefined;\r\n\t  _this.persons = persons;\r\n\t  _this.expenses = expenses;\r\n\t  _this.participations = participations;\r\n\t\r\n\t  if (data) {\r\n\t    importData(data);\r\n\t  }\r\n\t\r\n\t  // Methods\r\n\t\r\n\t  _this.getNonSettledParticipations = getNonSettledParticipations;\r\n\t\r\n\t  _this.isBalanced = isBalanced;\r\n\t\r\n\t  _this.getPerson = getPerson;\r\n\t  _this.createPerson = createPerson;\r\n\t  _this.removePerson = removePerson;\r\n\t\r\n\t  _this.getExpense = getExpense;\r\n\t  _this.createExpense = createExpense;\r\n\t  _this.removeExpense = removeExpense;\r\n\t\r\n\t  _this.getParticipation = getParticipation;\r\n\t  _this.createParticipation = createParticipation;\r\n\t  _this.removeParticipation = removeParticipation;\r\n\t\r\n\t  _this.exportData = exportData;\r\n\t\r\n\t  _this.isValid = isValid;\r\n\t  _this.throwErrorIfInvalid = throwErrorIfInvalid;\r\n\t\r\n\t  _this.currenciesEnabled = currenciesEnabled;\r\n\t  _this.getExchangeRates = getExchangeRates;\r\n\t  _this.getCurrencies = getCurrencies;\r\n\t  _this.getExpenseCurrencies = getExpenseCurrencies;\r\n\t  _this.getExchangeRateCurrencies = getExchangeRateCurrencies;\r\n\t  _this.addOrUpdateExchangeRate = addOrUpdateExchangeRate;\r\n\t  _this.removeExchangeRate = removeExchangeRate;\r\n\t  _this.convertCurrency = convertCurrency;\r\n\t  _this.getConvertibleCurrencies = getConvertibleCurrencies;\r\n\t  _this.getNonConvertibleCurrencies = getNonConvertibleCurrencies;\r\n\t  _this.throwErrorIfInvalidExpenseCurrencies = throwErrorIfInvalidExpenseCurrencies;\r\n\t\r\n\t  /////////////////////////////////////\r\n\t\r\n\t\r\n\t  function getNonSettledParticipations() {\r\n\t    return _.filter(participations, function(pt) {\r\n\t      return !pt.expense.settled;\r\n\t    });\r\n\t  }\r\n\t\r\n\t  function isBalanced() {\r\n\t    return _.reduce(expenses, function(isBalanced, e) {\r\n\t      return isBalanced && (e.settled || e.isBalanced());\r\n\t    }, true);\r\n\t  }\r\n\t\r\n\t\r\n\t  function getPerson(id) {\r\n\t    return _(persons).find(function(p) {\r\n\t      return p.id == id;\r\n\t    });\r\n\t  }\r\n\t\r\n\t  /**\r\n\t   * Creates a person.\r\n\t   *\r\n\t   * @param {Object} [data] - Person data\r\n\t   * @param {String} [data.name=Person <number>] - Person's name\r\n\t   * @param {Object} [options] - Options for creating a person\r\n\t   * @param {boolean} [options.createParticipations=true] - Whether the person is set to participate in all existing expenses\r\n\t   * @returns {Person} - The created Person object\r\n\t   */\r\n\t  function createPerson(data, options) {\r\n\t    data = _.extend({\r\n\t      name: \"Person \" + (persons.length + 1)\r\n\t    }, data);\r\n\t\r\n\t    options = _.extend({}, options);\r\n\t\r\n\t    if (data.id === undefined) {\r\n\t      data.id = idSequence;\r\n\t      idSequence = idSequence + 1;\r\n\t    }\r\n\t\r\n\t    var person = new Person(data);\r\n\t    persons.push(person);\r\n\t\r\n\t    if (options.createParticipations === true) {\r\n\t      _.each(expenses, function(e) {\r\n\t        if (!e.settled) {\r\n\t          createParticipation({person: person, expense: e});\r\n\t          e.shareCost();\r\n\t        }\r\n\t      });\r\n\t    }\r\n\t\r\n\t    return person;\r\n\t  }\r\n\t\r\n\t  function removePerson(toRemove) {\r\n\t    toRemove = getPerson(toRemove.id);\r\n\t\r\n\t    if (!toRemove) return;\r\n\t\r\n\t    _.remove(persons, function(e) {\r\n\t      return e.equals(toRemove);\r\n\t    });\r\n\t\r\n\t    _.forEach(toRemove.getParticipations(), function(pt) {\r\n\t      removeParticipation(pt);\r\n\t    });\r\n\t  }\r\n\t\r\n\t  function getExpense(id) {\r\n\t    return _(expenses).find(function(e) {\r\n\t      return e.id == id;\r\n\t    });\r\n\t  }\r\n\t\r\n\t  /**\r\n\t   * Creates an expense.\r\n\t   *\r\n\t   * @param {Object} [data] - Expense data\r\n\t   * @param {String} [data.name=Expense <number>] - Expense's name\r\n\t   * @param {String} [data.currency] - The currency the expense was paid in\r\n\t   * @param {Object} [options] - Options for creating an expense\r\n\t   * @param {boolean} [options.createParticipations=true] - Whether all existing persons are set to participate in the expense\r\n\t   * @returns {Expense} - The created Expense object\r\n\t   */\r\n\t  function createExpense(data, options) {\r\n\t    data = _.extend({\r\n\t      name: \"Expense \" + (expenses.length + 1),\r\n\t      sharing: \"equal\",\r\n\t      settled: false,\r\n\t      currency: undefined\r\n\t    }, data);\r\n\t\r\n\t    options = _.extend({}, options);\r\n\t\r\n\t    if (data.id === undefined) {\r\n\t      data.id = idSequence;\r\n\t      idSequence = idSequence + 1;\r\n\t    }\r\n\t\r\n\t    var expense = new Expense(data);\r\n\t    expenses.push(expense);\r\n\t\r\n\t    if (options.createParticipations === true) {\r\n\t      _.each(persons, function(p) {\r\n\t        createParticipation({person: p, expense: expense});\r\n\t      });\r\n\t    }\r\n\t\r\n\t    return expense;\r\n\t  }\r\n\t\r\n\t  function removeExpense(toRemove) {\r\n\t    toRemove = getExpense(toRemove.id);\r\n\t\r\n\t    if (!toRemove) return;\r\n\t\r\n\t    _.remove(expenses, function(e) {\r\n\t      return e.equals(toRemove);\r\n\t    });\r\n\t\r\n\t    _.forEach(toRemove.getParticipations(), function(pt) {\r\n\t      removeParticipation(pt);\r\n\t    });\r\n\t  }\r\n\t\r\n\t\r\n\t  function getParticipation(criteria) {\r\n\t    var toSeek = new Participation(criteria);\r\n\t    return _(participations).find(function(pt) {\r\n\t      return toSeek.equals(pt);\r\n\t    });\r\n\t  }\r\n\t\r\n\t  /**\r\n\t   * Creates a participation of a Person to an Expense.\r\n\t   *\r\n\t   * @param {Object} data - Participation data\r\n\t   * @param {Person} data.person - The participant person\r\n\t   * @param {Expense} data.expense - The expense to participate in\r\n\t   * @param {number} [data.paid=0] - How much the person has paid for the expense (in the expense currency)\r\n\t   * @param {number} [data.share=0] - The person's share of the expense's total cost (in the expense currency)\r\n\t   * @returns {Participation} - The created Participation object\r\n\t   */\r\n\t  function createParticipation(data) {\r\n\t    if (getParticipation(data)) {\r\n\t      throw new Error(\"Duplicate participation\");\r\n\t    }\r\n\t\r\n\t    data = _.extend({\r\n\t      paid: 0,\r\n\t      share: 0\r\n\t    }, data);\r\n\t\r\n\t    var participation = new Participation(data);\r\n\t    participations.push(participation);\r\n\t\r\n\t    participation.expense.shareCost();\r\n\t\r\n\t    return participation;\r\n\t  }\r\n\t\r\n\t  function removeParticipation(toRemove) {\r\n\t    toRemove = getParticipation(toRemove);\r\n\t\r\n\t    if (!toRemove) return;\r\n\t\r\n\t    _.remove(participations, function(pt) {\r\n\t      return pt.equals(toRemove);\r\n\t    });\r\n\t\r\n\t    toRemove.expense.shareCost();\r\n\t  }\r\n\t\r\n\t\r\n\t  /**\r\n\t   * @returns {boolean} Whether currencies are enabled in this balance sheet\r\n\t   */\r\n\t  function currenciesEnabled() {\r\n\t    return exchangeRates && exchangeRates.length > 0;\r\n\t  }\r\n\t  /**\r\n\t   * @return {string[]} copy of exchange rates in this sheet\r\n\t   */\r\n\t  function getExchangeRates() {\r\n\t    return _.cloneDeep(exchangeRates);\r\n\t  }\r\n\t\r\n\t  /**\r\n\t   * @return list of currencies in alphabetical order\r\n\t   */\r\n\t  function getCurrencies() {\r\n\t    return _.chain(getExchangeRateCurrencies())\r\n\t      .concat(getExpenseCurrencies(), _this.currency)\r\n\t      .uniq()\r\n\t      .sort()\r\n\t      .value();\r\n\t  }\r\n\t\r\n\t  function getExchangeRateCurrencies() {\r\n\t    return _.reduce(exchangeRates, function(result, er) {\r\n\t      result.push(er.fixed);\r\n\t      result.push(er.variable);\r\n\t      return result;\r\n\t    }, []);\r\n\t  }\r\n\t\r\n\t  function getExpenseCurrencies() {\r\n\t    return _.map(expenses, function(e) {\r\n\t      return e.computedCurrency();\r\n\t    });\r\n\t  }\r\n\t\r\n\t  /**\r\n\t   * Adds or updates an exchange rate.\r\n\t   *\r\n\t   * @param {Object} quotation - The exchange rate object\r\n\t   * @param {string} quotation.fixed - The fixed currency symbol\r\n\t   * @param {string} quotation.variable - The variable currency symbol\r\n\t   * @param {number} quotation.rate - The rate: 1 unit of the fixed currency buys this amount of the variable currency. Must be a positive number with at most 4 decimals.\r\n\t   */\r\n\t  function addOrUpdateExchangeRate(quotation) {\r\n\t    validateQuotation(quotation);\r\n\t    var existing = _.find(exchangeRates, _.pick(quotation, 'fixed', 'variable'));\r\n\t    if (existing) {\r\n\t      _.extend(existing, quotation);\r\n\t    } else {\r\n\t      exchangeRates.push(quotation);\r\n\t    }\r\n\t    updateBalanceSheetCurrencyIfNeeded();\r\n\t  }\r\n\t\r\n\t  function validateQuotation(quotation) {\r\n\t    if (!_.isString(quotation.fixed) || _.trim(quotation.fixed) === \"\") {\r\n\t      throw new TypeError(\"Fixed currency symbol must be a non-empty string\");\r\n\t    }\r\n\t    if (!_.isString(quotation.variable) || _.trim(quotation.variable) === \"\") {\r\n\t      throw new TypeError(\"Variable currency symbol must be a non-empty string\");\r\n\t    }\r\n\t    if (!_.isNumber(quotation.rate) || quotation.rate < 0.0001) {\r\n\t      throw new RangeError(\"Foreign currency rate must be >= 0.0001\");\r\n\t    }\r\n\t  }\r\n\t\r\n\t  function cleanUpCurrency(currency) {\r\n\t    if (!currency) {\r\n\t      return undefined;\r\n\t    } else if (_.isString(currency) && _.trim(currency).length === 0) {\r\n\t      return undefined;\r\n\t    } else {\r\n\t      return _.trim(currency);\r\n\t    }\r\n\t  }\r\n\t\r\n\t  function cleanUpCurrencyPair(currencyPair) {\r\n\t    currencyPair = _.clone(currencyPair);\r\n\t    currencyPair.fixed = cleanUpCurrency(currencyPair.fixed);\r\n\t    currencyPair.variable = cleanUpCurrency(currencyPair.variable);\r\n\t    return currencyPair;\r\n\t  }\r\n\t\r\n\t  /**\r\n\t   * Removes an exchange rate.\r\n\t   *\r\n\t   * @param currencyPair - The currency pair to remove\r\n\t   * @param {string} currencyPair.fixed - The fixed currency symbol\r\n\t   * @param {string} currencyPair.variable - The variable currency symbol\r\n\t   */\r\n\t  function removeExchangeRate(currencyPair) {\r\n\t    if (!currencyPair) return;\r\n\t    currencyPair = cleanUpCurrencyPair(currencyPair);\r\n\t    _.remove(exchangeRates, _.pick(currencyPair, 'fixed', 'variable'));\r\n\t    updateBalanceSheetCurrencyIfNeeded();\r\n\t    updateExpenseCurrenciesIfNeeded();\r\n\t  }\r\n\t\r\n\t  /**\r\n\t   * Converts a value from one currency to another. Uses the inverse of an exchange\r\n\t   * rate if an inverse currency pair is found.\r\n\t   *\r\n\t   * @param {Object} toConvert - The data object\r\n\t   * @param {number} toConvert.value - The value to convert\r\n\t   * @param {string} toConvert.fixed - The currency of the value to be converted\r\n\t   * @param {string} toConvert.variable - The currency to convert the value to\r\n\t   * @return {number} - The value in the variable currency\r\n\t   */\r\n\t  function convertCurrency(toConvert) {\r\n\t    var rate;\r\n\t\r\n\t    if (!toConvert) {\r\n\t      throw new CurrencyConversionError(\"Undefined or null conversion data\");\r\n\t    }\r\n\t\r\n\t    toConvert = cleanUpCurrencyPair(toConvert);\r\n\t\r\n\t    if (toConvert.fixed == toConvert.variable) {\r\n\t      return new Decimal(toConvert.value).toNumber();\r\n\t    }\r\n\t\r\n\t    var quotation = _.find(exchangeRates, {fixed: toConvert.fixed, variable: toConvert.variable});\r\n\t\r\n\t    if (quotation) {\r\n\t      rate = new Decimal(quotation.rate, EXCHANGE_RATE_DECIMALS);\r\n\t    } else {\r\n\t      var searchPair = {variable: toConvert.fixed, fixed: toConvert.variable};\r\n\t      var inverseQuotation = _.find(exchangeRates, searchPair);\r\n\t      if (inverseQuotation) {\r\n\t        rate = new Decimal(1/inverseQuotation.rate, EXCHANGE_RATE_DECIMALS);\r\n\t      }\r\n\t    }\r\n\t\r\n\t    if (!rate) {\r\n\t      throw new CurrencyConversionError(\"Could not find an exchange rate for conversion '\" + toConvert.fixed + \"' -> '\" + toConvert.variable + \"'.\");\r\n\t    }\r\n\t\r\n\t    return new Decimal(toConvert.value*100).multiply(rate).divideBy(100).toNumber();\r\n\t  }\r\n\t\r\n\t  function tryToConvertCurrency(toConvert) {\r\n\t    try {\r\n\t      return convertCurrency(toConvert);\r\n\t    } catch (e) {\r\n\t      if (e instanceof CurrencyConversionError) {\r\n\t        return NaN;\r\n\t      } else {\r\n\t        throw e;\r\n\t      }\r\n\t    }\r\n\t  }\r\n\t\r\n\t  /**\r\n\t   * Returns currencies that can be converted to the given currency.\r\n\t   *\r\n\t   * @param {string[]} fromCurrencies - Currencies to convert\r\n\t   * @param {string} toCurrency - Currency to convert to\r\n\t   * @returns {string[]} - Convertible currencies in fromCurrencies\r\n\t   */\r\n\t  function getConvertibleCurrencies(fromCurrencies, toCurrency) {\r\n\t    if (!_.isArray(fromCurrencies)) {\r\n\t      return [];\r\n\t    }\r\n\t\r\n\t    var convertible = [];\r\n\t    _.each(getCurrencies(), function(c) {\r\n\t      try {\r\n\t        convertCurrency({fixed: c, variable: toCurrency, value: 1});\r\n\t        convertible.push(c);\r\n\t      } catch (e) {}\r\n\t    });\r\n\t    return convertible;\r\n\t  }\r\n\t\r\n\t  /**\r\n\t   * Finds currencies that can not be converted to the given currency.\r\n\t   *\r\n\t   * @param {string[]} fromCurrencies - Currencies to convert\r\n\t   * @param {string} toCurrency - Currency to convert to\r\n\t   * @returns {string[]} - Non-convertible currencies\r\n\t   */\r\n\t  function getNonConvertibleCurrencies(fromCurrencies, toCurrency) {\r\n\t    return _.difference(fromCurrencies, getConvertibleCurrencies(fromCurrencies, toCurrency));\r\n\t  }\r\n\t\r\n\t\r\n\t  function updateBalanceSheetCurrencyIfNeeded() {\r\n\t    var currencies = getExchangeRateCurrencies();\r\n\t\r\n\t    if (exchangeRates.length === 0) {\r\n\t      _this.currency = undefined;\r\n\t    } else if (_this.currency === undefined || _.indexOf(currencies, _this.currency) === -1) {\r\n\t      _this.currency = exchangeRates[0].fixed;\r\n\t    }\r\n\t  }\r\n\t\r\n\t\r\n\t  function updateExpenseCurrenciesIfNeeded() {\r\n\t    var currencies = _.concat(getExchangeRateCurrencies(), _this.currency);\r\n\t    _.each(expenses, function(e) {\r\n\t      if (_.indexOf(currencies, e.currency) === -1) {\r\n\t        e.currency = _this.currency;\r\n\t      }\r\n\t    });\r\n\t  }\r\n\t\r\n\t  function throwErrorIfInvalidExpenseCurrencies() {\r\n\t    _.each(expenses, function(expense) {\r\n\t      try {\r\n\t        convertCurrency({fixed: expense.computedCurrency(), variable: _this.currency, value: 1});\r\n\t      } catch (ex) {\r\n\t        throw new CurrencyConversionError(\"Cannot convert currency '\" + expense.computedCurrency()  + \"' of '\" + expense.name + \"' to balance sheet's currency '\" + _this.currency + \"'\");\r\n\t      }\r\n\t    });\r\n\t  }\r\n\t\r\n\t\r\n\t  /**\r\n\t   * Creates a Person object.\r\n\t   *\r\n\t   * @param {Object} [data] - Initial data\r\n\t   * @param {number} [data.id] - Id\r\n\t   * @param {string} [data.name} - Name\r\n\t   * @constructor\r\n\t   */\r\n\t  function Person(data) {\r\n\t    var _this = this;\r\n\t\r\n\t    _.extend(_this, data);\r\n\t\r\n\t    // Methods\r\n\t\r\n\t    _this.computedCurrency = computedCurrency;\r\n\t    _this.equals = equals;\r\n\t    _this.getCost = getCost;\r\n\t    _this.getSumOfShares = getSumOfShares;\r\n\t    _this.getBalance = getBalance;\r\n\t    _this.isBalanced = isBalanced;\r\n\t    _this.getParticipations = getParticipations;\r\n\t    _this.exportData = exportData;\r\n\t\r\n\t    ///////////////////////////////////////\r\n\t\r\n\t    var _myParticipations = _.chain(participations)\r\n\t      .filter(function(pt) {\r\n\t        return _this.equals(pt.person);\r\n\t      });\r\n\t\r\n\t    var _nonSettledParticipations = _myParticipations\r\n\t      .filter(function(pt) {\r\n\t        return !pt.expense.settled;\r\n\t      });\r\n\t\r\n\t\r\n\t    function getTotal(participationMapping) {\r\n\t      return _nonSettledParticipations\r\n\t        .map(participationMapping)\r\n\t        .reduce(function(total, value) {\r\n\t          return total.add(value);\r\n\t        }, new Decimal(0))\r\n\t        .value()\r\n\t        .toNumber();\r\n\t    }\r\n\t\r\n\t    function computedCurrency() {\r\n\t      return _sheet.currency;\r\n\t    }\r\n\t\r\n\t    /**\r\n\t     *\r\n\t     * @param {string} [currency] - The currency in which to get the total (default: balance sheet's default currency)\r\n\t     * @returns {number} - The total amount this person has paid. NaN if cannot convert currency.\r\n\t     */\r\n\t    function getCost(currency) {\r\n\t      currency = currency || _this.computedCurrency();\r\n\t      return getTotal(function(pt) {\r\n\t        return pt.getPaid(currency);\r\n\t      });\r\n\t    }\r\n\t\r\n\t    /**\r\n\t     *\r\n\t     * @param {string} [currency] - The currency in which to get the total (default: balance sheet's default currency)\r\n\t     * @returns {number} - This person's total share of all the expenses. NaN if cannot convert currency.\r\n\t     */\r\n\t    function getSumOfShares(currency) {\r\n\t      currency = currency || _this.computedCurrency();\r\n\t      return getTotal(function(pt) {\r\n\t        return pt.getShare(currency);\r\n\t      });\r\n\t    }\r\n\t\r\n\t    /**\r\n\t     * Checks whether this person's costs and shares sum up to zero, i.e. the person neither\r\n\t     * owes money nor is owed money by anyone else.\r\n\t     *\r\n\t     * @returns {boolean} - Whether this person's costs and shares sum up to zero\r\n\t     */\r\n\t    function isBalanced() {\r\n\t      return getBalance() === 0;\r\n\t    }\r\n\t\r\n\t    /**\r\n\t     * Computes the difference between the total share and cost paid by this person.\r\n\t     * If the difference is negative, then the person's share is smaller than the costs\r\n\t     * she has paid, that is others owe her money.\r\n\t     *\r\n\t     * @param {string} [currency] - The currency in which to get the balance (default: balance sheet's default currency)\r\n\t     * @returns {number} - The difference between the total share and cost paid by this person. NaN if cannot convert currency.\r\n\t     */\r\n\t    function getBalance(currency) {\r\n\t      currency = currency || _this.computedCurrency();\r\n\t      return new Decimal( getSumOfShares(currency) ).subtract( getCost(currency) ).toNumber();\r\n\t    }\r\n\t\r\n\t    /**\r\n\t     * @returns {Participation[]} - The expense participations of this person\r\n\t     */\r\n\t    function getParticipations() {\r\n\t      return _myParticipations.value();\r\n\t    }\r\n\t\r\n\t    /**\r\n\t     * @param {Object} other - Another object\r\n\t     * @returns {boolean} - True if this person is equal to the other object\r\n\t     */\r\n\t    function equals(other) {\r\n\t      return (other instanceof Person) && (other.id === _this.id);\r\n\t    }\r\n\t\r\n\t    function exportData() {\r\n\t      var isNotFunction = _.negate(_.isFunction);\r\n\t      return _.extend(_.pickBy(_this, isNotFunction), {});\r\n\t    }\r\n\t\r\n\t  }\r\n\t\r\n\t\r\n\t  /**\r\n\t   * An expense.\r\n\t   *\r\n\t   * @param {object} [data] - Initial data\r\n\t   * @param {number} [data.id] - The expense's id\r\n\t   * @param {string} [data.name] - The expense's name\r\n\t   * @param {string} [data.sharing] -  The expense's cost sharing mode. Value \"equal\" = share costs equally. All other values mean custom sharing.\r\n\t   * @param {string} [data.currency] - The expense's currency\r\n\t   * @constructor\r\n\t   */\r\n\t  function Expense(data) {\r\n\t    var _this = this;\r\n\t\r\n\t    // Data\r\n\t    _.extend(_this, data);\r\n\t\r\n\t    // Methods\r\n\t    _this.computedCurrency = computedCurrency;\r\n\t    _this.getCost = getCost;\r\n\t    _this.getSumOfShares = getSumOfShares;\r\n\t    _this.getBalance = getBalance;\r\n\t    _this.isBalanced = isBalanced;\r\n\t    _this.getParticipations = getParticipations;\r\n\t    _this.shareCost = shareCost;\r\n\t    _this.equals = equals;\r\n\t    _this.exportData = exportData;\r\n\t\r\n\t    ///////////////////////////////////////\r\n\t\r\n\t    var _myParticipations = _.chain(participations).filter(function(p) {\r\n\t      return _this.equals(p.expense);\r\n\t    });\r\n\t\r\n\t\r\n\t    function getTotal(participationMapping, currency) {\r\n\t      var total = _myParticipations\r\n\t        .map(participationMapping)\r\n\t        .reduce(function(total, value) {\r\n\t          return total.add(value);\r\n\t        }, new Decimal(0))\r\n\t        .value()\r\n\t        .toNumber();\r\n\t\r\n\t      if (!currency || currency === _this.computedCurrency()) {\r\n\t        return total;\r\n\t      } else {\r\n\t        return tryToConvertCurrency({\r\n\t          value: total,\r\n\t          fixed: _this.computedCurrency(),\r\n\t          variable: currency\r\n\t        });\r\n\t      }\r\n\t    }\r\n\t\r\n\t\r\n\t    /**\r\n\t     * Gets the currency of this expense used for currency computations.\r\n\t     *\r\n\t     * @returns {string} - The currency of this expense\r\n\t     */\r\n\t    function computedCurrency() {\r\n\t      return _this.currency || _sheet.currency;\r\n\t    }\r\n\t\r\n\t    /**\r\n\t     *\r\n\t     * @param {string} [currency] - Currency in which to get the value. Default is this expense's currency or if undefined, the balance sheet's default currency.\r\n\t     * @return {number} The cost of this expense. NaN if cannot convert currency.\r\n\t     */\r\n\t    function getCost(currency) {\r\n\t      return getTotal(function(pt) {\r\n\t        return pt.paid;\r\n\t      }, currency);\r\n\t    }\r\n\t\r\n\t    /**\r\n\t     *\r\n\t     * @param {string} [currency] - Currency in which to get the value. Default is this expense's currency or if undefined, the balance sheet's default currency.\r\n\t     * @return {number} The sum of shares of this expense. NaN if cannot convert currency.\r\n\t     */\r\n\t    function getSumOfShares(currency) {\r\n\t      return getTotal(function(pt) {\r\n\t        return pt.share;\r\n\t      }, currency);\r\n\t    }\r\n\t\r\n\t    function isBalanced() {\r\n\t      return getBalance(_this.computedCurrency()) === 0;\r\n\t    }\r\n\t\r\n\t    /**\r\n\t     *\r\n\t     * @param {string} [currency] - Currency in which to get the value. Default is this expense's currency or if undefined, the balance sheet's default currency.\r\n\t     * @return {number} The balance of this expense. NaN if cannot convert currency.\r\n\t     */\r\n\t    function getBalance(currency) {\r\n\t      return new Decimal( getSumOfShares(currency) ).subtract( getCost(currency) ).toNumber();\r\n\t    }\r\n\t\r\n\t    function getParticipations() {\r\n\t      return _myParticipations.value();\r\n\t    }\r\n\t\r\n\t    function shareCost() {\r\n\t      if (_this.sharing === \"equal\") {\r\n\t        shareEqually();\r\n\t      }\r\n\t    }\r\n\t\r\n\t    function shareEqually() {\r\n\t      var participations = _this.getParticipations();\r\n\t      if (participations.length === 0) {\r\n\t        return;\r\n\t      }\r\n\t\r\n\t      var cost = new Decimal(_this.getCost());\r\n\t      var share = cost.divideBy(participations.length);\r\n\t      var lastShare = cost.subtract(share.multiply(participations.length - 1));\r\n\t\r\n\t      _.forEach(participations, function(p, i) {\r\n\t        if (i < participations.length - 1) {\r\n\t          p.share = share.toNumber();\r\n\t        }\r\n\t      });\r\n\t      _.last(participations).share = lastShare.toNumber();\r\n\t    }\r\n\t\r\n\t    function equals(other) {\r\n\t      return (other instanceof Expense) && (other.id === _this.id);\r\n\t    }\r\n\t\r\n\t    function exportData() {\r\n\t      var isNotFunction = _.negate(_.isFunction);\r\n\t      return _.extend(_.pickBy(_this, isNotFunction));\r\n\t    }\r\n\t\r\n\t  }\r\n\t\r\n\t  /**\r\n\t   * Creates a participation of a Person to an Expense.\r\n\t   *\r\n\t   * @param {Object} data - Participation data\r\n\t   * @param {Person} data.person - The participant person\r\n\t   * @param {Expense} data.expense - The expense to participate in\r\n\t   * @param {number} [data.paid=0] - How much the person has paid for the expense (in the expense currency)\r\n\t   * @param {number} [data.share=0] - The person's share of the expense's total cost (in the expense currency)\r\n\t   * @constructor\r\n\t   */\r\n\t  function Participation(data) {\r\n\t    var _this = this;\r\n\t\r\n\t    if (!data || !data.person || !data.expense) {\r\n\t      throw new ReferenceError(\"Undefined participation\");\r\n\t    }\r\n\t\r\n\t    // Data\r\n\t\r\n\t    _.extend(_this, data);\r\n\t\r\n\t    // Methods\r\n\t\r\n\t    _this.getPaid = getPaid;\r\n\t    _this.getShare = getShare;\r\n\t    _this.equals = equals;\r\n\t    _this.exportData = exportData;\r\n\t\r\n\t    ///////////////////////////////////////\r\n\t\r\n\t    function getCurrencyConversionFunction(options) {\r\n\t      if (options.strictConversion) {\r\n\t        return convertCurrency;\r\n\t      } else {\r\n\t        return tryToConvertCurrency;\r\n\t      }\r\n\t    }\r\n\t\r\n\t    /**\r\n\t     * Returns the value of property propName with currency conversion (if applicable) adjusted such\r\n\t     * that the expense is balanced in the target currency.\r\n\t     *\r\n\t     * @param {string} propName - The name of the monetary value property\r\n\t     * @param {string} currency - The target currency\r\n\t     * @param {object} options - Currrency conversion options\r\n\t     * @returns {number} - The property value with currency conversion\r\n\t     */\r\n\t    function getValue(propName, currency, options) {\r\n\t      if (!currency || currency === _this.expense.computedCurrency()) {\r\n\t        return _this[propName];\r\n\t      }\r\n\t\r\n\t      options = _.extend({strictConversion: false}, options);\r\n\t      var convert = getCurrencyConversionFunction(options);\r\n\t      var expenseParticipations = _this.expense.getParticipations();\r\n\t\r\n\t      if (_.last(expenseParticipations) === _this) {\r\n\t\r\n\t        var thisValueConverted = convert({\r\n\t          value: _this[propName],\r\n\t          fixed: _this.expense.computedCurrency(),\r\n\t          variable: currency\r\n\t        });\r\n\t\r\n\t        var originalSum = _.reduce(expenseParticipations, function(sum, prt) {\r\n\t          return sum.add(prt[propName]);\r\n\t        }, new Decimal(0)).toNumber();\r\n\t\r\n\t        var convertedSum = convert({\r\n\t          value: originalSum,\r\n\t          fixed: _this.expense.computedCurrency(),\r\n\t          variable: currency\r\n\t        });\r\n\t\r\n\t        var sumOfConverted = _.reduce(expenseParticipations, function(sum, prt) {\r\n\t          var value = convert({\r\n\t            value: prt[propName],\r\n\t            fixed: prt.expense.computedCurrency(),\r\n\t            variable: currency\r\n\t          });\r\n\t          return sum.add(value);\r\n\t        }, new Decimal(0));\r\n\t\r\n\t        var delta = sumOfConverted.subtract(convertedSum);\r\n\t\r\n\t        return new Decimal(thisValueConverted).subtract(delta).toNumber();\r\n\t\r\n\t      } else {\r\n\t\r\n\t        return convert({\r\n\t          value: _this[propName],\r\n\t          fixed: _this.expense.computedCurrency(),\r\n\t          variable: currency\r\n\t        });\r\n\t\r\n\t      }\r\n\t    }\r\n\t\r\n\t    /**\r\n\t     *\r\n\t     * @param {string} [currency] - Currency in which to get the payment. Default is expense's currency.\r\n\t     * @param {object} [options] - Options\r\n\t     * @param {boolean} [options.strictConversion] - True to throw error if currency conversion fails, false to return NaN. Default is false.\r\n\t     * @return {number} How much the person paid for the expense.\r\n\t     */\r\n\t    function getPaid(currency, options) {\r\n\t      return getValue(\"paid\", currency, options);\r\n\t    }\r\n\t\r\n\t    /**\r\n\t     *\r\n\t     * @param {string} [currency] - Currency in which to get the share. Default is expense's currency.\r\n\t     * @param {object} [options] - Options\r\n\t     * @param {boolean} [options.strictConversion] - True to throw error if currency conversion fails, false to return NaN. Default is false.\r\n\t     * @return {number} How much the person shares for the expense.\r\n\t     */\r\n\t    function getShare(currency, options) {\r\n\t      return getValue(\"share\", currency, options);\r\n\t    }\r\n\t\r\n\t    function equals(other) {\r\n\t      return (other instanceof Participation) && _this.expense.equals(other.expense) && _this.person.equals(other.person);\r\n\t    }\r\n\t\r\n\t    function exportData() {\r\n\t      return {personId: _this.person.id, expenseId: _this.expense.id, paid: _this.paid, share: _this.share};\r\n\t    }\r\n\t\r\n\t  }\r\n\t\r\n\t\r\n\t  function exportData() {\r\n\t    var isNotFunction = _.negate(_.isFunction);\r\n\t    var data = _.pickBy(_this, isNotFunction);\r\n\t    data.persons = _.map(persons, function(p) {\r\n\t      return p.exportData();\r\n\t    });\r\n\t    data.expenses = _.map(expenses, function(e) {\r\n\t      return e.exportData();\r\n\t    });\r\n\t    data.participations = _.map(participations, function(pt) {\r\n\t      return pt.exportData();\r\n\t    });\r\n\t    data.exchangeRates = getExchangeRates();\r\n\t    return data;\r\n\t  }\r\n\t\r\n\t  function importData(data) {\r\n\t    idSequence = _([])\r\n\t        .concat(data.persons)\r\n\t        .concat(data.expenses)\r\n\t        .map(\"id\")\r\n\t        .max() + 1;\r\n\t    if (_.isNaN(idSequence)) {\r\n\t      idSequence = 1;\r\n\t    }\r\n\t\r\n\t    var separately = {persons: true, expenses: true, participations: true, exchangeRates: true};\r\n\t\r\n\t    _.each(data.exchangeRates, function(q) {\r\n\t      addOrUpdateExchangeRate(q);\r\n\t    });\r\n\t\r\n\t    _.extend(_this, _.pickBy(data, function(value, key) {\r\n\t      return !separately[key];\r\n\t    }));\r\n\t\r\n\t    _.each(data.persons, function(p) {\r\n\t      createPerson(p);\r\n\t    });\r\n\t\r\n\t    _.each(data.expenses, function(e) {\r\n\t      createExpense(e);\r\n\t    });\r\n\t\r\n\t    _.each(data.participations, function(p) {\r\n\t      var person = getPerson(p.personId);\r\n\t      var expense = getExpense(p.expenseId);\r\n\t      createParticipation({person: person, expense: expense, paid: p.paid, share: p.share});\r\n\t    });\r\n\t\r\n\t    throwErrorIfInvalid();\r\n\t  }\r\n\t\r\n\t  function isValid() {\r\n\t    try {\r\n\t      throwErrorIfInvalid();\r\n\t      return true;\r\n\t    } catch (e) {\r\n\t      return false;\r\n\t    }\r\n\t  }\r\n\t\r\n\t  function throwErrorIfInvalid() {\r\n\t\r\n\t    _.each(persons, function(p) {\r\n\t      if (!_.isNumber(p.id)) {\r\n\t        throw new Error(\"Person has no id\");\r\n\t      }\r\n\t    });\r\n\t\r\n\t    _.each(expenses, function(e) {\r\n\t      if (!_.isNumber(e.id)) {\r\n\t        throw new Error(\"Expense has no id\");\r\n\t      }\r\n\t    });\r\n\t\r\n\t    var idToEntity = {};\r\n\t    _.each(persons, function(p) {\r\n\t      idToEntity[p.id] = p;\r\n\t    });\r\n\t    _.each(expenses, function(e) {\r\n\t      idToEntity[e.id] = e;\r\n\t    });\r\n\t    _.each(participations, function(pt) {\r\n\t      if (!pt.person) {\r\n\t        throw new Error(\"Participation has no person\");\r\n\t      }\r\n\t      if (!idToEntity[pt.person.id]) {\r\n\t        throw new Error(\"Participation person is unknown\");\r\n\t      }\r\n\t      if (!pt.expense) {\r\n\t        throw new Error(\"Participation has no expense\");\r\n\t      }\r\n\t      if (!idToEntity[pt.expense.id]) {\r\n\t        throw new Error(\"Participation expense is unknown\");\r\n\t      }\r\n\t    });\r\n\t\r\n\t  }\r\n\t\r\n\t};\r\n\t\r\n\t\r\n\tmodule.exports = BalanceSheet;\n\n/***/ },\n/* 41 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\r\n\t\r\n\tfunction CurrencyConversionError(message) {\r\n\t  var temp = Error.apply(this, arguments);\r\n\t  //temp.name = this.name = 'CurrencyConversionError';\r\n\t  this.stack = temp.stack;\r\n\t  this.message = temp.message;\r\n\t}\r\n\t\r\n\tCurrencyConversionError.prototype = Object.create(Error.prototype, {\r\n\t  constructor: {\r\n\t    value: CurrencyConversionError,\r\n\t    writable: true,\r\n\t    configurable: true\r\n\t  }\r\n\t});\r\n\t\r\n\tmodule.exports = CurrencyConversionError;\n\n/***/ },\n/* 42 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tbalanceSheetService.$inject = [\"localStorageService\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar BalanceSheet = __webpack_require__(40);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .factory(\"balanceSheetService\", balanceSheetService);\r\n\t\r\n\tfunction balanceSheetService(localStorageService) {\r\n\t\r\n\t  var DATE_REGEX = /\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z/; // 2016-04-07T21:00:00.000Z\r\n\t\r\n\t  var service = {\r\n\t    balanceSheet: undefined,\r\n\t    save: save,\r\n\t    loadFromJson: loadFromJson,\r\n\t    exportToJson: exportToJson,\r\n\t    createNew: createNew,\r\n\t    init: init\r\n\t  };\r\n\t\r\n\t  return service;\r\n\t\r\n\t\r\n\t  function init() {\r\n\t    var localStorageData = localStorageService.get(\"balanceSheetData\");\r\n\t    var data;\r\n\t    if (localStorageData && localStorageData.json) {\r\n\t       data = JSON.parse(localStorageData.json, dateReviver);\r\n\t    } else if (localStorageData) {\r\n\t      data = localStorageData; // backwards compatibility\r\n\t    } else {\r\n\t      data = {};\r\n\t    }\r\n\t    service.balanceSheet = new BalanceSheet(data);\r\n\t  }\r\n\t\r\n\t  function save() {\r\n\t    if (!service.balanceSheet) {\r\n\t      throw new ReferenceError(\"No balance valid balance sheet\");\r\n\t    }\r\n\t    service.balanceSheet.throwErrorIfInvalid();\r\n\t\r\n\t    // Store a JSON string in localStorage instead of allowing localStorageService to stringify\r\n\t    // the data so that we can control date parsing.\r\n\t    var jsonString = JSON.stringify(service.balanceSheet.exportData());\r\n\t    localStorageService.set(\"balanceSheetData\", {json: jsonString});\r\n\t  }\r\n\t\r\n\t  function loadFromJson(json) {\r\n\t    var data = JSON.parse(json, dateReviver);\r\n\t    var balanceSheet = new BalanceSheet(data);\r\n\t    balanceSheet.throwErrorIfInvalid();\r\n\t    service.balanceSheet = balanceSheet;\r\n\t    save();\r\n\t  }\r\n\t\r\n\t  function dateReviver(key, value) {\r\n\t    if (typeof value === 'string' && DATE_REGEX.test(value)) {\r\n\t      return new Date(value);\r\n\t    }\r\n\t    return value;\r\n\t  }\r\n\t\r\n\t  function exportToJson() {\r\n\t    var data = service.balanceSheet.exportData();\r\n\t    return JSON.stringify(data);\r\n\t  }\r\n\t\r\n\t  function createNew() {\r\n\t    service.balanceSheet = new BalanceSheet();\r\n\t    service.save();\r\n\t  }\r\n\t\r\n\t}\r\n\t\r\n\t\r\n\n\n/***/ },\n/* 43 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tBalanceSheetCtrl.$inject = [\"balanceSheetService\", \"debtService\", \"events\", \"$scope\", \"$log\"];\r\n\tvar angular = __webpack_require__(14);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .controller(\"BalanceSheetCtrl\", BalanceSheetCtrl);\r\n\t\r\n\tfunction BalanceSheetCtrl(balanceSheetService, debtService, events, $scope, $log) {\r\n\t  var vm = this;\r\n\t  \r\n\t  vm.init = init;\r\n\t  vm.refresh = refresh;\r\n\t  vm.updateSheet = updateSheet;\r\n\t  \r\n\t  init();\r\n\t  \r\n\t  /////////////////////////////////////////////////////////////\r\n\t  \r\n\t  function init() {\r\n\t    refresh();\r\n\t    $scope.$on(events.BALANCE_SHEET_UPDATED, vm.refresh);\r\n\t  }\r\n\t  \r\n\t  function refresh() {\r\n\t    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n\t    try {\r\n\t      vm.debtsByDebtor = computeDebts();\r\n\t      vm.debtComputationError = undefined;\r\n\t    } catch (e) {\r\n\t      $log.error(e);\r\n\t      vm.debtsByDebtor = undefined;\r\n\t      vm.debtComputationError = \"Cannot compute debts\";\r\n\t    }\r\n\t  }\r\n\t  \r\n\t  function computeDebts() {\r\n\t    if (vm.balanceSheet.isBalanced()) {\r\n\t      var participations = vm.balanceSheet.getNonSettledParticipations();\r\n\t      var debts = debtService.computeDebts(participations, vm.balanceSheet.currency);\r\n\t      return debtService.organizeByDebtor(debts);\r\n\t    } else {\r\n\t      return undefined;\r\n\t    }\r\n\t  }\r\n\t\r\n\t  function updateSheet() {\r\n\t    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n\t  }\r\n\t}\n\n/***/ },\n/* 44 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\t__webpack_require__(45);\r\n\t__webpack_require__(48);\r\n\t__webpack_require__(49);\n\n/***/ },\n/* 45 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tconfig.$inject = [\"$stateProvider\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar personDetailTpl = __webpack_require__(46);\r\n\tvar floatingButtonTpl = __webpack_require__(47);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .config(config);\r\n\t\r\n\tfunction config($stateProvider) {\r\n\t  $stateProvider\r\n\t    .state(\"person\", {\r\n\t      url: \"/persons/:id\",\r\n\t      views: {\r\n\t        \"\": {\r\n\t          templateUrl: personDetailTpl,\r\n\t          controller: \"PersonDetailCtrl as vm\"\r\n\t        },\r\n\t        \"floatingButton\": {\r\n\t          templateUrl: floatingButtonTpl\r\n\t        }\r\n\t      }\r\n\t\r\n\t    });\r\n\t}\n\n/***/ },\n/* 46 */\n/***/ function(module, exports) {\n\n\tvar path = 'persons/person-detail.html';\n\tvar html = \"<section> <div layout=row layout-align=\\\"start start\\\"> <md-input-container class=md-title flex md-no-float> <input type=text placeholder=\\\"Person name\\\" ng-model=::vm.person.name ng-change=::vm.updatePerson() ng-required=true /> </md-input-container> <md-button class=md-icon-button aria-label=delete ng-click=vm.removePerson()> <md-tooltip>Delete</md-tooltip> <md-icon md-svg-icon=ic_delete_24px></md-icon> </md-button> </div> <div layout=column> <div layout=row layout-align=\\\"start center\\\"> <span flex id=balance>Balance</span> <span aria-labelledby=balance class=margin-right> <span ng-if=::vm.balanceSheet.currenciesEnabled()>{{::vm.person.computedCurrency()}}</span> {{vm.balance | balance}} </span> </div> </div> </section> <section> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">Expenses</md-subheader> <div layout=column> <div ng-repeat=\\\"expense in vm.balanceSheet.expenses\\\" class=participation layout-xs=column layout-align-xs=\\\"center start\\\" layout-gt-xs=row layout-align-gt-xs=\\\"start center\\\"> <div layout-fill class=participant flex-gt-xs layout=row layout-align=\\\"start center\\\"> <md-checkbox class=md-primary ng-class=\\\"{'md-warn': !expense.isBalanced()}\\\" ng-model=::vm.isParticipant[expense.id] ng-change=\\\"::vm.setParticipation(expense, vm.isParticipant[expense.id])\\\" ng-disabled=::expense.settled> <span ng-class=\\\"::{settled: expense.settled}\\\">{{::expense.name}}</span> </md-checkbox> <span flex></span> <md-button hide-gt-xs ng-href=#/expenses/{{::expense.id}} class=md-icon-button aria-label=\\\"{{::expense.name}} details\\\"> <md-icon md-svg-icon=ic_chevron_right_24px></md-icon> </md-button> </div> <div layout=row layout-align=\\\"start center\\\"> <span class=currency-label ng-if=::vm.balanceSheet.currenciesEnabled()>{{::expense.computedCurrency()}}</span> <md-input-container> <label>Paid</label> <input type=number money-input ng-required=::vm.isParticipant[expense.id] ng-model=\\\"::vm.balanceSheet.getParticipation({person: vm.person, expense: expense}).paid\\\" ng-change=::vm.updateExpense(expense) ng-disabled=\\\"expense.settled || !vm.isParticipant[expense.id]\\\"/> </md-input-container> <md-input-container> <label>Share</label> <input type=number money-input ng-required=::vm.isParticipant[expense.id] ng-model=\\\"::vm.balanceSheet.getParticipation({person: vm.person, expense: expense}).share\\\" ng-change=::vm.updateExpense(expense) ng-disabled=\\\"expense.settled || !vm.isParticipant[expense.id]\\\" ng-readonly=\\\"::expense.sharing != 'custom'\\\"/> </md-input-container> </div> <md-button hide-xs ng-href=#/expenses/{{::expense.id}} class=md-icon-button aria-label=\\\"{{::expense.name}} details\\\"> <md-icon md-svg-icon=ic_chevron_right_24px></md-icon> </md-button> </div> <div class=participation layout-xs=column layout-align-xs=\\\"center start\\\" layout-gt-xs=row layout-align-gt-xs=\\\"start center\\\"> <div layout-fill flex-gt-xs layout=row layout-align=\\\"start center\\\"> <span class=label>Total</span> <icon-button-strut hide-gt-xs></icon-button-strut> </div> <div layout=row layout-align=\\\"start center\\\"> <span class=currency-label ng-if=::vm.balanceSheet.currenciesEnabled()>{{::vm.person.computedCurrency()}}</span> <md-input-container> <label>Paid</label> <input type=number money-input ng-model=::vm.cost ng-readonly=true /> </md-input-container> <md-input-container> <label>Share</label> <input type=number money-input ng-model=::vm.sumOfShares ng-readonly=true /> </md-input-container> </div> <icon-button-strut hide-xs></icon-button-strut> </div> </div> </section> <section> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">Debts</md-subheader> <div layout=column> <div ng-switch=vm.debtRole class=margin-bottom> <span ng-switch-when=debtor>{{vm.person.name}} owes</span> <span ng-switch-when=creditor>{{vm.person.name}} is owed by</span> <span ng-switch-when=settled>{{vm.person.name}} is settled up</span> <span ng-switch-when=unbalanced>Debts cannot be computed. There are unbalanced expenses.</span> </div> <div ng-repeat=\\\"d in vm.debts\\\" class=\\\"margin-bottom margin-left-double\\\"> <span>{{d.person.name}}: {{d.currency}} {{d.amount | money}}</span> </div> <div ng-if=vm.debtComputationError class=margin-bottom> <md-icon class=md-warn md-svg-icon=ic_warning_24px></md-icon> {{vm.debtComputationError}} </div> </div> </section>\";\n\twindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\n\tmodule.exports = path;\n\n/***/ },\n/* 47 */\n/***/ function(module, exports) {\n\n\tvar path = 'persons/floating-button.html';\n\tvar html = \"<md-fab-speed-dial class=md-fab-bottom-right> <md-fab-trigger> <md-button ng-click=::vm.createExpense() aria-label=\\\"Create expense\\\" class=\\\"md-fab md-primary\\\"> <md-icon md-svg-icon=ic_shopping_basket_24px></md-icon> </md-button> </md-fab-trigger> </md-fab-speed-dial>\";\n\twindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\n\tmodule.exports = path;\n\n/***/ },\n/* 48 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tPersonDetailCtrl.$inject = [\"balanceSheetService\", \"debtService\", \"events\", \"debounce\", \"debtCalculationInterval\", \"$state\", \"$stateParams\", \"$mdDialog\", \"$scope\", \"$timeout\", \"$log\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar _ = __webpack_require__(25);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .controller(\"PersonDetailCtrl\", PersonDetailCtrl);\r\n\t\r\n\tfunction PersonDetailCtrl(balanceSheetService,\r\n\t                          debtService,\r\n\t                          events,\r\n\t                          debounce,\r\n\t                          debtCalculationInterval,\r\n\t                          $state,\r\n\t                          $stateParams,\r\n\t                          $mdDialog,\r\n\t                          $scope,\r\n\t                          $timeout,\r\n\t                          $log) {\r\n\t\r\n\t  var vm = this;\r\n\t  var confirmRemovePerson;\r\n\t\r\n\t  var computeDebtsDebounced = debounce(function() {\r\n\t    $timeout(function() {\r\n\t      try {\r\n\t        var debtResult = computeDebts();\r\n\t        vm.debtRole = debtResult.role;\r\n\t        vm.debts = debtResult.debts;\r\n\t        vm.debtComputationError = undefined;\r\n\t      } catch (e) {\r\n\t        $log.error(e);\r\n\t        vm.debtRole = undefined;\r\n\t        vm.debts = undefined;\r\n\t        vm.debtComputationError = \"Cannot compute debts\";\r\n\t      }\r\n\t    });\r\n\t  }, debtCalculationInterval);\r\n\t\r\n\t  vm.init = init;\r\n\t  vm.refresh = refresh;\r\n\t  vm.updateExpense = updateExpense;\r\n\t  vm.setParticipation = setParticipation;\r\n\t  vm.removePerson = removePerson;\r\n\t  vm.updatePerson = updatePerson;\r\n\t\r\n\t  init();\r\n\t\r\n\t  function init() {\r\n\t    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n\t    vm.person = vm.balanceSheet.getPerson($stateParams.id);\r\n\t\r\n\t    refresh();\r\n\t\r\n\t    confirmRemovePerson = $mdDialog.confirm()\r\n\t      .content(\"Really delete this person?\")\r\n\t      .ok(\"Ok\").cancel(\"Cancel\");\r\n\t\r\n\t    $scope.$on(events.BALANCE_SHEET_UPDATED, vm.refresh);\r\n\t  }\r\n\t\r\n\t  function refresh() {\r\n\t    vm.isParticipant = getParticipationMap();\r\n\t    vm.cost = vm.person.getCost();\r\n\t    vm.sumOfShares = vm.person.getSumOfShares();\r\n\t    vm.balance = vm.person.getBalance();\r\n\t    computeDebtsDebounced();\r\n\t  }\r\n\t\r\n\t  function getParticipationMap() {\r\n\t    var map = {};\r\n\t\r\n\t    _.forEach(vm.balanceSheet.expenses, function(expense) {\r\n\t      map[expense.id] = false;\r\n\t      _.forEach(vm.person.getParticipations(), function(pt) {\r\n\t        if (pt.expense.equals(expense)) {\r\n\t          map[expense.id] = true;\r\n\t        }\r\n\t      });\r\n\t    });\r\n\t\r\n\t    return map;\r\n\t  }\r\n\t\r\n\t  function updateExpense(expense) {\r\n\t    expense.shareCost();\r\n\t    refresh();\r\n\t    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n\t  }\r\n\t\r\n\t  function setParticipation(expense, isParticipant) {\r\n\t    if (isParticipant) {\r\n\t      vm.balanceSheet.createParticipation({expense: expense, person: vm.person});\r\n\t    } else {\r\n\t      vm.balanceSheet.removeParticipation({expense: expense, person: vm.person});\r\n\t    }\r\n\t    vm.updateExpense(expense);\r\n\t  }\r\n\t\r\n\t  function computeDebts() {\r\n\t    var result = {\r\n\t      role: undefined,\r\n\t      debts: undefined\r\n\t    };\r\n\t\r\n\t    if (!vm.balanceSheet.isBalanced()) {\r\n\t      result.role = \"unbalanced\";\r\n\t      return result;\r\n\t    }\r\n\t\r\n\t    if (vm.balance > 0) {\r\n\t      result.role = \"debtor\";\r\n\t    } else if (vm.balance < 0) {\r\n\t      result.role = \"creditor\";\r\n\t    } else if (vm.balance === 0) {\r\n\t      result.role = \"settled\";\r\n\t      return result;\r\n\t    }\r\n\t\r\n\t    var counterRole = {\r\n\t      \"debtor\": \"creditor\",\r\n\t      \"creditor\": \"debtor\"\r\n\t    };\r\n\t\r\n\t    var debts = debtService.computeDebts(vm.balanceSheet.getNonSettledParticipations(), vm.person.computedCurrency());\r\n\t    result.debts = _.chain(debts)\r\n\t      .filter(function(d) {\r\n\t        return d[result.role].equals(vm.person);\r\n\t      })\r\n\t      .map(function(d) {\r\n\t        return {person: d[counterRole[result.role]], amount: d.amount, currency: d.currency};\r\n\t      })\r\n\t      .value();\r\n\t\r\n\t    return result;\r\n\t  }\r\n\t\r\n\t  function removePerson() {\r\n\t    $mdDialog.show(confirmRemovePerson)\r\n\t      .then(doRemovePerson);\r\n\t  }\r\n\t\r\n\t  function doRemovePerson() {\r\n\t    vm.balanceSheet.removePerson(vm.person);\r\n\t    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n\t    $state.go(\"balanceSheet\");\r\n\t  }\r\n\t\r\n\t  function updatePerson() {\r\n\t    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n\t  }\r\n\t}\r\n\n\n/***/ },\n/* 49 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\topenCreatePersonDialog.$inject = [\"$mdDialog\"];\r\n\tDialogController.$inject = [\"$mdDialog\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar createPersonDialogTpl = __webpack_require__(50);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t.factory(\"openCreatePersonDialog\", openCreatePersonDialog);\r\n\t\r\n\t\r\n\tfunction openCreatePersonDialog($mdDialog) {\r\n\t  \r\n\t  return open;\r\n\t  \r\n\t  function open() {\r\n\t    return $mdDialog.show({\r\n\t      templateUrl: createPersonDialogTpl,\r\n\t      controller: DialogController,\r\n\t      controllerAs: \"vm\"\r\n\t    });\r\n\t  }\r\n\t  \r\n\t}\r\n\t\r\n\tfunction DialogController($mdDialog) {\r\n\t  var vm = this;\r\n\t  \r\n\t  vm.ok = ok;\r\n\t  vm.cancel = cancel;\r\n\t  vm.init = init;\r\n\t  \r\n\t  init();\r\n\t  \r\n\t  \r\n\t  function init() {\r\n\t    vm.person = {\r\n\t      name: undefined\r\n\t    };\r\n\t    vm.options = {\r\n\t      createParticipations: true\r\n\t    };\r\n\t  }\r\n\t\r\n\t  function ok() {\r\n\t    $mdDialog.hide({person: vm.person, options: vm.options});\r\n\t  }\r\n\t  \r\n\t  function cancel() {\r\n\t    $mdDialog.cancel();\r\n\t  }\r\n\t}\n\n/***/ },\n/* 50 */\n/***/ function(module, exports) {\n\n\tvar path = 'persons/create-person-dialog.html';\n\tvar html = \"<md-dialog aria-label=\\\"Create person dialog\\\"> <form name=form novalidate autocomplete=off> <md-dialog-content class=md-dialog-content> <h2 class=md-title>Create person</h2> <div layout=column> <md-input-container> <label>Name</label> <input type=text ng-model=vm.person.name ng-required=true md-autofocus/> </md-input-container> <md-checkbox ng-model=vm.options.createParticipations class=md-primary> Shares all expenses </md-checkbox> </div> </md-dialog-content> <md-dialog-actions> <md-button type=button ng-click=vm.cancel()>Cancel</md-button> <md-button type=submit class=md-primary ng-click=vm.ok() ng-disabled=!form.$valid>Ok</md-button> </md-dialog-actions> </form> </md-dialog> \";\n\twindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\n\tmodule.exports = path;\n\n/***/ },\n/* 51 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\t__webpack_require__(52);\r\n\t__webpack_require__(55);\r\n\t__webpack_require__(56);\n\n/***/ },\n/* 52 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tconfig.$inject = [\"$stateProvider\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar expenseDetailTpl = __webpack_require__(53);\r\n\tvar floatingButtonTpl = __webpack_require__(54);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t\t.config(config);\r\n\t\r\n\tfunction config($stateProvider) {\r\n\t\r\n\t\t$stateProvider\r\n\t\t\t.state(\"expense\", {\r\n\t\t\t\turl: \"/expenses/:id\",\r\n\t\t\t\tviews: {\r\n\t\t\t\t\t\"\": {\r\n\t\t\t\t\t\ttemplateUrl: expenseDetailTpl,\r\n\t\t\t\t\t\tcontroller: \"ExpenseDetailCtrl as vm\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"floatingButton\": {\r\n\t\t\t\t\t\ttemplateUrl: floatingButtonTpl\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t;\r\n\t}\n\n/***/ },\n/* 53 */\n/***/ function(module, exports) {\n\n\tvar path = 'expenses/expense-detail.html';\n\tvar html = \"<section layout=column> <div layout=row layout-align=\\\"start start\\\"> <md-input-container class=md-title flex md-no-float> <input type=text placeholder=\\\"Expense name\\\" ng-model=::vm.expense.name ng-change=::vm.updateExpense() ng-required=true /> </md-input-container> <md-button class=md-icon-button aria-label=delete ng-click=::vm.removeExpense()> <md-tooltip>Delete</md-tooltip> <md-icon md-svg-icon=ic_delete_24px></md-icon> </md-button> </div> <div layout=column> <div class=row layout=row layout-align=\\\"start center\\\"> <span flex aria-hidden=true>Date</span> <md-datepicker class=no-icon md-placeholder=Date ng-model=::vm.expense.date ng-change=::vm.updateExpense()></md-datepicker> </div> <div ng-if=::vm.balanceSheet.currenciesEnabled() class=row layout=row layout-align=\\\"start center\\\"> <span flex aria-hidden=true>Currency</span> <md-select id=currency aria-label=Currency class=\\\"no-margin margin-right\\\" ng-model=vm.expense.currency ng-change=::vm.updateExpense()> <md-option ng-value=::currency ng-repeat=\\\"currency in ::vm.balanceSheet.getCurrencies()\\\">{{::currency}}</md-option> </md-select> </div> <div class=row layout=row layout-align=\\\"start center\\\"> <span flex id=cost>Cost</span> <div aria-labelledby=cost class=margin-right> <span ng-if=::vm.balanceSheet.currenciesEnabled()>{{vm.expense.currency}}</span> {{vm.cost | money}} <span ng-if=\\\"vm.balanceSheet.currenciesEnabled() && vm.balanceSheet.currency !== vm.expense.computedCurrency()\\\"> ({{vm.balanceSheet.currency}} {{vm.expense.getCost(vm.balanceSheet.currency) | money}}) </span> </div> </div> <div class=row layout=row layout-align=\\\"start center\\\"> <span flex aria-hidden=true>Share equally</span> <md-switch ng-model=vm.expense.sharing ng-change=::vm.updateExpense() ng-disabled=vm.expense.settled ng-true-value=\\\"'equal'\\\" ng-false-value=\\\"'custom'\\\" id=sharing class=\\\"md-primary no-margin\\\" aria-label=\\\"Share equally\\\"> </md-switch> </div> <div class=row layout=row layout-align=\\\"start center\\\"> <span flex aria-hidden=true>Settled</span> <md-switch ng-model=vm.expense.settled ng-change=::vm.updateExpense() id=settled class=\\\"md-primary no-margin\\\" aria-label=Settled> </md-switch> </div> </div> </section> <section> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">People</md-subheader> <div layout=column> <div ng-repeat=\\\"person in vm.balanceSheet.persons\\\" class=participation layout-xs=column layout-align-xs=\\\"center start\\\" layout-gt-xs=row layout-align-gt-xs=\\\"start center\\\"> <div layout-fill flex-gt-xs class=participant layout=row layout-align=\\\"start center\\\"> <md-checkbox class=md-primary ng-model=::vm.isParticipant[person.id] ng-change=\\\"::vm.setParticipation(person, vm.isParticipant[person.id])\\\" ng-disabled=vm.expense.settled> {{::person.name}} </md-checkbox> <span flex></span> <md-button hide-gt-xs ng-href=#/persons/{{::person.id}} class=md-icon-button aria-label=\\\"{{::person.name}} details\\\"> <md-icon md-svg-icon=ic_chevron_right_24px></md-icon> </md-button> </div> <div layout=row layout-align=\\\"start center\\\"> <span class=currency-label ng-if=::vm.balanceSheet.currenciesEnabled()>{{vm.expense.currency}}</span> <md-input-container> <label>Paid</label> <input type=number money-input ng-required=::vm.isParticipant[person.id] ng-model=\\\"::vm.balanceSheet.getParticipation({person: person, expense: vm.expense}).paid\\\" ng-change=::vm.updateExpense() ng-disabled=\\\"vm.expense.settled || !vm.isParticipant[person.id]\\\"/> </md-input-container> <md-input-container> <label>Share</label> <input type=number money-input ng-required=::vm.isParticipant[person.id] ng-model=\\\"::vm.balanceSheet.getParticipation({person: person, expense: vm.expense}).share\\\" ng-change=::vm.updateExpense() ng-disabled=\\\"vm.expense.settled || !vm.isParticipant[person.id]\\\" ng-readonly=\\\"vm.expense.sharing != 'custom'\\\"/> </md-input-container> </div> <md-button hide-xs ng-href=#/persons/{{::person.id}} class=md-icon-button aria-label=\\\"{{::person.name}} details\\\"> <md-icon md-svg-icon=ic_chevron_right_24px></md-icon> </md-button> </div> <div class=participation layout-xs=column layout-align-xs=\\\"center start\\\" layout-gt-xs=row layout-align-gt-xs=\\\"start center\\\"> <div layout-fill flex-gt-xs layout=row layout-align=\\\"start center\\\"> <span ng-if=!vm.isBalanced style=color:red> <md-icon class=\\\"md-warn no-margin-left\\\" md-svg-icon=ic_warning_24px></md-icon>&nbsp;Unbalanced </span> <span ng-if=vm.isBalanced class=label>Total</span> <icon-button-strut hide-gt-xs></icon-button-strut> </div> <div layout=row layout-align=\\\"start center\\\"> <span class=currency-label ng-if=::vm.balanceSheet.currenciesEnabled()>{{vm.expense.currency}}</span> <md-input-container> <label>Paid</label> <input type=number money-input ng-model=::vm.cost ng-readonly=true /> </md-input-container> <md-input-container> <label>Share</label> <input type=number money-input ng-model=::vm.sumOfShares ng-readonly=true /> </md-input-container> </div> <icon-button-strut hide-xs></icon-button-strut> </div> </div> </section> <section> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">Debts</md-subheader> <div layout=column> <div ng-if=\\\"vm.debtsByDebtor.length > 0\\\"> <p ng-if=!vm.expense.settled>To settle this expense individually:</p> <div ng-if=vm.expense.settled> <p>This expense is settled. It does not affect total balances and debts.</p> <p>The debts from this expense were:</p> </div> <div ng-repeat=\\\"d in vm.debtsByDebtor\\\"> <p layout=column> <span class=margin-bottom>{{d.debtor.name}} owes </span> <span ng-repeat=\\\"c in d.debts\\\" class=\\\"margin-bottom margin-left-double\\\"> {{c.creditor.name}}: <span ng-if=::vm.balanceSheet.currenciesEnabled()>{{c.currency}}</span> {{c.amount | money}} </span> </p> </div> </div> <div ng-if=\\\"vm.debtsByDebtor.length == 0\\\"> <p>No debts!</p> </div> <div ng-if=!vm.isBalanced> <p>Cannot compute debts. Expense is not balanced.</p> </div> </div> </section>\";\n\twindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\n\tmodule.exports = path;\n\n/***/ },\n/* 54 */\n/***/ function(module, exports) {\n\n\tvar path = 'expenses/floating-button.html';\n\tvar html = \"<md-fab-speed-dial class=md-fab-bottom-right> <md-fab-trigger> <md-button ng-click=::vm.createPerson() aria-label=\\\"Create person\\\" class=\\\"md-fab md-primary\\\"> <md-icon md-svg-icon=ic_face_24px></md-icon> </md-button> </md-fab-trigger> </md-fab-speed-dial>\";\n\twindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\n\tmodule.exports = path;\n\n/***/ },\n/* 55 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tExpenseDetailCtrl.$inject = [\"balanceSheetService\", \"debtService\", \"events\", \"debounce\", \"debtCalculationInterval\", \"$mdDialog\", \"$stateParams\", \"$state\", \"$scope\", \"$timeout\"];\r\n\tvar angular = __webpack_require__(14);\r\n\t\r\n\tangular\r\n\t  .module(\"debtApp\")\r\n\t  .controller(\"ExpenseDetailCtrl\", ExpenseDetailCtrl);\r\n\t\r\n\tfunction ExpenseDetailCtrl(balanceSheetService,\r\n\t                           debtService,\r\n\t                           events,\r\n\t                           debounce,\r\n\t                           debtCalculationInterval,\r\n\t                           $mdDialog,\r\n\t                           $stateParams,\r\n\t                           $state,\r\n\t                           $scope,\r\n\t                           $timeout)\r\n\t{\r\n\t  var vm = this;\r\n\t\r\n\t  var confirmRemoveExpense = $mdDialog.confirm()\r\n\t    .content(\"Really delete this expense?\")\r\n\t    .ok(\"Ok\").cancel(\"Cancel\");\r\n\t\r\n\t  var computeDebtsDebounced = debounce(function() {\r\n\t    $timeout(function() {\r\n\t      vm.debtsByDebtor = computeDebts();\r\n\t    });\r\n\t  }, debtCalculationInterval);\r\n\t\r\n\t  vm.init = init;\r\n\t  vm.setParticipation = setParticipation;\r\n\t  vm.updateExpense = updateExpense;\r\n\t  vm.removeExpense = removeExpense;\r\n\t  vm.setCurrency = setCurrency;\r\n\t\r\n\t  init();\r\n\t\r\n\t  /////////////////////////////////////////////////////////////\r\n\t\r\n\t  function init() {\r\n\t    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n\t    vm.expense = vm.balanceSheet.getExpense($stateParams.id);\r\n\t    vm.isParticipant = {};\r\n\t    vm.everyoneParticipates = true;\r\n\t    updateExpense();\r\n\t\r\n\t    $scope.$on(events.BALANCE_SHEET_UPDATED, function(event) {\r\n\t      if (event.targetScope != $scope) {\r\n\t        vm.updateExpense();\r\n\t      }\r\n\t    });\r\n\t  }\r\n\t\r\n\t  function updateExpense() {\r\n\t    vm.expense.shareCost();\r\n\t    vm.isParticipant = getParticipationMap();\r\n\t    vm.cost = vm.expense.getCost();\r\n\t    vm.sumOfShares = vm.expense.getSumOfShares();\r\n\t    vm.isBalanced = vm.expense.isBalanced();\r\n\t    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n\t    computeDebtsDebounced();\r\n\t  }\r\n\t\r\n\t  function getParticipationMap() {\r\n\t    var map = {};\r\n\t\r\n\t    angular.forEach(vm.balanceSheet.persons, function(person) {\r\n\t      map[person.id] = false;\r\n\t      angular.forEach(vm.expense.getParticipations(), function(p) {\r\n\t        if (p.person.equals(person)) {\r\n\t          map[person.id] = true;\r\n\t        }\r\n\t      });\r\n\t    });\r\n\t\r\n\t    return map;\r\n\t  }\r\n\t\r\n\t  function setParticipation(person, isParticipant) {\r\n\t    if (isParticipant) {\r\n\t      vm.balanceSheet.createParticipation({expense: vm.expense, person: person});\r\n\t    } else {\r\n\t      vm.balanceSheet.removeParticipation({expense: vm.expense, person: person});\r\n\t    }\r\n\t    updateExpense();\r\n\t  }\r\n\t\r\n\t  function removeExpense() {\r\n\t    $mdDialog.show(confirmRemoveExpense)\r\n\t      .then(doRemoveExpense);\r\n\t  }\r\n\t\r\n\t  function doRemoveExpense() {\r\n\t    vm.balanceSheet.removeExpense(vm.expense);\r\n\t    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n\t    $state.go(\"balanceSheet\");\r\n\t  }\r\n\t\r\n\t  function computeDebts() {\r\n\t    if (vm.expense.isBalanced()) {\r\n\t      var debts = debtService.computeDebts(vm.expense.getParticipations(), vm.expense.computedCurrency());\r\n\t      return debtService.organizeByDebtor(debts);\r\n\t    }\r\n\t  }\r\n\t\r\n\t  function setCurrency(currency) {\r\n\t    vm.expense.currency = currency;\r\n\t    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n\t  }\r\n\t\r\n\t\r\n\t}\r\n\n\n/***/ },\n/* 56 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\topenCreateExpenseDialog.$inject = [\"$mdDialog\"];\r\n\tDialogController.$inject = [\"$mdDialog\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar createExpenseDialogTpl = __webpack_require__(57);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t.factory(\"openCreateExpenseDialog\", openCreateExpenseDialog);\r\n\t\r\n\t\r\n\tfunction openCreateExpenseDialog($mdDialog) {\r\n\t  \r\n\t  return open;\r\n\t  \r\n\t  function open() {\r\n\t    return $mdDialog.show({\r\n\t      templateUrl: createExpenseDialogTpl,\r\n\t      controller: DialogController,\r\n\t      controllerAs: \"vm\"\r\n\t    });\r\n\t  }\r\n\t  \r\n\t}\r\n\t\r\n\tfunction DialogController($mdDialog) {\r\n\t  var vm = this;\r\n\t  \r\n\t  vm.ok = ok;\r\n\t  vm.cancel = cancel;\r\n\t  vm.init = init;\r\n\t  \r\n\t  init();\r\n\t  \r\n\t  \r\n\t  function init() {\r\n\t    vm.expense = {\r\n\t      name: undefined,\r\n\t      sharing: \"equal\"\r\n\t    };\r\n\t    vm.options = {\r\n\t      createParticipations: true\r\n\t    };\r\n\t  }\r\n\t\r\n\t  function ok() {\r\n\t    $mdDialog.hide({expense: vm.expense, options: vm.options});\r\n\t  }\r\n\t  \r\n\t  function cancel() {\r\n\t    $mdDialog.cancel();\r\n\t  }\r\n\t}\n\n/***/ },\n/* 57 */\n/***/ function(module, exports) {\n\n\tvar path = 'expenses/create-expense-dialog.html';\n\tvar html = \"<md-dialog aria-label=\\\"Create expense dialog\\\"> <form name=form novalidate autocomplete=off> <md-dialog-content class=md-dialog-content> <h2 class=md-title>Create expense</h2> <div layout=column> <md-input-container> <label>Name</label> <input type=text ng-model=vm.expense.name ng-required=true md-autofocus/> </md-input-container> <md-checkbox ng-model=vm.options.createParticipations class=md-primary> Everyone participates </md-checkbox> </div> </md-dialog-content> <md-dialog-actions> <md-button type=button ng-click=vm.cancel()>Cancel</md-button> <md-button type=submit class=md-primary ng-click=vm.ok() ng-disabled=!form.$valid>Ok</md-button> </md-dialog-actions> </form> </md-dialog> \";\n\twindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\n\tmodule.exports = path;\n\n/***/ },\n/* 58 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\t__webpack_require__(59);\r\n\t__webpack_require__(60);\r\n\t__webpack_require__(61);\r\n\t__webpack_require__(62);\r\n\t__webpack_require__(67);\r\n\t__webpack_require__(68);\n\n/***/ },\n/* 59 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tmoneyInput.$inject = [\"$filter\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar Decimal = __webpack_require__(33);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .directive(\"moneyInput\", moneyInput);\r\n\t\r\n\t\r\n\tfunction moneyInput($filter) {\r\n\t  return {\r\n\t    restrict: \"A\",\r\n\t    require: \"ngModel\",\r\n\t    link: link\r\n\t  };\r\n\t\r\n\t  function link($scope, iElem, iAttrs, ngModel) {\r\n\t    ngModel.$validators.money = validateMoney;\r\n\t    ngModel.$parsers.push(parseMoney);\r\n\t    ngModel.$formatters.unshift(formatMoney);\r\n\t\r\n\t    iElem.on(\"blur\", handleBlur);\r\n\t    ngModel.$render = render;\r\n\t\r\n\t    function render() {\r\n\t      if (ngModel.$valid) {\r\n\t        iElem.val(formatMoney(ngModel.$modelValue));\r\n\t      } else {\r\n\t        iElem.val(ngModel.$viewValue);\r\n\t      }\r\n\t    }\r\n\t\r\n\t    function handleBlur() {\r\n\t      ngModel.$render();\r\n\t    }\r\n\t  }\r\n\t\r\n\t  function validateMoney(value) {\r\n\t    if (value < 0) {\r\n\t      return false;\r\n\t    } else {\r\n\t      return true;\r\n\t    }\r\n\t  }\r\n\t\r\n\t  function formatMoney(value) {\r\n\t    if (value === undefined || value === null) {\r\n\t      return \"\";\r\n\t    } else {\r\n\t      return $filter(\"number\")(value, 2);\r\n\t    }\r\n\t  }\r\n\t\r\n\t  function parseMoney(value) {\r\n\t    return new Decimal(value).toNumber();\r\n\t  }\r\n\t\r\n\t}\r\n\n\n/***/ },\n/* 60 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tbalance.$inject = [\"$filter\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar _ = __webpack_require__(25);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .filter(\"balance\", balance);\r\n\t\r\n\t\r\n\tfunction balance($filter) {\r\n\t  return function balance(value) {\r\n\t    if (!_.isNumber(value) || isNaN(value)) {\r\n\t      return value;\r\n\t    }\r\n\t\r\n\t    if (value > 0) {\r\n\t      return \"+\" + $filter(\"number\")(value, \"2\");\r\n\t    } else {\r\n\t      return $filter(\"number\")(value, \"2\");\r\n\t    }\r\n\t  };\r\n\t}\n\n/***/ },\n/* 61 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tmoney.$inject = [\"$filter\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar _ = __webpack_require__(25);\r\n\t\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .filter(\"money\", money);\r\n\t\r\n\t\r\n\tfunction money($filter) {\r\n\t  return function money(value) {\r\n\t    if (!_.isNumber(value) || isNaN(value)) {\r\n\t      return value;\r\n\t    }\r\n\t\r\n\t    return $filter(\"number\")(value, \"2\");\r\n\t  };\r\n\t}\n\n/***/ },\n/* 62 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tfileService.$inject = [\"$q\", \"$window\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar fileSaver = __webpack_require__(63);\r\n\t__webpack_require__(66);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .factory(\"fileService\", fileService);\r\n\t\r\n\t\r\n\tfunction fileService($q, $window) {\r\n\t\r\n\t  return {\r\n\t    readAsText: readAsText,\r\n\t    saveAsFile: saveAsFile,\r\n\t    isSupported: isSupported\r\n\t  };\r\n\t\r\n\t  function readAsText(blob) {\r\n\t    var deferred = $q.defer();\r\n\t\r\n\t    var reader = new $window.FileReader();\r\n\t    reader.onload = function() {\r\n\t      deferred.resolve(reader.result);\r\n\t    };\r\n\t    reader.onerror = function() {\r\n\t      deferred.resolve(reader.error);\r\n\t    };\r\n\t    reader.readAsText(blob);\r\n\t\r\n\t    return deferred.promise;\r\n\t  }\r\n\t\r\n\t  function saveAsFile(dataArray, fileName) {\r\n\t    var blob = new $window.Blob(dataArray, {});\r\n\t    fileSaver.saveAs(blob, fileName);\r\n\t  }\r\n\t\r\n\t  function isSupported() {\r\n\t    return $window.FileReader && $window.Blob;\r\n\t  }\r\n\t}\n\n/***/ },\n/* 63 */,\n/* 64 */,\n/* 65 */,\n/* 66 */,\n/* 67 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tfocus.$inject = [\"$timeout\"];\r\n\tvar angular = __webpack_require__(14);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .directive(\"focus\", focus);\r\n\t\r\n\t\r\n\tfunction focus($timeout) {\r\n\t  return {\r\n\t    restrict: \"A\",\r\n\t    link: function($scope, iElem, iAttrs) {\r\n\t      var focusExpr = iAttrs.focus || 'true';\r\n\t      $timeout(function() {\r\n\t        var shouldFocus = $scope.$eval(focusExpr);\r\n\t        if (shouldFocus) {\r\n\t          iElem[0].focus();\r\n\t        }\r\n\t      }, 0);\r\n\t    }\r\n\t  };\r\n\t}\n\n/***/ },\n/* 68 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tdebounceFactory.$inject = [\"$timeout\"];\r\n\tvar angular = __webpack_require__(14);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .factory(\"debounce\", debounceFactory);\r\n\t\r\n\t\r\n\tfunction debounceFactory($timeout) {\r\n\t\r\n\t  return debounce;\r\n\t\r\n\t  /**\r\n\t   * Returns a function, that, as long as it continues to be invoked, will not be triggered.\r\n\t   * The function will be called after it stops being called for N milliseconds.\r\n\t   *\r\n\t   * @param {function} func - The function to \"debouncify\"\r\n\t   * @param {number} [wait=10] - The time to wait (milliseconds) after the last call until func is called\r\n\t   * @param {Scope} [scope] - Angular scope to call the function in\r\n\t   * @param {boolean} [invokeApply=false] - Should the function call trigger $digest\r\n\t   * @returns {function} - The debounced function\r\n\t   */\r\n\t  function debounce(func, wait, scope, invokeApply) {\r\n\t    var timer;\r\n\t\r\n\t    return function debounced() {\r\n\t      var context = scope,\r\n\t        args = Array.prototype.slice.call(arguments);\r\n\t\r\n\t      $timeout.cancel(timer);\r\n\t      timer = $timeout(function() {\r\n\t\r\n\t        timer = undefined;\r\n\t        func.apply(context, args);\r\n\t\r\n\t      }, wait || 10, invokeApply);\r\n\t    };\r\n\t  }\r\n\t\r\n\t}\r\n\t\r\n\t\r\n\n\n/***/ },\n/* 69 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\t__webpack_require__(70);\r\n\t__webpack_require__(73);\n\n/***/ },\n/* 70 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tconfig.$inject = [\"$stateProvider\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar currenciesTpl = __webpack_require__(71);\r\n\tvar floatingButtonTpl = __webpack_require__(72);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .config(config);\r\n\t\r\n\tfunction config($stateProvider) {\r\n\t\r\n\t  $stateProvider\r\n\t    .state(\"currencies\", {\r\n\t      url: \"/currencies\",\r\n\t      views: {\r\n\t        \"\": {\r\n\t          controller: \"CurrencyListCtrl as vm\",\r\n\t          templateUrl: currenciesTpl\r\n\t        },\r\n\t        \"floatingButton\": {\r\n\t          controller: \"CurrencyListCtrl as vm\",\r\n\t          templateUrl: floatingButtonTpl\r\n\t        }\r\n\t      }\r\n\t    })\r\n\t  ;\r\n\t  \r\n\t}\n\n/***/ },\n/* 71 */\n/***/ function(module, exports) {\n\n\tvar path = 'currencies/currencies.html';\n\tvar html = \"<section> <div ng-repeat=\\\"quotation in vm.exchangeRates\\\" class=exchange-rate layout=row layout-align=\\\"start center\\\"> <span flex-xs=66 flex=33>{{::quotation.fixed}} to {{::quotation.variable}}</span> <md-input-container md-no-float> <input type=number placeholder=Rate ng-model=::quotation.rate ng-change=::vm.updateExchangeRate(quotation) required min=0.0001 /> </md-input-container> <span flex></span> <md-button class=md-icon-button ng-click=::vm.removeExchangeRate(quotation)> <md-icon aria-label=Remove md-svg-icon=ic_delete_24px></md-icon> </md-button> </div> <p ng-if=\\\"!vm.exchangeRates || vm.exchangeRates.length == 0\\\"> Enable currencies by adding an exchange rate. Click the floating button below. </p> </section> \";\n\twindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\n\tmodule.exports = path;\n\n/***/ },\n/* 72 */\n/***/ function(module, exports) {\n\n\tvar path = 'currencies/floating-button.html';\n\tvar html = \"<md-fab-speed-dial class=md-fab-bottom-right> <md-fab-trigger> <md-button ng-click=::vm.openExchangeRateDialog() aria-label=\\\"Add exchange rate\\\" class=\\\"md-fab md-primary\\\"> <md-icon md-svg-icon=ic_attach_money_24px></md-icon> </md-button> </md-fab-trigger> </md-fab-speed-dial>\";\n\twindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\n\tmodule.exports = path;\n\n/***/ },\n/* 73 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t\r\n\tCurrencyListCtrl.$inject = [\"balanceSheetService\", \"events\", \"$scope\", \"$mdDialog\", \"debounce\", \"$log\"];\r\n\tExchangeRateDialogCtrl.$inject = [\"$mdDialog\"];\r\n\tvar angular = __webpack_require__(14);\r\n\tvar _ = __webpack_require__(25);\r\n\t\r\n\tangular.module(\"debtApp\")\r\n\t  .controller(\"CurrencyListCtrl\", CurrencyListCtrl)\r\n\t  .controller(\"ExchangeRateDialogCtrl\", ExchangeRateDialogCtrl);\r\n\t\r\n\t\r\n\tfunction CurrencyListCtrl(balanceSheetService, events, $scope, $mdDialog, debounce, $log) {\r\n\t  var vm = this;\r\n\t\r\n\t  vm.init = init;\r\n\t  vm.openExchangeRateDialog = openExchangeRateDialog;\r\n\t  vm.updateExchangeRate = updateExchangeRate;\r\n\t  vm.removeExchangeRate = removeExchangeRate;\r\n\t\r\n\t  init();\r\n\t\r\n\t  function init() {\r\n\t    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n\t    \r\n\t    refresh();\r\n\t\r\n\t    // Workaround to allow FAB for creating an exchange rate to reside\r\n\t    // in a different scope (for layout).\r\n\t    $scope.$watch(function() {\r\n\t      return balanceSheetService.balanceSheet.getExchangeRates();\r\n\t    }, debounce(refresh, 50), true);\r\n\t  }\r\n\t\r\n\t  function refresh() {\r\n\t    vm.exchangeRates = balanceSheetService.balanceSheet.getExchangeRates();\r\n\t  }\r\n\t\r\n\t  function openExchangeRateDialog() {\r\n\t\r\n\t    return $mdDialog.show({\r\n\t      templateUrl: \"currencies/exchange-rate-dialog.html\",\r\n\t      controller: \"ExchangeRateDialogCtrl as vm\"\r\n\t    }).then(function(quotation) {\r\n\t      updateExchangeRate(quotation);\r\n\t    });\r\n\t\r\n\t  }\r\n\t\r\n\t  function updateExchangeRate(exchangeRate) {\r\n\t    try {\r\n\t      balanceSheetService.balanceSheet.addOrUpdateExchangeRate(exchangeRate);\r\n\t      $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n\t      refresh();\r\n\t    } catch (e) {\r\n\t      $log.error(e);\r\n\t    }\r\n\t  }\r\n\t\r\n\t  function removeExchangeRate(exchangeRate) {\r\n\t    balanceSheetService.balanceSheet.removeExchangeRate(exchangeRate);\r\n\t    _.remove(vm.exchangeRates, exchangeRate);\r\n\t    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n\t    refresh();\r\n\t  }\r\n\t\r\n\t}\r\n\t\r\n\tfunction ExchangeRateDialogCtrl($mdDialog) {\r\n\t  var vm = this;\r\n\t\r\n\t  vm.ok = ok;\r\n\t  vm.cancel = cancel;\r\n\t  vm.init = init;\r\n\t\r\n\t  init();\r\n\t\r\n\t  function init() {\r\n\t    vm.quotation = {};\r\n\t  }\r\n\t\r\n\t  function ok() {\r\n\t    $mdDialog.hide(vm.quotation);\r\n\t  }\r\n\t\r\n\t  function cancel() {\r\n\t    $mdDialog.cancel();\r\n\t  }\r\n\t\r\n\t}\n\n/***/ },\n/* 74 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar map = {\n\t\t\"./ic_add_24px.svg\": 75,\n\t\t\"./ic_attach_money_24px.svg\": 76,\n\t\t\"./ic_chevron_right_24px.svg\": 77,\n\t\t\"./ic_close_24px.svg\": 78,\n\t\t\"./ic_delete_24px.svg\": 79,\n\t\t\"./ic_face_24px.svg\": 80,\n\t\t\"./ic_home_24px.svg\": 81,\n\t\t\"./ic_more_vert_24px.svg\": 82,\n\t\t\"./ic_shopping_basket_24px.svg\": 83,\n\t\t\"./ic_warning_24px.svg\": 84\n\t};\n\tfunction webpackContext(req) {\n\t\treturn __webpack_require__(webpackContextResolve(req));\n\t};\n\tfunction webpackContextResolve(req) {\n\t\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n\t};\n\twebpackContext.keys = function webpackContextKeys() {\n\t\treturn Object.keys(map);\n\t};\n\twebpackContext.resolve = webpackContextResolve;\n\tmodule.exports = webpackContext;\n\twebpackContext.id = 74;\n\n\n/***/ },\n/* 75 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTkgMTNoLTZ2NmgtMnYtNkg1di0yaDZWNWgydjZoNnYyeiIvPjwvc3ZnPg==\"\n\n/***/ },\n/* 76 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTEuOCAxMC45Yy0yLjI3LS41OS0zLTEuMi0zLTIuMTUgMC0xLjA5IDEuMDEtMS44NSAyLjctMS44NSAxLjc4IDAgMi40NC44NSAyLjUgMi4xaDIuMjFjLS4wNy0xLjcyLTEuMTItMy4zLTMuMjEtMy44MVYzaC0zdjIuMTZjLTEuOTQuNDItMy41IDEuNjgtMy41IDMuNjEgMCAyLjMxIDEuOTEgMy40NiA0LjcgNC4xMyAyLjUuNiAzIDEuNDggMyAyLjQxIDAgLjY5LS40OSAxLjc5LTIuNyAxLjc5LTIuMDYgMC0yLjg3LS45Mi0yLjk4LTIuMWgtMi4yYy4xMiAyLjE5IDEuNzYgMy40MiAzLjY4IDMuODNWMjFoM3YtMi4xNWMxLjk1LS4zNyAzLjUtMS41IDMuNS0zLjU1IDAtMi44NC0yLjQzLTMuODEtNC43LTQuNHoiLz48L3N2Zz4=\"\n\n/***/ },\n/* 77 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTAgNkw4LjU5IDcuNDEgMTMuMTcgMTJsLTQuNTggNC41OUwxMCAxOGw2LTZ6Ii8+PC9zdmc+\"\n\n/***/ },\n/* 78 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjwvc3ZnPg==\"\n\n/***/ },\n/* 79 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNNiAxOWMwIDEuMS45IDIgMiAyaDhjMS4xIDAgMi0uOSAyLTJWN0g2djEyek0xOSA0aC0zLjVsLTEtMWgtNWwtMSAxSDV2MmgxNFY0eiIvPjwvc3ZnPg==\"\n\n/***/ },\n/* 80 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNOSAxMS43NWMtLjY5IDAtMS4yNS41Ni0xLjI1IDEuMjVzLjU2IDEuMjUgMS4yNSAxLjI1IDEuMjUtLjU2IDEuMjUtMS4yNS0uNTYtMS4yNS0xLjI1LTEuMjV6bTYgMGMtLjY5IDAtMS4yNS41Ni0xLjI1IDEuMjVzLjU2IDEuMjUgMS4yNSAxLjI1IDEuMjUtLjU2IDEuMjUtMS4yNS0uNTYtMS4yNS0xLjI1LTEuMjV6TTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgMThjLTQuNDEgMC04LTMuNTktOC04IDAtLjI5LjAyLS41OC4wNS0uODYgMi4zNi0xLjA1IDQuMjMtMi45OCA1LjIxLTUuMzdDMTEuMDcgOC4zMyAxNC4wNSAxMCAxNy40MiAxMGMuNzggMCAxLjUzLS4wOSAyLjI1LS4yNi4yMS43MS4zMyAxLjQ3LjMzIDIuMjYgMCA0LjQxLTMuNTkgOC04IDh6Ii8+PC9zdmc+\"\n\n/***/ },\n/* 81 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTAgMjB2LTZoNHY2aDV2LThoM0wxMiAzIDIgMTJoM3Y4eiIvPjwvc3ZnPg==\"\n\n/***/ },\n/* 82 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTIgOGMxLjEgMCAyLS45IDItMnMtLjktMi0yLTItMiAuOS0yIDIgLjkgMiAyIDJ6bTAgMmMtMS4xIDAtMiAuOS0yIDJzLjkgMiAyIDIgMi0uOSAyLTItLjktMi0yLTJ6bTAgNmMtMS4xIDAtMiAuOS0yIDJzLjkgMiAyIDIgMi0uOSAyLTItLjktMi0yLTJ6Ii8+PC9zdmc+\"\n\n/***/ },\n/* 83 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTcuMjEgOWwtNC4zOC02LjU2Yy0uMTktLjI4LS41MS0uNDItLjgzLS40Mi0uMzIgMC0uNjQuMTQtLjgzLjQzTDYuNzkgOUgyYy0uNTUgMC0xIC40NS0xIDEgMCAuMDkuMDEuMTguMDQuMjdsMi41NCA5LjI3Yy4yMy44NCAxIDEuNDYgMS45MiAxLjQ2aDEzYy45MiAwIDEuNjktLjYyIDEuOTMtMS40NmwyLjU0LTkuMjdMMjMgMTBjMC0uNTUtLjQ1LTEtMS0xaC00Ljc5ek05IDlsMy00LjRMMTUgOUg5em0zIDhjLTEuMSAwLTItLjktMi0ycy45LTIgMi0yIDIgLjkgMiAyLS45IDItMiAyeiIvPjwvc3ZnPg==\"\n\n/***/ },\n/* 84 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMSAyMWgyMkwxMiAyIDEgMjF6bTEyLTNoLTJ2LTJoMnYyem0wLTRoLTJ2LTRoMnY0eiIvPjwvc3ZnPg==\"\n\n/***/ }\n]);\n\n\n// WEBPACK FOOTER //\n// debt.cd037e84f17fb3115b88.js","\"use strict\";\r\n\r\nrequire(\"angular-material/angular-material.css\");\r\nrequire(\"../resources/debt.css\");\r\n\r\nrequire(\"./appcache-reload\");\r\n\r\nvar angular = require(\"angular\");\r\nrequire(\"angular-material\");\r\nrequire(\"angular-ui-router\");\r\nrequire(\"angular-local-storage\");\r\nrequire(\"ng-file-upload\");\r\n\r\nvar _ = require(\"lodash\");\r\n\r\nangular\r\n  .module(\"debtApp\", [\"ngMaterial\", \"ui.router\", \"LocalStorageModule\", \"ngFileUpload\"])\r\n  .constant(\"events\", {\r\n    BALANCE_SHEET_UPDATED: \"balance sheet updated\",\r\n    ERROR: \"error\"\r\n  })\r\n  .constant(\"debtCalculationInterval\", 500)\r\n  .config(configureLocalStorage)\r\n  .config(configureIcons)\r\n  .config(hrefSanitization)\r\n  .config(decorateExceptionHandler)\r\n  .run(makeStateAvailableInScope)\r\n  .run(makeMdMediaAvailableInScope)\r\n;\r\n\r\nrequire(\"./debt-app-ctrl\");\r\nrequire(\"./route-config\");\r\nrequire(\"./debts\");\r\nrequire(\"./balance-sheet\");\r\nrequire(\"./persons\");\r\nrequire(\"./expenses\");\r\nrequire(\"./utils\");\r\nrequire(\"./currencies\");\r\n\r\nfunction configureIcons($mdIconProvider) {\r\n  var iconFiles = [\r\n    'ic_add_24px.svg',\r\n    'ic_attach_money_24px.svg',\r\n    'ic_chevron_right_24px.svg',\r\n    'ic_close_24px.svg',\r\n    'ic_delete_24px.svg',\r\n    'ic_face_24px.svg',\r\n    'ic_home_24px.svg',\r\n    'ic_more_vert_24px.svg',\r\n    'ic_shopping_basket_24px.svg',\r\n    'ic_warning_24px.svg'\r\n  ];\r\n  var iconProps = _.map(iconFiles, function(fileName) {\r\n    var iconName = fileName.substr(0, fileName.indexOf('.'));\r\n    return {\r\n      filePath: require('../resources/icons/' + fileName),\r\n      iconName: iconName\r\n    };\r\n  });\r\n\r\n  _.each(iconProps, function(prop) {\r\n    $mdIconProvider.icon(prop.iconName, prop.filePath);\r\n  });\r\n}\r\n\r\n\r\nfunction configureLocalStorage(localStorageServiceProvider) {\r\n  localStorageServiceProvider.setPrefix(\"debtApp\");\r\n}\r\n\r\n\r\nfunction hrefSanitization($compileProvider) {\r\n  $compileProvider.aHrefSanitizationWhitelist(/^(blob||https?):/);\r\n}\r\n\r\n\r\nvar CurrencyConversionError = require(\"./balance-sheet/currency-conversion-error\");\r\nfunction decorateExceptionHandler($provide, events) {\r\n  $provide.decorator('$exceptionHandler', function($delegate, $log, $injector) {\r\n    return function(exception, cause) {\r\n      $delegate(exception, cause);\r\n\r\n      var $rootScope = $injector.get('$rootScope');\r\n      $rootScope.$broadcast(events.ERROR, exception, cause);\r\n\r\n      if (exception instanceof CurrencyConversionError) {\r\n        var $state = $injector.get('$state');\r\n        $state.go(\"currencies\");\r\n      }\r\n\r\n    };\r\n  });\r\n}\r\n\r\n// Injection of $state may trigger a GET, which can show as an \r\n// \"Unexpected request\" error in your test. Workaround is to \r\n// $provide a mock $state to Angular.\r\nfunction makeStateAvailableInScope($rootScope, $state, $stateParams) {\r\n  $rootScope.$state = $state;\r\n  $rootScope.$stateParams = $stateParams;\r\n}\r\n\r\nfunction makeMdMediaAvailableInScope($rootScope, $mdMedia) {\r\n  $rootScope.$mdMedia = $mdMedia;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/debt.js","window.addEventListener('load', function() {\r\n  window.applicationCache.addEventListener('updateready', function() {\r\n    window.location.reload();\r\n  }, false);\r\n}, false);\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/appcache-reload.js\n// module id = 13\n// module chunks = 0","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar _ = require(\"lodash\");\r\n\r\nangular.module(\"debtApp\")\r\n  .constant(\"balanceSheetSaveInterval\", 500)\r\n  .controller(\"DebtAppCtrl\", DebtAppCtrl);\r\n\r\nfunction DebtAppCtrl(balanceSheetService,\r\n                     debounce,\r\n                     balanceSheetSaveInterval,\r\n                     openCreatePersonDialog,\r\n                     openCreateExpenseDialog,\r\n                     fileService,\r\n                     events,\r\n                     $mdDialog,\r\n                     $state,\r\n                     $scope,\r\n                     $log) {\r\n\r\n  var vm = this;\r\n\r\n  vm.init = init;\r\n  vm.createPerson = createPerson;\r\n  vm.createExpense = createExpense;\r\n  vm.createNewSheet = createNewSheet;\r\n  vm.loadSheet = loadSheet;\r\n  vm.exportSheet = exportSheet;\r\n  vm.balanceSheetUpdated = balanceSheetUpdated;\r\n  vm.showHelp = showHelp;\r\n\r\n  var confirmCreateNewSheet = $mdDialog.confirm()\r\n    .title(\"Create new sheet\")\r\n    .content(\"The current sheet will be discarded. Please consider exporting it first. Continue?\")\r\n    .ok(\"Ok\").cancel(\"Cancel\");\r\n\r\n  init();\r\n\r\n  /////////////////////////////////////////////////////////////\r\n\r\n  function init() {\r\n    $scope.$on(events.BALANCE_SHEET_UPDATED, debounce(function() {\r\n      vm.balanceSheetUpdated();\r\n    }), balanceSheetSaveInterval, $scope, true);\r\n    $scope.$on(events.ERROR, handleErrorEvent);\r\n    balanceSheetService.init();\r\n    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n    findExpensesWithInvalidCurrencies();\r\n  }\r\n\r\n  function balanceSheetUpdated() {\r\n    vm.errorMessage = undefined;\r\n    tryToSave();\r\n    findExpensesWithInvalidCurrencies();\r\n  }\r\n\r\n  function tryToSave() {\r\n    try {\r\n      balanceSheetService.save();\r\n    } catch (e) {\r\n      $log.error(e);\r\n      vm.errorMessage = \"Cannot save: \" + e.message;\r\n    }\r\n  }\r\n\r\n  function findExpensesWithInvalidCurrencies() {\r\n    var nonConvertible = vm.balanceSheet.getNonConvertibleCurrencies(vm.balanceSheet.getExpenseCurrencies(), vm.balanceSheet.currency);\r\n\r\n    if (nonConvertible.length === 0 || vm.errorMessage) {\r\n      return;\r\n    }\r\n    var messageTemplate = _.template(\"Cannot convert <%= currencyWord %> <%= currencyList %> to balance sheet's currency <%= balanceSheetCurrency %>\");\r\n\r\n    var data = {\r\n      currencyWord: nonConvertible.length == 1 ? \"currency\" : \"currencies\",\r\n      currencyList: \"\",\r\n      balanceSheetCurrency: \"'\" + vm.balanceSheet.currency + \"'\"\r\n    };\r\n\r\n    _.each(nonConvertible, function(c, index) {\r\n      data.currencyList = data.currencyList + (index > 0 ? \", \" : \"\") + \"'\" + c + \"'\";\r\n    });\r\n\r\n    vm.errorMessage = messageTemplate(data);\r\n  }\r\n\r\n  function handleErrorEvent(event, error) {\r\n    vm.errorMessage = error.message;\r\n  }\r\n\r\n  function createPerson() {\r\n    openCreatePersonDialog()\r\n      .then(function(dialogResult) {\r\n        balanceSheetService.balanceSheet.createPerson(dialogResult.person, dialogResult.options);\r\n        vm.balanceSheetUpdated();\r\n        $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n      });\r\n  }\r\n\r\n  function createExpense() {\r\n    openCreateExpenseDialog()\r\n      .then(function(dialogResult) {\r\n        balanceSheetService.balanceSheet.createExpense(dialogResult.expense, dialogResult.options);\r\n        vm.balanceSheetUpdated();\r\n        $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n      });\r\n  }\r\n\r\n  function createNewSheet() {\r\n    $mdDialog.show(confirmCreateNewSheet)\r\n      .then(function() {\r\n        balanceSheetService.createNew();\r\n        vm.balanceSheetUpdated();\r\n        $state.go(\"balanceSheet\");\r\n        $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n      });\r\n  }\r\n\r\n  function loadSheet(files) {\r\n    if (!files || !files.length) return;\r\n\r\n    if (!fileService.isSupported()) {\r\n      vm.errorMessage = \"File operations not supported in this browser. Please consider a more modern browser.\";\r\n      return;\r\n    }\r\n\r\n    var file = files[0];\r\n    fileService.readAsText(file)\r\n      .then(function(result) {\r\n        loadSheetFromJson(result);\r\n      })\r\n      .catch(function(e) {\r\n        $log.error(e);\r\n        vm.errorMessage = \"Unable to read file\";\r\n      });\r\n  }\r\n\r\n  function loadSheetFromJson(json) {\r\n    balanceSheetService.loadFromJson(json);\r\n    vm.balanceSheetUpdated();\r\n    $state.go(\"balanceSheet\");\r\n    $scope.$broadcast(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n\r\n  function exportSheet() {\r\n    if (!fileService.isSupported()) {\r\n      vm.errorMessage = \"File operations not supported in this browser. Please consider a more modern browser.\";\r\n      return;\r\n    }\r\n\r\n    var json = balanceSheetService.exportToJson();\r\n    try {\r\n      fileService.saveAsFile([json], balanceSheetService.balanceSheet.name + \".txt\");\r\n    } catch (e) {\r\n      $log.error(e);\r\n      vm.errorMessage = \"Error when saving file\";\r\n    }\r\n  }\r\n\r\n  function showHelp() {\r\n    $mdDialog.show({\r\n      templateUrl: \"help.html\",\r\n      controller: function($scope, $mdDialog) {\r\n        $scope.close = function() {\r\n          $mdDialog.hide();\r\n        };\r\n      }\r\n    });\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/debt-app-ctrl.js","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n\t.config(config);\r\n\r\nfunction config($urlRouterProvider) {\r\n  \r\n  $urlRouterProvider.otherwise(\"/\");\r\n  \r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/route-config.js","\"use strict\";\r\n\r\nrequire(\"./lin-eq-solver\");\r\nrequire(\"./lin-eq-solver-factory\");\r\nrequire(\"./debt-solver\");\r\nrequire(\"./debt-service\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/debts/index.js\n// module id = 29\n// module chunks = 0","\"use strict\";\r\n\r\n\r\nfunction solve(input) {\r\n\t// Internal copies of the linear system and its dimensions\r\n\tvar coefMatrix, constVector, xVector;\r\n\tvar m, n, rank, numberOfSolutions;\r\n\t\r\n\t// With these we can \"virtually\" rearrange the rows and columns\r\n\t// for better numerical stability in the variable elimination phases.\r\n\t// At step i, row index pivotToEquationMap[i] is the pivot equation and\r\n\t// it is used for eliminating variable index pivotToVariableMap[i] from all the\r\n\t// other equations.\r\n\tvar pivotToEquationMap, pivotToVariableMap, equationScale;\r\n\t\r\n\tvalidate();\r\n\tinitialize();\r\n\ttransformToRowEchelonForm();\r\n\treduceRowEchelonForm();\r\n\tdetermineRank();\r\n\tdetermineNumberOfSolutions();\r\n\tdetermineSolution();\r\n\r\n\treturn {\r\n\t\txVector: xVector,\r\n\t\tnumberOfEquations: m,\r\n\t\tnumberOfVariables: n,\r\n\t\trank: rank,\r\n\t\tnumberOfFreeVariables: n - rank,\r\n\t\tnumberOfSolutions: numberOfSolutions\r\n\t};\r\n\t\r\n\t/////////////////////////////////////////////////////////////\r\n\t\r\n\tfunction validate() {\r\n    \tif (!input || !input.A || !input.b) {\r\n    \t\tthrow new TypeError(\"Null matrix A or vector b in system Ax = b\");\r\n    \t}\r\n    \t\r\n    \tif (input.A.length < 1 || input.A[0].length < 1) {\r\n    \t\tthrow new TypeError(\"Matrix A in Ax = b has no rows or no columns\");\r\n    \t}\r\n\t\t\r\n    \tif (input.A.length != input.b.length) {\r\n    \t\tthrow new RangeError(\"The dimensions of the matrix and the constant vector are incompatible\");\r\n    \t}\r\n\t}\r\n\r\n\tfunction initialize() {\r\n\t\tcoefMatrix = copyMatrix(input.A);\r\n\t\tconstVector = copyArray(input.b);\r\n\t\t\r\n\t\tm = coefMatrix.length;\r\n\t\tn = coefMatrix[0].length;\r\n\r\n\t\tpivotToEquationMap = [];\r\n\t\tfor (var i = 0; i < m; i++) {\r\n\t\t\tpivotToEquationMap[i] = i;\r\n\t\t}\r\n\t\t\r\n\t\tequationScale = [];\r\n\t\tfor (var i = 0; i < m; i++) {\r\n\t\t\tequationScale[i] = 0;\r\n\t\t\tfor (var j = 0; j < n; j++) {\r\n\t\t\t\tvar abscoef = Math.abs(coefMatrix[i][j]);\r\n\t\t\t\tif (abscoef > equationScale[i]) {\r\n\t\t\t\t\tequationScale[i] = abscoef;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpivotToVariableMap = [];\r\n\t\tfor (var j = 0; j < n; j++) {\r\n\t\t\tpivotToVariableMap[j] = j;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction transformToRowEchelonForm() {\r\n\t\tvar pivotIdx = 0; \r\n\t\tvar knownFreeVariables = [];\r\n\t\t\r\n\t\twhile (pivotIdx < m-1) { \r\n\r\n\t\t\t// Choose the best pivot-equation for eliminating variable pivotToVariableMap[pivotIdx] \r\n\t\t\t// from equations equations not yet used as pivot equations.\r\n\t\t\tvar maxRatio = 0;\r\n\t\t\tvar bestPivotEquationIndex = pivotIdx;\r\n\t\t\tfor (var i = pivotIdx; i < m; ++i) {\r\n\t\t\t\tvar rowIdx = pivotToEquationMap[i];\r\n\t\t\t\tvar colIdx = pivotToVariableMap[pivotIdx];\r\n\t\t\t\tvar ratio = Math.abs(coefMatrix[rowIdx][colIdx]/equationScale[rowIdx]);\r\n\t\r\n\t\t\t\tif (ratio > maxRatio) {\r\n\t\t\t\t\tmaxRatio = ratio;\r\n\t\t\t\t\tbestPivotEquationIndex = i;\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// If maxRatio == 0, the coefficient of variable pivotToVariableMap[pivotIdx] is 0 in all the rest of the equations. \r\n\t\t\t// That is pivotToVariableMap[pivotIdx] is a free variable. Find the next suitable variable.\r\n\t\t\tif (maxRatio === 0) {\r\n\t\t\t\tvar currPivotVaribleIdx = pivotToVariableMap[pivotIdx];\r\n\t\t\t\tknownFreeVariables[currPivotVaribleIdx] = true;     \r\n\t\t\t\t\r\n\t\t\t\t// The next one must not be a free variable.\r\n\t\t\t\tvar i = pivotIdx;\r\n\t\t\t\tvar newPivotVariableIdx = currPivotVaribleIdx;\r\n\t\t\t\twhile (newPivotVariableIdx == currPivotVaribleIdx && i < n-1) {\r\n\t\t\t\t\t++i;\r\n\t\t\t\t\tif (!knownFreeVariables[pivotToVariableMap[i]]) {\r\n\t\t\t\t\t\tnewPivotVariableIdx = pivotToVariableMap[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (newPivotVariableIdx != currPivotVaribleIdx) {\r\n\t\t\t\t\tpivotToVariableMap[pivotIdx] = newPivotVariableIdx;\r\n\t\t\t\t\tpivotToVariableMap[i] = currPivotVaribleIdx;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else { \r\n\t\t\t\t\t// Could not find a suitable variable. This means the row echelon form is ready.\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\r\n\t\t\tvar temp = pivotToEquationMap[pivotIdx];\r\n\t\t\tpivotToEquationMap[pivotIdx] = pivotToEquationMap[bestPivotEquationIndex];\r\n\t\t\tpivotToEquationMap[bestPivotEquationIndex] = temp;     \r\n\t\t\t\r\n\t\t\t// Elimination phase\r\n\t\t\tvar pivotRowIdx = pivotToEquationMap[pivotIdx];\r\n\t\t\tvar pivotColIdx = pivotToVariableMap[pivotIdx];\r\n\t\t\tfor (i = pivotIdx + 1; i < m; ++i) {\r\n\t\t\t\tvar rowIdx = pivotToEquationMap[i];\r\n\t\t\t\tvar mult = coefMatrix[rowIdx][pivotColIdx] / coefMatrix[pivotRowIdx][pivotColIdx];\r\n\r\n\t\t\t\tfor (var j = pivotIdx + 1; j < n; ++j) {\r\n\t\t\t\t\tvar colIndex = pivotToVariableMap[j];\r\n\t\t\t\t\tcoefMatrix[rowIdx][colIndex] = coefMatrix[rowIdx][colIndex] - mult * coefMatrix[pivotRowIdx][colIndex];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcoefMatrix[rowIdx][pivotColIdx] = 0;\r\n\t\t\t\tconstVector[rowIdx] = constVector[rowIdx] - mult * constVector[pivotRowIdx];\r\n\t\t\t}\r\n\r\n\t\t\tpivotIdx++;\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tfunction reduceRowEchelonForm() {\r\n\t\t// Eliminate pivot variables from previous pivot equations by going through the pivot steps in reverse order.\r\n\t\tvar pivotIndex;\r\n\t\tfor (pivotIndex = Math.min(m, n) - 1; pivotIndex > 0; --pivotIndex) {\r\n\t\t\tvar pivotRowIdx = pivotToEquationMap[pivotIndex];\r\n\t\t\tvar pivotColIdx = pivotToVariableMap[pivotIndex];\r\n\t\t\t\r\n\t\t\tif (coefMatrix[pivotRowIdx][pivotColIdx] === 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (var i = pivotIndex - 1; i > -1; --i) {\r\n\t\t\t\t\r\n\t\t\t\tvar mult = coefMatrix[pivotToEquationMap[i]][pivotToVariableMap[pivotIndex]]/coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[pivotIndex]];\r\n\t\t\t\tfor (var j = 0; j < n; ++j) {\r\n\t\t\t\t\tcoefMatrix[pivotToEquationMap[i]][pivotToVariableMap[j]] -= mult*coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[j]];\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconstVector[pivotToEquationMap[i]] -= mult*constVector[pivotToEquationMap[pivotIndex]];\r\n\t\t\t}            \t\t\r\n\t\t}\r\n\t\t\r\n\t\t// Normalize the coeffients in each row and the rhs value by the coeffient of the pivot variable in the row\r\n\t\tfor (pivotIndex = 0; pivotIndex < Math.min(m, n); ++pivotIndex) {\r\n\t\t\t\r\n\t\t\tif (coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[pivotIndex]] === 0) {\r\n\t\t\t\tcontinue; \r\n\t\t\t}\r\n\r\n\t\t\tvar div = coefMatrix[pivotToEquationMap[pivotIndex]][pivotToVariableMap[pivotIndex]];\r\n\t\t\tfor (var j = 0; j < n; ++j) {\r\n\t\t\t\tcoefMatrix[pivotToEquationMap[pivotIndex]][j] = coefMatrix[pivotToEquationMap[pivotIndex]][j]/div;\r\n\t\t\t}\r\n\t\t\tconstVector[pivotToEquationMap[pivotIndex]] = constVector[pivotToEquationMap[pivotIndex]]/div;\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\tfunction determineRank() {\r\n\t\trank = 0;\r\n\t\tvar i,j;\r\n\t\t\r\n\t\tcolumns: \r\n\t\tfor (j=0; j<n; ++j) {\r\n\t\t\trows:\r\n\t\t\tfor (i=0; i<m; ++i) { \r\n\t\t\t\tif (i != j && coefMatrix[pivotToEquationMap[i]][pivotToVariableMap[j]] !== 0) {\r\n\t\t\t\t\tbreak columns;\r\n\t\t\t\t}\r\n\t\t\t\telse if (i == j && coefMatrix[pivotToEquationMap[i]][pivotToVariableMap[j]] != 1) {\r\n\t\t\t\t\tbreak columns;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t++rank;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction determineNumberOfSolutions() {\r\n\t\t\r\n\t\tvar b2IsZero = true;\r\n\r\n\t\tfor (var i = rank; i < m; ++i) {\r\n\t\t\tif (constVector[pivotToEquationMap[i]] !== 0) {\r\n\t\t\t\tb2IsZero = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (rank < m && !b2IsZero) {\r\n\t\t\tnumberOfSolutions = 0;\r\n\t\t} else if (rank == n && (rank == m || b2IsZero)) {\r\n\t\t\tnumberOfSolutions = 1;\r\n\t\t} else if (rank < n && (rank == m || b2IsZero)) {\r\n\t\t\tnumberOfSolutions = Number.MAX_VALUE;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction determineSolution() {\r\n\t\tif (numberOfSolutions === 0) {\r\n\t\t\txVector = undefined;\r\n\t\t} else {\r\n\t\t\txVector = initArray(n);\r\n\t\t\tfor (var i = 0; i < rank; ++i) {\r\n\t\t\t\txVector[pivotToVariableMap[i]] = constVector[pivotToEquationMap[i]];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction initArray(size) {\r\n\t\tvar array = [];\r\n\t\tfor (var i = 0; i < size; i++) {\r\n\t\t\tarray[i] = 0;\r\n\t\t}\r\n\t\treturn array;\r\n\t}\r\n\t\r\nfunction copyArray(input) {\r\n\treturn input.slice();\r\n}\r\n\r\nfunction copyMatrix(input) {\r\n\tvar copy = [];\r\n\tfor (var i = 0; i < input.length; i++) {\r\n\t\tcopy[i] = input[i].slice();\r\n\t}\r\n\treturn copy;\r\n}\r\n\t\r\n\r\nmodule.exports = solve;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/debts/lin-eq-solver.js\n// module id = 30\n// module chunks = 0","\"use strict\";\r\n\r\nvar solve = require(\"./lin-eq-solver\");\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n.factory(\"solveLinearSystem\", solveLinearSystem);\r\n\r\nfunction solveLinearSystem() {\r\n  return solve;\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/debts/lin-eq-solver-factory.js\n// module id = 31\n// module chunks = 0","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar Decimal = require(\"simple-decimal-money\");\r\nvar Random = require(\"random-js\");\r\nvar _ = require(\"lodash\");\r\n\r\nangular\r\n  .module(\"debtApp\")\r\n    .factory(\"solveDebts\", debtSolverFactory);\r\n\r\n\r\n\r\n\r\n/**\r\n * A function that computes debts from given expense participations.\r\n *\r\n * The input is an array of Participation objects in a BalanceSheet.\r\n *\r\n * Returns an array of debts:\r\n * [{debtor: <a Person object>, creditor: <a Person object>, amount: <float; how much the debtor owes the creditor>}, ...]\r\n *\r\n * We form a linear system Ax = b. A is a binary matrix with size (d+c)*(d*c),\r\n * where d is the number of debtors and c is the number of creditors. Columns of A \r\n * are ordered so that x[c*i + j] is the value of the debt owed by debtor i to creditor j.\r\n * \r\n * Elements of b are balances - converted to non-negative - of the debtors and the creditors \r\n * with the following correspondence:\r\n * \r\n * b[0]: first debtor\r\n * ... \r\n * b[d-1]: last debtor\r\n * b[d] = first creditor\r\n * ... \r\n * b[d+c-1] = last creditor\r\n * \r\n * The coefficient matrix A is constructed so that for each person i, we have equation\r\n * where total value of debts to paid by i (if i is a debtor) or to i (if i is a creditor) equals i's \r\n * non-negative balance.\r\n * \r\n * Rows of A indexed between [0, d-1] represent the debtors in the order \r\n * of debtors> list. Rows of A indexed between [d, d+c-1] represent the \r\n * creditors in the order of creditors list.\r\n * \r\n * Ideally, we would like to find the sparsest (most 0's) solution x to Ax = b\r\n * in case the system is underdetermined and has an infinite number of solutions.\r\n * \r\n * This problem, posed as min ||x||_0  s.t. Ax = b, x >= 0, where ||x||_0 is the number\r\n * of non-zero elements, is in general an NP-hard problem. There is some amount of literature\r\n * about the problem (keywords: sparse nonnegative solution of underdetermined linear equations).\r\n * The problem is usually approximated as convex optimization problem by minimizing L1-norm (sum of \r\n * absolute value) instead. One option could be to use the cassowary javascript library.\r\n * \r\n * In this function we find a non-negative x using Gaussian elimination and setting random combinations \r\n * of free variables to zero until we find a non-negative solution.\r\n */\r\nfunction debtSolverFactory(solveLinearSystem) {\r\n  \r\n  return solve;\r\n  \r\n  \r\n  function solve(participations) {\r\n    if (!participations || participations.length === 0) {\r\n      return [];\r\n    }\r\n\r\n    var balances = computeBalances(participations);\r\n    if (isEveryoneBalanced(balances)) {\r\n      return [];\r\n    }\r\n\r\n    if (!isSystemBalanced(balances)) {\r\n      throw new Error(\"Debt system is not balanced\");\r\n    }\r\n\r\n    var roles = getDebtorsAndCreditors(balances);\r\n    var linearSystem = createDebtEquations(roles);\r\n    var debtVector = solveDebts(linearSystem);\r\n    return createDebts(debtVector, roles);\r\n  }\r\n  \r\n  function computeBalances(participations) {\r\n    var balances = {};\r\n    angular.forEach(participations, function(p) {\r\n      var b = balances[p.person.id];\r\n      if (b === undefined) {\r\n        b = {person: p.person, balance: new Decimal(0)};\r\n        balances[p.person.id] = b;\r\n      }\r\n      var paid = new Decimal(p.paid);\r\n      var share = new Decimal(p.share);\r\n      b.balance = b.balance.add(share.subtract(paid));\r\n    });\r\n\r\n    angular.forEach(balances, function(b) {\r\n      b.balance = b.balance.toNumber();\r\n    });\r\n    \r\n    return balances;\r\n  }\r\n  \r\n  function isEveryoneBalanced(balances) {\r\n    return _.every(balances, {balance: 0});\r\n  }\r\n\r\n  function isSystemBalanced(balances) {\r\n    return _.reduce(balances, function(sum, b) {\r\n        return sum.add(b.balance);\r\n    }, new Decimal(0)).toNumber() === 0;\r\n  }\r\n  \r\n  function getDebtorsAndCreditors(balances) {\r\n    var debtors = [];\r\n    var creditors = [];\r\n    \r\n    angular.forEach(balances, function(b) {\r\n      if (b.balance <= 0) {\r\n        creditors.push(b);\r\n      } else {\r\n        debtors.push(b);\r\n      }\r\n    });\r\n    \r\n    return {\r\n      debtors: debtors,\r\n      creditors: creditors\r\n    };\r\n  }\r\n  \r\n  function createDebtEquations(roles) {\r\n    var d = roles.debtors.length;\r\n    var c = roles.creditors.length;\r\n    \r\n    // Right-hand side vector, creditor balances converted to non-negative to allow binary coefficients\r\n    var b = [];\r\n    _.each(roles.debtors, function(debtor, i) {\r\n      b[i] = (new Decimal(debtor.balance)).multiply(100).toNumber();\r\n    });\r\n    _.each(roles.creditors, function(creditor, i) {\r\n      b[d + i] = (new Decimal(creditor.balance)).multiply(-100).toNumber();\r\n    });\r\n    \r\n    // Coefficient matrix\r\n    var A = initMatrix(d + c, d*c); \r\n    \r\n    // Coefficients of equations \"sum of debts paid by debtor = debtor's balance\"\r\n    for (var i = 0; i < d; i++) {\r\n      for (var j = i*c; j < (i+1)*c; j++) {\r\n        A[i][j] = 1;\r\n      }\r\n    }\r\n    \r\n    // Coefficients of equations \"sum debts received by creditor = creditor's balance\"\r\n    for (var i = d; i < c+d; ++i) {\r\n      for (var j = (i-d); j < d*c; j += c) {\r\n        A[i][j] = 1;\r\n      }\r\n    } \r\n    \r\n    return {\r\n      A: A,\r\n      b: b\r\n    };\r\n  }\r\n  \r\n  function initMatrix(rows, cols) {\r\n    var A = [];\r\n    for (var i = 0; i < rows; i++) {\r\n      A[i] = [];\r\n      for (var j = 0; j < cols; j++) {\r\n        A[i][j] = 0;\r\n      }\r\n    }\r\n    return A;\r\n  }\r\n  \r\n  // Solve debts, ensuring a non-negative solution \r\n  function solveDebts(linearSystem) {\r\n    var solution = solveLinearSystem(linearSystem);\r\n    if (solution.numberOfSolutions === 0) {\r\n      throw new Error(\"Debt system has no solutions\");\r\n    }\r\n\r\n\r\n    var numVars = solution.numberOfVariables;\r\n    var numFreeVars = solution.numberOfFreeVariables;\r\n    \r\n    if (numFreeVars === 0) {\r\n      return solution.xVector;\r\n    }\r\n\r\n    // Known seed so we always get the same result from\r\n    // the same system.\r\n    var randomEngine = Random.engines.mt19937();\r\n    randomEngine.seed(20150312);\r\n\r\n    var toEliminate;\r\n    do {\r\n      \r\n      var A = angular.copy(linearSystem.A);\r\n      var b = linearSystem.b;\r\n      \r\n      // Pick random numFreeVars variables for elimination\r\n      \r\n      var candidates = [];\r\n      for (var i = 0; i < numVars; i++) {\r\n        candidates[i] = i;\r\n      }\r\n      \r\n      toEliminate = [];\r\n      for (var i = 0; i < numFreeVars; i++) {\r\n        var candidateIdx = Random.integer(0, candidates.length-1)(randomEngine);\r\n        toEliminate.push(candidates[candidateIdx]);\r\n        candidates.splice(candidateIdx, 1);\r\n      }\r\n      \r\n      // Eliminate the chosen variables by setting their coefficients to zero\r\n      \r\n      for (var i = 0; i < A.length; i++) {\r\n        for (var j = 0; j < toEliminate.length; j++) {\r\n          A[i][toEliminate[j]] = 0;\r\n        }\r\n      }\r\n\r\n      // Solve the updated system\r\n      \r\n      solution = solveLinearSystem({A: A, b: b});\r\n      \r\n    } while (!isNonNegative(solution.xVector));\r\n\r\n    \r\n    return solution.xVector;\r\n  }\r\n  \r\n  function isNonNegative(vector) {\r\n    if (!vector) {\r\n      return false;\r\n    }\r\n    for (var i = 0; i < vector.length; i++) {\r\n      if (vector[i] < 0) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n  \r\n  function createDebts(debtVector, roles) {\r\n    var debts = [];\r\n\r\n    for (var i = 0; i < debtVector.length; i++) {\r\n      if (debtVector[i] !== 0) {\r\n        var debtorIdx = Math.floor(i/roles.creditors.length);\r\n        var creditorIdx = i - roles.creditors.length*debtorIdx;\r\n        var amount = (new Decimal(debtVector[i])).divideBy(100).toNumber();\r\n        var debt = {debtor: roles.debtors[debtorIdx].person, creditor: roles.creditors[creditorIdx].person, amount: amount};\r\n        debts.push(debt);\r\n      }\r\n    }\r\n    \r\n    return debts;\r\n  }\r\n}  \n\n\n// WEBPACK FOOTER //\n// ./src/app/debts/debt-solver.js","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar _ = require(\"lodash\");\r\n\r\nangular\r\n  .module(\"debtApp\")\r\n    .factory(\"debtService\", debtService);\r\n\r\n\r\nfunction debtService(solveDebts) {\r\n  \r\n  return {\r\n    computeDebts: computeDebts,\r\n    organizeByDebtor: organizeByDebtor\r\n  };\r\n  \r\n  /////////////////////////////////////////\r\n\r\n  function computeDebts(participations, currency) {\r\n    if (currency !== undefined) {\r\n      participations = _.map(participations, function(p) {\r\n        return {\r\n          person: p.person,\r\n          expense: p.expense,\r\n          paid: p.getPaid(currency, {strictConversion: true}),\r\n          share: p.getShare(currency, {strictConversion: true})\r\n        };\r\n      });\r\n    }\r\n\r\n    var debts = solveDebts(participations);\r\n\r\n    if (currency !== undefined) {\r\n      debts = _.map(debts, function(debt) {\r\n        return _.extend(debt, {currency: currency});\r\n      });\r\n    }\r\n\r\n    return debts;\r\n  } \r\n  \r\n  function organizeByDebtor(debts) {\r\n    var debtorList = [];\r\n    var debtorIndices = {};\r\n    \r\n    _.each(debts, function(d) {\r\n      var debtorIndex = debtorIndices[d.debtor.id];\r\n      var debtor;\r\n      if (debtorIndex === undefined) {\r\n        debtorIndex = debtorList.length;\r\n        debtor = {debtor: d.debtor, debts: []};\r\n        debtorList.push(debtor);\r\n        debtorIndices[d.debtor.id] = debtorIndex;\r\n      }\r\n      debtor = debtorList[debtorIndex];\r\n      debtor.debts.push(_.omit(d, \"debtor\")) ;\r\n    });\r\n\r\n    _.each(debtorList, function(d) {\r\n      d.debts.sort(function(d1, d2) {\r\n        return d1.creditor.name.localeCompare(d2.creditor.name);\r\n      });\r\n    });\r\n    debtorList.sort(function(d1, d2) {\r\n      return d1.debtor.name.localeCompare(d2.debtor.name);\r\n    });\r\n    \r\n    return debtorList;\r\n  }\r\n  \r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/debts/debt-service.js","\"use strict\";\r\n\r\nrequire(\"./route-config\");\r\nrequire(\"./balance-sheet\");\r\nrequire(\"./balance-sheet-service\");\r\nrequire(\"./balance-sheet-ctrl\");\r\nrequire(\"./currency-conversion-error\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/balance-sheet/index.js\n// module id = 36\n// module chunks = 0","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar balanceSheetTpl = require(\"./balance-sheet.html\");\r\nvar floatingButtonTpl = require(\"./floating-button.html\");\r\n\r\nangular.module(\"debtApp\")\r\n  .config(config);\r\n\r\nfunction config($stateProvider) {\r\n\r\n  $stateProvider\r\n    .state(\"balanceSheet\", {\r\n      url: \"/\",\r\n      views: {\r\n        \"\": {\r\n          templateUrl : balanceSheetTpl,\r\n          controller : \"BalanceSheetCtrl as vm\"\r\n        },\r\n        \"floatingButton\": {\r\n          templateUrl : floatingButtonTpl\r\n        }\r\n      }\r\n    });\r\n  \r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/balance-sheet/route-config.js","var path = 'balance-sheet/balance-sheet.html';\nvar html = \"<section layout=column> <md-input-container class=md-title md-no-float> <input type=text placeholder=\\\"Sheet name\\\" ng-model=vm.balanceSheet.name ng-change=::vm.updateSheet() ng-required=true /> </md-input-container> <div ng-if=vm.balanceSheet.currenciesEnabled() class=row layout=row layout-align=\\\"start center\\\"> <label for=currency flex>Currency</label> <md-select id=currency aria-label=Currency class=\\\"no-margin margin-right\\\" ng-model=vm.balanceSheet.currency ng-change=::vm.updateSheet()> <md-option ng-value=::currency ng-repeat=\\\"currency in ::vm.balanceSheet.getCurrencies()\\\">{{::currency}}</md-option> </md-select> </div> </section> <section> <md-list> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">Expenses</md-subheader> <md-list-item class=md-2-line ng-repeat=\\\"expense in vm.balanceSheet.expenses\\\" ng-click=\\\"::$state.go('expense', {id: expense.id})\\\"> <md-icon hide-xs ng-if=::expense.isBalanced() class=md-primary md-svg-icon=ic_shopping_basket_24px></md-icon> <md-icon ng-if=::!expense.isBalanced() class=md-warn md-svg-icon=ic_warning_24px></md-icon> <div class=md-list-item-text layout=column> <div layout=row ng-class=\\\"{'md-body-1': $mdMedia('xs')}\\\"> <span flex class=margin-right-double ng-class=\\\"::{settled: expense.settled}\\\">{{::expense.name}}</span> <span ng-if=::!vm.balanceSheet.currenciesEnabled()> {{::expense.getCost() | money}} </span> <span ng-if=::vm.balanceSheet.currenciesEnabled()> {{vm.balanceSheet.currency}} {{expense.getCost(vm.balanceSheet.currency) | money}} </span> </div> <p layout=row> <span>{{expense.date | date:'longDate'}}</span> <span flex>&nbsp;</span> <span ng-if=\\\"vm.balanceSheet.currenciesEnabled() && vm.balanceSheet.currency !== expense.computedCurrency()\\\"> {{expense.computedCurrency()}} {{::expense.getCost() | money}} </span> </p> </div> </md-list-item> <md-list-item ng-if=\\\"vm.balanceSheet.expenses.length == 0\\\"> <p class=md-list-item-text> No expenses. </p> </md-list-item> </md-list> </section> <section> <md-list> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">People</md-subheader> <md-list-item class=md-2-line ng-repeat=\\\"person in vm.balanceSheet.persons\\\" ng-click=\\\"::$state.go('person', {id: person.id})\\\"> <md-icon hide-xs class=md-primary md-svg-icon=ic_face_24px></md-icon> <div class=md-list-item-text> <div layout=row ng-class=\\\"{'md-body-1': $mdMedia('xs')}\\\"> <span flex class=margin-right-double>{{::person.name}}</span> <span ng-if=::!vm.balanceSheet.currenciesEnabled()> {{::person.getBalance() | balance}} </span> <span ng-if=::vm.balanceSheet.currenciesEnabled()> {{vm.balanceSheet.currency}} {{person.getBalance(vm.balanceSheet.currency) | balance}} </span> </div> <p>&nbsp;</p> </div> </md-list-item> <md-list-item ng-if=\\\"vm.balanceSheet.persons.length == 0\\\"> <p class=md-list-item-text> No people. </p> </md-list-item> </md-list> </section> <section> <md-list> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">Debts</md-subheader> <md-list-item class=md-2-line ng-repeat=\\\"d in vm.debtsByDebtor\\\"> <div class=md-list-item-text layout=column> <span class=margin-bottom>{{d.debtor.name}} owes</span> <span ng-repeat=\\\"c in d.debts\\\" class=\\\"margin-left-double margin-bottom\\\"> {{c.creditor.name}}: {{c.currency}} {{c.amount | money}} </span> </div> </md-list-item> <md-list-item ng-if=\\\"vm.balanceSheet.persons.length == 0 || vm.balanceSheet.expenses.length == 0\\\"> <div class=md-list-item-text> <p>This section will show debts that settle all expenses with minimum number of transactions.</p> <p>You can also settle expenses individually.</p> </div> </md-list-item> <md-list-item ng-if=\\\"vm.debtsByDebtor.length == 0 && vm.balanceSheet.persons.length > 0 && vm.balanceSheet.expenses.length > 0\\\"> <p class=md-list-item-text> Everyone is settled up! </p> </md-list-item> <md-list-item ng-if=::!vm.balanceSheet.isBalanced()> <md-icon class=md-warn md-svg-icon=ic_warning_24px></md-icon> <p class=md-list-item-text> Cannot compute debts. There are unbalanced expenses. </p> </md-list-item> <md-list-item ng-if=vm.debtComputationError> <md-icon class=md-warn md-svg-icon=ic_warning_24px></md-icon> <p class=md-list-item-text> {{vm.debtComputationError}} </p> </md-list-item> </md-list> </section>\";\nwindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/balance-sheet/balance-sheet.html\n// module id = 38\n// module chunks = 0","var path = 'balance-sheet/floating-button.html';\nvar html = \"<md-fab-speed-dial md-direction=up ng-init=\\\"isFabOpen = false\\\" md-open=isFabOpen ng-mouseenter=\\\"isFabOpen = true\\\" ng-mouseleave=\\\"isFabOpen = false\\\" class=\\\"md-fab-bottom-right md-scale md-hover-full\\\"> <md-fab-trigger> <md-button aria-label=Create... class=\\\"md-fab md-primary\\\"> <md-icon md-svg-icon=ic_add_24px></md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <md-button ng-click=vm.createExpense() aria-label=\\\"Create expense\\\" class=\\\"md-fab md-primary md-mini\\\"> <md-icon md-svg-icon=ic_shopping_basket_24px></md-icon> </md-button> <md-button ng-click=vm.createPerson() aria-label=\\\"Create person\\\" class=\\\"md-fab md-primary md-mini\\\"> <md-icon md-svg-icon=ic_face_24px></md-icon> </md-button> </md-fab-actions> </md-fab-speed-dial> \";\nwindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/balance-sheet/floating-button.html\n// module id = 39\n// module chunks = 0","\"use strict\";\r\n\r\nvar _ = require('lodash');\r\nvar Decimal = require(\"simple-decimal-money\");\r\nvar CurrencyConversionError = require(\"./currency-conversion-error\");\r\n\r\nvar BalanceSheet = function(data) {\r\n\r\n  var _this = this;\r\n  var _sheet = this;\r\n\r\n  var EXCHANGE_RATE_DECIMALS = 4;\r\n\r\n  // Data\r\n\r\n  var persons = [];\r\n  var expenses = [];\r\n  var participations = [];\r\n\r\n  var exchangeRates = [];\r\n\r\n  var idSequence = 1;\r\n\r\n  _this.name = \"New sheet\";\r\n  _this.currency = undefined;\r\n  _this.persons = persons;\r\n  _this.expenses = expenses;\r\n  _this.participations = participations;\r\n\r\n  if (data) {\r\n    importData(data);\r\n  }\r\n\r\n  // Methods\r\n\r\n  _this.getNonSettledParticipations = getNonSettledParticipations;\r\n\r\n  _this.isBalanced = isBalanced;\r\n\r\n  _this.getPerson = getPerson;\r\n  _this.createPerson = createPerson;\r\n  _this.removePerson = removePerson;\r\n\r\n  _this.getExpense = getExpense;\r\n  _this.createExpense = createExpense;\r\n  _this.removeExpense = removeExpense;\r\n\r\n  _this.getParticipation = getParticipation;\r\n  _this.createParticipation = createParticipation;\r\n  _this.removeParticipation = removeParticipation;\r\n\r\n  _this.exportData = exportData;\r\n\r\n  _this.isValid = isValid;\r\n  _this.throwErrorIfInvalid = throwErrorIfInvalid;\r\n\r\n  _this.currenciesEnabled = currenciesEnabled;\r\n  _this.getExchangeRates = getExchangeRates;\r\n  _this.getCurrencies = getCurrencies;\r\n  _this.getExpenseCurrencies = getExpenseCurrencies;\r\n  _this.getExchangeRateCurrencies = getExchangeRateCurrencies;\r\n  _this.addOrUpdateExchangeRate = addOrUpdateExchangeRate;\r\n  _this.removeExchangeRate = removeExchangeRate;\r\n  _this.convertCurrency = convertCurrency;\r\n  _this.getConvertibleCurrencies = getConvertibleCurrencies;\r\n  _this.getNonConvertibleCurrencies = getNonConvertibleCurrencies;\r\n  _this.throwErrorIfInvalidExpenseCurrencies = throwErrorIfInvalidExpenseCurrencies;\r\n\r\n  /////////////////////////////////////\r\n\r\n\r\n  function getNonSettledParticipations() {\r\n    return _.filter(participations, function(pt) {\r\n      return !pt.expense.settled;\r\n    });\r\n  }\r\n\r\n  function isBalanced() {\r\n    return _.reduce(expenses, function(isBalanced, e) {\r\n      return isBalanced && (e.settled || e.isBalanced());\r\n    }, true);\r\n  }\r\n\r\n\r\n  function getPerson(id) {\r\n    return _(persons).find(function(p) {\r\n      return p.id == id;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a person.\r\n   *\r\n   * @param {Object} [data] - Person data\r\n   * @param {String} [data.name=Person <number>] - Person's name\r\n   * @param {Object} [options] - Options for creating a person\r\n   * @param {boolean} [options.createParticipations=true] - Whether the person is set to participate in all existing expenses\r\n   * @returns {Person} - The created Person object\r\n   */\r\n  function createPerson(data, options) {\r\n    data = _.extend({\r\n      name: \"Person \" + (persons.length + 1)\r\n    }, data);\r\n\r\n    options = _.extend({}, options);\r\n\r\n    if (data.id === undefined) {\r\n      data.id = idSequence;\r\n      idSequence = idSequence + 1;\r\n    }\r\n\r\n    var person = new Person(data);\r\n    persons.push(person);\r\n\r\n    if (options.createParticipations === true) {\r\n      _.each(expenses, function(e) {\r\n        if (!e.settled) {\r\n          createParticipation({person: person, expense: e});\r\n          e.shareCost();\r\n        }\r\n      });\r\n    }\r\n\r\n    return person;\r\n  }\r\n\r\n  function removePerson(toRemove) {\r\n    toRemove = getPerson(toRemove.id);\r\n\r\n    if (!toRemove) return;\r\n\r\n    _.remove(persons, function(e) {\r\n      return e.equals(toRemove);\r\n    });\r\n\r\n    _.forEach(toRemove.getParticipations(), function(pt) {\r\n      removeParticipation(pt);\r\n    });\r\n  }\r\n\r\n  function getExpense(id) {\r\n    return _(expenses).find(function(e) {\r\n      return e.id == id;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates an expense.\r\n   *\r\n   * @param {Object} [data] - Expense data\r\n   * @param {String} [data.name=Expense <number>] - Expense's name\r\n   * @param {String} [data.currency] - The currency the expense was paid in\r\n   * @param {Object} [options] - Options for creating an expense\r\n   * @param {boolean} [options.createParticipations=true] - Whether all existing persons are set to participate in the expense\r\n   * @returns {Expense} - The created Expense object\r\n   */\r\n  function createExpense(data, options) {\r\n    data = _.extend({\r\n      name: \"Expense \" + (expenses.length + 1),\r\n      sharing: \"equal\",\r\n      settled: false,\r\n      currency: undefined\r\n    }, data);\r\n\r\n    options = _.extend({}, options);\r\n\r\n    if (data.id === undefined) {\r\n      data.id = idSequence;\r\n      idSequence = idSequence + 1;\r\n    }\r\n\r\n    var expense = new Expense(data);\r\n    expenses.push(expense);\r\n\r\n    if (options.createParticipations === true) {\r\n      _.each(persons, function(p) {\r\n        createParticipation({person: p, expense: expense});\r\n      });\r\n    }\r\n\r\n    return expense;\r\n  }\r\n\r\n  function removeExpense(toRemove) {\r\n    toRemove = getExpense(toRemove.id);\r\n\r\n    if (!toRemove) return;\r\n\r\n    _.remove(expenses, function(e) {\r\n      return e.equals(toRemove);\r\n    });\r\n\r\n    _.forEach(toRemove.getParticipations(), function(pt) {\r\n      removeParticipation(pt);\r\n    });\r\n  }\r\n\r\n\r\n  function getParticipation(criteria) {\r\n    var toSeek = new Participation(criteria);\r\n    return _(participations).find(function(pt) {\r\n      return toSeek.equals(pt);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a participation of a Person to an Expense.\r\n   *\r\n   * @param {Object} data - Participation data\r\n   * @param {Person} data.person - The participant person\r\n   * @param {Expense} data.expense - The expense to participate in\r\n   * @param {number} [data.paid=0] - How much the person has paid for the expense (in the expense currency)\r\n   * @param {number} [data.share=0] - The person's share of the expense's total cost (in the expense currency)\r\n   * @returns {Participation} - The created Participation object\r\n   */\r\n  function createParticipation(data) {\r\n    if (getParticipation(data)) {\r\n      throw new Error(\"Duplicate participation\");\r\n    }\r\n\r\n    data = _.extend({\r\n      paid: 0,\r\n      share: 0\r\n    }, data);\r\n\r\n    var participation = new Participation(data);\r\n    participations.push(participation);\r\n\r\n    participation.expense.shareCost();\r\n\r\n    return participation;\r\n  }\r\n\r\n  function removeParticipation(toRemove) {\r\n    toRemove = getParticipation(toRemove);\r\n\r\n    if (!toRemove) return;\r\n\r\n    _.remove(participations, function(pt) {\r\n      return pt.equals(toRemove);\r\n    });\r\n\r\n    toRemove.expense.shareCost();\r\n  }\r\n\r\n\r\n  /**\r\n   * @returns {boolean} Whether currencies are enabled in this balance sheet\r\n   */\r\n  function currenciesEnabled() {\r\n    return exchangeRates && exchangeRates.length > 0;\r\n  }\r\n  /**\r\n   * @return {string[]} copy of exchange rates in this sheet\r\n   */\r\n  function getExchangeRates() {\r\n    return _.cloneDeep(exchangeRates);\r\n  }\r\n\r\n  /**\r\n   * @return list of currencies in alphabetical order\r\n   */\r\n  function getCurrencies() {\r\n    return _.chain(getExchangeRateCurrencies())\r\n      .concat(getExpenseCurrencies(), _this.currency)\r\n      .uniq()\r\n      .sort()\r\n      .value();\r\n  }\r\n\r\n  function getExchangeRateCurrencies() {\r\n    return _.reduce(exchangeRates, function(result, er) {\r\n      result.push(er.fixed);\r\n      result.push(er.variable);\r\n      return result;\r\n    }, []);\r\n  }\r\n\r\n  function getExpenseCurrencies() {\r\n    return _.map(expenses, function(e) {\r\n      return e.computedCurrency();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Adds or updates an exchange rate.\r\n   *\r\n   * @param {Object} quotation - The exchange rate object\r\n   * @param {string} quotation.fixed - The fixed currency symbol\r\n   * @param {string} quotation.variable - The variable currency symbol\r\n   * @param {number} quotation.rate - The rate: 1 unit of the fixed currency buys this amount of the variable currency. Must be a positive number with at most 4 decimals.\r\n   */\r\n  function addOrUpdateExchangeRate(quotation) {\r\n    validateQuotation(quotation);\r\n    var existing = _.find(exchangeRates, _.pick(quotation, 'fixed', 'variable'));\r\n    if (existing) {\r\n      _.extend(existing, quotation);\r\n    } else {\r\n      exchangeRates.push(quotation);\r\n    }\r\n    updateBalanceSheetCurrencyIfNeeded();\r\n  }\r\n\r\n  function validateQuotation(quotation) {\r\n    if (!_.isString(quotation.fixed) || _.trim(quotation.fixed) === \"\") {\r\n      throw new TypeError(\"Fixed currency symbol must be a non-empty string\");\r\n    }\r\n    if (!_.isString(quotation.variable) || _.trim(quotation.variable) === \"\") {\r\n      throw new TypeError(\"Variable currency symbol must be a non-empty string\");\r\n    }\r\n    if (!_.isNumber(quotation.rate) || quotation.rate < 0.0001) {\r\n      throw new RangeError(\"Foreign currency rate must be >= 0.0001\");\r\n    }\r\n  }\r\n\r\n  function cleanUpCurrency(currency) {\r\n    if (!currency) {\r\n      return undefined;\r\n    } else if (_.isString(currency) && _.trim(currency).length === 0) {\r\n      return undefined;\r\n    } else {\r\n      return _.trim(currency);\r\n    }\r\n  }\r\n\r\n  function cleanUpCurrencyPair(currencyPair) {\r\n    currencyPair = _.clone(currencyPair);\r\n    currencyPair.fixed = cleanUpCurrency(currencyPair.fixed);\r\n    currencyPair.variable = cleanUpCurrency(currencyPair.variable);\r\n    return currencyPair;\r\n  }\r\n\r\n  /**\r\n   * Removes an exchange rate.\r\n   *\r\n   * @param currencyPair - The currency pair to remove\r\n   * @param {string} currencyPair.fixed - The fixed currency symbol\r\n   * @param {string} currencyPair.variable - The variable currency symbol\r\n   */\r\n  function removeExchangeRate(currencyPair) {\r\n    if (!currencyPair) return;\r\n    currencyPair = cleanUpCurrencyPair(currencyPair);\r\n    _.remove(exchangeRates, _.pick(currencyPair, 'fixed', 'variable'));\r\n    updateBalanceSheetCurrencyIfNeeded();\r\n    updateExpenseCurrenciesIfNeeded();\r\n  }\r\n\r\n  /**\r\n   * Converts a value from one currency to another. Uses the inverse of an exchange\r\n   * rate if an inverse currency pair is found.\r\n   *\r\n   * @param {Object} toConvert - The data object\r\n   * @param {number} toConvert.value - The value to convert\r\n   * @param {string} toConvert.fixed - The currency of the value to be converted\r\n   * @param {string} toConvert.variable - The currency to convert the value to\r\n   * @return {number} - The value in the variable currency\r\n   */\r\n  function convertCurrency(toConvert) {\r\n    var rate;\r\n\r\n    if (!toConvert) {\r\n      throw new CurrencyConversionError(\"Undefined or null conversion data\");\r\n    }\r\n\r\n    toConvert = cleanUpCurrencyPair(toConvert);\r\n\r\n    if (toConvert.fixed == toConvert.variable) {\r\n      return new Decimal(toConvert.value).toNumber();\r\n    }\r\n\r\n    var quotation = _.find(exchangeRates, {fixed: toConvert.fixed, variable: toConvert.variable});\r\n\r\n    if (quotation) {\r\n      rate = new Decimal(quotation.rate, EXCHANGE_RATE_DECIMALS);\r\n    } else {\r\n      var searchPair = {variable: toConvert.fixed, fixed: toConvert.variable};\r\n      var inverseQuotation = _.find(exchangeRates, searchPair);\r\n      if (inverseQuotation) {\r\n        rate = new Decimal(1/inverseQuotation.rate, EXCHANGE_RATE_DECIMALS);\r\n      }\r\n    }\r\n\r\n    if (!rate) {\r\n      throw new CurrencyConversionError(\"Could not find an exchange rate for conversion '\" + toConvert.fixed + \"' -> '\" + toConvert.variable + \"'.\");\r\n    }\r\n\r\n    return new Decimal(toConvert.value*100).multiply(rate).divideBy(100).toNumber();\r\n  }\r\n\r\n  function tryToConvertCurrency(toConvert) {\r\n    try {\r\n      return convertCurrency(toConvert);\r\n    } catch (e) {\r\n      if (e instanceof CurrencyConversionError) {\r\n        return NaN;\r\n      } else {\r\n        throw e;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns currencies that can be converted to the given currency.\r\n   *\r\n   * @param {string[]} fromCurrencies - Currencies to convert\r\n   * @param {string} toCurrency - Currency to convert to\r\n   * @returns {string[]} - Convertible currencies in fromCurrencies\r\n   */\r\n  function getConvertibleCurrencies(fromCurrencies, toCurrency) {\r\n    if (!_.isArray(fromCurrencies)) {\r\n      return [];\r\n    }\r\n\r\n    var convertible = [];\r\n    _.each(getCurrencies(), function(c) {\r\n      try {\r\n        convertCurrency({fixed: c, variable: toCurrency, value: 1});\r\n        convertible.push(c);\r\n      } catch (e) {}\r\n    });\r\n    return convertible;\r\n  }\r\n\r\n  /**\r\n   * Finds currencies that can not be converted to the given currency.\r\n   *\r\n   * @param {string[]} fromCurrencies - Currencies to convert\r\n   * @param {string} toCurrency - Currency to convert to\r\n   * @returns {string[]} - Non-convertible currencies\r\n   */\r\n  function getNonConvertibleCurrencies(fromCurrencies, toCurrency) {\r\n    return _.difference(fromCurrencies, getConvertibleCurrencies(fromCurrencies, toCurrency));\r\n  }\r\n\r\n\r\n  function updateBalanceSheetCurrencyIfNeeded() {\r\n    var currencies = getExchangeRateCurrencies();\r\n\r\n    if (exchangeRates.length === 0) {\r\n      _this.currency = undefined;\r\n    } else if (_this.currency === undefined || _.indexOf(currencies, _this.currency) === -1) {\r\n      _this.currency = exchangeRates[0].fixed;\r\n    }\r\n  }\r\n\r\n\r\n  function updateExpenseCurrenciesIfNeeded() {\r\n    var currencies = _.concat(getExchangeRateCurrencies(), _this.currency);\r\n    _.each(expenses, function(e) {\r\n      if (_.indexOf(currencies, e.currency) === -1) {\r\n        e.currency = _this.currency;\r\n      }\r\n    });\r\n  }\r\n\r\n  function throwErrorIfInvalidExpenseCurrencies() {\r\n    _.each(expenses, function(expense) {\r\n      try {\r\n        convertCurrency({fixed: expense.computedCurrency(), variable: _this.currency, value: 1});\r\n      } catch (ex) {\r\n        throw new CurrencyConversionError(\"Cannot convert currency '\" + expense.computedCurrency()  + \"' of '\" + expense.name + \"' to balance sheet's currency '\" + _this.currency + \"'\");\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n   * Creates a Person object.\r\n   *\r\n   * @param {Object} [data] - Initial data\r\n   * @param {number} [data.id] - Id\r\n   * @param {string} [data.name} - Name\r\n   * @constructor\r\n   */\r\n  function Person(data) {\r\n    var _this = this;\r\n\r\n    _.extend(_this, data);\r\n\r\n    // Methods\r\n\r\n    _this.computedCurrency = computedCurrency;\r\n    _this.equals = equals;\r\n    _this.getCost = getCost;\r\n    _this.getSumOfShares = getSumOfShares;\r\n    _this.getBalance = getBalance;\r\n    _this.isBalanced = isBalanced;\r\n    _this.getParticipations = getParticipations;\r\n    _this.exportData = exportData;\r\n\r\n    ///////////////////////////////////////\r\n\r\n    var _myParticipations = _.chain(participations)\r\n      .filter(function(pt) {\r\n        return _this.equals(pt.person);\r\n      });\r\n\r\n    var _nonSettledParticipations = _myParticipations\r\n      .filter(function(pt) {\r\n        return !pt.expense.settled;\r\n      });\r\n\r\n\r\n    function getTotal(participationMapping) {\r\n      return _nonSettledParticipations\r\n        .map(participationMapping)\r\n        .reduce(function(total, value) {\r\n          return total.add(value);\r\n        }, new Decimal(0))\r\n        .value()\r\n        .toNumber();\r\n    }\r\n\r\n    function computedCurrency() {\r\n      return _sheet.currency;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} [currency] - The currency in which to get the total (default: balance sheet's default currency)\r\n     * @returns {number} - The total amount this person has paid. NaN if cannot convert currency.\r\n     */\r\n    function getCost(currency) {\r\n      currency = currency || _this.computedCurrency();\r\n      return getTotal(function(pt) {\r\n        return pt.getPaid(currency);\r\n      });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} [currency] - The currency in which to get the total (default: balance sheet's default currency)\r\n     * @returns {number} - This person's total share of all the expenses. NaN if cannot convert currency.\r\n     */\r\n    function getSumOfShares(currency) {\r\n      currency = currency || _this.computedCurrency();\r\n      return getTotal(function(pt) {\r\n        return pt.getShare(currency);\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Checks whether this person's costs and shares sum up to zero, i.e. the person neither\r\n     * owes money nor is owed money by anyone else.\r\n     *\r\n     * @returns {boolean} - Whether this person's costs and shares sum up to zero\r\n     */\r\n    function isBalanced() {\r\n      return getBalance() === 0;\r\n    }\r\n\r\n    /**\r\n     * Computes the difference between the total share and cost paid by this person.\r\n     * If the difference is negative, then the person's share is smaller than the costs\r\n     * she has paid, that is others owe her money.\r\n     *\r\n     * @param {string} [currency] - The currency in which to get the balance (default: balance sheet's default currency)\r\n     * @returns {number} - The difference between the total share and cost paid by this person. NaN if cannot convert currency.\r\n     */\r\n    function getBalance(currency) {\r\n      currency = currency || _this.computedCurrency();\r\n      return new Decimal( getSumOfShares(currency) ).subtract( getCost(currency) ).toNumber();\r\n    }\r\n\r\n    /**\r\n     * @returns {Participation[]} - The expense participations of this person\r\n     */\r\n    function getParticipations() {\r\n      return _myParticipations.value();\r\n    }\r\n\r\n    /**\r\n     * @param {Object} other - Another object\r\n     * @returns {boolean} - True if this person is equal to the other object\r\n     */\r\n    function equals(other) {\r\n      return (other instanceof Person) && (other.id === _this.id);\r\n    }\r\n\r\n    function exportData() {\r\n      var isNotFunction = _.negate(_.isFunction);\r\n      return _.extend(_.pickBy(_this, isNotFunction), {});\r\n    }\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * An expense.\r\n   *\r\n   * @param {object} [data] - Initial data\r\n   * @param {number} [data.id] - The expense's id\r\n   * @param {string} [data.name] - The expense's name\r\n   * @param {string} [data.sharing] -  The expense's cost sharing mode. Value \"equal\" = share costs equally. All other values mean custom sharing.\r\n   * @param {string} [data.currency] - The expense's currency\r\n   * @constructor\r\n   */\r\n  function Expense(data) {\r\n    var _this = this;\r\n\r\n    // Data\r\n    _.extend(_this, data);\r\n\r\n    // Methods\r\n    _this.computedCurrency = computedCurrency;\r\n    _this.getCost = getCost;\r\n    _this.getSumOfShares = getSumOfShares;\r\n    _this.getBalance = getBalance;\r\n    _this.isBalanced = isBalanced;\r\n    _this.getParticipations = getParticipations;\r\n    _this.shareCost = shareCost;\r\n    _this.equals = equals;\r\n    _this.exportData = exportData;\r\n\r\n    ///////////////////////////////////////\r\n\r\n    var _myParticipations = _.chain(participations).filter(function(p) {\r\n      return _this.equals(p.expense);\r\n    });\r\n\r\n\r\n    function getTotal(participationMapping, currency) {\r\n      var total = _myParticipations\r\n        .map(participationMapping)\r\n        .reduce(function(total, value) {\r\n          return total.add(value);\r\n        }, new Decimal(0))\r\n        .value()\r\n        .toNumber();\r\n\r\n      if (!currency || currency === _this.computedCurrency()) {\r\n        return total;\r\n      } else {\r\n        return tryToConvertCurrency({\r\n          value: total,\r\n          fixed: _this.computedCurrency(),\r\n          variable: currency\r\n        });\r\n      }\r\n    }\r\n\r\n\r\n    /**\r\n     * Gets the currency of this expense used for currency computations.\r\n     *\r\n     * @returns {string} - The currency of this expense\r\n     */\r\n    function computedCurrency() {\r\n      return _this.currency || _sheet.currency;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} [currency] - Currency in which to get the value. Default is this expense's currency or if undefined, the balance sheet's default currency.\r\n     * @return {number} The cost of this expense. NaN if cannot convert currency.\r\n     */\r\n    function getCost(currency) {\r\n      return getTotal(function(pt) {\r\n        return pt.paid;\r\n      }, currency);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} [currency] - Currency in which to get the value. Default is this expense's currency or if undefined, the balance sheet's default currency.\r\n     * @return {number} The sum of shares of this expense. NaN if cannot convert currency.\r\n     */\r\n    function getSumOfShares(currency) {\r\n      return getTotal(function(pt) {\r\n        return pt.share;\r\n      }, currency);\r\n    }\r\n\r\n    function isBalanced() {\r\n      return getBalance(_this.computedCurrency()) === 0;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} [currency] - Currency in which to get the value. Default is this expense's currency or if undefined, the balance sheet's default currency.\r\n     * @return {number} The balance of this expense. NaN if cannot convert currency.\r\n     */\r\n    function getBalance(currency) {\r\n      return new Decimal( getSumOfShares(currency) ).subtract( getCost(currency) ).toNumber();\r\n    }\r\n\r\n    function getParticipations() {\r\n      return _myParticipations.value();\r\n    }\r\n\r\n    function shareCost() {\r\n      if (_this.sharing === \"equal\") {\r\n        shareEqually();\r\n      }\r\n    }\r\n\r\n    function shareEqually() {\r\n      var participations = _this.getParticipations();\r\n      if (participations.length === 0) {\r\n        return;\r\n      }\r\n\r\n      var cost = new Decimal(_this.getCost());\r\n      var share = cost.divideBy(participations.length);\r\n      var lastShare = cost.subtract(share.multiply(participations.length - 1));\r\n\r\n      _.forEach(participations, function(p, i) {\r\n        if (i < participations.length - 1) {\r\n          p.share = share.toNumber();\r\n        }\r\n      });\r\n      _.last(participations).share = lastShare.toNumber();\r\n    }\r\n\r\n    function equals(other) {\r\n      return (other instanceof Expense) && (other.id === _this.id);\r\n    }\r\n\r\n    function exportData() {\r\n      var isNotFunction = _.negate(_.isFunction);\r\n      return _.extend(_.pickBy(_this, isNotFunction));\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * Creates a participation of a Person to an Expense.\r\n   *\r\n   * @param {Object} data - Participation data\r\n   * @param {Person} data.person - The participant person\r\n   * @param {Expense} data.expense - The expense to participate in\r\n   * @param {number} [data.paid=0] - How much the person has paid for the expense (in the expense currency)\r\n   * @param {number} [data.share=0] - The person's share of the expense's total cost (in the expense currency)\r\n   * @constructor\r\n   */\r\n  function Participation(data) {\r\n    var _this = this;\r\n\r\n    if (!data || !data.person || !data.expense) {\r\n      throw new ReferenceError(\"Undefined participation\");\r\n    }\r\n\r\n    // Data\r\n\r\n    _.extend(_this, data);\r\n\r\n    // Methods\r\n\r\n    _this.getPaid = getPaid;\r\n    _this.getShare = getShare;\r\n    _this.equals = equals;\r\n    _this.exportData = exportData;\r\n\r\n    ///////////////////////////////////////\r\n\r\n    function getCurrencyConversionFunction(options) {\r\n      if (options.strictConversion) {\r\n        return convertCurrency;\r\n      } else {\r\n        return tryToConvertCurrency;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Returns the value of property propName with currency conversion (if applicable) adjusted such\r\n     * that the expense is balanced in the target currency.\r\n     *\r\n     * @param {string} propName - The name of the monetary value property\r\n     * @param {string} currency - The target currency\r\n     * @param {object} options - Currrency conversion options\r\n     * @returns {number} - The property value with currency conversion\r\n     */\r\n    function getValue(propName, currency, options) {\r\n      if (!currency || currency === _this.expense.computedCurrency()) {\r\n        return _this[propName];\r\n      }\r\n\r\n      options = _.extend({strictConversion: false}, options);\r\n      var convert = getCurrencyConversionFunction(options);\r\n      var expenseParticipations = _this.expense.getParticipations();\r\n\r\n      if (_.last(expenseParticipations) === _this) {\r\n\r\n        var thisValueConverted = convert({\r\n          value: _this[propName],\r\n          fixed: _this.expense.computedCurrency(),\r\n          variable: currency\r\n        });\r\n\r\n        var originalSum = _.reduce(expenseParticipations, function(sum, prt) {\r\n          return sum.add(prt[propName]);\r\n        }, new Decimal(0)).toNumber();\r\n\r\n        var convertedSum = convert({\r\n          value: originalSum,\r\n          fixed: _this.expense.computedCurrency(),\r\n          variable: currency\r\n        });\r\n\r\n        var sumOfConverted = _.reduce(expenseParticipations, function(sum, prt) {\r\n          var value = convert({\r\n            value: prt[propName],\r\n            fixed: prt.expense.computedCurrency(),\r\n            variable: currency\r\n          });\r\n          return sum.add(value);\r\n        }, new Decimal(0));\r\n\r\n        var delta = sumOfConverted.subtract(convertedSum);\r\n\r\n        return new Decimal(thisValueConverted).subtract(delta).toNumber();\r\n\r\n      } else {\r\n\r\n        return convert({\r\n          value: _this[propName],\r\n          fixed: _this.expense.computedCurrency(),\r\n          variable: currency\r\n        });\r\n\r\n      }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} [currency] - Currency in which to get the payment. Default is expense's currency.\r\n     * @param {object} [options] - Options\r\n     * @param {boolean} [options.strictConversion] - True to throw error if currency conversion fails, false to return NaN. Default is false.\r\n     * @return {number} How much the person paid for the expense.\r\n     */\r\n    function getPaid(currency, options) {\r\n      return getValue(\"paid\", currency, options);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} [currency] - Currency in which to get the share. Default is expense's currency.\r\n     * @param {object} [options] - Options\r\n     * @param {boolean} [options.strictConversion] - True to throw error if currency conversion fails, false to return NaN. Default is false.\r\n     * @return {number} How much the person shares for the expense.\r\n     */\r\n    function getShare(currency, options) {\r\n      return getValue(\"share\", currency, options);\r\n    }\r\n\r\n    function equals(other) {\r\n      return (other instanceof Participation) && _this.expense.equals(other.expense) && _this.person.equals(other.person);\r\n    }\r\n\r\n    function exportData() {\r\n      return {personId: _this.person.id, expenseId: _this.expense.id, paid: _this.paid, share: _this.share};\r\n    }\r\n\r\n  }\r\n\r\n\r\n  function exportData() {\r\n    var isNotFunction = _.negate(_.isFunction);\r\n    var data = _.pickBy(_this, isNotFunction);\r\n    data.persons = _.map(persons, function(p) {\r\n      return p.exportData();\r\n    });\r\n    data.expenses = _.map(expenses, function(e) {\r\n      return e.exportData();\r\n    });\r\n    data.participations = _.map(participations, function(pt) {\r\n      return pt.exportData();\r\n    });\r\n    data.exchangeRates = getExchangeRates();\r\n    return data;\r\n  }\r\n\r\n  function importData(data) {\r\n    idSequence = _([])\r\n        .concat(data.persons)\r\n        .concat(data.expenses)\r\n        .map(\"id\")\r\n        .max() + 1;\r\n    if (_.isNaN(idSequence)) {\r\n      idSequence = 1;\r\n    }\r\n\r\n    var separately = {persons: true, expenses: true, participations: true, exchangeRates: true};\r\n\r\n    _.each(data.exchangeRates, function(q) {\r\n      addOrUpdateExchangeRate(q);\r\n    });\r\n\r\n    _.extend(_this, _.pickBy(data, function(value, key) {\r\n      return !separately[key];\r\n    }));\r\n\r\n    _.each(data.persons, function(p) {\r\n      createPerson(p);\r\n    });\r\n\r\n    _.each(data.expenses, function(e) {\r\n      createExpense(e);\r\n    });\r\n\r\n    _.each(data.participations, function(p) {\r\n      var person = getPerson(p.personId);\r\n      var expense = getExpense(p.expenseId);\r\n      createParticipation({person: person, expense: expense, paid: p.paid, share: p.share});\r\n    });\r\n\r\n    throwErrorIfInvalid();\r\n  }\r\n\r\n  function isValid() {\r\n    try {\r\n      throwErrorIfInvalid();\r\n      return true;\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function throwErrorIfInvalid() {\r\n\r\n    _.each(persons, function(p) {\r\n      if (!_.isNumber(p.id)) {\r\n        throw new Error(\"Person has no id\");\r\n      }\r\n    });\r\n\r\n    _.each(expenses, function(e) {\r\n      if (!_.isNumber(e.id)) {\r\n        throw new Error(\"Expense has no id\");\r\n      }\r\n    });\r\n\r\n    var idToEntity = {};\r\n    _.each(persons, function(p) {\r\n      idToEntity[p.id] = p;\r\n    });\r\n    _.each(expenses, function(e) {\r\n      idToEntity[e.id] = e;\r\n    });\r\n    _.each(participations, function(pt) {\r\n      if (!pt.person) {\r\n        throw new Error(\"Participation has no person\");\r\n      }\r\n      if (!idToEntity[pt.person.id]) {\r\n        throw new Error(\"Participation person is unknown\");\r\n      }\r\n      if (!pt.expense) {\r\n        throw new Error(\"Participation has no expense\");\r\n      }\r\n      if (!idToEntity[pt.expense.id]) {\r\n        throw new Error(\"Participation expense is unknown\");\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\nmodule.exports = BalanceSheet;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/balance-sheet/balance-sheet.js\n// module id = 40\n// module chunks = 0","\"use strict\";\r\n\r\nfunction CurrencyConversionError(message) {\r\n  var temp = Error.apply(this, arguments);\r\n  //temp.name = this.name = 'CurrencyConversionError';\r\n  this.stack = temp.stack;\r\n  this.message = temp.message;\r\n}\r\n\r\nCurrencyConversionError.prototype = Object.create(Error.prototype, {\r\n  constructor: {\r\n    value: CurrencyConversionError,\r\n    writable: true,\r\n    configurable: true\r\n  }\r\n});\r\n\r\nmodule.exports = CurrencyConversionError;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/balance-sheet/currency-conversion-error.js\n// module id = 41\n// module chunks = 0","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar BalanceSheet = require('./balance-sheet');\r\n\r\nangular.module(\"debtApp\")\r\n  .factory(\"balanceSheetService\", balanceSheetService);\r\n\r\nfunction balanceSheetService(localStorageService) {\r\n\r\n  var DATE_REGEX = /\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z/; // 2016-04-07T21:00:00.000Z\r\n\r\n  var service = {\r\n    balanceSheet: undefined,\r\n    save: save,\r\n    loadFromJson: loadFromJson,\r\n    exportToJson: exportToJson,\r\n    createNew: createNew,\r\n    init: init\r\n  };\r\n\r\n  return service;\r\n\r\n\r\n  function init() {\r\n    var localStorageData = localStorageService.get(\"balanceSheetData\");\r\n    var data;\r\n    if (localStorageData && localStorageData.json) {\r\n       data = JSON.parse(localStorageData.json, dateReviver);\r\n    } else if (localStorageData) {\r\n      data = localStorageData; // backwards compatibility\r\n    } else {\r\n      data = {};\r\n    }\r\n    service.balanceSheet = new BalanceSheet(data);\r\n  }\r\n\r\n  function save() {\r\n    if (!service.balanceSheet) {\r\n      throw new ReferenceError(\"No balance valid balance sheet\");\r\n    }\r\n    service.balanceSheet.throwErrorIfInvalid();\r\n\r\n    // Store a JSON string in localStorage instead of allowing localStorageService to stringify\r\n    // the data so that we can control date parsing.\r\n    var jsonString = JSON.stringify(service.balanceSheet.exportData());\r\n    localStorageService.set(\"balanceSheetData\", {json: jsonString});\r\n  }\r\n\r\n  function loadFromJson(json) {\r\n    var data = JSON.parse(json, dateReviver);\r\n    var balanceSheet = new BalanceSheet(data);\r\n    balanceSheet.throwErrorIfInvalid();\r\n    service.balanceSheet = balanceSheet;\r\n    save();\r\n  }\r\n\r\n  function dateReviver(key, value) {\r\n    if (typeof value === 'string' && DATE_REGEX.test(value)) {\r\n      return new Date(value);\r\n    }\r\n    return value;\r\n  }\r\n\r\n  function exportToJson() {\r\n    var data = service.balanceSheet.exportData();\r\n    return JSON.stringify(data);\r\n  }\r\n\r\n  function createNew() {\r\n    service.balanceSheet = new BalanceSheet();\r\n    service.save();\r\n  }\r\n\r\n}\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/balance-sheet/balance-sheet-service.js","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n  .controller(\"BalanceSheetCtrl\", BalanceSheetCtrl);\r\n\r\nfunction BalanceSheetCtrl(balanceSheetService, debtService, events, $scope, $log) {\r\n  var vm = this;\r\n  \r\n  vm.init = init;\r\n  vm.refresh = refresh;\r\n  vm.updateSheet = updateSheet;\r\n  \r\n  init();\r\n  \r\n  /////////////////////////////////////////////////////////////\r\n  \r\n  function init() {\r\n    refresh();\r\n    $scope.$on(events.BALANCE_SHEET_UPDATED, vm.refresh);\r\n  }\r\n  \r\n  function refresh() {\r\n    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n    try {\r\n      vm.debtsByDebtor = computeDebts();\r\n      vm.debtComputationError = undefined;\r\n    } catch (e) {\r\n      $log.error(e);\r\n      vm.debtsByDebtor = undefined;\r\n      vm.debtComputationError = \"Cannot compute debts\";\r\n    }\r\n  }\r\n  \r\n  function computeDebts() {\r\n    if (vm.balanceSheet.isBalanced()) {\r\n      var participations = vm.balanceSheet.getNonSettledParticipations();\r\n      var debts = debtService.computeDebts(participations, vm.balanceSheet.currency);\r\n      return debtService.organizeByDebtor(debts);\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  function updateSheet() {\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/balance-sheet/balance-sheet-ctrl.js","\"use strict\";\r\n\r\nrequire(\"./route-config\");\r\nrequire(\"./person-detail-ctrl\");\r\nrequire(\"./create-person-dialog\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/persons/index.js\n// module id = 44\n// module chunks = 0","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar personDetailTpl = require(\"./person-detail.html\");\r\nvar floatingButtonTpl = require(\"./floating-button.html\");\r\n\r\nangular.module(\"debtApp\")\r\n  .config(config);\r\n\r\nfunction config($stateProvider) {\r\n  $stateProvider\r\n    .state(\"person\", {\r\n      url: \"/persons/:id\",\r\n      views: {\r\n        \"\": {\r\n          templateUrl: personDetailTpl,\r\n          controller: \"PersonDetailCtrl as vm\"\r\n        },\r\n        \"floatingButton\": {\r\n          templateUrl: floatingButtonTpl\r\n        }\r\n      }\r\n\r\n    });\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/persons/route-config.js","var path = 'persons/person-detail.html';\nvar html = \"<section> <div layout=row layout-align=\\\"start start\\\"> <md-input-container class=md-title flex md-no-float> <input type=text placeholder=\\\"Person name\\\" ng-model=::vm.person.name ng-change=::vm.updatePerson() ng-required=true /> </md-input-container> <md-button class=md-icon-button aria-label=delete ng-click=vm.removePerson()> <md-tooltip>Delete</md-tooltip> <md-icon md-svg-icon=ic_delete_24px></md-icon> </md-button> </div> <div layout=column> <div layout=row layout-align=\\\"start center\\\"> <span flex id=balance>Balance</span> <span aria-labelledby=balance class=margin-right> <span ng-if=::vm.balanceSheet.currenciesEnabled()>{{::vm.person.computedCurrency()}}</span> {{vm.balance | balance}} </span> </div> </div> </section> <section> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">Expenses</md-subheader> <div layout=column> <div ng-repeat=\\\"expense in vm.balanceSheet.expenses\\\" class=participation layout-xs=column layout-align-xs=\\\"center start\\\" layout-gt-xs=row layout-align-gt-xs=\\\"start center\\\"> <div layout-fill class=participant flex-gt-xs layout=row layout-align=\\\"start center\\\"> <md-checkbox class=md-primary ng-class=\\\"{'md-warn': !expense.isBalanced()}\\\" ng-model=::vm.isParticipant[expense.id] ng-change=\\\"::vm.setParticipation(expense, vm.isParticipant[expense.id])\\\" ng-disabled=::expense.settled> <span ng-class=\\\"::{settled: expense.settled}\\\">{{::expense.name}}</span> </md-checkbox> <span flex></span> <md-button hide-gt-xs ng-href=#/expenses/{{::expense.id}} class=md-icon-button aria-label=\\\"{{::expense.name}} details\\\"> <md-icon md-svg-icon=ic_chevron_right_24px></md-icon> </md-button> </div> <div layout=row layout-align=\\\"start center\\\"> <span class=currency-label ng-if=::vm.balanceSheet.currenciesEnabled()>{{::expense.computedCurrency()}}</span> <md-input-container> <label>Paid</label> <input type=number money-input ng-required=::vm.isParticipant[expense.id] ng-model=\\\"::vm.balanceSheet.getParticipation({person: vm.person, expense: expense}).paid\\\" ng-change=::vm.updateExpense(expense) ng-disabled=\\\"expense.settled || !vm.isParticipant[expense.id]\\\"/> </md-input-container> <md-input-container> <label>Share</label> <input type=number money-input ng-required=::vm.isParticipant[expense.id] ng-model=\\\"::vm.balanceSheet.getParticipation({person: vm.person, expense: expense}).share\\\" ng-change=::vm.updateExpense(expense) ng-disabled=\\\"expense.settled || !vm.isParticipant[expense.id]\\\" ng-readonly=\\\"::expense.sharing != 'custom'\\\"/> </md-input-container> </div> <md-button hide-xs ng-href=#/expenses/{{::expense.id}} class=md-icon-button aria-label=\\\"{{::expense.name}} details\\\"> <md-icon md-svg-icon=ic_chevron_right_24px></md-icon> </md-button> </div> <div class=participation layout-xs=column layout-align-xs=\\\"center start\\\" layout-gt-xs=row layout-align-gt-xs=\\\"start center\\\"> <div layout-fill flex-gt-xs layout=row layout-align=\\\"start center\\\"> <span class=label>Total</span> <icon-button-strut hide-gt-xs></icon-button-strut> </div> <div layout=row layout-align=\\\"start center\\\"> <span class=currency-label ng-if=::vm.balanceSheet.currenciesEnabled()>{{::vm.person.computedCurrency()}}</span> <md-input-container> <label>Paid</label> <input type=number money-input ng-model=::vm.cost ng-readonly=true /> </md-input-container> <md-input-container> <label>Share</label> <input type=number money-input ng-model=::vm.sumOfShares ng-readonly=true /> </md-input-container> </div> <icon-button-strut hide-xs></icon-button-strut> </div> </div> </section> <section> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">Debts</md-subheader> <div layout=column> <div ng-switch=vm.debtRole class=margin-bottom> <span ng-switch-when=debtor>{{vm.person.name}} owes</span> <span ng-switch-when=creditor>{{vm.person.name}} is owed by</span> <span ng-switch-when=settled>{{vm.person.name}} is settled up</span> <span ng-switch-when=unbalanced>Debts cannot be computed. There are unbalanced expenses.</span> </div> <div ng-repeat=\\\"d in vm.debts\\\" class=\\\"margin-bottom margin-left-double\\\"> <span>{{d.person.name}}: {{d.currency}} {{d.amount | money}}</span> </div> <div ng-if=vm.debtComputationError class=margin-bottom> <md-icon class=md-warn md-svg-icon=ic_warning_24px></md-icon> {{vm.debtComputationError}} </div> </div> </section>\";\nwindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/persons/person-detail.html\n// module id = 46\n// module chunks = 0","var path = 'persons/floating-button.html';\nvar html = \"<md-fab-speed-dial class=md-fab-bottom-right> <md-fab-trigger> <md-button ng-click=::vm.createExpense() aria-label=\\\"Create expense\\\" class=\\\"md-fab md-primary\\\"> <md-icon md-svg-icon=ic_shopping_basket_24px></md-icon> </md-button> </md-fab-trigger> </md-fab-speed-dial>\";\nwindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/persons/floating-button.html\n// module id = 47\n// module chunks = 0","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar _ = require('lodash');\r\n\r\nangular.module(\"debtApp\")\r\n  .controller(\"PersonDetailCtrl\", PersonDetailCtrl);\r\n\r\nfunction PersonDetailCtrl(balanceSheetService,\r\n                          debtService,\r\n                          events,\r\n                          debounce,\r\n                          debtCalculationInterval,\r\n                          $state,\r\n                          $stateParams,\r\n                          $mdDialog,\r\n                          $scope,\r\n                          $timeout,\r\n                          $log) {\r\n\r\n  var vm = this;\r\n  var confirmRemovePerson;\r\n\r\n  var computeDebtsDebounced = debounce(function() {\r\n    $timeout(function() {\r\n      try {\r\n        var debtResult = computeDebts();\r\n        vm.debtRole = debtResult.role;\r\n        vm.debts = debtResult.debts;\r\n        vm.debtComputationError = undefined;\r\n      } catch (e) {\r\n        $log.error(e);\r\n        vm.debtRole = undefined;\r\n        vm.debts = undefined;\r\n        vm.debtComputationError = \"Cannot compute debts\";\r\n      }\r\n    });\r\n  }, debtCalculationInterval);\r\n\r\n  vm.init = init;\r\n  vm.refresh = refresh;\r\n  vm.updateExpense = updateExpense;\r\n  vm.setParticipation = setParticipation;\r\n  vm.removePerson = removePerson;\r\n  vm.updatePerson = updatePerson;\r\n\r\n  init();\r\n\r\n  function init() {\r\n    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n    vm.person = vm.balanceSheet.getPerson($stateParams.id);\r\n\r\n    refresh();\r\n\r\n    confirmRemovePerson = $mdDialog.confirm()\r\n      .content(\"Really delete this person?\")\r\n      .ok(\"Ok\").cancel(\"Cancel\");\r\n\r\n    $scope.$on(events.BALANCE_SHEET_UPDATED, vm.refresh);\r\n  }\r\n\r\n  function refresh() {\r\n    vm.isParticipant = getParticipationMap();\r\n    vm.cost = vm.person.getCost();\r\n    vm.sumOfShares = vm.person.getSumOfShares();\r\n    vm.balance = vm.person.getBalance();\r\n    computeDebtsDebounced();\r\n  }\r\n\r\n  function getParticipationMap() {\r\n    var map = {};\r\n\r\n    _.forEach(vm.balanceSheet.expenses, function(expense) {\r\n      map[expense.id] = false;\r\n      _.forEach(vm.person.getParticipations(), function(pt) {\r\n        if (pt.expense.equals(expense)) {\r\n          map[expense.id] = true;\r\n        }\r\n      });\r\n    });\r\n\r\n    return map;\r\n  }\r\n\r\n  function updateExpense(expense) {\r\n    expense.shareCost();\r\n    refresh();\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n\r\n  function setParticipation(expense, isParticipant) {\r\n    if (isParticipant) {\r\n      vm.balanceSheet.createParticipation({expense: expense, person: vm.person});\r\n    } else {\r\n      vm.balanceSheet.removeParticipation({expense: expense, person: vm.person});\r\n    }\r\n    vm.updateExpense(expense);\r\n  }\r\n\r\n  function computeDebts() {\r\n    var result = {\r\n      role: undefined,\r\n      debts: undefined\r\n    };\r\n\r\n    if (!vm.balanceSheet.isBalanced()) {\r\n      result.role = \"unbalanced\";\r\n      return result;\r\n    }\r\n\r\n    if (vm.balance > 0) {\r\n      result.role = \"debtor\";\r\n    } else if (vm.balance < 0) {\r\n      result.role = \"creditor\";\r\n    } else if (vm.balance === 0) {\r\n      result.role = \"settled\";\r\n      return result;\r\n    }\r\n\r\n    var counterRole = {\r\n      \"debtor\": \"creditor\",\r\n      \"creditor\": \"debtor\"\r\n    };\r\n\r\n    var debts = debtService.computeDebts(vm.balanceSheet.getNonSettledParticipations(), vm.person.computedCurrency());\r\n    result.debts = _.chain(debts)\r\n      .filter(function(d) {\r\n        return d[result.role].equals(vm.person);\r\n      })\r\n      .map(function(d) {\r\n        return {person: d[counterRole[result.role]], amount: d.amount, currency: d.currency};\r\n      })\r\n      .value();\r\n\r\n    return result;\r\n  }\r\n\r\n  function removePerson() {\r\n    $mdDialog.show(confirmRemovePerson)\r\n      .then(doRemovePerson);\r\n  }\r\n\r\n  function doRemovePerson() {\r\n    vm.balanceSheet.removePerson(vm.person);\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n    $state.go(\"balanceSheet\");\r\n  }\r\n\r\n  function updatePerson() {\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/persons/person-detail-ctrl.js","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar createPersonDialogTpl = require(\"./create-person-dialog.html\");\r\n\r\nangular.module(\"debtApp\")\r\n.factory(\"openCreatePersonDialog\", openCreatePersonDialog);\r\n\r\n\r\nfunction openCreatePersonDialog($mdDialog) {\r\n  \r\n  return open;\r\n  \r\n  function open() {\r\n    return $mdDialog.show({\r\n      templateUrl: createPersonDialogTpl,\r\n      controller: DialogController,\r\n      controllerAs: \"vm\"\r\n    });\r\n  }\r\n  \r\n}\r\n\r\nfunction DialogController($mdDialog) {\r\n  var vm = this;\r\n  \r\n  vm.ok = ok;\r\n  vm.cancel = cancel;\r\n  vm.init = init;\r\n  \r\n  init();\r\n  \r\n  \r\n  function init() {\r\n    vm.person = {\r\n      name: undefined\r\n    };\r\n    vm.options = {\r\n      createParticipations: true\r\n    };\r\n  }\r\n\r\n  function ok() {\r\n    $mdDialog.hide({person: vm.person, options: vm.options});\r\n  }\r\n  \r\n  function cancel() {\r\n    $mdDialog.cancel();\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/persons/create-person-dialog.js","var path = 'persons/create-person-dialog.html';\nvar html = \"<md-dialog aria-label=\\\"Create person dialog\\\"> <form name=form novalidate autocomplete=off> <md-dialog-content class=md-dialog-content> <h2 class=md-title>Create person</h2> <div layout=column> <md-input-container> <label>Name</label> <input type=text ng-model=vm.person.name ng-required=true md-autofocus/> </md-input-container> <md-checkbox ng-model=vm.options.createParticipations class=md-primary> Shares all expenses </md-checkbox> </div> </md-dialog-content> <md-dialog-actions> <md-button type=button ng-click=vm.cancel()>Cancel</md-button> <md-button type=submit class=md-primary ng-click=vm.ok() ng-disabled=!form.$valid>Ok</md-button> </md-dialog-actions> </form> </md-dialog> \";\nwindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/persons/create-person-dialog.html\n// module id = 50\n// module chunks = 0","\"use strict\";\r\n\r\nrequire(\"./route-config\");\r\nrequire(\"./expense-detail-ctrl\");\r\nrequire(\"./create-expense-dialog\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/expenses/index.js\n// module id = 51\n// module chunks = 0","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar expenseDetailTpl = require(\"./expense-detail.html\");\r\nvar floatingButtonTpl = require(\"./floating-button.html\");\r\n\r\nangular.module(\"debtApp\")\r\n\t.config(config);\r\n\r\nfunction config($stateProvider) {\r\n\r\n\t$stateProvider\r\n\t\t.state(\"expense\", {\r\n\t\t\turl: \"/expenses/:id\",\r\n\t\t\tviews: {\r\n\t\t\t\t\"\": {\r\n\t\t\t\t\ttemplateUrl: expenseDetailTpl,\r\n\t\t\t\t\tcontroller: \"ExpenseDetailCtrl as vm\"\r\n\t\t\t\t},\r\n\t\t\t\t\"floatingButton\": {\r\n\t\t\t\t\ttemplateUrl: floatingButtonTpl\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\t;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/expenses/route-config.js","var path = 'expenses/expense-detail.html';\nvar html = \"<section layout=column> <div layout=row layout-align=\\\"start start\\\"> <md-input-container class=md-title flex md-no-float> <input type=text placeholder=\\\"Expense name\\\" ng-model=::vm.expense.name ng-change=::vm.updateExpense() ng-required=true /> </md-input-container> <md-button class=md-icon-button aria-label=delete ng-click=::vm.removeExpense()> <md-tooltip>Delete</md-tooltip> <md-icon md-svg-icon=ic_delete_24px></md-icon> </md-button> </div> <div layout=column> <div class=row layout=row layout-align=\\\"start center\\\"> <span flex aria-hidden=true>Date</span> <md-datepicker class=no-icon md-placeholder=Date ng-model=::vm.expense.date ng-change=::vm.updateExpense()></md-datepicker> </div> <div ng-if=::vm.balanceSheet.currenciesEnabled() class=row layout=row layout-align=\\\"start center\\\"> <span flex aria-hidden=true>Currency</span> <md-select id=currency aria-label=Currency class=\\\"no-margin margin-right\\\" ng-model=vm.expense.currency ng-change=::vm.updateExpense()> <md-option ng-value=::currency ng-repeat=\\\"currency in ::vm.balanceSheet.getCurrencies()\\\">{{::currency}}</md-option> </md-select> </div> <div class=row layout=row layout-align=\\\"start center\\\"> <span flex id=cost>Cost</span> <div aria-labelledby=cost class=margin-right> <span ng-if=::vm.balanceSheet.currenciesEnabled()>{{vm.expense.currency}}</span> {{vm.cost | money}} <span ng-if=\\\"vm.balanceSheet.currenciesEnabled() && vm.balanceSheet.currency !== vm.expense.computedCurrency()\\\"> ({{vm.balanceSheet.currency}} {{vm.expense.getCost(vm.balanceSheet.currency) | money}}) </span> </div> </div> <div class=row layout=row layout-align=\\\"start center\\\"> <span flex aria-hidden=true>Share equally</span> <md-switch ng-model=vm.expense.sharing ng-change=::vm.updateExpense() ng-disabled=vm.expense.settled ng-true-value=\\\"'equal'\\\" ng-false-value=\\\"'custom'\\\" id=sharing class=\\\"md-primary no-margin\\\" aria-label=\\\"Share equally\\\"> </md-switch> </div> <div class=row layout=row layout-align=\\\"start center\\\"> <span flex aria-hidden=true>Settled</span> <md-switch ng-model=vm.expense.settled ng-change=::vm.updateExpense() id=settled class=\\\"md-primary no-margin\\\" aria-label=Settled> </md-switch> </div> </div> </section> <section> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">People</md-subheader> <div layout=column> <div ng-repeat=\\\"person in vm.balanceSheet.persons\\\" class=participation layout-xs=column layout-align-xs=\\\"center start\\\" layout-gt-xs=row layout-align-gt-xs=\\\"start center\\\"> <div layout-fill flex-gt-xs class=participant layout=row layout-align=\\\"start center\\\"> <md-checkbox class=md-primary ng-model=::vm.isParticipant[person.id] ng-change=\\\"::vm.setParticipation(person, vm.isParticipant[person.id])\\\" ng-disabled=vm.expense.settled> {{::person.name}} </md-checkbox> <span flex></span> <md-button hide-gt-xs ng-href=#/persons/{{::person.id}} class=md-icon-button aria-label=\\\"{{::person.name}} details\\\"> <md-icon md-svg-icon=ic_chevron_right_24px></md-icon> </md-button> </div> <div layout=row layout-align=\\\"start center\\\"> <span class=currency-label ng-if=::vm.balanceSheet.currenciesEnabled()>{{vm.expense.currency}}</span> <md-input-container> <label>Paid</label> <input type=number money-input ng-required=::vm.isParticipant[person.id] ng-model=\\\"::vm.balanceSheet.getParticipation({person: person, expense: vm.expense}).paid\\\" ng-change=::vm.updateExpense() ng-disabled=\\\"vm.expense.settled || !vm.isParticipant[person.id]\\\"/> </md-input-container> <md-input-container> <label>Share</label> <input type=number money-input ng-required=::vm.isParticipant[person.id] ng-model=\\\"::vm.balanceSheet.getParticipation({person: person, expense: vm.expense}).share\\\" ng-change=::vm.updateExpense() ng-disabled=\\\"vm.expense.settled || !vm.isParticipant[person.id]\\\" ng-readonly=\\\"vm.expense.sharing != 'custom'\\\"/> </md-input-container> </div> <md-button hide-xs ng-href=#/persons/{{::person.id}} class=md-icon-button aria-label=\\\"{{::person.name}} details\\\"> <md-icon md-svg-icon=ic_chevron_right_24px></md-icon> </md-button> </div> <div class=participation layout-xs=column layout-align-xs=\\\"center start\\\" layout-gt-xs=row layout-align-gt-xs=\\\"start center\\\"> <div layout-fill flex-gt-xs layout=row layout-align=\\\"start center\\\"> <span ng-if=!vm.isBalanced style=color:red> <md-icon class=\\\"md-warn no-margin-left\\\" md-svg-icon=ic_warning_24px></md-icon>&nbsp;Unbalanced </span> <span ng-if=vm.isBalanced class=label>Total</span> <icon-button-strut hide-gt-xs></icon-button-strut> </div> <div layout=row layout-align=\\\"start center\\\"> <span class=currency-label ng-if=::vm.balanceSheet.currenciesEnabled()>{{vm.expense.currency}}</span> <md-input-container> <label>Paid</label> <input type=number money-input ng-model=::vm.cost ng-readonly=true /> </md-input-container> <md-input-container> <label>Share</label> <input type=number money-input ng-model=::vm.sumOfShares ng-readonly=true /> </md-input-container> </div> <icon-button-strut hide-xs></icon-button-strut> </div> </div> </section> <section> <md-subheader class=\\\"md-primary section-header md-no-sticky\\\">Debts</md-subheader> <div layout=column> <div ng-if=\\\"vm.debtsByDebtor.length > 0\\\"> <p ng-if=!vm.expense.settled>To settle this expense individually:</p> <div ng-if=vm.expense.settled> <p>This expense is settled. It does not affect total balances and debts.</p> <p>The debts from this expense were:</p> </div> <div ng-repeat=\\\"d in vm.debtsByDebtor\\\"> <p layout=column> <span class=margin-bottom>{{d.debtor.name}} owes </span> <span ng-repeat=\\\"c in d.debts\\\" class=\\\"margin-bottom margin-left-double\\\"> {{c.creditor.name}}: <span ng-if=::vm.balanceSheet.currenciesEnabled()>{{c.currency}}</span> {{c.amount | money}} </span> </p> </div> </div> <div ng-if=\\\"vm.debtsByDebtor.length == 0\\\"> <p>No debts!</p> </div> <div ng-if=!vm.isBalanced> <p>Cannot compute debts. Expense is not balanced.</p> </div> </div> </section>\";\nwindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/expenses/expense-detail.html\n// module id = 53\n// module chunks = 0","var path = 'expenses/floating-button.html';\nvar html = \"<md-fab-speed-dial class=md-fab-bottom-right> <md-fab-trigger> <md-button ng-click=::vm.createPerson() aria-label=\\\"Create person\\\" class=\\\"md-fab md-primary\\\"> <md-icon md-svg-icon=ic_face_24px></md-icon> </md-button> </md-fab-trigger> </md-fab-speed-dial>\";\nwindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/expenses/floating-button.html\n// module id = 54\n// module chunks = 0","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular\r\n  .module(\"debtApp\")\r\n  .controller(\"ExpenseDetailCtrl\", ExpenseDetailCtrl);\r\n\r\nfunction ExpenseDetailCtrl(balanceSheetService,\r\n                           debtService,\r\n                           events,\r\n                           debounce,\r\n                           debtCalculationInterval,\r\n                           $mdDialog,\r\n                           $stateParams,\r\n                           $state,\r\n                           $scope,\r\n                           $timeout)\r\n{\r\n  var vm = this;\r\n\r\n  var confirmRemoveExpense = $mdDialog.confirm()\r\n    .content(\"Really delete this expense?\")\r\n    .ok(\"Ok\").cancel(\"Cancel\");\r\n\r\n  var computeDebtsDebounced = debounce(function() {\r\n    $timeout(function() {\r\n      vm.debtsByDebtor = computeDebts();\r\n    });\r\n  }, debtCalculationInterval);\r\n\r\n  vm.init = init;\r\n  vm.setParticipation = setParticipation;\r\n  vm.updateExpense = updateExpense;\r\n  vm.removeExpense = removeExpense;\r\n  vm.setCurrency = setCurrency;\r\n\r\n  init();\r\n\r\n  /////////////////////////////////////////////////////////////\r\n\r\n  function init() {\r\n    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n    vm.expense = vm.balanceSheet.getExpense($stateParams.id);\r\n    vm.isParticipant = {};\r\n    vm.everyoneParticipates = true;\r\n    updateExpense();\r\n\r\n    $scope.$on(events.BALANCE_SHEET_UPDATED, function(event) {\r\n      if (event.targetScope != $scope) {\r\n        vm.updateExpense();\r\n      }\r\n    });\r\n  }\r\n\r\n  function updateExpense() {\r\n    vm.expense.shareCost();\r\n    vm.isParticipant = getParticipationMap();\r\n    vm.cost = vm.expense.getCost();\r\n    vm.sumOfShares = vm.expense.getSumOfShares();\r\n    vm.isBalanced = vm.expense.isBalanced();\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n    computeDebtsDebounced();\r\n  }\r\n\r\n  function getParticipationMap() {\r\n    var map = {};\r\n\r\n    angular.forEach(vm.balanceSheet.persons, function(person) {\r\n      map[person.id] = false;\r\n      angular.forEach(vm.expense.getParticipations(), function(p) {\r\n        if (p.person.equals(person)) {\r\n          map[person.id] = true;\r\n        }\r\n      });\r\n    });\r\n\r\n    return map;\r\n  }\r\n\r\n  function setParticipation(person, isParticipant) {\r\n    if (isParticipant) {\r\n      vm.balanceSheet.createParticipation({expense: vm.expense, person: person});\r\n    } else {\r\n      vm.balanceSheet.removeParticipation({expense: vm.expense, person: person});\r\n    }\r\n    updateExpense();\r\n  }\r\n\r\n  function removeExpense() {\r\n    $mdDialog.show(confirmRemoveExpense)\r\n      .then(doRemoveExpense);\r\n  }\r\n\r\n  function doRemoveExpense() {\r\n    vm.balanceSheet.removeExpense(vm.expense);\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n    $state.go(\"balanceSheet\");\r\n  }\r\n\r\n  function computeDebts() {\r\n    if (vm.expense.isBalanced()) {\r\n      var debts = debtService.computeDebts(vm.expense.getParticipations(), vm.expense.computedCurrency());\r\n      return debtService.organizeByDebtor(debts);\r\n    }\r\n  }\r\n\r\n  function setCurrency(currency) {\r\n    vm.expense.currency = currency;\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n  }\r\n\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/expenses/expense-detail-ctrl.js","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar createExpenseDialogTpl = require(\"./create-expense-dialog.html\");\r\n\r\nangular.module(\"debtApp\")\r\n.factory(\"openCreateExpenseDialog\", openCreateExpenseDialog);\r\n\r\n\r\nfunction openCreateExpenseDialog($mdDialog) {\r\n  \r\n  return open;\r\n  \r\n  function open() {\r\n    return $mdDialog.show({\r\n      templateUrl: createExpenseDialogTpl,\r\n      controller: DialogController,\r\n      controllerAs: \"vm\"\r\n    });\r\n  }\r\n  \r\n}\r\n\r\nfunction DialogController($mdDialog) {\r\n  var vm = this;\r\n  \r\n  vm.ok = ok;\r\n  vm.cancel = cancel;\r\n  vm.init = init;\r\n  \r\n  init();\r\n  \r\n  \r\n  function init() {\r\n    vm.expense = {\r\n      name: undefined,\r\n      sharing: \"equal\"\r\n    };\r\n    vm.options = {\r\n      createParticipations: true\r\n    };\r\n  }\r\n\r\n  function ok() {\r\n    $mdDialog.hide({expense: vm.expense, options: vm.options});\r\n  }\r\n  \r\n  function cancel() {\r\n    $mdDialog.cancel();\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/expenses/create-expense-dialog.js","var path = 'expenses/create-expense-dialog.html';\nvar html = \"<md-dialog aria-label=\\\"Create expense dialog\\\"> <form name=form novalidate autocomplete=off> <md-dialog-content class=md-dialog-content> <h2 class=md-title>Create expense</h2> <div layout=column> <md-input-container> <label>Name</label> <input type=text ng-model=vm.expense.name ng-required=true md-autofocus/> </md-input-container> <md-checkbox ng-model=vm.options.createParticipations class=md-primary> Everyone participates </md-checkbox> </div> </md-dialog-content> <md-dialog-actions> <md-button type=button ng-click=vm.cancel()>Cancel</md-button> <md-button type=submit class=md-primary ng-click=vm.ok() ng-disabled=!form.$valid>Ok</md-button> </md-dialog-actions> </form> </md-dialog> \";\nwindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/expenses/create-expense-dialog.html\n// module id = 57\n// module chunks = 0","\"use strict\";\r\n\r\nrequire(\"./money-input-directive\");\r\nrequire(\"./balance-filter\");\r\nrequire(\"./money-filter\");\r\nrequire(\"./file-service\");\r\nrequire(\"./focus-directive\");\r\nrequire(\"./debounce\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/utils/index.js\n// module id = 58\n// module chunks = 0","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar Decimal = require(\"simple-decimal-money\");\r\n\r\nangular.module(\"debtApp\")\r\n  .directive(\"moneyInput\", moneyInput);\r\n\r\n\r\nfunction moneyInput($filter) {\r\n  return {\r\n    restrict: \"A\",\r\n    require: \"ngModel\",\r\n    link: link\r\n  };\r\n\r\n  function link($scope, iElem, iAttrs, ngModel) {\r\n    ngModel.$validators.money = validateMoney;\r\n    ngModel.$parsers.push(parseMoney);\r\n    ngModel.$formatters.unshift(formatMoney);\r\n\r\n    iElem.on(\"blur\", handleBlur);\r\n    ngModel.$render = render;\r\n\r\n    function render() {\r\n      if (ngModel.$valid) {\r\n        iElem.val(formatMoney(ngModel.$modelValue));\r\n      } else {\r\n        iElem.val(ngModel.$viewValue);\r\n      }\r\n    }\r\n\r\n    function handleBlur() {\r\n      ngModel.$render();\r\n    }\r\n  }\r\n\r\n  function validateMoney(value) {\r\n    if (value < 0) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  function formatMoney(value) {\r\n    if (value === undefined || value === null) {\r\n      return \"\";\r\n    } else {\r\n      return $filter(\"number\")(value, 2);\r\n    }\r\n  }\r\n\r\n  function parseMoney(value) {\r\n    return new Decimal(value).toNumber();\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/utils/money-input-directive.js","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar _ = require('lodash');\r\n\r\nangular.module(\"debtApp\")\r\n  .filter(\"balance\", balance);\r\n\r\n\r\nfunction balance($filter) {\r\n  return function balance(value) {\r\n    if (!_.isNumber(value) || isNaN(value)) {\r\n      return value;\r\n    }\r\n\r\n    if (value > 0) {\r\n      return \"+\" + $filter(\"number\")(value, \"2\");\r\n    } else {\r\n      return $filter(\"number\")(value, \"2\");\r\n    }\r\n  };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/utils/balance-filter.js","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar _ = require('lodash');\r\n\r\n\r\nangular.module(\"debtApp\")\r\n  .filter(\"money\", money);\r\n\r\n\r\nfunction money($filter) {\r\n  return function money(value) {\r\n    if (!_.isNumber(value) || isNaN(value)) {\r\n      return value;\r\n    }\r\n\r\n    return $filter(\"number\")(value, \"2\");\r\n  };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/utils/money-filter.js","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar fileSaver = require(\"node-safe-filesaver\");\r\nrequire(\"blob-polyfill\");\r\n\r\nangular.module(\"debtApp\")\r\n  .factory(\"fileService\", fileService);\r\n\r\n\r\nfunction fileService($q, $window) {\r\n\r\n  return {\r\n    readAsText: readAsText,\r\n    saveAsFile: saveAsFile,\r\n    isSupported: isSupported\r\n  };\r\n\r\n  function readAsText(blob) {\r\n    var deferred = $q.defer();\r\n\r\n    var reader = new $window.FileReader();\r\n    reader.onload = function() {\r\n      deferred.resolve(reader.result);\r\n    };\r\n    reader.onerror = function() {\r\n      deferred.resolve(reader.error);\r\n    };\r\n    reader.readAsText(blob);\r\n\r\n    return deferred.promise;\r\n  }\r\n\r\n  function saveAsFile(dataArray, fileName) {\r\n    var blob = new $window.Blob(dataArray, {});\r\n    fileSaver.saveAs(blob, fileName);\r\n  }\r\n\r\n  function isSupported() {\r\n    return $window.FileReader && $window.Blob;\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/utils/file-service.js","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n  .directive(\"focus\", focus);\r\n\r\n\r\nfunction focus($timeout) {\r\n  return {\r\n    restrict: \"A\",\r\n    link: function($scope, iElem, iAttrs) {\r\n      var focusExpr = iAttrs.focus || 'true';\r\n      $timeout(function() {\r\n        var shouldFocus = $scope.$eval(focusExpr);\r\n        if (shouldFocus) {\r\n          iElem[0].focus();\r\n        }\r\n      }, 0);\r\n    }\r\n  };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/utils/focus-directive.js","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\n\r\nangular.module(\"debtApp\")\r\n  .factory(\"debounce\", debounceFactory);\r\n\r\n\r\nfunction debounceFactory($timeout) {\r\n\r\n  return debounce;\r\n\r\n  /**\r\n   * Returns a function, that, as long as it continues to be invoked, will not be triggered.\r\n   * The function will be called after it stops being called for N milliseconds.\r\n   *\r\n   * @param {function} func - The function to \"debouncify\"\r\n   * @param {number} [wait=10] - The time to wait (milliseconds) after the last call until func is called\r\n   * @param {Scope} [scope] - Angular scope to call the function in\r\n   * @param {boolean} [invokeApply=false] - Should the function call trigger $digest\r\n   * @returns {function} - The debounced function\r\n   */\r\n  function debounce(func, wait, scope, invokeApply) {\r\n    var timer;\r\n\r\n    return function debounced() {\r\n      var context = scope,\r\n        args = Array.prototype.slice.call(arguments);\r\n\r\n      $timeout.cancel(timer);\r\n      timer = $timeout(function() {\r\n\r\n        timer = undefined;\r\n        func.apply(context, args);\r\n\r\n      }, wait || 10, invokeApply);\r\n    };\r\n  }\r\n\r\n}\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/utils/debounce.js","\"use strict\";\r\n\r\nrequire(\"./route-config\");\r\nrequire(\"./currency-list-ctrl\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/currencies/index.js\n// module id = 69\n// module chunks = 0","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar currenciesTpl = require(\"./currencies.html\");\r\nvar floatingButtonTpl = require(\"./floating-button.html\");\r\n\r\nangular.module(\"debtApp\")\r\n  .config(config);\r\n\r\nfunction config($stateProvider) {\r\n\r\n  $stateProvider\r\n    .state(\"currencies\", {\r\n      url: \"/currencies\",\r\n      views: {\r\n        \"\": {\r\n          controller: \"CurrencyListCtrl as vm\",\r\n          templateUrl: currenciesTpl\r\n        },\r\n        \"floatingButton\": {\r\n          controller: \"CurrencyListCtrl as vm\",\r\n          templateUrl: floatingButtonTpl\r\n        }\r\n      }\r\n    })\r\n  ;\r\n  \r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/currencies/route-config.js","var path = 'currencies/currencies.html';\nvar html = \"<section> <div ng-repeat=\\\"quotation in vm.exchangeRates\\\" class=exchange-rate layout=row layout-align=\\\"start center\\\"> <span flex-xs=66 flex=33>{{::quotation.fixed}} to {{::quotation.variable}}</span> <md-input-container md-no-float> <input type=number placeholder=Rate ng-model=::quotation.rate ng-change=::vm.updateExchangeRate(quotation) required min=0.0001 /> </md-input-container> <span flex></span> <md-button class=md-icon-button ng-click=::vm.removeExchangeRate(quotation)> <md-icon aria-label=Remove md-svg-icon=ic_delete_24px></md-icon> </md-button> </div> <p ng-if=\\\"!vm.exchangeRates || vm.exchangeRates.length == 0\\\"> Enable currencies by adding an exchange rate. Click the floating button below. </p> </section> \";\nwindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/currencies/currencies.html\n// module id = 71\n// module chunks = 0","var path = 'currencies/floating-button.html';\nvar html = \"<md-fab-speed-dial class=md-fab-bottom-right> <md-fab-trigger> <md-button ng-click=::vm.openExchangeRateDialog() aria-label=\\\"Add exchange rate\\\" class=\\\"md-fab md-primary\\\"> <md-icon md-svg-icon=ic_attach_money_24px></md-icon> </md-button> </md-fab-trigger> </md-fab-speed-dial>\";\nwindow.angular.module('ng').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/currencies/floating-button.html\n// module id = 72\n// module chunks = 0","\"use strict\";\r\n\r\nvar angular = require(\"angular\");\r\nvar _ = require('lodash');\r\n\r\nangular.module(\"debtApp\")\r\n  .controller(\"CurrencyListCtrl\", CurrencyListCtrl)\r\n  .controller(\"ExchangeRateDialogCtrl\", ExchangeRateDialogCtrl);\r\n\r\n\r\nfunction CurrencyListCtrl(balanceSheetService, events, $scope, $mdDialog, debounce, $log) {\r\n  var vm = this;\r\n\r\n  vm.init = init;\r\n  vm.openExchangeRateDialog = openExchangeRateDialog;\r\n  vm.updateExchangeRate = updateExchangeRate;\r\n  vm.removeExchangeRate = removeExchangeRate;\r\n\r\n  init();\r\n\r\n  function init() {\r\n    vm.balanceSheet = balanceSheetService.balanceSheet;\r\n    \r\n    refresh();\r\n\r\n    // Workaround to allow FAB for creating an exchange rate to reside\r\n    // in a different scope (for layout).\r\n    $scope.$watch(function() {\r\n      return balanceSheetService.balanceSheet.getExchangeRates();\r\n    }, debounce(refresh, 50), true);\r\n  }\r\n\r\n  function refresh() {\r\n    vm.exchangeRates = balanceSheetService.balanceSheet.getExchangeRates();\r\n  }\r\n\r\n  function openExchangeRateDialog() {\r\n\r\n    return $mdDialog.show({\r\n      templateUrl: \"currencies/exchange-rate-dialog.html\",\r\n      controller: \"ExchangeRateDialogCtrl as vm\"\r\n    }).then(function(quotation) {\r\n      updateExchangeRate(quotation);\r\n    });\r\n\r\n  }\r\n\r\n  function updateExchangeRate(exchangeRate) {\r\n    try {\r\n      balanceSheetService.balanceSheet.addOrUpdateExchangeRate(exchangeRate);\r\n      $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n      refresh();\r\n    } catch (e) {\r\n      $log.error(e);\r\n    }\r\n  }\r\n\r\n  function removeExchangeRate(exchangeRate) {\r\n    balanceSheetService.balanceSheet.removeExchangeRate(exchangeRate);\r\n    _.remove(vm.exchangeRates, exchangeRate);\r\n    $scope.$emit(events.BALANCE_SHEET_UPDATED);\r\n    refresh();\r\n  }\r\n\r\n}\r\n\r\nfunction ExchangeRateDialogCtrl($mdDialog) {\r\n  var vm = this;\r\n\r\n  vm.ok = ok;\r\n  vm.cancel = cancel;\r\n  vm.init = init;\r\n\r\n  init();\r\n\r\n  function init() {\r\n    vm.quotation = {};\r\n  }\r\n\r\n  function ok() {\r\n    $mdDialog.hide(vm.quotation);\r\n  }\r\n\r\n  function cancel() {\r\n    $mdDialog.cancel();\r\n  }\r\n\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/currencies/currency-list-ctrl.js","var map = {\n\t\"./ic_add_24px.svg\": 75,\n\t\"./ic_attach_money_24px.svg\": 76,\n\t\"./ic_chevron_right_24px.svg\": 77,\n\t\"./ic_close_24px.svg\": 78,\n\t\"./ic_delete_24px.svg\": 79,\n\t\"./ic_face_24px.svg\": 80,\n\t\"./ic_home_24px.svg\": 81,\n\t\"./ic_more_vert_24px.svg\": 82,\n\t\"./ic_shopping_basket_24px.svg\": 83,\n\t\"./ic_warning_24px.svg\": 84\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 74;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/resources/icons ^\\.\\/.*$\n// module id = 74\n// module chunks = 0","module.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTkgMTNoLTZ2NmgtMnYtNkg1di0yaDZWNWgydjZoNnYyeiIvPjwvc3ZnPg==\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/resources/icons/ic_add_24px.svg\n// module id = 75\n// module chunks = 0","module.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTEuOCAxMC45Yy0yLjI3LS41OS0zLTEuMi0zLTIuMTUgMC0xLjA5IDEuMDEtMS44NSAyLjctMS44NSAxLjc4IDAgMi40NC44NSAyLjUgMi4xaDIuMjFjLS4wNy0xLjcyLTEuMTItMy4zLTMuMjEtMy44MVYzaC0zdjIuMTZjLTEuOTQuNDItMy41IDEuNjgtMy41IDMuNjEgMCAyLjMxIDEuOTEgMy40NiA0LjcgNC4xMyAyLjUuNiAzIDEuNDggMyAyLjQxIDAgLjY5LS40OSAxLjc5LTIuNyAxLjc5LTIuMDYgMC0yLjg3LS45Mi0yLjk4LTIuMWgtMi4yYy4xMiAyLjE5IDEuNzYgMy40MiAzLjY4IDMuODNWMjFoM3YtMi4xNWMxLjk1LS4zNyAzLjUtMS41IDMuNS0zLjU1IDAtMi44NC0yLjQzLTMuODEtNC43LTQuNHoiLz48L3N2Zz4=\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/resources/icons/ic_attach_money_24px.svg\n// module id = 76\n// module chunks = 0","module.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTAgNkw4LjU5IDcuNDEgMTMuMTcgMTJsLTQuNTggNC41OUwxMCAxOGw2LTZ6Ii8+PC9zdmc+\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/resources/icons/ic_chevron_right_24px.svg\n// module id = 77\n// module chunks = 0","module.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjwvc3ZnPg==\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/resources/icons/ic_close_24px.svg\n// module id = 78\n// module chunks = 0","module.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNNiAxOWMwIDEuMS45IDIgMiAyaDhjMS4xIDAgMi0uOSAyLTJWN0g2djEyek0xOSA0aC0zLjVsLTEtMWgtNWwtMSAxSDV2MmgxNFY0eiIvPjwvc3ZnPg==\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/resources/icons/ic_delete_24px.svg\n// module id = 79\n// module chunks = 0","module.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNOSAxMS43NWMtLjY5IDAtMS4yNS41Ni0xLjI1IDEuMjVzLjU2IDEuMjUgMS4yNSAxLjI1IDEuMjUtLjU2IDEuMjUtMS4yNS0uNTYtMS4yNS0xLjI1LTEuMjV6bTYgMGMtLjY5IDAtMS4yNS41Ni0xLjI1IDEuMjVzLjU2IDEuMjUgMS4yNSAxLjI1IDEuMjUtLjU2IDEuMjUtMS4yNS0uNTYtMS4yNS0xLjI1LTEuMjV6TTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgMThjLTQuNDEgMC04LTMuNTktOC04IDAtLjI5LjAyLS41OC4wNS0uODYgMi4zNi0xLjA1IDQuMjMtMi45OCA1LjIxLTUuMzdDMTEuMDcgOC4zMyAxNC4wNSAxMCAxNy40MiAxMGMuNzggMCAxLjUzLS4wOSAyLjI1LS4yNi4yMS43MS4zMyAxLjQ3LjMzIDIuMjYgMCA0LjQxLTMuNTkgOC04IDh6Ii8+PC9zdmc+\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/resources/icons/ic_face_24px.svg\n// module id = 80\n// module chunks = 0","module.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTAgMjB2LTZoNHY2aDV2LThoM0wxMiAzIDIgMTJoM3Y4eiIvPjwvc3ZnPg==\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/resources/icons/ic_home_24px.svg\n// module id = 81\n// module chunks = 0","module.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTIgOGMxLjEgMCAyLS45IDItMnMtLjktMi0yLTItMiAuOS0yIDIgLjkgMiAyIDJ6bTAgMmMtMS4xIDAtMiAuOS0yIDJzLjkgMiAyIDIgMi0uOSAyLTItLjktMi0yLTJ6bTAgNmMtMS4xIDAtMiAuOS0yIDJzLjkgMiAyIDIgMi0uOSAyLTItLjktMi0yLTJ6Ii8+PC9zdmc+\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/resources/icons/ic_more_vert_24px.svg\n// module id = 82\n// module chunks = 0","module.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTcuMjEgOWwtNC4zOC02LjU2Yy0uMTktLjI4LS41MS0uNDItLjgzLS40Mi0uMzIgMC0uNjQuMTQtLjgzLjQzTDYuNzkgOUgyYy0uNTUgMC0xIC40NS0xIDEgMCAuMDkuMDEuMTguMDQuMjdsMi41NCA5LjI3Yy4yMy44NCAxIDEuNDYgMS45MiAxLjQ2aDEzYy45MiAwIDEuNjktLjYyIDEuOTMtMS40NmwyLjU0LTkuMjdMMjMgMTBjMC0uNTUtLjQ1LTEtMS0xaC00Ljc5ek05IDlsMy00LjRMMTUgOUg5em0zIDhjLTEuMSAwLTItLjktMi0ycy45LTIgMi0yIDIgLjkgMiAyLS45IDItMiAyeiIvPjwvc3ZnPg==\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/resources/icons/ic_shopping_basket_24px.svg\n// module id = 83\n// module chunks = 0","module.exports = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMSAyMWgyMkwxMiAyIDEgMjF6bTEyLTNoLTJ2LTJoMnYyem0wLTRoLTJ2LTRoMnY0eiIvPjwvc3ZnPg==\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/resources/icons/ic_warning_24px.svg\n// module id = 84\n// module chunks = 0"],"sourceRoot":""}