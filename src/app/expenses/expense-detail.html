<section>

  <div layout="row" layout-margin-sides>
  
    <h2 flex>
      <md-input-container class="no-margin, no-padding">
        <input type="text" ng-model="expense.name" required/>
      </md-input-container> 
    </h2>
    <md-button class="md-icon-button md-warn" ng-click="removeExpense()" aria-label="Delete expense">
      <md-icon md-svg-icon="action:ic_delete_24px"/>
    </md-button>
  </div>
  
  <div layout="column" >
  
    <div layout="row" layout-align="start center" layout-margin-sides>
      <div flex="20">Cost</div>
      <div>{{cost | currency:""}}</div>
    </div>
    
    <div layout="row" layout-align="start center" layout-margin-sides>
      <div flex="20">Share</div>
      <md-radio-group layout="row" ng-model="expense.sharing" ng-change="refresh()">
        <md-radio-button value="equal" style="margin-left: 0">Equally</md-radio-button>
        <md-radio-button value="custom">Custom</md-radio-button>
      </md-radio-group>
    </div>
    
  </div>
  
</section>


<section>
  <md-list>
    <!-- Inputs and the new md-list-item do not seem work. Animation stops etc. Sticking to md-item. -->
    <md-item ng-repeat="person in balanceSheet.persons">
    
      <form novalidate flex layout-margin-sides
        layout="column" layout-align="center start"
        layout-gt-sm="row" layout-align-gt-sm="start center">
        
        <div flex flex-gt-sm="33">
          <md-checkbox ng-model="isParticipant[person.id]" ng-change="setParticipation(person, isParticipant[person.id])">{{person.name}}</md-checkbox>
        </div>
        
        <div flex layout="row" >
          <md-input-container layout-margin-sides>
            <label>Paid</label>
            <input type="number" style="width: 8em" ng-required="isParticipant[person.id]" pattern="(0|[1-9][0-9]*)([,|\.][0-9]{0,2})?"
              ng-model="balanceSheet.getParticipation({person: person, expense: expense}).paid" 
              ng-change="refresh()" 
              ng-disabled="!isParticipant[person.id]" />
          </md-input-container>
          <md-input-container layout-margin-sides>
            <label>Shared</label>
            <input type="number" style="width: 8em" ng-required="isParticipant[person.id]" 
              ng-model="balanceSheet.getParticipation({person: person, expense: expense}).share" 
              ng-disabled="!isParticipant[person.id]"
              ng-readonly="expense.sharing != 'custom'" />
          </md-input-container>
        </div>


      </form>
      
    </md-item>
    
    <md-item>
  
      <div flex layout-margin-sides 
        layout="column" layout-align="center start"
        layout-gt-sm="row" layout-align-gt-sm="start center">

        <div flex flex-gt-sm="33" >
          <span layout-margin-sides ng-if="!expense.isBalanced()" style="color: red;"><md-icon class="md-warn" md-svg-icon="alert:ic_error_24px"></md-icon> Unbalanced</span>
          <span layout-margin-sides ng-if="expense.isBalanced()">Total</span>
        </div>
        
        <div flex layout="row" >
          <md-input-container layout-margin-sides>
            <label>Paid</label>
            <input type="number" style="width: 8em" ng-model="cost" ng-readonly="true" />
          </md-input-container>
          <md-input-container layout-margin-sides>
            <label>Shared</label>
            <input type="number" style="width: 8em" ng-model="sumOfShares" ng-readonly="true"/>
          </md-input-container>
        </div>
        
        <div></div>
        
      </div>
      
    </md-item>
    
  </md-list>
</section>


<section>
  <div layout="column" layout-margin>
    <div flex ng-if="debtsByDebtor.length > 0">
      <p>To settle just this expense</p>
      <md-list>
        <md-item ng-repeat="d in debtsByDebtor">
          <md-item-content layout="column" layout-align="space-between start">
            <div flex>{{d.debtor.name}} pays</div>
            <md-list flex style="padding-left: 16px">
              <md-item ng-repeat="c in d.debts">
                <md-item-content>
                  {{c.creditor.name}}: {{c.amount | currency:""}}
                </md-item-content>
              </md-item>
            </md-list>
          </md-item-content>
        </md-item>
      </md-list>
    </div>
    <div flex ng-if="!debtsByDebtor || debtsByDebtor.length == 0">No debts!</div>
  </div>
</section>